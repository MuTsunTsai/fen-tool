<!DOCTYPE html>
<html lang="en">

<head>
	<title>FEN Tool</title>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, width=device-width, user-scalable=no">
	<meta name="description" content="Quick online tool for chess with features for composing problems and APIs.">
	<link rel="icon" href="./favicon.ico" type="image/x-icon">

	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-4GYC00FPRR"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag() { dataLayer.push(arguments); }
		gtag('js', new Date());
		gtag('config', 'G-4GYC00FPRR');
		if('serviceWorker' in navigator) {
			const scope = location.protocol == "https:" ? "/fen-tool/" : "/";
			navigator.serviceWorker.register('sw.js', { scope });
		}

		// This needs to be added as quickly as possible to prevent glitches
		if(self != top) document.documentElement.classList.add("iframe");
	</script>

	<!-- PWA setup -->
	<link rel="canonical" href="https://mutsuntsai.github.io/fen-tool" />
	<link rel="manifest" href="manifest.json">
	<link rel="icon" type="image/png" sizes="512x512" href="assets/icon/icon-512.png">
	<link rel="icon" type="image/png" sizes="192x192" href="assets/icon/icon-192.png">
	<link rel="icon" type="image/png" sizes="96x96" href="assets/icon/icon-96.png">
	<link rel="icon" type="image/png" sizes="48x48" href="assets/icon/icon-48.png">
	<link rel="icon" type="image/png" sizes="32x32" href="assets/icon/icon-32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="assets/icon/icon-16.png">
	<link rel='apple-touch-icon' sizes='192x192' href="assets/icon/icon-192.png">
	<meta name="theme-color" content="#D18B47">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-title" content="FEN Tool">

	<!-- #region iOS splash screens -->
	<link rel="apple-touch-startup-image"
		  media="screen and (device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
		  href="assets/splash/iPhone_14_Pro_Max_landscape.png">
	<link rel="apple-touch-startup-image"
		  media="screen and (device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
		  href="assets/splash/iPhone_14_Pro_landscape.png">
	<link rel="apple-touch-startup-image"
		  media="screen and (device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
		  href="assets/splash/iPhone_14_Plus__iPhone_13_Pro_Max__iPhone_12_Pro_Max_landscape.png">
	<link rel="apple-touch-startup-image"
		  media="screen and (device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
		  href="assets/splash/iPhone_14__iPhone_13_Pro__iPhone_13__iPhone_12_Pro__iPhone_12_landscape.png">
	<link rel="apple-touch-startup-image"
		  media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
		  href="assets/splash/iPhone_13_mini__iPhone_12_mini__iPhone_11_Pro__iPhone_XS__iPhone_X_landscape.png">
	<link rel="apple-touch-startup-image"
		  media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
		  href="assets/splash/iPhone_11_Pro_Max__iPhone_XS_Max_landscape.png">
	<link rel="apple-touch-startup-image"
		  media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
		  href="assets/splash/iPhone_11__iPhone_XR_landscape.png">
	<link rel="apple-touch-startup-image"
		  media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
		  href="assets/splash/iPhone_8_Plus__iPhone_7_Plus__iPhone_6s_Plus__iPhone_6_Plus_landscape.png">
	<link rel="apple-touch-startup-image"
		  media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
		  href="assets/splash/iPhone_8__iPhone_7__iPhone_6s__iPhone_6__4.7__iPhone_SE_landscape.png">
	<link rel="apple-touch-startup-image"
		  media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
		  href="assets/splash/4__iPhone_SE__iPod_touch_5th_generation_and_later_landscape.png">
	<link rel="apple-touch-startup-image"
		  media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
		  href="assets/splash/12.9__iPad_Pro_landscape.png">
	<link rel="apple-touch-startup-image"
		  media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
		  href="assets/splash/11__iPad_Pro__10.5__iPad_Pro_landscape.png">
	<link rel="apple-touch-startup-image"
		  media="screen and (device-width: 820px) and (device-height: 1180px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
		  href="assets/splash/10.9__iPad_Air_landscape.png">
	<link rel="apple-touch-startup-image"
		  media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
		  href="assets/splash/10.5__iPad_Air_landscape.png">
	<link rel="apple-touch-startup-image"
		  media="screen and (device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
		  href="assets/splash/10.2__iPad_landscape.png">
	<link rel="apple-touch-startup-image"
		  media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
		  href="assets/splash/9.7__iPad_Pro__7.9__iPad_mini__9.7__iPad_Air__9.7__iPad_landscape.png">
	<link rel="apple-touch-startup-image"
		  media="screen and (device-width: 744px) and (device-height: 1133px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
		  href="assets/splash/8.3__iPad_Mini_landscape.png">
	<link rel="apple-touch-startup-image"
		  media="screen and (device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
		  href="assets/splash/iPhone_14_Pro_Max_portrait.png">
	<link rel="apple-touch-startup-image"
		  media="screen and (device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
		  href="assets/splash/iPhone_14_Pro_portrait.png">
	<link rel="apple-touch-startup-image"
		  media="screen and (device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
		  href="assets/splash/iPhone_14_Plus__iPhone_13_Pro_Max__iPhone_12_Pro_Max_portrait.png">
	<link rel="apple-touch-startup-image"
		  media="screen and (device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
		  href="assets/splash/iPhone_14__iPhone_13_Pro__iPhone_13__iPhone_12_Pro__iPhone_12_portrait.png">
	<link rel="apple-touch-startup-image"
		  media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
		  href="assets/splash/iPhone_13_mini__iPhone_12_mini__iPhone_11_Pro__iPhone_XS__iPhone_X_portrait.png">
	<link rel="apple-touch-startup-image"
		  media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
		  href="assets/splash/iPhone_11_Pro_Max__iPhone_XS_Max_portrait.png">
	<link rel="apple-touch-startup-image"
		  media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
		  href="assets/splash/iPhone_11__iPhone_XR_portrait.png">
	<link rel="apple-touch-startup-image"
		  media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
		  href="assets/splash/iPhone_8_Plus__iPhone_7_Plus__iPhone_6s_Plus__iPhone_6_Plus_portrait.png">
	<link rel="apple-touch-startup-image"
		  media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
		  href="assets/splash/iPhone_8__iPhone_7__iPhone_6s__iPhone_6__4.7__iPhone_SE_portrait.png">
	<link rel="apple-touch-startup-image"
		  media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
		  href="assets/splash/4__iPhone_SE__iPod_touch_5th_generation_and_later_portrait.png">
	<link rel="apple-touch-startup-image"
		  media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
		  href="assets/splash/12.9__iPad_Pro_portrait.png">
	<link rel="apple-touch-startup-image"
		  media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
		  href="assets/splash/11__iPad_Pro__10.5__iPad_Pro_portrait.png">
	<link rel="apple-touch-startup-image"
		  media="screen and (device-width: 820px) and (device-height: 1180px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
		  href="assets/splash/10.9__iPad_Air_portrait.png">
	<link rel="apple-touch-startup-image"
		  media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
		  href="assets/splash/10.5__iPad_Air_portrait.png">
	<link rel="apple-touch-startup-image"
		  media="screen and (device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
		  href="assets/splash/10.2__iPad_portrait.png">
	<link rel="apple-touch-startup-image"
		  media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
		  href="assets/splash/9.7__iPad_Pro__7.9__iPad_mini__9.7__iPad_Air__9.7__iPad_portrait.png">
	<link rel="apple-touch-startup-image"
		  media="screen and (device-width: 744px) and (device-height: 1133px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
		  href="assets/splash/8.3__iPad_Mini_portrait.png">
	<!-- #endregion -->

	<link href="lib/css/all.min.css" rel="stylesheet" />
	<link href="style.css" rel="stylesheet">

	<script src="main.js" defer></script>
</head>

<body class="m-0" v-scope :class="{split:state.split}">

	<!-- #region Templates -->
	<template id="copyBtn">
		<button type="button" class="btn nowrap" :class="cls" @click="copy" :disabled="dis||state==1">
			<i :class="['fa-solid fa-clipboard', 'fa-spin fa-solid fa-spinner', 'fa-solid fa-check'][state]"></i>&ensp;{{ label }}
		</button>
	</template>

	<template id="checkbox">
		<div class="form-check">
			<input type="checkbox" class="form-check-input" :id="id" :checked="checked()" @change="change" :disabled="disabled()">
			<label class="form-check-label" :for="id">{{ label }}</label>
		</div>
	</template>
	<!-- #endregion -->

	<main class="d-flex justify-content-center p-3">
		<div class="flex-grow-0 text-start" style="max-width: 100%;">

			<!-- FEN header -->
			<div class="w-passive-100">
				<div class="row gx-3 mb-1">
					<div class="col mb-2" style="flex-basis: 15rem; flex-grow:1000;">
						<input type="text" class="form-control" placeholder="Enter FEN here" :readonly="noEditing||undefined"
							   id="FEN" onchange="FEN.update()">
					</div>
					<div v-cloak class="col ps-0 mb-2 text-end" style="white-space:nowrap; flex-basis:max-content;">
						<label class="col-form-label pe-2" v-text="status.pieceCount"></label>
						<button v-if="env.canCopy" class="btn btn-secondary" title="Copy" onclick="FEN.copy()">
							<i class="fa-solid fa-clipboard"></i>
						</button>
						<button v-if="env.canCopy&&env.canPaste" class="btn btn-secondary" :disabled="noEditing" title="Paste"
								onclick="FEN.paste()">
							<i class="fa-solid fa-paste"></i>
						</button>
					</div>
				</div>
			</div>

			<!-- Zone -->
			<div class="text-center">
				<div class="d-inline-blocck" style="overflow: hidden;">
					<div id="Zone" class="d-inline-flex justify-content-center text-center collapse flex-wrap-reverse">
						<div id="EditZone" class="flex-grow-0 pb-4">
							<div class="d-inline-block position-relative">
								<canvas id="SN"></canvas>
								<div id="Squares">
									<div class="play-mask" v-show="noEditing"></div>
								</div>
							</div>
						</div>
						<div id="DragZone" class="flex-grow-0 pb-4">
							<div class="position-relative d-inline-block" style="line-height: 0;">
								<canvas id="CN"></canvas>
								<div class="loader" :class="{show:status.loading}">
									<div class="h-100 d-flex align-items-center justify-content-center">
										<i class="display-1 fa-solid fa-spinner fa-spin"></i>
									</div>
								</div>
								<img id="PV">
							</div>
							<canvas id="TP" class="ms-4" v-show="!hideTemplate">
						</div>
					</div>
				</div>
			</div>

			<div v-cloak class="w-passive-100">

				<!-- Navigation -->
				<div class="mb-3 nav-container" :class="{'mt-n3':hideTemplate}">
					<ul class="nav nav-tabs" style="flex-wrap: nowrap;">
						<li class="nav-item">
							<div class="nav-link" :class="{active:state.tab==0}" @click="state.tab=0">Edit</div>
						</li>
						<li class="nav-item">
							<div class="nav-link" :class="{active:state.tab==1}" @click="state.tab=1">Options</div>
						</li>
						<li class="nav-item">
							<div class="nav-link" :class="{active:state.tab==7}" @click="state.tab=7">Popeye</div>
						</li>
						<li class="nav-item">
							<div class="nav-link" :class="{active:state.tab==6}" @click="state.tab=6">Play</div>
						</li>
						<li class="nav-item">
							<div class="nav-link" :class="{active:state.tab==8}" @click="state.tab=8">Analyze</div>
						</li>
						<li class="nav-item">
							<div class="nav-link" :class="{active:state.tab==2}" @click="state.tab=2">DB</div>
						</li>
						<li class="nav-item" v-if="env.isTaiwan">
							<div class="nav-link" :class="{active:state.tab==4}" @click="state.tab=4">BBS</div>
						</li>
						<li class="nav-item">
							<div class="nav-link" :class="{active:state.tab==5}" @click="state.tab=5">API</div>
						</li>
					</ul>
				</div>

				<div class="d-flex mb-4">
					<!-- Edit -->
					<section :class="{show:state.tab==0}">
						<div class="mb-3">
							<span class="d-inline-block">
								<button type="button" class="btn btn-secondary" onclick="FEN.empty()" :disabled="noEditing">
									<i class="fa-solid fa-trash-can"></i>&ensp;Empty board
								</button>
								<button type="button" class="btn btn-secondary" onclick="FEN.reset()" :disabled="noEditing">
									<i class="fa-solid fa-flag-checkered"></i> &ensp;Starting position
								</button>
							</span>
							<span class="d-inline-block">
								<span class="d-inline-block">
									<button type="button" class="btn btn-secondary" title="Shift leftwards"
											onclick="FEN.shift(-1,0)" :disabled="noEditing">
										<i class="fa-solid fa-arrow-left"></i>
									</button>
									<button type="button" class="btn btn-secondary" title="Shift rightwards"
											onclick="FEN.shift(1,0)" :disabled="noEditing">
										<i class="fa-solid fa-arrow-right"></i>
									</button>
									<button type="button" class="btn btn-secondary" title="Shift upwards"
											onclick="FEN.shift(0,-1)" :disabled="noEditing">
										<i class="fa-solid fa-arrow-up"></i>
									</button>
									<button type="button" class="btn btn-secondary" title="Shift downwards"
											onclick="FEN.shift(0,1)" :disabled="noEditing">
										<i class="fa-solid fa-arrow-down"></i>
									</button>
								</span>
								<span class="d-inline-block">
									<button type="button" class="btn btn-secondary" title="Rotate counterclockwise"
											onclick="FEN.rotate(-1)" :disabled="noEditing">
										<i class="fa-solid fa-rotate-left"></i>
									</button>
									<button type="button" class="btn btn-secondary" title="Rotate clockwise"
											onclick="FEN.rotate(1)" :disabled="noEditing">
										<i class="fa-solid fa-rotate-right"></i>
									</button>
									<button type="button" class="btn btn-secondary" title="Mirror horizontally"
											onclick="FEN.mirror('-')" :disabled="noEditing">
										<i class="fa-solid fa-arrows-left-right"></i>
									</button>
									<button type="button" class="btn btn-secondary" title="Mirror vertically"
											onclick="FEN.mirror('|')" :disabled="noEditing">
										<i class="fa-solid fa-arrows-up-down"></i>
									</button>
								</span>
							</span>
							<span class="d-inline-block">
								<input type="button" class="btn btn-secondary" value="All Black" onclick="FEN.color(-1)"
									   :disabled="noEditing">
								<input type="button" class="btn btn-secondary" value="All Neutral" onclick="FEN.color(0)"
									   :disabled="noEditing">
								<input type="button" class="btn btn-secondary" value="All White" onclick="FEN.color(1)"
									   :disabled="noEditing">
							</span>
							<span class="d-inline-block">
								<input type="button" class="btn btn-secondary" value="Switch side" title="Texts are not converted"
									   onclick="FEN.invert(false)" :disabled="noEditing">
								<input type="button" class="btn btn-secondary" value="Switch case" title="Texts are converted"
									   onclick="FEN.invert(true)" :disabled="noEditing">
							</span>
						</div>
						<div class="text-end">
							<span class="d-inline-block">
								<span v-if="store.feature.janko"
									  v-scope="CopyButton('Create Janko URL', API.copyJanko, 'btn-primary')"></span>
								<span v-if="!env.isTouch" v-scope="CopyButton('Copy image', copyImage, 'btn-primary')"></span>
								<span v-scope="CopyButton('Create image URL', API.copyUrl, 'btn-primary')"></span>
							</span>
							<span class="d-inline-block">
								<button v-if="env.canShare" class="btn btn-primary" onclick="share(this)">
									<i class="fa-solid fa-share-nodes"></i>&ensp;Share image
								</button>
								<a class="btn btn-primary" download="board.png" id="Save" onclick="gtag('event', 'img_save')">
									<i class="fa-solid fa-download"></i>&ensp;Save image
								</a>
							</span>
						</div>
						<div class="mt-3 d-none d-md-block text-end" v-if="env.isTop">
							<div class="d-inline-block">
								<div class="form-check form-switch" v-effect="resize()">
									<input class="form-check-input" type="checkbox" role="switch" id="sSplit"
										   v-model="state.split">
									<label class="form-check-label" for="sSplit">Split window</label>
								</div>
							</div>
						</div>
					</section>

					<!-- Option -->
					<section :class="{show:state.tab==1}" v-effect="saveSettings()">
						<div class="row mb-2">
							<div class="col flex-grow-1" style="flex-basis: 18rem;">
								<div class="row gx-3 mb-2">
									<label class="col-auto col-form-label">Chess set:</label>
									<div class="col">
										<select class="form-select" v-model="store.board.set"
												onchange="Layout.setOption({set:this.value})">
											<option value="1echecs">1Echecs</option>
											<option value="alpha">Alpha</option>
											<option value="goodCompanion">Good Companion</option>
											<option value="kilfiger">Kilfiger</option>
											<option value="merida">Merida</option>
											<option value="mpchess">MPChess</option>
											<option value="skak">Skak</option>
										</select>
									</div>
								</div>
								<div class="row gx-3 mb-2">
									<label class="col-auto col-form-label">Square size:</label>
									<div class="col">
										<select class="form-select" v-model.number="store.board.size"
												onchange="Layout.setOption({size:Number(this.value)})">
											<option value="26">26px</option>
											<option value="32">32px</option>
											<option value="38">38px</option>
											<option value="44">44px</option>
										</select>
									</div>
								</div>
								<div class="mb-2"
									 v-scope="Checkbox('board.exHigh', 'Export to high-resolution image', drawExport)"></div>
								<div class="row gx-3 mb-2">
									<label class="col-auto col-form-label">Background:</label>
									<div class="col">
										<select class="form-select" v-model="store.board.bg" @change="updateBG">
											<option :value="undefined">Default</option>
											<option value="gray">Gray</option>
											<option value="green">Green</option>
											<option value="classic">Classic</option>
										</select>
									</div>
								</div>
								<div class="row gx-3 mb-2">
									<label class="col-auto col-form-label">Board pattern:</label>
									<div class="col">
										<select class="form-select" v-model="store.board.pattern" @change="updateBG">
											<option :value="undefined">Normal</option>
											<option value="inverted">Inverted</option>
											<option value="mono">Uncolored</option>
										</select>
									</div>
								</div>
							</div>
							<div class="col flex-grow-1 mb-2" style="flex-basis: 22rem;">
								<div class="row gx-3">
									<div class="col mb-2" style="flex-basis: 14rem; flex-grow: 10000;">
										<div class="row gx-3">
											<div class="col">
												<div class="input-group">
													<button class="btn btn-secondary px-2" :disabled="store.board.w==1"
															type="button" onclick="Layout.setWidth(-1)">
														<i class="fa-solid fa-minus"></i>
													</button>
													<input type="number" class="form-control text-center px-0" min="1"
														   title="Files" :value="store.board.w" onchange="Layout.setWidth(this)"
														   onfocus="this.select()">
													<button class="btn btn-secondary px-2" type="button"
															onclick="Layout.setWidth(1)">
														<i class="fa-solid fa-plus"></i>
													</button>
												</div>
											</div>
											<label class="col-auto col-form-label">x</label>
											<div class="col">
												<div class="input-group">
													<button class="btn btn-secondary px-2" :disabled="store.board.h==1"
															type="button" onclick="Layout.setHeight(-1)">
														<i class="fa-solid fa-minus"></i>
													</button>
													<input type="number" class="form-control text-center px-0" min="1"
														   title="Rows" :value="store.board.h" onchange="Layout.setHeight(this)"
														   onfocus="this.select()">
													<button class="btn btn-secondary px-2" type="button"
															onclick="Layout.setHeight(1)">
														<i class="fa-solid fa-plus"></i>
													</button>
												</div>
											</div>
										</div>
									</div>
									<div class="col mb-2 text-end">
										<button type="button" class="btn btn-secondary"
												onclick="Layout.setDimension({w:8,h:8})">Reset</button>
									</div>
								</div>
								<div class="row gx-3 mb-2">
									<label class="col-auto col-form-label">Border pattern:</label>
									<div class="col">
										<input type="text" placeholder="Use comma-separated numbers"
											   title="Use comma-separated numbers" class="form-control"
											   :value="store.board.border" onchange="Layout.setBorder(this)">
									</div>
								</div>
								<div v-scope="Checkbox('board.SN', 'Use S for knight', updateSN)"></div>
								<div v-scope="Checkbox('board.blackWhite', 'Black/White neutral piece', redraw)"></div>
								<div class="row align-items-center" v-show="store.board.blackWhite">
									<label class="col-auto col-form-label">Knight offset:</label>
									<div class="col">
										<input type="range" class="form-range" min="0.25" max="0.75" step="0.025"
											   v-model.number="store.board.knightOffset" @input="redraw()">
									</div>
								</div>
								<div class="d-none d-md-block"
									 v-scope="Checkbox('board.collapse', 'Always collapse boards', resize)"></div>
								<div v-scope="Checkbox('board.coordinates', 'Show coordinate labels', toggleCoordinates)"></div>
								<div v-scope="Checkbox('board.fullFEN', 'Show full FEN', toFEN)"></div>
							</div>
						</div>
					</section>

					<!-- API -->
					<section :class="{show:state.tab==5}">
						<div class="mb-2">
							<span
								  v-scope="CopyButton('Copy base64 link', API.copyBase64, 'btn-secondary', !location.protocol.startsWith('http'))"></span>
							<span
								  v-scope="CopyButton('Copy base64 &lt;img&gt; code', API.copyBase64Img, 'btn-secondary', !location.protocol.startsWith('http'))"></span>
						</div>
						<h6>Embed mode</h6>
						<div class="mb-2">
							<span v-scope="CopyButton('Copy embed HTML code', API.copyEmbed, 'btn-secondary')"></span>
							<span v-scope="CopyButton('Copy just the URL', API.copyEmbedUrl, 'btn-secondary')"></span>
						</div>
						<h6>SDK mode</h6>
						<div>
							<span v-scope="CopyButton('Copy SDK script tag', API.copySDK, 'btn-secondary')"></span>
							<span v-scope="CopyButton('Copy SDK &lt;img&gt; code', API.copyImg, 'btn-secondary')"></span>
						</div>
					</section>

					<!-- DB -->
					<section :class="{show:state.tab==2}">
						<div class="row gx-3 mb-2 align-items-center">
							<label class="col-auto col-form-label">Use database: </label>
							<div class="col">
								<div class="form-check d-inline-block me-3">
									<input class="form-check-input" type="radio" :checked="store.DB.use=='PDB'"
										   @change="store.DB.use='PDB'" name="DB" id="rPDB">
									<label class="form-check-label" for="rPDB">
										PDB
									</label>
								</div>
								<div class="form-check d-inline-block">
									<input class="form-check-input" type="radio" :checked="store.DB.use=='YACPDB'"
										   @change="store.DB.use='YACPDB'" name="DB" id="rYACPDB">
									<label class="form-check-label" for="rYACPDB">
										YACPDB
									</label>
								</div>
							</div>
						</div>
						<div class="mb-3">
							<span v-scope="CopyButton('Copy board edit syntax', ()=>DB.copyEdit, 'btn-primary')"></span>
							<span v-scope="CopyButton('Copy YACPDB FEN', YACPDB.copyFEN, 'btn-secondary')"
								  v-if="store.DB.use=='YACPDB'"></span>
						</div>
						<div class="row gx-3 mb-3">
							<label class="col-auto col-form-label">Problem Id:</label>
							<div class="col">
								<input type="text" class="form-control" id="DB" :readonly="noEditing||undefined">
							</div>
							<div class="col-auto">
								<input type="button" class="btn btn-primary" value="Get FEN" @click="DB.fetch($event.target)"
									   :disabled="noEditing">
							</div>
						</div>
						<div class="row align-items-center flex-wrap">
							<div class="col-auto mb-2">
								<div v-scope="Checkbox('DB.exact', 'Search exactly these pieces')"></div>
							</div>
							<div class="col text-end" style="flex-basis: 24rem;">
								<span v-scope="CopyButton('Copy search query', ()=>DB.copyQuery, 'btn-secondary')"></span>
								<button class="btn btn-primary nowrap" @click="DB.search">
									<i class="fa-solid fa-magnifying-glass"></i>&ensp;Search position
								</button>
							</div>
						</div>
					</section>

					<!-- Play -->
					<section :class="{show:state.tab==6}" v-effect="saveSession()">
						<!-- Playing -->
						<div v-if="state.play.playing">
							<div class="mb-3">
								<button type="button" class="py-0 btn btn-secondary" @click="PLAY.move(-1)"
										:disabled="state.play.moveNumber<0">
									<i class="fa-solid fa-angles-left fa-fw"></i>
								</button>
								<button type="button" class="py-0 btn btn-secondary" @click="PLAY.moveBy(-1)"
										:disabled="state.play.moveNumber<0">
									<i class="fa-solid fa-angle-left fa-fw"></i>
								</button>
								<button type="button" class="py-0 btn btn-secondary" @click="PLAY.moveBy(1)"
										:disabled="state.play.moveNumber>=state.play.history.length-1">
									<i class="fa-solid fa-angle-right fa-fw"></i>
								</button>
								<button type="button" class="py-0 btn btn-secondary"
										@click="PLAY.move(state.play.history.length-1)"
										:disabled="state.play.moveNumber>=state.play.history.length-1">
									<i class="fa-solid fa-angles-right fa-fw"></i>
								</button>
								<span>
									<span class="btn step px-1 py-0 ms-3" @click="PLAY.goto()"
										  :class="{active:-1==state.play.moveNumber}">*</span>
								</span>
								<span v-for="(h,i) in state.play.history">
									<span v-if="state.play.history[i-1]&&state.play.history[i-1].color==h.color">
										<span v-if="h.color=='w'"> ... </span>
										<span v-else>{{PLAY.number(h)}}...</span>
									</span>
									<span v-if="h.color=='b'&&i==0" class="ms-2">{{PLAY.number(h)}}...</span>
									<span v-if="h.color=='w'" class="ms-2">{{PLAY.number(h)}}.</span>
									<span class="btn step px-1 py-0" @click="PLAY.move(i)"
										  :class="{active:i==state.play.moveNumber}">{{PLAY.format(h)}}</span>
								</span>
								<span v-if="state.play.mode!='retro'&&state.play.over==1">Checkmate.</span>
								<span v-if="state.play.mode!='retro'&&state.play.over==2">Draw.</span>
							</div>
							<div>
								<button class="btn btn-secondary" @click="PLAY.exit">Exit playing</button>
								<span v-scope="CopyButton('Copy game', PLAY.copyGame, 'btn-primary')"></span>
								<span v-scope="CopyButton('Copy PGN', PLAY.copyPGN, 'btn-primary')"></span>
								<button v-if="env.canPaste" class="btn btn-secondary" @click="PLAY.pasteMoves">
									<i class="fa-solid fa-paste"></i> Paste moves
								</button>
							</div>
							<div class="mt-2">
								<span class="me-3">Symbol:</span>
								<div class="form-check d-inline-block me-3">
									<input class="form-check-input" type="radio" :checked="store.PLAY.symbol==null"
										   @change="store.PLAY.symbol=null" name="SYM" id="sEng">
									<label class="form-check-label" for="sEng">
										English
									</label>
								</div>
								<div class="form-check d-inline-block me-3">
									<input class="form-check-input" type="radio" :checked="store.PLAY.symbol=='german'"
										   @change="store.PLAY.symbol='german'" name="SYM" id="sGer">
									<label class="form-check-label" for="sGer">
										German
									</label>
								</div>
								<div class="form-check d-inline-block">
									<input class="form-check-input" type="radio" :checked="store.PLAY.symbol=='unicode'"
										   @change="store.PLAY.symbol='unicode'" name="SYM" id="sUni">
									<label class="form-check-label" for="sUni">
										Unicode
									</label>
								</div>
							</div>
							<div class="mt-2" v-if="state.play.mode!='retro'">
								<span v-scope="Checkbox('PLAY.ep', 'Add ep to en passant moves')"></span>
							</div>
							<div class="mt-2">
								<span v-scope="Checkbox('PLAY.zero', 'Use number 0 for castling notation')"></span>
							</div>
							<div class="mt-2" v-if="state.play.mode=='retro'">
								<span v-scope="Checkbox('PLAY.negative', 'Use negative numbers in retro mode')"></span>
							</div>
						</div>
						<!-- Not playing -->
						<template v-else>
							<div v-effect="updateEdwards()">
								<button class="btn btn-primary" @click="PLAY.start" :disabled="state.popeye.playing">Start
									playing</button>
								<button type="button" class="btn btn-secondary" onclick="FEN.reset()" @click="PLAY.reset"
										:disabled="state.popeye.playing">
									<i class="fa-solid fa-flag-checkered"></i> &ensp;Starting position
								</button>
								<button class="btn btn-secondary" @click="PLAY.pasteGame" :disabled="state.popeye.playing">
									<i class="fa-solid fa-paste"></i> Paste PGN
								</button>
							</div>
							<div class="mt-2 gx-3 row">
								<div class="col flex-grow-1" style="flex-basis: 22rem;">
									<div class="d-flex align-items-center flex-wrap-reverse mb-2">
										<div class="flex-grow-1 col-form-label" style="flex-basis: max-content;">
											<span class="me-3">Turn:</span>
											<div class="form-check d-inline-block me-3">
												<input class="form-check-input" type="radio" :checked="state.play.turn=='w'"
													   :disabled="state.play.mode=='pass'" @change="state.play.turn='w'"
													   name="TURN" id="wTurn">
												<label class="form-check-label" for="wTurn">
													White
												</label>
											</div>
											<div class="form-check d-inline-block me-3">
												<input class="form-check-input" type="radio" :checked="state.play.turn=='b'"
													   :disabled="state.play.mode=='pass'" @change="state.play.turn='b'"
													   name="TURN" id="bTurn">
												<label class="form-check-label" for="bTurn">
													Black
												</label>
											</div>
										</div>
										<div class="flex-grow-1" style="flex-basis: max-content;">
											<div class="row gx-3">
												<label class="col-auto col-form-label">Mode:</label>
												<div class="col">
													<select class="form-select" v-model="state.play.mode" @change="updateBG">
														<option value="normal">Normal</option>
														<option value="pass">Allow passing move</option>
														<option value="retro">Retro</option>
													</select>
												</div>
											</div>
										</div>
									</div>
									<div class="mb-2">
										Castling:
										<span class="d-inline-block">
											<span v-scope="CheckboxR('state.play.castle.K', 'WK')"
												  class="ms-2 d-inline-block"></span>
											<span v-scope="CheckboxR('state.play.castle.Q', 'WQ')"
												  class="ms-2 d-inline-block"></span>
										</span>
										<span class="d-inline-block">
											<span v-scope="CheckboxR('state.play.castle.k', 'BK')"
												  class="ms-2 d-inline-block"></span>
											<span v-scope="CheckboxR('state.play.castle.q', 'BQ')"
												  class="ms-2 d-inline-block"></span>
										</span>
									</div>
								</div>
								<div class="col flex-grow-1" style="flex-basis: 22rem;">
									<div class="row gx-3 mb-2">
										<label class="col-auto col-form-label">En passant square: </label>
										<div class="col">
											<input type="text" class="form-control" maxlength="2" v-model="state.play.enPassant"
												   :disabled="state.play.mode=='retro'">
										</div>
									</div>
									<div class="row gx-3">
										<div class="col mb-2" style="flex-basis: 10.5rem;">
											<div class="row gx-3">
												<label class="col-auto col-form-label">Half moves: </label>
												<div class="col">
													<input type="number" class="form-control" min="0"
														   v-model.number="state.play.halfMove"
														   :disabled="state.play.mode=='retro'">
												</div>
											</div>
										</div>
										<div class="col mb-2" style="flex-basis: 10.5rem;">
											<div class="row gx-3">
												<label class="col-auto col-form-label">Full moves: </label>
												<div class="col">
													<input type="number" class="form-control" min="1"
														   v-model.number="state.play.fullMove"
														   :disabled="state.play.mode=='retro'">
												</div>
											</div>
										</div>
									</div>
									<div class="text-end">
										<button class="btn btn-secondary" @click="PLAY.reset">Reset settings</button>
									</div>
								</div>
							</div>
						</template>
					</section>

					<!-- Analyze -->
					<section :class="{show:state.tab==8}">
						<div v-if="status.stockfish.status<2">
							<div class="mb-3">To use this feature, we need to download Stockfish modules first.</div>
							<button v-if="status.stockfish.status==0" type="button" class="btn btn-primary"
									@click="Stockfish.download">
								<i class="fa-solid fa-download"></i>&ensp;Download now! (39.5MB)
							</button>
							<button v-else type="button" class="btn btn-primary" disabled>
								<i class="fa-solid fa-download"></i>&ensp;Downloading...&ensp;<i
								   class="fa-solid fa-spinner fa-spin"></i>
							</button>
						</div>
						<div v-else-if="status.stockfish.status==2">
							<div class="mb-3">Download complete. Please restart FEN Tool.</div>
							<button v-else type="button" class="btn btn-primary" onclick="location.reload()">
								<i class="fa-solid fa-rotate-right"></i>&ensp;Restart FEN Tool now
							</button>
						</div>
						<div v-else v-show="state.tab==8">
							<div class="row align-items-baseline" v-if="status.stockfish.running<2">
								<div class="col" style="flex-basis: 12rem;">
									<div class="row gx-3 mb-2">
										<label class="col-auto col-form-label">Search depth:</label>
										<div class="col">
											<input type="number" class="form-control" v-model.number="store.Stockfish.depth"
												   min="1">
										</div>
									</div>
								</div>
								<div class="col" style="flex-basis: 8rem;">
									<div class="row gx-3 mb-2">
										<label class="col-auto col-form-label">Lines:</label>
										<div class="col">
											<input type="number" class="form-control" v-model.number="store.Stockfish.lines"
												   min="1">
										</div>
									</div>
								</div>
								<div class="col mb-2" style="flex-basis: 10rem;">
									<div v-scope="Checkbox('Stockfish.study', 'Study mode', null, ()=>store.Stockfish.lines<=1)">
									</div>
								</div>
							</div>
							<!-- Start button -->
							<div>
								<button v-if="!status.stockfish.running" type="button" class="btn btn-primary"
										@click="Stockfish.analyze">
									<i class="fa-solid fa-play"></i>&ensp;Analyze with Stockfish 16
								</button>
								<button v-else-if="status.stockfish.running==1" disabled class="btn btn-primary">
									<i class="fa-solid fa-play"></i>&ensp;Initializing...
								</button>
								<button v-else type="button" class="btn btn-secondary"
										@click="Stockfish.stop">
									<i class="fa-solid fa-stop"></i>&ensp;Stop
								</button>
							</div>
							<!-- Output -->
							<div class="mt-3">
								<div v-if="state.stockfish.depth">
									<span>Depth: {{state.stockfish.depth}}</span><span
										  v-if="status.stockfish.running">/{{store.Stockfish.depth}}</span>
								</div>
								<div v-if="state.stockfish.header.length">
									Solution is unique against best defense up to {{state.stockfish.header.length/2}}
									move{{state.stockfish.header.length>2?"s":""}}<span v-if="status.stockfish.running==0">, and
										then {{Stockfish.then()}}.</span><span v-else>...</span>
								</div>
								<div v-if="state.stockfish.mate">{{(state.stockfish.mate||"")[0]}} has mate in
									{{(state.stockfish.mate||"")[1]}}</div>
								<div v-else-if="state.stockfish.score">Score: {{state.stockfish.score}}</div>
								<table class="table">
									<tr v-for="line in state.stockfish.lines.filter(l=>l&&l.moves.length)">
										<td class="align-top">
											<div>{{line.score}}</div>
											<div class="mt-2">
												<button type="button" class="btn btn-primary px-2 py-0" title="Play this line"
														@click="Stockfish.play(line)">
													<i class="fa-solid fa-play"></i>
												</button>
											</div>
										</td>
										<td class="align-top" v-text="Stockfish.format(line.moves)"></td>
									</tr>
								</table>
							</div>
						</div>
					</section>

					<!-- Popeye -->
					<section :class="{show:state.tab==7}">
						<div v-show="!state.popeye.playing&&!state.popeye.editMap">
							<textarea class="form-control mb-2" rows="5" v-model="state.popeye.input"
									  :disabled="state.popeye.running" placeholder="For example:
=============
Stipulation #2
Option Variation"></textarea>
							<div class="mb-3 row">
								<div class="col">
									<button type="button" class="btn btn-secondary m-0" @click="Popeye.editMap"
											:disabled="state.popeye.running">
										Edit fairy piece mapping
									</button>
								</div>
								<div class="col-auto text-end">
									<button type="button" class="btn btn-secondary m-0" @click="Popeye.play"
											:disabled="state.popeye.error" v-if="!state.popeye.running&&state.popeye.output">
										Play solution
									</button>
									<span v-if="!state.popeye.running">
										<button type="button" class="btn btn-primary m-0 disabled"
												v-if="state.play.playing||!state.popeye.input.trim()"
												:title="state.play.playing?'Need to exit play mode first':'Input instructions first'">
											<i class="fa-solid fa-play"></i>&ensp;Run
										</button>
										<button type="button" class="btn btn-primary m-0" @click="Popeye.run" v-else
												title="Run Popeye on your device!">
											<i class="fa-solid fa-play"></i>&ensp;Run
										</button>
									</span>
									<button v-else type="button" class="btn btn-secondary m-0" @click="Popeye.cancel">
										<i class="fa-solid fa-stop"></i>&ensp;Cancel
									</button>
								</div>
							</div>
						</div>
						<div v-if="!state.popeye.playing&&state.popeye.editMap">
							<textarea class="form-control mb-2" rows="5" v-model="state.popeye.mapping"
									  placeholder="Use the format like *2Q=G for each line."></textarea>
							<div class="mb-3 row">
								<div class="col">
									<button type="button" class="btn btn-primary m-0" @click="Popeye.saveMap">
										Save setting
									</button>
									<button type="button" class="btn btn-secondary m-0" @click="state.popeye.editMap=false">
										Cancel
									</button>
								</div>
								<div class="col-auto text-end">
									<button type="button" class="btn btn-secondary m-0" @click="Popeye.resetMap">
										Reset
									</button>
								</div>
							</div>
						</div>
						<div class="mb-3 row" v-if="state.popeye.playing">
							<div class="col">
								<button type="button" class="btn btn-secondary" @click="Popeye.move(0)"
										:disabled="state.popeye.index<=0">
									<i class="fa-solid fa-angles-left fa-fw"></i>
								</button>
								<button type="button" class="btn btn-secondary" @click="Popeye.moveBy(-1)"
										:disabled="state.popeye.index<=0">
									<i class="fa-solid fa-angle-left fa-fw"></i>
								</button>
								<button type="button" class="btn btn-secondary" @click="Popeye.moveBy(1)"
										:disabled="state.popeye.index>=state.popeye.steps.length-1">
									<i class="fa-solid fa-angle-right fa-fw"></i>
								</button>
								<button type="button" class="btn btn-secondary" @click="Popeye.move(state.popeye.steps.length-1)"
										:disabled="state.popeye.index>=state.popeye.steps.length-1">
									<i class="fa-solid fa-angles-right fa-fw"></i>
								</button>
							</div>
							<div class="col-auto text-end">
								<button type="button" class="btn btn-secondary" @click="Popeye.exit">
									Exit playing
								</button>
							</div>
						</div>
						<div id="Output" v-show="state.popeye.output&&state.tab==7" class="form-control"
							 v-html="state.popeye.output" @click="Popeye.step($event)">
						</div>
						<div class="mt-2">
							<a href="https://github.com/thomas-maeder/popeye/blob/master/py-engl.txt" target="_blank">
								Popeye documentation
							</a>
						</div>
					</section>

					<!-- BBS -->
					<section :class="{show:state.tab==4}" v-if="env.isTaiwan">
						<div class="row gx-3">
							<div class="col flex-grow-1 mb-3" style="flex-basis: max-content;">
								<div v-scope="Checkbox('BBS.Id', 'Include database Id')"></div>
								<div v-scope="Checkbox('BBS.coordinates', 'Include Coordinates')"></div>
								<div v-scope="Checkbox('BBS.notes', 'Include Notes')"></div>
								<div v-scope="Checkbox('BBS.uncoloredNotes', 'Uncolored Note')"></div>
								<div v-scope="Checkbox('BBS.redBlue', 'Use Red and Blue in BBS Code')"></div>
							</div>
							<div class="col flex-grow-1 text-end">
								<span v-scope="CopyButton('Copy BBS Code', BBS.copy, 'btn-primary')"></span>
							</div>
						</div>
					</section>
				</div>
			</div>

			<hr>
			<!-- Footer -->
			<div class="mb-4 row small">
				<div class="col flex-grow-1" style="flex-basis: max-content;">
					For more information and API, see
					<a href="https://github.com/MuTsunTsai/fen-tool" target="_blank">README</a>
					of this tool on GitHub.
				</div>
				<div class="col-auto text-end">Copyright Â© 2023 Mu-Tsun Tsai</div>
			</div>
		</div>
	</main>
	<iframe v-if="state.split" src="."></iframe>

	<canvas id="CanvasGhost" class="ghost" width="210" height="210"></canvas>
	<canvas id="TemplateGhost" class="ghost"></canvas>
</body>

</html>