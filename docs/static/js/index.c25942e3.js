(()=>{"use strict";var e={9843:function(e,t,n){let o;n.d(t,{O:function(){return f},S:function(){return d}});var a=n(6919),l=n(737);let i=document.currentScript,r="img[fen]",s=document.createElement("iframe");function c(e){let t=new MessageChannel;t.port1.onmessage=t=>{e.src=t.data,e.title=o.getTitle(n,e.dataset)};let n=e.getAttribute("fen"),i=(0,l.D_)(Object.assign({},o.getDefault(),e.dataset)),r=(0,a.A1)(n);r&&Object.assign(i,r);let{w:c,h:u}=(0,l.t_)(i);e.width=c,e.height=u,s.contentWindow.postMessage({fen:n,options:i},"*",[t.port2])}function u(e){e instanceof Element&&(e.matches(r)?c(e):e.querySelectorAll(r).forEach(e=>c(e)))}async function d(e){let t=new URL("../../../api/",i.src);o=e,document.head.appendChild(s),await new Promise(e=>{let n=t=>{t.source==s.contentWindow&&(removeEventListener("message",n),e())};addEventListener("message",n),s.src=t.toString()});let n=document.documentElement;new MutationObserver(e=>{for(let t of e)if("attributes"==t.type){let e=t.attributeName.toLowerCase(),n=e.startsWith("data");t.target==i&&n&&u(document.body),"IMG"==t.target.nodeName&&("fen"==e||n)&&c(t.target)}else for(let e of t.addedNodes)u(e)}).observe(n,{childList:!0,attributes:!0,subtree:!0}),u(n)}function f(){u(document.body)}s.style.display="none"},4109:function(e,t,n){n.d(t,{Ar:function(){return U},SI:function(){return S},l:function(){return y},q_:function(){return _}});var o=n(4881),a=n(4097),l=n(899),i=n(9391),r=n(5547),s=n(3369),c=n(737),u=n(9683),d=n(9843),f=n(2506);let p=document.getElementById("Zone"),m=document.getElementById("DragZone"),h=document.getElementById("EditZone");function g(){return document.body.clientWidth/(i.SB.split?2:1)}async function y(e,t){let n=i.h.board,a={};for(let t in e)a[t]=e[t]!==n[t];Object.assign(n,e);let{border:p,margin:m,w:h,h:y}=(0,c.t_)(n),b=function(e,t,n){let o=w();return g()<(e.w+f._N)*e.size+t.x+4*n.size+4.2*o}(n,m,p);a.mode=b!==i.i7.hor,i.i7.hor=b;let _=a.w||a.h;(_||t)&&(0,s.co)();let k=t||a.set||a.size,U=k||a.border,x=U||_,B=U||a.mode;B&&function(e,t,n){let o=(f._N*e+2*t)*u.u,a=(f.Dm*e+2*t)*u.u;i.i7.hor?[o,a]=[a+n.x*u.u,o]:a+=n.y*u.u,(l.in.width!==o||l.in.height!==a)&&(l.Ab.width=l.in.width=o,l.Ab.height=l.in.height=a)}(n.size,p.size,m),x&&function(e,t){let n=e*u.u,o=t*u.u;(l.m8.width!==n||l.m8.height!==o)&&(l.ut.width=l.S8.width=l.m8.width=n,l.ut.height=l.S8.height=l.m8.height=o),(0,r.Sk)(l.ut.getContext("2d"))}(h,y),S(),k&&(await (0,r.zD)(),i.h.project.length&&(0,d.O)()),x&&(0,r.ii)(),B&&(0,r.t1)(),(0,o.Y3)(S)}document.addEventListener("visibilitychange",()=>{"visible"==document.visibilityState&&((0,r.ii)(),(0,r.t1)())});function b(e){let{w:t,h:n}=i.h.board,o=(0,s.Ox)();y(e),(0,s.v)(o,t,n)}function S(){p.style.maxWidth="calc(".concat(g(),"px + 1rem)"),l.m8.style.width=l.m8.width/u.u+"px",l.in.style.width=l.in.width/u.u+"px";let{w:e}=i.h.board,t=(0,i.nj)(void 0,void 0,f.Dm);if(i.i7.hor){if(e>f.Dm)l.in.style.width=t.width+"px";else if(e<f.Dm){let{width:t}=(0,i.nj)(l.in,!0,e);l.m8.style.width=t+"px"}}s.nC.style.borderWidth="".concat(t.offset.y,"px ").concat(t.offset.r,"px ").concat(t.offset.b,"px ").concat(t.offset.x,"px");let n=w();i.h.board.collapse?(p.style.width="120%",p.style.width=m.clientWidth+4*n+"px"):p.style.width="unset",l.S8.style.width=l.m8.clientWidth+"px",l.S8.style.height=l.m8.clientHeight+"px",l.Ab.style.width=l.in.clientWidth+"px",l.Ab.style.height=l.in.clientHeight+"px",(0,s.gg)(t.s);p.clientWidth<m.clientWidth+l.m8.clientWidth+6*n?(h.style.marginTop=-m.clientHeight+"px",h.style.width=m.clientWidth+"px",i.i7.collapse=!0):(h.style.marginTop="0",h.style.width="unset",i.i7.collapse=!1)}function w(){return parseFloat(getComputedStyle(document.documentElement).fontSize)}async function _(){window.addEventListener("resize",()=>y({}));let e=i.yC.get("fen");await y({},!0),s.uz.draw=r.ii,s.uz.setOption=y,e?((0,s.dd)(e,!0),(0,s.qA)()):(0,s.uu)(),setTimeout(S,f.WT)}if(u.O.isTop)window.resizeIframe=function(){let e=document.getElementsByTagName("iframe")[0];e&&(e.style.minHeight=e.contentDocument.body.scrollHeight+"px")};else{function k(){try{parent.resizeIframe()}catch{}}"undefined"!=typeof ResizeObserver?new ResizeObserver(k).observe(document.body):new MutationObserver(k).observe(document.body,{childList:!0}),k()}let U={setDimension:b,setBorder(e){let t=(0,c.By)(e.value);t?(e.value=t,y({border:t})):e.value=i.h.board.border},get set(){return i.h.board.set},set set(v){y({set:v})},get size(){return i.h.board.size},set size(v){y({size:v})},get height(){return i.h.board.h},set height(v){b({h:v})},get width(){return i.h.board.w},set width(v){b({w:v})}};addEventListener("storage",e=>{if(e.storageArea==localStorage&&"settings"==e.key){let e=localStorage.getItem("settings"),t=e?JSON.parse(e):null;(0,a.n)(i.h,t,!0),y({},!0)}})},3369:function(e,t,n){n.d(t,{Ox:function(){return D},Qt:function(){return j},RI:function(){return m},Wc:function(){return T},X4:function(){return z},ZD:function(){return W},co:function(){return y},dd:function(){return x},gg:function(){return g},gx:function(){return V},mj:function(){return I},nC:function(){return f},oO:function(){return M},qA:function(){return C},tZ:function(){return E},uu:function(){return N},uz:function(){return p},v:function(){return P},xG:function(){return d},xL:function(){return A},zF:function(){return U}});var o=n(4881),a=n(899),l=n(6919),i=n(9391),r=n(6384),s=n(2506),c=n(3276);let u=["K","Q","k","q"],d=Array(s.cb),f=document.getElementById("Squares"),p={},m=(0,o.XI)("");function h(e){var t;null===(t=p.draw)||void 0===t||t.call(p,e)}function g(e){for(let t of(f.style.width=a.m8.clientWidth+"px",f.style.height=a.m8.clientHeight+"px",d))t.style.fontSize=e-10+"px",t.style.lineHeight=e-10+"px"}function y(){let{w:e,h:t}=i.h.board,n=e*t;f.style.gridTemplateColumns="repeat(".concat(e,", 1fr)"),f.style.gridTemplateRows="repeat(".concat(t,", 1fr)");for(let e=0;e<n||e<d.length;e++){if(!d[e]){let t=document.createElement("input");d[e]=t,t.type="text",t.addEventListener("input",_),t.addEventListener("change",w),t.addEventListener("focus",b),t.addEventListener("blur",S),t.classList.add("square"),f.appendChild(t)}d[e].style.display=e<n?"block":"none"}}function b(){if(this.style.zIndex="10",i.i7.collapse){let e=D();e[d.indexOf(this)]="",h(e)}this.select()}function S(){this.style.zIndex="unset",k(this)?N():i.i7.collapse&&h(D())}function w(){k(this),i.i7.collapse&&this.blur(),N()}function _(){if(!i.i7.collapse){let e=D();e[d.indexOf(this)]=(0,l.Fv)(this.value,i.h.board.SN),h(e)}}function k(e,t){let n=(0,l.Fv)(e.value,i.h.board.SN,t),o=n!==e.value;return e.value=n,o}function U(e,t){let n=e.value!==t;e.value=t,k(e),n&&N()}function x(e,t){let n=B(e);m.value=n[0]+(i.h.board.fullFEN?R():""),O(t)}function B(e){let t=e.split(" ");if(t[1]&&t[1].match(/^[wb]$/)&&(i.SB.play.turn=t[1]),t[2]&&t[2].match(/^(-|[kq]+)$/i))for(let e in i.SB.play.castle)i.SB.play.castle[e]=t[2].includes(e);return t[3]&&t[3].match(/^[a-h][36]$/)&&(i.SB.play.enPassant=t[3]),t[4]&&t[4].match(/^\d+$/)&&(i.SB.play.halfMove=Number(t[4])),t[5]&&t[5].match(/^\d+$/)&&(i.SB.play.fullMove=Number(t[5])),t}r.n4.options=i.h.board,r.n4.callback=x;function C(){let e=new URL(location.href).searchParams.get("fen")||l.TP,t=m.value.split(" ")[0],n=t==l.TP?"":"?fen="+encodeURIComponent(t);t!==e&&history.pushState(null,"",n||".")}function D(){let{w:e,h:t}=i.h.board;return d.slice(0,e*t).map(e=>e.value)}function A(){return D().map(e=>(0,l.hv)(e,!1,!0))}function P(e,t,n){let{w:o,h:a}=i.h.board;for(let l=0;l<a;l++)for(let a=0;a<o;a++){let i=d[l*o+a];l<n&&a<t?i.value=e[l*t+a]:i.value=""}N()}function N(){h(E())}function E(){let{w:e,h:t,fullFEN:n}=i.h.board,o=D();return m.value=(0,l.N0)(o,e,t)+(n?R():""),o}addEventListener("popstate",function(){if(i.SB.play.playing)return;let e=new URL(location.href).searchParams.get("fen");e&&x(e,!0)});function I(){let e=function(){let{w:e,h:t}=i.h.board;if(e!=s.Dm||t!=s.Dm)return null;let n=A();for(let e of n)if(""!=e&&!e.match(/^[kqbsnrp]$/i))return null;return(0,l.N0)(n)}();return e?e+R(!0):null}function R(e){let t=i.SB.play;!t.enPassant.match(/^[a-h][36]$/)&&(t.enPassant=""),e&&"pass"==t.mode&&t.enPassant&&"3"==t.enPassant[1]!=("b"==t.turn)&&(t.turn="b"==t.turn?"w":"b");let n="retro"==t.mode;e&&((n||!Number.isSafeInteger(t.halfMove)||t.halfMove<0)&&(t.halfMove=0),(n||!Number.isSafeInteger(t.fullMove)||t.fullMove<1)&&(t.fullMove=1));let o=n?"-":function(e){let t=D(),n="",o=i.SB.play.castle;return e?("K"==t[60]&&(o.K&&"R"==t[63]&&(n+="K"),o.Q&&"R"==t[56]&&(n+="Q")),"k"==t[4]&&(o.k&&"r"==t[7]&&(n+="k"),o.q&&"r"==t[0]&&(n+="q"))):(o.K&&(n+="K"),o.Q&&(n+="Q"),o.k&&(n+="k"),o.q&&(n+="q")),""==n?"-":n}(e),a=n?"-":t.enPassant||"-";return" ".concat(t.turn," ").concat(o," ").concat(a," ").concat(t.halfMove," ").concat(t.fullMove)}function O(e){var t;let n=m.value;W(n);let o=(0,l.C3)(n),a=(0,l.A1)(o),{w:r,h:s}=a||i.h.board,c=(0,l.S3)(o,r,s);null===(t=p.setOption)||void 0===t||t.call(p,{w:r,h:s});let u=o!=n;for(let e=0;e<r*s;e++)d[e].value=c[e],u=k(d[e])||u;u||e||!a?N():h(D())}function W(e){let t=i.SB.play,n=e.split(" ");if(1!=n.length){if(("w"==n[1]||"b"==n[1])&&(t.turn=n[1]),n[2])for(let e of u)t.castle[e]=n[2].includes(e);t.enPassant=n[3]&&"-"!=n[3]?n[3]:"","retro"!=t.mode&&(t.halfMove=Number(n[4]||0),t.fullMove=Number(n[5]||1))}}function M(){let e=!1;for(let t of d)e=k(t,!0)||e;e&&N()}function j(e){for(let t of d)t.readOnly=e}function V(e){if(e.anime){let t=(0,l.N0)(e,i.h.board.w,i.h.board.h);(0,r.jt)(m.value,t,e.anime)}else e.forEach((e,t)=>d[t].value=e),N()}function T(){for(let e of(Object.assign(i.SB.play,{turn:c.Il.white,enPassant:"",halfMove:0,fullMove:1}),u))i.SB.play.castle[e]=!0}let z={update:()=>{B(m.value),O(!0)},empty(){for(let e of d)e.value="";N()},reset(e){var t;null===(t=p.setOption)||void 0===t||t.call(p,{w:8,h:8}),(i.h.board.fullFEN||e)&&T(),x(l.J7)},color(e){for(let t of d){let n=t.value;!n.startsWith("'")&&""!=n&&(n.startsWith("-")&&(n=n.substr(1)),n=n.toLowerCase(),0==e&&(n="-"+n),1==e&&(n=n.toUpperCase()),t.value=n)}N()},fixSN(){for(let e of(gtag("event","fen_fix_sn"),d)){let t=e.value;!t.startsWith("'")&&""!=t&&(e.value=t.replace("s","n").replace("S","N"))}N()},invert(e){V((0,l.U_)(D(),e))}}},3813:function(e,t,n){let o,a,l,i,r,s,c,u,d,f,p,m,h,g;var y=n("4881"),b=n("9391"),S=n("3369"),w=n("4109"),_=n("899"),k=n("5547"),U=n("6384"),x=n("9683"),B=n("375");async function C(e){if(x.O.canCopyImg){let t=await e();return navigator.clipboard.write([new ClipboardItem({"image/png":t})])}throw(0,B.Z)('Image copying is not enabled in your browser.\n\nIf you\'re using Firefox, this can be enabled by the following.\n1. Visit "about:config" in your address bar.\n2. Search for "dom.events.asyncClipboard.clipboardItem".\n3. Toggle its value to true.\n4. Reload this tool.'),Error()}async function D(){if(x.O.canPaste)return await navigator.clipboard.readText();throw(0,B.Z)('Pasting text is not enabled in your browser.\n\nIf you\'re using Firefox on desktops or Firefox Nightly on Android, this can be enabled by the following.\n1. Visit "about:config" in your address bar.\n2. Search for "dom.events.asyncClipboard.readText".\n3. Toggle its value to true.\n4. Reload this tool.'),Error()}var A=n("9857"),P=n("6919"),N=n("3276"),E=n("2506"),I=n("7739");function R(e){let t=b.SB.play,n=t.moveNumber;(n+=e)<-1&&(n=-1),n>t.history.length-1&&(n=t.history.length-1),n!=t.moveNumber&&O(n)}function O(e){let t=b.SB.play,n=t.moveNumber,o=e>=0||0==n;if(Q.goto(t.history[e],o),o){let o=e==n-1,a=t.history[o?n:e],l=a.from+a.to;("k"==a.flags||"q"==a.flags)&&(l+=","+M(a)),(0,U.jt)(a.before,a.after,l,o!=(b.SB.play.mode==N.jl.retro))}}function W(e,t,n){let o=(0,P.MA)(e),l=(0,P.MA)(t);if(b.SB.play.mode==N.jl.retro){let e=a.retract({from:o,to:l,...b.SB.play.retro});return e&&(L(),q()),e}try{let e=a.move({from:o,to:l,promotion:n});if(!e)return!1;if("k"==e.flags||"q"==e.flags)return function(e){let t=(0,P.S3)(e.before),n=e.color==N.Il.white;return t[(0,P.Di)(e.from)]="",t[(0,P.Di)(e.to)]=n?"K":"k",{before:(0,P.N0)(t),after:e.after,move:M(e)}}(e);return!0}catch{return!1}}(0,b.t4)(()=>{if(b.SB.play.playing){let e=b.SB.play;e.playing=!1,Promise.all([(0,k.zD)(),T()]).then(()=>{z(),Q.goto(e.history[e.moveNumber])})}});function M(e){let t=e.color==N.Il.white,n="k"==e.flags,o=t?I.zi:I.TF;return(n?"h":"a")+o+(n?"f":"d")+o}function j(){(0,S.dd)(a.fen())}function V(e){return a.get((0,P.MA)(e)).color}async function T(){if(!o){let e=await n.e("471").then(n.bind(n,102));!o&&((o=e).Chess.options=b.h.PLAY,a=new o.Chess(b.SB.play),b.i7.module.chess=!0)}return o}function z(){Object.assign(b.SB.play,{playing:!0,pendingPromotion:!1}),(0,S.Qt)(!0),b.SB.play.mode==N.jl.retro?(L(),q()):(0,k.t1)([])}function L(){b.SB.play.retro={uncapture:void 0,unpromote:!1,ep:!1}}function q(){(0,k.t1)(a.turn()==N.Il.black?I.th.wr:I.th.br)}async function F(e){await T();try{a.loadGame(e),j(),z()}catch(e){e instanceof Error&&(0,B.Z)(e.message)}}let Q={async start(){try{let e=(0,S.mj)();if(!e)throw Error("Only orthodox chess is supported.");await T(),a.init(e),b.SB.play.over=a.overState(),z()}catch(e){e instanceof Error&&(0,B.Z)(e.message)}gtag("event","fen_play_"+b.SB.play.mode)},exit(){let e=b.SB.play.initFEN;b.SB.play.playing=!1,b.SB.play.game="",(0,S.dd)(e),(0,S.ZD)(e),(0,S.Qt)(!1),(0,k.t1)([])},goto(e,t){b.SB.play.pendingPromotion&&(b.SB.play.pendingPromotion=!1,(0,k.t1)([]));let n=a.goto(e);!t&&((0,U.p_)(),(0,S.dd)(n)),b.SB.play.mode==N.jl.retro&&(L(),q())},move(e){e!=b.SB.play.moveNumber&&O(e)},moveBy(e){R(e)},copyGame:()=>a.copyGame(),copyPGN:()=>a.copyPGN(),number:e=>o.number(e,b.SB.play.mode),format:e=>o.format(e,b.SB.play.mode),async pasteMoves(){let e=await D();try{a.addMoves(o.parseMoves(e))}catch(e){e instanceof Error&&(0,B.Z)(e.message)}j()},async pasteGame(){let e=await D();await F(e)}},Y=new URL(location.href).searchParams.get("play");null!==Y&&setTimeout(()=>{b.SB.tab=N.mQ.play,F(Y)},0);var K=n("737"),G=n("2519");function H(e){if(e.targetTouches){let t=e.target.getBoundingClientRect(),n=e.targetTouches[0]||e.changedTouches[0];e.clientX=n.clientX,e.clientY=n.clientY,e.offsetX=e.clientX-t.x,e.offsetY=e.clientY-t.y}return e}function Z(e,t){let{s:n,offset:o}=(0,b.nj)(),a=t.getBoundingClientRect(),l=Math.floor((e.clientY-a.top-o.y)/n);return{x:Math.floor((e.clientX-a.left-o.x)/n),y:l}}function $(e,t,n){return(t.x-e.x)*(n.y-e.y)-(n.x-e.x)*(t.y-e.y)}let X={x:0,y:0},J={x:0,y:0},ee=0,et=0,en=performance.now();function eo(e){let t=H(e);"pending"==b.i7.dragging&&function(e,t){let n=e.offsetX-t.x,o=e.offsetY-t.y;return Math.sqrt(n*n+o*o)}(t,X)>5&&(et=0,s?(u=x.O.isTouch?[]:null,function(e,t){ea(),r.style.display="block",t&&(t.value="",(0,S.uu)()),b.i7.dragging=!0,ec(e)}(t,i)):b.i7.dragging=!1),!0===b.i7.dragging&&(u&&u.push({x:t.clientX,y:t.clientY}),ec(t))}function ea(){b.i7.selection=null,(0,k.t1)([])}function el(e){(function(e){if(i&&"pending"==b.i7.dragging&&!b.SB.play.playing&&e.target==_.fr){let t=performance.now();t-ee<300&&i.focus(),ee=t,e.preventDefault(),b.i7.dragging=!1}})(e),r&&(r.style.display="none");let t=H(e);if(function(e){if(performance.now()-et>=250)return!1;if(e.target!=_.in||(0,b.I3)()){if(e.target==_.fr&&b.SB.popeye.playing){let{x:t}=Z(e,_.fr);return t<3&&G.wD.moveBy(-1),t>4&&G.wD.moveBy(1),!0}}else{let{x:t,y:n}=Z(e,_.in);if(b.i7.hor&&([t,n]=[n,t]),eu(t,n,E._N,E.Dm)){let e=k.Kv[n*E._N+t];b.i7.selection==e?b.i7.selection=null:b.i7.selection=e,(0,k.t1)([])}else ea();return b.i7.dragging=!1,!0}return!1}(t)||b.SB.popeye.playing||!b.i7.dragging)return;if(b.i7.dragging=!1,!s)return;let{w:n,h:o}=b.h.board,{x:d,y:f}=Z(t,_.m8),p=f*n+d,m=eu(d,f,n,o);if(b.SB.play.playing){let e;if(m){if(function(e,t){let n=b.SB.play.mode;return n!=N.jl.retro&&(n==N.jl.pass&&V(e)!=a.turn()&&a.switchSide(),!!a.checkPromotion((0,P.MA)(e),(0,P.MA)(t))&&(l=t,b.SB.play.pendingPromotion=!0,(0,k.t1)(a.turn()==N.Il.black?I.th.b:I.th.w),!0))}(c,p))return(0,S.zF)(S.xG[p],s);c!=p&&(e=W(c,p))}"object"==typeof e?(0,U.jt)(e.before,e.after,e.move):j()}else if(m){if((0,S.zF)(S.xG[p],s),i&&u&&u.length>10){var h;er(i,function(e,t){let n=0;for(let o=0,a=t.length-1;o<t.length;a=o++){let l=t[o],i=t[a];i.y<=e.y?l.y>e.y&&$(i,l,e)>0&&n++:l.y<=e.y&&0>$(i,l,e)&&n--}return n}(function(e){let t=0,n=0;for(let o of e)t+=o.x,n+=o.y;return t/=e.length,{x:t,y:n/=e.length}}(h=u),h)>0?N.mi.r90:N.mi.r270)}}else(0,S.qA)()}function ei(e){if((0,b.I3)())return;let{w:t,h:n}=b.h.board,{offset:o,s:a}=(0,b.nj)(),l=Math.floor((e.offsetX-o.x)/a),i=Math.floor((e.offsetY-o.y)/a);if(eu(l,i,t,n)){let n=S.xG[i*t+l];if(""==n.value)return;e.preventDefault();let o=performance.now();if(o-en<50)return;en=o,er(n,e.deltaY>0?N.mi.r90:N.mi.r270)}}function er(e,t){e.value=e.value.replace(/(^-?)(?:\*(\d))?([^-].*$)/,(e,n,o,a)=>{let l=(Number(o||0)+t)%N.mi.full;return n+(l?"*"+l:"")+a}),(0,S.uu)()}function es(e){if(et=performance.now(),b.SB.popeye.playing||b.i7.loading||0!=e.button&&!e.targetTouches||e.targetTouches&&e.targetTouches.length>1)return;let t=H(e);document.activeElement&&document.activeElement.blur();let n=this!=_.in,{offset:o,s:u}=n?(0,b.nj)():(0,b.nj)(_.in,b.i7.hor),{w:d,h:f}=b.h.board;X.x=t.offsetX,X.y=t.offsetY;let[p,m]=[o.x,o.y];J.x=Math.floor((X.x-p)/u),J.y=Math.floor((X.y-m)/u);let h=J.y*(n?d:E._N)+J.x;r=n?_.S8:_.Ab;let g=b.i7.selection;if(n&&g)return function(e,t,n,o,a){if(e.preventDefault(),eu(J.x,J.y,t,n)){let e=S.xG[a];e.value==o?e.value="":e.value=o,(0,S.uu)()}else ea()}(t,d,f,g,h);if(!b.SB.play.playing||(!n&&function(e){if(b.SB.play.pendingPromotion){b.i7.hor&&([J.x,J.y]=[J.y,J.x]);let e="p"==s?0:1;if(J.y>N.wg.k&&J.y<N.wg.p&&J.x==e){var t,n;t=c,n=A.V5[J.y],W(t,l,n)?(l<E.Dm&&(n=n.toUpperCase()),(0,S.zF)(S.xG[l],n)):j(),b.SB.play.pendingPromotion=!1,(0,k.t1)([])}}"retro"==b.SB.play.mode&&(e.preventDefault(),b.i7.hor&&([J.x,J.y]=[J.y,J.x]),!function(e,t){if(2==e)return;let n=b.SB.play.retro,o=0==e==(a.turn()==N.Il.black);if(o){if(N.wg.k<t&&t<N.wg.x){var l;l=A.V5[t],n.uncapture=n.uncapture==l?void 0:l}(t==N.wg.p||t==N.wg.c)&&(n.unpromote=!1)}else t==N.wg.p&&(n.unpromote=!n.unpromote,("p"==n.uncapture||"c"==n.uncapture)&&(n.uncapture=void 0));q()}(J.x,J.y))}(t),!!n&&!!function(e){let t=b.SB.play.mode;if(b.SB.play.pendingPromotion||t!=N.jl.retro&&a.isGameOver())return!1;let n=V(e)==a.turn();return(t==N.jl.pass||n==(t==N.jl.normal))&&!0}(h)))n?(c=h,i=S.xG[h],b.i7.dragging="pending",s=void 0):i=void 0,(!i||""!=i.value)&&function(e,t,n,o){let[a,l]=[n.x,n.y];e.preventDefault(),r.style.clip="rect(".concat(J.y*t+l+1,"px,").concat((J.x+1)*t+a-1,"px,").concat((J.y+1)*t+l-1,"px,").concat(J.x*t+a+1,"px)"),i?s=i.value:(s=b.i7.hor?k.Kv[J.x*E._N+J.y]:k.Kv[o],b.i7.dragging="pending")}(t,u,o,h)}function ec(e){let{offset:t,s:n}=(0,b.nj)(),{w:o,h:a,coordinates:l}=b.h.board,i=_.m8.getBoundingClientRect(),s=r==_.Ab&&l&&!b.i7.hor?i.left+K.Cd:i.left,c=Math.floor((e.clientY-i.top-t.y)/n),d=Math.floor((e.clientX-i.left-t.x)/n);(d!==J.x||c!==J.y)&&(u=null);let{scrollLeft:f,scrollTop:p}=document.documentElement;eu(d,c,o,a)?(r.style.left=s+(d-J.x)*n+f+"px",r.style.top=i.top+(c-J.y)*n+p+"px"):(r.style.left=e.clientX+f+1-X.x+"px",r.style.top=e.clientY+p-X.y+"px")}function eu(e,t,n,o){return t>-1&&t<o&&e>-1&&e<n}var ed=n("9843"),ef=n("4097"),ep=n("2539");function em(e){d.postMessage(e)}(0,b.t4)(()=>{if(b.SB.stockfish.lines.length){let e=b.SB.stockfish.lines,t=b.SB.stockfish.header;b.SB.stockfish.lines=[],b.SB.stockfish.header=[],T().then(n=>{f=n,b.SB.stockfish.lines=e,b.SB.stockfish.header=t})}}),window.cmd=em;let eh="(".concat(ep.SQ,")(").concat(ep.SQ,")([qrbn]?)"),eg="modules/stockfish/",ey=x.O.thread?"":"-single",eb=["".concat(eg,"stockfish-nnue-16.js#stockfish-nnue-16.wasm,worker"),"".concat(eg,"stockfish-nnue-16.wasm"),"".concat(eg,"stockfish-nnue-16-single.js#stockfish-nnue-16-single.wasm,worker"),"".concat(eg,"stockfish-nnue-16-single.wasm"),"".concat(eg,"nn-5af11540bbfe.nnue")];function ev(e){return d?Promise.resolve():new Promise((t,n)=>{b.i7.stockfish.running=N.MI.starting,(d=new Worker("".concat(eg,"stockfish-nnue-16").concat(ey,".js#stockfish-nnue-16").concat(ey,".wasm"))).onmessage=e=>{let n=e.data;console.info(n),"readyok"==n&&(b.i7.stockfish.running=N.MI.running,t()),n.startsWith("info ")&&function(e){let t;if(b.i7.stockfish.running!=N.MI.running)return;let n=e.match(/multipv (\d+)/);if(!n)return;let o=Number(n[1])-1,a=e.match(/mate (-?)(\d+)/),l=e.match(/score cp (-?\d+)/),i=Number(l&&l[1]||0)/100;if(a){let e="w"==m.split(" ")[1]==!!a[1]?"Black":"White";t=Number(a[2])+b.SB.stockfish.header.length/2,0==o&&(b.SB.stockfish.mate=[e,t])}if(0==o){let t=e.match(/depth (\d+)/);t&&(b.SB.stockfish.depth=t[1]),l&&(b.SB.stockfish.score=i)}let r=e.match(new RegExp("pv (".concat(eh,"(?: ").concat(eh,")*)")));if(r){var s;if((null===(s=b.SB.stockfish.lines[o])||void 0===s?void 0:s.raw)==r[1])return;let e=r[1].split(" ").map(e=>e.match(new RegExp(eh)));b.SB.stockfish.moves=[];let t=b.SB.stockfish.header;for(let n of(p.init(t.length?t[t.length-1].after:m),e))if(p.move({from:n[1],to:n[2],promotion:n[3]}).san.endsWith("=")){i=0;break}let n={rawScore:function(e,t){return e?e[1]?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY:t}(a,i),score:a?a[1]+"#"+a[2]:i.toFixed(2),raw:r[1],moves:p.state.history.concat(),pgn:p.copyPGN(t)};b.SB.stockfish.lines[o]=n}b.h.Stockfish.study&&eS()}(n.substring(5)),n.match(new RegExp("^bestmove ".concat(eh)))&&function(){let e=b.h.Stockfish.depth;if(b.h.Stockfish.study&&!(e<4)&&eS()){let t=b.SB.stockfish.header;t.push(...b.SB.stockfish.lines["0"].moves.slice(0,2)),em("position fen "+t[t.length-1].after),em("go depth "+e)}else ek.stop()}()},d.onerror=e=>{e.message.includes("RangeError")?n(-1):e.message.includes("memory")?n("Not enough memory."):n("Unknown error has occurred.")},em("uci"),em("setoption name Use NNUE value true"),x.O.thread&&em("setoption name Threads value "+Math.max(2,navigator.hardwareConcurrency-4)),em("setoption name Hash value "+e),em("isready")})}function eS(){let e=b.SB.stockfish.lines.filter(e=>e&&e.moves.length);if(e.length<=1)return!1;e.forEach(e=>e.moves[0]&&(e.moves[0].annotation=void 0));let t=e.filter(e=>e.rawScore>1);if(t.length>1)return!1;if(1==t.length)return t[0].moves[0].annotation="!",!0;let n=e.filter(e=>e.rawScore>-1);return 1==n.length&&(n[0].moves[0].annotation="!",!0)}async function ew(e){if(200!=(await fetch(e)).status)throw Error()}async function e_(e,t){try{await e}catch(e){if(-1!==e)throw e;if(ek.stop(),(t/=2)<4)throw Error("Not enough memory.");await e_(ev(t),t)}}let ek={async download(){gtag("event","fen_stockfish_download"),b.i7.stockfish.status=N.KO.downloading,isHttps&&"serviceWorker"in navigator&&await navigator.serviceWorker.ready;try{await Promise.all(eb.map(e=>ew(e)))}catch{(0,B.Z)("Download failed. Please check your network connection."),b.i7.stockfish.status=N.KO.notDownloaded;return}b.h.Stockfish.downloaded=!0,b.i7.stockfish.status=N.KO.needReload},async analyze(){try{gtag("event","fen_stockfish_run");let e=ev(128);if(!(m=(0,S.mj)()))throw Error("Only orthodox chess is supported.");if(!f){let e=await T();!f&&(f=e)}(p=new f.Chess).init(m),await e_(e,128),b.SB.stockfish=(0,ef.d)(b.bi),em("setoption name MultiPV value "+b.h.Stockfish.lines),em("ucinewgame"),em("position fen "+m),em("go depth "+b.h.Stockfish.depth)}catch(e){ek.stop(),(0,B.Z)(e instanceof Error?e.message:e),b.i7.stockfish.running=N.MI.stop}},play(e){gtag("event","fen_stockfish_play"),b.SB.play.mode="normal",b.SB.tab=6,F(e.pgn)},stop(){d&&d.terminate(),d=void 0,b.i7.stockfish.running=N.MI.stop},format:e=>f.formatGame(e)};(0,b.t4)(()=>{if(b.SB.syzygy.lines){let e=b.SB.syzygy.lines;e.forEach(e=>e.searching=!1),b.SB.syzygy.lines=[],T().then(t=>{h=t,b.SB.syzygy.lines=e})}});let eU=new Set;function ex(e){return new Promise(t=>{eU.add(t),setTimeout(()=>{eU.delete(t),t()},e*E.WT)})}async function eB(e,t){try{if(!t.running)return null;let n=t.ready;if(t.ready=n.then(()=>ex(1)),await n,!t.running)return null;let o=await fetch("https://tablebase.lichess.ovh/standard?fen="+e);if(429==o.status)return await ex(61),await eB(e,t);return await o.json()}catch{throw Error("Unable to connect to the server. Please check your network connection.")}}async function eC(e){let t=new(h=await T()).Chess;t.init(e.fen);let n=await eB(t.fen(),e),o="w"==t.turn()?"White":"Black",a=n.category;if(b.SB.syzygy.header="The position is a ".concat(a," for ").concat(o,"."),"unknown"==a||a.includes("loss")||!e.running)return;for(let o of(b.SB.syzygy.lines=[],e.outcome=a,e.op=function(e){return"draw"==e?e:eE[eN.indexOf(e)]}(a),n.moves.filter(t=>t.category==e.op))){t.init(e.fen);let[n,a,l]=o.uci.match(/..|./g);t.move({from:n,to:a,promotion:l});let i=t.fen();e.positions.add(eD(i));let r={fen:i,dtm:o.dtm,indent:0,history:t.state.history.concat(),leaf:!0,moves:t.state.history.concat(),pgn:t.copyPGN(),transpose:!1,searching:!t.isGameOver()};b.SB.syzygy.lines.push(r)}if(!e.running)return;let l=b.SB.syzygy.lines.filter(e=>e.searching);if(!(l.length>1))for(l[0].moves[0].annotation="!";l.length;){let t=l.map(t=>eA(t,e));if(await Promise.all(t),l=b.SB.syzygy.lines.filter(e=>e.searching),!e.running)return}}function eD(e){return e.replace(/ \d+ \d+$/,"")}async function eA(e,t){let n=new h.Chess;n.init(e.fen);let o="number"==typeof e.dtm,a=n.moves({verbose:!0}),l=new Set((await eB(e.fen,t)).moves.filter(e=>e.category==t.outcome).map(e=>e.uci)),i=a.filter(e=>l.has(e.from+e.to+(e.promotion||""))).map(e=>eP(e,t,o)),r=(await Promise.all(i)).filter(e=>e).sort((e,t)=>t.score-e.score).filter((e,t,n)=>e.score==n[0].score);if(e.searching&&(e.searching=!1),!t.running)return;let s=r.filter(e=>"draw"!=t.op&&e.moves.length>0||1==e.moves.length);if(0==s.length)return;let c=1==s.length,u=s.map(o=>(function(e,t,n,o,a){o.init(t.fen);let l=o.move(e.defense);n&&(l.annotation="!");let[i,r,s]=e.moves[0].uci.match(/..|./g),c=o.move({from:i,to:r,promotion:s});1==e.moves.length&&(c.annotation="!");let u=o.fen(),d=eD(u),f=a.positions.has(d);!f&&a.positions.add(d);let p=o.state.history.concat();return{dtm:"number"==typeof e.dtm?1-e.dtm:null,fen:u,transpose:f,leaf:!0,indent:t.indent+(n?0:1),history:t.history.concat(p),moves:n?t.moves.concat(p):p,pgn:o.copyPGN(t.history),searching:!o.isGameOver()&&!f}})(o,e,c,n,t)),d=b.SB.syzygy.lines.concat(),f=d.indexOf(e);c?d.splice(f,1,...u):(e.leaf=!1,d.splice(f+1,0,...u)),b.SB.syzygy.lines=d}async function eP(e,t,n){let o=await eB(e.after,t);if(!t.running)return null;let a=o.moves.filter(e=>e.category==t.op);return{score:(n?o.dtm:0)-a.length,json:o,dtm:o.dtm,defense:e,moves:a}}let eN=["win","maybe-win","cursed-win"],eE=["loss","maybe-loss","blessed-loss"],eI={async run(){let e={positions:new Set,running:!0,ready:Promise.resolve()};g=e;try{var t;if(gtag("event","fen_syzygy_run"),b.i7.syzygy.running=!0,b.SB.syzygy.header=null,b.SB.syzygy.lines=null,e.fen=(0,S.mj)(),!e.fen)throw Error("Only orthodox chess is supported.");if((null===(t=e.fen.split(" ")[0].match(/[a-z]/ig))||void 0===t?void 0:t.length)>7)throw Error("Only supports position with up to ".concat(7," pieces."));await eC(e)}catch(e){(0,B.Z)(e instanceof Error?e.message:e)}finally{e.running&&eI.stop()}},play(e){gtag("event","fen_syzygy_play"),b.SB.play.mode="normal",b.SB.tab=6,F(e.pgn)},stop(){var e;for(let e of(g&&(g.running=!1),eU))e();eU.clear(),null===(e=b.SB.syzygy.lines)||void 0===e||e.forEach(e=>e.searching=!1),b.i7.syzygy.running=!1},format(e){let t=h.formatGame(e.moves);return e.searching?t+=" ...":e.transpose&&(t+=" (transpose)"),t}};var eR=n("4486"),eO=n.n(eR);let eW={class:"modal-dialog modal-dialog-centered"},eM={class:"modal-content"},ej=["innerHTML"],eV={class:"modal-footer"},eT=Promise.resolve(),ez=(0,y.aZ)({name:"DialogModal",__name:"dialog",setup(e,t){let n,{expose:o}=t,a=(0,y.XI)();(0,y.bv)(()=>{n=new(eO())(a.value,{backdrop:"static"})});let l=(0,y.XI)("");return o({show:async function e(e,t){let o;let i=eT;return eT=new Promise(e=>{o=e}),await i,new Promise(i=>{l.value=e.replace(/\n/g,"<br>"),a.value.addEventListener("hide.bs.modal",()=>{i()},{once:!0}),a.value.addEventListener("hidden.bs.modal",o,{once:!0}),null==t||t(),n.show()})},hide:()=>n.hide()}),(e,t)=>((0,y.wg)(),(0,y.iD)("div",{class:"modal fade modal-second",ref_key:"el",ref:a},[(0,y._)("div",eW,[(0,y._)("div",eM,[(0,y._)("div",{class:"modal-body",innerHTML:l.value},null,8,ej),(0,y._)("div",eV,[(0,y.WI)(e.$slots,"default")])])])],512))}}),eL=(0,y.aZ)({name:"Alert",__name:"alert",setup(e,t){let{expose:n}=t,o=(0,y.XI)();function a(e){return o.value.show(e)}return(0,y.bv)(()=>B.Z.setup(a)),n({show:a}),(e,t)=>((0,y.wg)(),(0,y.j4)(ez,{ref_key:"dialog",ref:o},{default:(0,y.w5)(()=>t[0]||(t[0]=[(0,y._)("button",{type:"button",class:"btn btn-primary","data-bs-dismiss":"modal"},"OK",-1)])),_:1},512))}}),eq=(0,y.aZ)({name:"Confirm",__name:"confirm",setup(e,t){let{expose:n}=t,o=!1,a=(0,y.XI)();async function l(e){return await a.value.show(e,()=>o=!1),o}function i(){o=!0,a.value.hide()}return(0,y.bv)(()=>B.i.setup(l)),n({show:l}),(e,t)=>((0,y.wg)(),(0,y.j4)(ez,{ref_key:"dialog",ref:a},{default:(0,y.w5)(()=>[t[0]||(t[0]=(0,y._)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"No",-1)),(0,y._)("button",{type:"button",class:"btn btn-primary",onClick:i},"Yes")]),_:1},512))}}),eF={class:"nav-item"},eQ=["title"],eY={class:"d-sm-none"},eK={class:"d-none d-sm-inline"},eG=(0,y.aZ)({__name:"menuTab",props:{index:{},icon:{},title:{}},setup:e=>(e,t)=>((0,y.wg)(),(0,y.iD)("li",eF,[(0,y._)("div",{class:(0,y.C_)(["nav-link",{active:(0,y.SU)(b.SB).tab==e.index}]),onClick:t[0]||(t[0]=t=>(0,y.SU)(b.SB).tab=e.index),title:e.title},[(0,y._)("span",eY,[(0,y._)("i",{class:(0,y.C_)(e.icon)},null,2)]),(0,y._)("span",eK,[(0,y.WI)(e.$slots,"default")])],10,eQ)]))}),eH={class:"nav nav-tabs pe-1",style:{"flex-wrap":"nowrap"}},eZ=(0,y.aZ)({__name:"menu",setup:e=>(e,t)=>((0,y.wg)(),(0,y.iD)("div",{class:(0,y.C_)(["mb-3 nav-container",{"mt-n3":(0,y.SU)(b.u8)()}])},[(0,y._)("ul",eH,[(0,y.Wm)(eG,{index:0,icon:"fa-solid fa-pen-to-square",title:"Edit"},{default:(0,y.w5)(()=>t[0]||(t[0]=[(0,y.Uk)("Edit")])),_:1}),(0,y.Wm)(eG,{index:8,icon:"fa-solid fa-chess-board",title:"Project"},{default:(0,y.w5)(()=>t[1]||(t[1]=[(0,y.Uk)("Project")])),_:1}),(0,y.Wm)(eG,{index:1,icon:"fa-solid fa-gear",title:"Options"},{default:(0,y.w5)(()=>t[2]||(t[2]=[(0,y.Uk)("Options")])),_:1}),(0,y.Wm)(eG,{index:7,icon:"fa-solid fa-calculator",title:"Compute"},{default:(0,y.w5)(()=>t[3]||(t[3]=[(0,y.Uk)("Compute")])),_:1}),(0,y.Wm)(eG,{index:6,icon:"fa-solid fa-gamepad",title:"Play"},{default:(0,y.w5)(()=>t[4]||(t[4]=[(0,y.Uk)("Play")])),_:1}),(0,y.Wm)(eG,{index:2,icon:"fa-solid fa-database",title:"Database"},{default:(0,y.w5)(()=>t[5]||(t[5]=[(0,y.Uk)("DB")])),_:1}),(0,y.SU)(b.i7).envReady&&(0,y.SU)(x.O).isTaiwan?((0,y.wg)(),(0,y.j4)(eG,{key:0,index:4,icon:"fa-solid fa-terminal",title:"BBS"},{default:(0,y.w5)(()=>t[6]||(t[6]=[(0,y.Uk)("BBS")])),_:1})):(0,y.kq)("",!0),(0,y.Wm)(eG,{index:5,icon:"fa-solid fa-share-from-square",title:"API"},{default:(0,y.w5)(()=>t[7]||(t[7]=[(0,y.Uk)("API")])),_:1})])],2))});function e$(e){return new URL(e,location.href).toString()}function eX(){let{SN:e,w:t,h:n}=b.h.board;return e?(0,P.N0)((0,S.xL)(),t,n):S.RI.value}function eJ(){let e=b.h.board,t=eX(),n=e$("gen/?fen="+t);return e.size!=K.Cg&&(n+="&size="+e.size),e.set!=K.z6&&(n+="&set="+e.set),e.pattern&&(n+="&pattern="+e.pattern),e.bg&&(n+="&bg="+e.bg),"1"!=e.border&&(n+="&border="+e.border),e.blackWhite&&(n+="&blackWhite&knightOffset="+e.knightOffset),!(0,P.A1)(t)&&(n+="&w=".concat(e.w,"&h=").concat(e.h)),n}let e0={copyJanko:()=>(gtag("event","fen_copy_janko"),"https://www.janko.at/Retros/d.php?ff="+eX()),copyBase64:()=>(gtag("event","fen_link_copy64"),k.Uw.toDataURL()),copyBase64Img:()=>(gtag("event","fen_link_copy64img"),'<img fen="'.concat(k.Uw.toDataURL(),'">')),async copyUrl(){gtag("event","fen_gen_link");let e=new FormData,t=await (0,k.Br)();e.append("key","7802c5da1788f2315222d44bfba20519"),e.append("image",t,"fen");try{let t=await fetch("https://api.imgbb.com/1/upload",{method:"post",body:e}),n=await t.json();if(!n.success)throw n.error.message;return n.data.url+"?="+eX()}catch(e){throw(0,B.Z)("string"==typeof e?e:"Internet connection failed. Please try again later."),e}},copyEmbed(){gtag("event","fen_copy_embed");let e=b.h.board,t=eJ(),{w:n,h:o}=(0,K.t_)(e);return'<iframe src="'.concat(t,'" style="border:none;width:').concat(n,"px;height:").concat(o,'px"></iframe>')},copyEmbedUrl:()=>(gtag("event","fen_copy_embedUrl"),eJ()),copyImg:()=>(gtag("event","fen_copy_sdkImg"),'<img fen="'.concat(eX(),'">')),copySDK(){gtag("event","fen_copy_sdk");let e=b.h.board,t="";return e.size!=K.Cg&&(t+=' data-size="'.concat(e.size,'"')),e.set!=K.z6&&(t+=' data-set="'.concat(e.set,'"')),e.bg&&(t+=' data-bg="'.concat(e.bg,'"')),"1"!=e.border&&(t+=' data-border="'.concat(e.border,'"')),e.blackWhite&&(t+=' data-black-white="true" data-knight-offset="'.concat(e.knightOffset,'"')),'<script src="'.concat(e$("sdk.js"),'"').concat(t,"><\/script>")}},e1=["disabled"],e2=(0,y.aZ)({__name:"copyButton",props:{class:{},factory:{type:Function},disabled:{type:Boolean}},setup(e){let t=(0,y.XI)(0);async function n(){t.value=1;try{let n=e.factory;for(;"function"==typeof n;)n=await n();"string"==typeof n&&function(e){if(x.O.canCopy)navigator.clipboard.writeText(e);else{let t=document.createElement("input");document.body.appendChild(t),t.value=e,t.select(),document.execCommand("copy"),document.body.removeChild(t)}}(n),t.value=2,setTimeout(()=>t.value=0,E.WT)}catch(e){t.value=0}}return(o,a)=>((0,y.wg)(),(0,y.iD)("button",{type:"button",class:(0,y.C_)(["btn nowrap",e.class]),onClick:n,disabled:o.disabled||1==t.value},[(0,y._)("i",{class:(0,y.C_)(["fa-solid fa-clipboard","fa-spin fa-solid fa-spinner","fa-solid fa-check"][t.value])},null,2),a[0]||(a[0]=(0,y.Uk)(" ")),(0,y.WI)(o.$slots,"default")],10,e1))}}),e3=["disabled"],e8=(0,y.aZ)({__name:"shareButton",setup(e){let t=(0,y.XI)(!1);async function n(){if(gtag("event","fen_img_share"),x.O.canSharePng){let e=[new File([await (0,k.Br)()],"board.png",{type:"image/png"})];navigator.share({files:e})}else{t.value=!0;try{let e=await e0.copyUrl();navigator.share({url:e,text:eX()})}finally{t.value&&(t.value=!1)}}}return(e,o)=>(0,y.SU)(b.i7).envReady&&(0,y.SU)(x.O).canShare?((0,y.wg)(),(0,y.iD)("button",{key:0,class:"btn btn-primary",disabled:t.value,onClick:n},[(0,y._)("i",{class:(0,y.C_)(t.value?"fa-spin fa-solid fa-spinner":"fa-solid fa-share-nodes")},null,2),o[0]||(o[0]=(0,y.Uk)(" Share image "))],8,e3)):(0,y.kq)("",!0)}}),e4={class:"mb-3 btn-gap"},e5={class:"d-inline-block"},e7=["disabled"],e6=["disabled"],e9={class:"btn-group"},te=["disabled"],tt=["disabled"],tn=["disabled"],to=["disabled"],ta={class:"btn-group"},tl=["disabled"],ti=["disabled"],tr=["disabled"],ts=["disabled"],tc={class:"btn-group"},tu=["disabled"],td=["disabled"],tf={key:0,class:"fa-solid fa-chess-king fa-fw shadow-neutral",style:{color:"gray"}},tp=["disabled"],tm={class:"btn-group"},th=["disabled"],tg=["disabled"],ty=["disabled"],tb={class:"text-end btn-gap"},tv={class:"d-inline-block"},tS={class:"d-inline-block"},tw={key:0,class:"mt-3 d-none d-md-block text-end"},t_={class:"d-inline-block"},tk={class:"form-check form-switch"},tU=(0,y.aZ)({__name:"edit",setup(e){function t(e,t){(0,U.p_)(!0);let{w:n,h:o}=b.h.board;(0,S.gx)((0,P.uY)((0,S.Ox)(),e,t,n,o))}function n(e){(0,U.p_)(!0);let{w:t,h:n}=b.h.board;(0,S.gx)((0,P.hD)((0,S.Ox)(),e,t,n))}function o(e){(0,U.p_)(!0);let{w:t,h:n}=b.h.board;t!==n&&(0,w.l)({w:n,h:t}),(0,S.gx)((0,P.U1)((0,S.Ox)(),e,t,n))}return(e,a)=>((0,y.wg)(),(0,y.iD)("section",{class:(0,y.C_)({show:0==(0,y.SU)(b.SB).tab})},[(0,y._)("div",e4,[(0,y._)("span",e5,[(0,y._)("button",{type:"button",class:"btn btn-secondary",onClick:a[0]||(a[0]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,y.SU)(S.X4).empty&&(0,y.SU)(S.X4).empty(...t)}),disabled:(0,y.SU)(b.I3)(),title:"Empty board"},a[17]||(a[17]=[(0,y._)("i",{class:"fa-solid fa-trash-can"},null,-1),(0,y._)("span",null," Empty board",-1)]),8,e7),(0,y._)("button",{type:"button",class:"btn btn-secondary",onClick:a[1]||(a[1]=e=>(0,y.SU)(S.X4).reset()),disabled:(0,y.SU)(b.I3)(),title:"Starting position"},a[18]||(a[18]=[(0,y._)("i",{class:"fa-solid fa-flag-checkered"},null,-1),(0,y._)("span",null," Starting position",-1)]),8,e6)]),(0,y._)("span",e9,[(0,y._)("button",{type:"button",class:"btn btn-secondary",title:"Shift leftwards",onClick:a[2]||(a[2]=e=>t(-1,0)),disabled:(0,y.SU)(b.I3)()},a[19]||(a[19]=[(0,y._)("i",{class:"fa-solid fa-arrow-left"},null,-1)]),8,te),(0,y._)("button",{type:"button",class:"btn btn-secondary",title:"Shift rightwards",onClick:a[3]||(a[3]=e=>t(1,0)),disabled:(0,y.SU)(b.I3)()},a[20]||(a[20]=[(0,y._)("i",{class:"fa-solid fa-arrow-right"},null,-1)]),8,tt),(0,y._)("button",{type:"button",class:"btn btn-secondary",title:"Shift upwards",onClick:a[4]||(a[4]=e=>t(0,-1)),disabled:(0,y.SU)(b.I3)()},a[21]||(a[21]=[(0,y._)("i",{class:"fa-solid fa-arrow-up"},null,-1)]),8,tn),(0,y._)("button",{type:"button",class:"btn btn-secondary",title:"Shift downwards",onClick:a[5]||(a[5]=e=>t(0,1)),disabled:(0,y.SU)(b.I3)()},a[22]||(a[22]=[(0,y._)("i",{class:"fa-solid fa-arrow-down"},null,-1)]),8,to)]),(0,y._)("span",ta,[(0,y._)("button",{type:"button",class:"btn btn-secondary",title:"Rotate counterclockwise",onClick:a[6]||(a[6]=e=>o(-1)),disabled:(0,y.SU)(b.I3)()},a[23]||(a[23]=[(0,y._)("i",{class:"fa-solid fa-rotate-left"},null,-1)]),8,tl),(0,y._)("button",{type:"button",class:"btn btn-secondary",title:"Rotate clockwise",onClick:a[7]||(a[7]=e=>o(1)),disabled:(0,y.SU)(b.I3)()},a[24]||(a[24]=[(0,y._)("i",{class:"fa-solid fa-rotate-right"},null,-1)]),8,ti),(0,y._)("button",{type:"button",class:"btn btn-secondary",title:"Mirror horizontally",onClick:a[8]||(a[8]=e=>n("-")),disabled:(0,y.SU)(b.I3)()},a[25]||(a[25]=[(0,y._)("i",{class:"fa-solid fa-arrows-left-right"},null,-1)]),8,tr),(0,y._)("button",{type:"button",class:"btn btn-secondary",title:"Mirror vertically",onClick:a[9]||(a[9]=e=>n("|")),disabled:(0,y.SU)(b.I3)()},a[26]||(a[26]=[(0,y._)("i",{class:"fa-solid fa-arrows-up-down"},null,-1)]),8,ts)]),(0,y._)("span",tc,[(0,y._)("button",{type:"button",class:"btn btn-secondary px-2",title:"All Black",onClick:a[10]||(a[10]=e=>(0,y.SU)(S.X4).color(-1)),disabled:(0,y.SU)(b.I3)()},a[27]||(a[27]=[(0,y._)("i",{class:"fa-solid fa-chess-king fa-fw text-black shadow-white"},null,-1)]),8,tu),(0,y._)("button",{type:"button",class:"btn btn-secondary px-2",title:"All Neutral",onClick:a[11]||(a[11]=e=>(0,y.SU)(S.X4).color(0)),disabled:(0,y.SU)(b.I3)()},[(0,y.SU)(b.h).board.blackWhite?((0,y.wg)(),(0,y.iD)(y.HY,{key:1},[a[28]||(a[28]=(0,y._)("i",{class:"fa-solid fa-chess-king fa-fw text-black shadow-white"},null,-1)),a[29]||(a[29]=(0,y._)("i",{class:"fa-solid fa-chess-king fa-fw text-white shadow-black",style:{"margin-left":"-1.25em","clip-path":"polygon(51.5% 0, 100% 0, 100% 100%, 51.5% 100%)"}},null,-1))],64)):((0,y.wg)(),(0,y.iD)("i",tf))],8,td),(0,y._)("button",{type:"button",class:"btn btn-secondary px-2",title:"All White",onClick:a[12]||(a[12]=e=>(0,y.SU)(S.X4).color(1)),disabled:(0,y.SU)(b.I3)()},a[30]||(a[30]=[(0,y._)("i",{class:"fa-solid fa-chess-king fa-fw text-white shadow-black"},null,-1)]),8,tp)]),(0,y._)("span",tm,[(0,y._)("button",{type:"button",class:"btn btn-secondary",title:"Switch side",onClick:a[13]||(a[13]=e=>(0,y.SU)(S.X4).invert(!1)),disabled:(0,y.SU)(b.I3)()},a[31]||(a[31]=[(0,y._)("i",{class:"fa-solid fa-chess-king text-black shadow-white"},null,-1),(0,y.Uk)(" "),(0,y._)("i",{class:"fa-solid fa-arrows-left-right"},null,-1),(0,y.Uk)(" "),(0,y._)("i",{class:"fa-solid fa-chess-king text-white shadow-black"},null,-1)]),8,th),(0,y._)("button",{type:"button",class:"btn btn-secondary",title:"Switch case (including text)",onClick:a[14]||(a[14]=e=>(0,y.SU)(S.X4).invert(!0)),disabled:(0,y.SU)(b.I3)()},a[32]||(a[32]=[(0,y.Uk)(" A "),(0,y._)("i",{class:"fa-solid fa-arrows-left-right"},null,-1),(0,y.Uk)(" a ")]),8,tg),(0,y.SU)(b.h).board.SN?(0,y.kq)("",!0):((0,y.wg)(),(0,y.iD)("button",{key:0,type:"button",class:"btn btn-secondary",title:"Change all S to N when 'Use S for knight' mode is off",onClick:a[15]||(a[15]=e=>(0,y.SU)(S.X4).fixSN()),disabled:(0,y.SU)(b.I3)()},a[33]||(a[33]=[(0,y.Uk)(" S "),(0,y._)("i",{class:"fa-solid fa-arrow-right"},null,-1),(0,y.Uk)(" N ")]),8,ty))])]),(0,y._)("div",tb,[(0,y._)("span",tv,[(0,y.SU)(b.h).feature.janko?((0,y.wg)(),(0,y.j4)(e2,{key:0,factory:(0,y.SU)(e0).copyJanko,class:"btn-primary"},{default:(0,y.w5)(()=>a[34]||(a[34]=[(0,y.Uk)("Create Janko URL")])),_:1},8,["factory"])):(0,y.kq)("",!0),(0,y.SU)(b.i7).envReady&&!(0,y.SU)(x.O).isTouch?((0,y.wg)(),(0,y.j4)(e2,{key:1,factory:()=>(0,y.SU)(C)((0,y.SU)(k.Br)),class:"btn-primary"},{default:(0,y.w5)(()=>a[35]||(a[35]=[(0,y.Uk)("Copy image ")])),_:1},8,["factory"])):(0,y.kq)("",!0),(0,y.Wm)(e2,{factory:(0,y.SU)(e0).copyUrl,class:"btn-primary"},{default:(0,y.w5)(()=>a[36]||(a[36]=[(0,y.Uk)("Create image URL")])),_:1},8,["factory"])]),(0,y._)("span",tS,[(0,y.Wm)(e8),a[37]||(a[37]=(0,y._)("a",{class:"btn btn-primary",download:"board.png",id:"Save",onclick:"gtag('event', 'img_save')"},[(0,y._)("i",{class:"fa-solid fa-download"}),(0,y.Uk)(" Save image ")],-1))])]),(0,y.SU)(b.i7).envReady&&(0,y.SU)(x.O).isTop?((0,y.wg)(),(0,y.iD)("div",tw,[(0,y._)("div",t_,[(0,y._)("div",tk,[(0,y.wy)((0,y._)("input",{class:"form-check-input",type:"checkbox",role:"switch",id:"sSplit","onUpdate:modelValue":a[16]||(a[16]=e=>(0,y.SU)(b.SB).split=e)},null,512),[[y.e8,(0,y.SU)(b.SB).split]]),a[38]||(a[38]=(0,y._)("label",{class:"form-check-label",for:"sSplit"},"Split window",-1))])])])):(0,y.kq)("",!0)],2))}}),tx={class:"form-check"},tB=["checked","disabled"],tC=(0,y.aZ)({__name:"checkbox",props:{modelValue:{type:Boolean},disabled:{type:Boolean}},emits:["update:modelValue","change"],setup(e){let t="chk"+(0,y.FN)().uid;return(e,n)=>((0,y.wg)(),(0,y.iD)("div",tx,[(0,y._)("input",{type:"checkbox",class:"form-check-input",id:t,checked:e.modelValue,onChange:n[0]||(n[0]=t=>{e.$emit("update:modelValue",!e.modelValue),e.$emit("change")}),disabled:e.disabled},null,40,tB),(0,y._)("label",{class:"form-check-label",for:t},[(0,y.WI)(e.$slots,"default")])]))}}),tD={class:"input-group"},tA=["disabled"],tP=["title","value"],tN=["disabled"],tE=(0,y.aZ)({__name:"inputNumber",props:{title:{},min:{},max:{},modelValue:{}},emits:["update:modelValue"],setup(e,t){let{emit:n}=t;function o(t){n("update:modelValue",e.modelValue+t)}let a=()=>e.modelValue<=e.min,l=()=>void 0!==e.max&&e.modelValue>=e.max;return(t,i)=>((0,y.wg)(),(0,y.iD)("div",tD,[(0,y._)("button",{class:"btn btn-secondary px-2",disabled:a(),type:"button",onClick:i[0]||(i[0]=e=>o(-1))},i[3]||(i[3]=[(0,y._)("i",{class:"fa-solid fa-minus"},null,-1)]),8,tA),(0,y._)("input",{type:"number",class:"form-control text-center px-0",min:"1",title:t.title,value:e.modelValue,onChange:i[1]||(i[1]=t=>(function(t){let o=t.target,a=e.modelValue,l=Math.round(Number(o.value));isNaN(l)||l<e.min||void 0!==e.max&&l>e.max?o.value=a.toString():n("update:modelValue",l)})(t)),onfocus:"this.select()"},null,40,tP),(0,y._)("button",{class:"btn btn-secondary px-2",disabled:l(),type:"button",onClick:i[2]||(i[2]=e=>o(1))},i[4]||(i[4]=[(0,y._)("i",{class:"fa-solid fa-plus"},null,-1)]),8,tN)]))}}),tI={class:"row mb-2"},tR={class:"col flex-grow-1",style:{"flex-basis":"18rem"}},tO={class:"row gx-3"},tW={class:"col",style:{"flex-basis":"15rem"}},tM={class:"row gx-3 mb-2"},tj={class:"col"},tV={class:"col",style:{"flex-basis":"13rem"}},tT={class:"row gx-3 mb-2"},tz={class:"col"},tL={class:"row gx-3"},tq={class:"col",style:{"flex-basis":"15rem"}},tF={class:"row gx-3 mb-2"},tQ={class:"col"},tY={class:"col",style:{"flex-basis":"16rem"}},tK={class:"row gx-3 mb-2"},tG={class:"col"},tH={class:"col flex-grow-1 mb-2",style:{"flex-basis":"22rem"}},tZ={class:"row gx-3"},t$={class:"col",style:{"flex-basis":"22rem"}},tX={class:"row gx-3"},tJ={class:"col mb-2",style:{"flex-basis":"14rem","flex-grow":"10000"}},t0={class:"row gx-3"},t1={class:"col"},t2={class:"col"},t3={class:"col mb-2 text-end"},t8={class:"col",style:{"flex-basis":"14rem"}},t4={class:"row gx-3 mb-2"},t5={class:"col"},t7=["value"],t6={class:"row gx-3 align-items-baseline"},t9={class:"col",style:{"flex-basis":"15rem"}},ne={class:"col",style:{"flex-basis":"15rem"}},nt={class:"row align-items-center"},nn={class:"col"},no={class:"d-none d-md-block"},na=(0,y.aZ)({__name:"options",setup(e){function t(){(0,w.l)({},!0)}return(e,n)=>((0,y.wg)(),(0,y.iD)("section",{class:(0,y.C_)({show:1==(0,y.SU)(b.SB).tab})},[(0,y._)("div",tI,[(0,y._)("div",tR,[(0,y._)("div",tO,[(0,y._)("div",tW,[(0,y._)("div",tM,[n[19]||(n[19]=(0,y._)("label",{class:"col-auto col-form-label"},"Chess set:",-1)),(0,y._)("div",tj,[(0,y.wy)((0,y._)("select",{class:"form-select","onUpdate:modelValue":n[0]||(n[0]=e=>(0,y.SU)(w.Ar).set=e)},n[18]||(n[18]=[(0,y.uE)('<option value="1echecs">1Echecs</option><option value="alpha">Alpha</option><option value="goodCompanion">Good Companion</option><option value="kilfiger">Kilfiger</option><option value="merida">Merida</option><option value="mpchess">MPChess</option><option value="skak">Skak</option>',7)]),512),[[y.bM,(0,y.SU)(w.Ar).set]])])])]),(0,y._)("div",tV,[(0,y._)("div",tT,[n[21]||(n[21]=(0,y._)("label",{class:"col-auto col-form-label"},"Square size:",-1)),(0,y._)("div",tz,[(0,y.wy)((0,y._)("select",{class:"form-select","onUpdate:modelValue":n[1]||(n[1]=e=>(0,y.SU)(w.Ar).size=e)},n[20]||(n[20]=[(0,y._)("option",{value:"26"},"26px",-1),(0,y._)("option",{value:"32"},"32px",-1),(0,y._)("option",{value:"38"},"38px",-1),(0,y._)("option",{value:"44"},"44px",-1)]),512),[[y.bM,(0,y.SU)(w.Ar).size,void 0,{number:!0}]])])])])]),(0,y.Wm)(tC,{class:"mb-2",modelValue:(0,y.SU)(b.h).board.exHigh,"onUpdate:modelValue":n[2]||(n[2]=e=>(0,y.SU)(b.h).board.exHigh=e),onChange:(0,y.SU)(k.G2)},{default:(0,y.w5)(()=>n[22]||(n[22]=[(0,y.Uk)("Export to high-resolution image")])),_:1},8,["modelValue","onChange"]),(0,y._)("div",tL,[(0,y._)("div",tq,[(0,y._)("div",tF,[n[24]||(n[24]=(0,y._)("label",{class:"col-auto col-form-label"},"Background:",-1)),(0,y._)("div",tQ,[(0,y.wy)((0,y._)("select",{class:"form-select","onUpdate:modelValue":n[3]||(n[3]=e=>(0,y.SU)(b.h).board.bg=e),onChange:n[4]||(n[4]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,y.SU)(k.wY)&&(0,y.SU)(k.wY)(...t)})},n[23]||(n[23]=[(0,y._)("option",{value:void 0},"Default",-1),(0,y._)("option",{value:"gray"},"Gray",-1),(0,y._)("option",{value:"green"},"Green",-1),(0,y._)("option",{value:"classic"},"Classic",-1)]),544),[[y.bM,(0,y.SU)(b.h).board.bg]])])])]),(0,y._)("div",tY,[(0,y._)("div",tK,[n[26]||(n[26]=(0,y._)("label",{class:"col-auto col-form-label"},"Board pattern:",-1)),(0,y._)("div",tG,[(0,y.wy)((0,y._)("select",{class:"form-select","onUpdate:modelValue":n[5]||(n[5]=e=>(0,y.SU)(b.h).board.pattern=e),onChange:n[6]||(n[6]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,y.SU)(k.wY)&&(0,y.SU)(k.wY)(...t)})},n[25]||(n[25]=[(0,y._)("option",{value:void 0},"Normal",-1),(0,y._)("option",{value:"inverted"},"Inverted",-1),(0,y._)("option",{value:"mono"},"Uncolored",-1)]),544),[[y.bM,(0,y.SU)(b.h).board.pattern]])])])])])]),(0,y._)("div",tH,[(0,y._)("div",tZ,[(0,y._)("div",t$,[(0,y._)("div",tX,[(0,y._)("div",tJ,[(0,y._)("div",t0,[(0,y._)("div",t1,[(0,y.Wm)(tE,{modelValue:(0,y.SU)(w.Ar).width,"onUpdate:modelValue":n[7]||(n[7]=e=>(0,y.SU)(w.Ar).width=e),min:1,title:"Files"},null,8,["modelValue"])]),n[27]||(n[27]=(0,y._)("label",{class:"col-auto col-form-label"},"x",-1)),(0,y._)("div",t2,[(0,y.Wm)(tE,{modelValue:(0,y.SU)(w.Ar).height,"onUpdate:modelValue":n[8]||(n[8]=e=>(0,y.SU)(w.Ar).height=e),min:1,title:"Ranks"},null,8,["modelValue"])])])]),(0,y._)("div",t3,[(0,y._)("button",{type:"button",class:"btn btn-secondary",onClick:n[9]||(n[9]=e=>(0,y.SU)(w.Ar).setDimension({w:8,h:8}))},"Reset")])])]),(0,y._)("div",t8,[(0,y._)("div",t4,[n[28]||(n[28]=(0,y._)("label",{class:"col-auto col-form-label"},"Border pattern:",-1)),(0,y._)("div",t5,[(0,y._)("input",{type:"text",placeholder:"Use comma-separated numbers",title:"Use comma-separated numbers",class:"form-control",value:(0,y.SU)(b.h).board.border,onChange:n[10]||(n[10]=e=>(0,y.SU)(w.Ar).setBorder(e.target))},null,40,t7)])])])]),(0,y.Wm)(tC,{modelValue:(0,y.SU)(b.h).board.SN,"onUpdate:modelValue":n[11]||(n[11]=e=>(0,y.SU)(b.h).board.SN=e),onChange:(0,y.SU)(S.oO)},{default:(0,y.w5)(()=>n[29]||(n[29]=[(0,y.Uk)("Use S for knight")])),_:1},8,["modelValue","onChange"]),(0,y._)("div",t6,[(0,y._)("div",t9,[(0,y.Wm)(tC,{modelValue:(0,y.SU)(b.h).board.blackWhite,"onUpdate:modelValue":n[12]||(n[12]=e=>(0,y.SU)(b.h).board.blackWhite=e),onChange:(0,y.SU)(k.pz)},{default:(0,y.w5)(()=>n[30]||(n[30]=[(0,y.Uk)("Black/White neutral piece")])),_:1},8,["modelValue","onChange"])]),(0,y.wy)((0,y._)("div",ne,[(0,y._)("div",nt,[n[31]||(n[31]=(0,y._)("label",{class:"col-auto col-form-label"},"Knight offset:",-1)),(0,y._)("div",nn,[(0,y.wy)((0,y._)("input",{type:"range",class:"form-range",min:"0.25",max:"0.75",step:"0.025","onUpdate:modelValue":n[13]||(n[13]=e=>(0,y.SU)(b.h).board.knightOffset=e),onInput:n[14]||(n[14]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,y.SU)(k.pz)&&(0,y.SU)(k.pz)(...t)})},null,544),[[y.nr,(0,y.SU)(b.h).board.knightOffset,void 0,{number:!0}]])])])],512),[[y.F8,(0,y.SU)(b.h).board.blackWhite]])]),(0,y._)("div",no,[(0,y.Wm)(tC,{modelValue:(0,y.SU)(b.h).board.collapse,"onUpdate:modelValue":n[15]||(n[15]=e=>(0,y.SU)(b.h).board.collapse=e),onChange:(0,y.SU)(w.SI)},{default:(0,y.w5)(()=>n[32]||(n[32]=[(0,y.Uk)("Always collapse boards")])),_:1},8,["modelValue","onChange"])]),(0,y.Wm)(tC,{modelValue:(0,y.SU)(b.h).board.coordinates,"onUpdate:modelValue":n[16]||(n[16]=e=>(0,y.SU)(b.h).board.coordinates=e),onChange:t},{default:(0,y.w5)(()=>n[33]||(n[33]=[(0,y.Uk)("Show coordinate labels")])),_:1},8,["modelValue"]),(0,y.Wm)(tC,{modelValue:(0,y.SU)(b.h).board.fullFEN,"onUpdate:modelValue":n[17]||(n[17]=e=>(0,y.SU)(b.h).board.fullFEN=e),onChange:(0,y.SU)(S.uu)},{default:(0,y.w5)(()=>n[34]||(n[34]=[(0,y.Uk)("Show full FEN")])),_:1},8,["modelValue","onChange"])])])],2))}}),nl={class:"me-3"},ni=["checked","disabled","onChange","id"],nr=["for","textContent"],ns=(0,y.aZ)({__name:"radio",props:{label:{},text:{},value:{},modelValue:{},disabled:{type:Boolean}},emits:["update:modelValue"],setup(e,t){let{emit:n}=t,o="rdo"+(0,y.FN)().uid;return(t,a)=>((0,y.wg)(),(0,y.iD)(y.HY,null,[(0,y._)("span",nl,(0,y.zw)(t.label),1),((0,y.wg)(!0),(0,y.iD)(y.HY,null,(0,y.Ko)(t.text,(a,l)=>{var i;return(0,y.wg)(),(0,y.iD)("div",{class:"form-check d-inline-block me-3",key:l},[(0,y._)("input",{class:"form-check-input",type:"radio",checked:(i=l,e.modelValue===e.value[i]),disabled:t.disabled,onChange:t=>{var o;return o=l,void n("update:modelValue",e.value[o])},name:o,id:o+"_"+l},null,40,ni),(0,y._)("label",{class:"form-check-label",for:o+"_"+l,textContent:(0,y.zw)(a)},null,8,nr)])}),128))],64))}});var nc=n("1528");let nu={key:0},nd={class:"mb-3"},nf={class:"btn-gap"},np=["disabled"],nm=["disabled"],nh=["disabled"],ng=["disabled"],ny={key:0,class:"btn-gap"},nb={key:0},nv={key:0},nS={key:1},nw={key:1,class:"ms-2"},n_={key:2,class:"ms-2"},nk=["onClick"],nU={key:0},nx={key:1},nB={class:"btn-gap"},nC={class:"mt-2"},nD={class:"form-check d-inline-block me-3"},nA=["checked"],nP={class:"form-check d-inline-block me-3"},nN=["checked"],nE={class:"form-check d-inline-block"},nI=["checked"],nR={key:0,class:"mt-2"},nO={class:"mt-2"},nW={key:1,class:"mt-2"},nM={class:"btn-gap"},nj=["disabled"],nV=["disabled"],nT=["disabled"],nz={class:"mt-2 gx-3 row"},nL={class:"col flex-grow-1",style:{"flex-basis":"22rem"}},nq={class:"d-flex align-items-center flex-wrap-reverse mb-2"},nF={class:"flex-grow-1 col-form-label",style:{"flex-basis":"max-content"}},nQ={class:"flex-grow-1",style:{"flex-basis":"max-content"}},nY={class:"row gx-3"},nK={class:"col"},nG={class:"mb-2"},nH={class:"d-inline-block"},nZ={class:"d-inline-block"},n$={class:"col flex-grow-1",style:{"flex-basis":"22rem"}},nX={class:"row gx-3 mb-2"},nJ={class:"col"},n0=["disabled"],n1={class:"row gx-3"},n2={class:"col mb-2",style:{"flex-basis":"10.5rem"}},n3={class:"row gx-3"},n8={class:"col"},n4=["disabled"],n5={class:"col mb-2",style:{"flex-basis":"10.5rem"}},n7={class:"row gx-3"},n6={class:"col"},n9=["disabled"],oe={class:"text-end"},ot=(0,y.aZ)({__name:"play",setup(e){let t=()=>b.SB.play.mode==N.jl.retro,n=()=>b.SB.play.moveNumber<0,o=()=>b.SB.play.moveNumber>=b.SB.play.history.length-1;return(e,a)=>((0,y.wg)(),(0,y.iD)("section",{class:(0,y.C_)({show:6==(0,y.SU)(b.SB).tab})},[(0,y.SU)(b.SB).play.playing?((0,y.wg)(),(0,y.iD)("div",nu,[(0,y._)("div",nd,[(0,y._)("span",nf,[(0,y._)("button",{type:"button",class:"py-0 btn btn-secondary",onClick:a[0]||(a[0]=e=>(0,y.SU)(Q).move(-1)),disabled:n()},a[27]||(a[27]=[(0,y._)("i",{class:"fa-solid fa-angles-left fa-fw"},null,-1)]),8,np),(0,y._)("button",{type:"button",class:"py-0 btn btn-secondary",onClick:a[1]||(a[1]=e=>(0,y.SU)(Q).moveBy(-1)),disabled:n()},a[28]||(a[28]=[(0,y._)("i",{class:"fa-solid fa-angle-left fa-fw"},null,-1)]),8,nm),(0,y._)("button",{type:"button",class:"py-0 btn btn-secondary",onClick:a[2]||(a[2]=e=>(0,y.SU)(Q).moveBy(1)),disabled:o()},a[29]||(a[29]=[(0,y._)("i",{class:"fa-solid fa-angle-right fa-fw"},null,-1)]),8,nh),(0,y._)("button",{type:"button",class:"py-0 btn btn-secondary",onClick:a[3]||(a[3]=e=>(0,y.SU)(Q).move((0,y.SU)(b.SB).play.history.length-1)),disabled:o()},a[30]||(a[30]=[(0,y._)("i",{class:"fa-solid fa-angles-right fa-fw"},null,-1)]),8,ng)]),(0,y._)("span",null,[(0,y._)("span",{class:(0,y.C_)(["btn step px-1 py-0 ms-3",{active:-1==(0,y.SU)(b.SB).play.moveNumber}]),onClick:a[4]||(a[4]=e=>(0,y.SU)(Q).goto())},"*",2)]),(0,y.SU)(b.i7).module.chess?((0,y.wg)(),(0,y.iD)("span",ny,[((0,y.wg)(!0),(0,y.iD)(y.HY,null,(0,y.Ko)((0,y.SU)(b.SB).play.history,(e,t)=>((0,y.wg)(),(0,y.iD)("span",{key:t},[(0,y.SU)(b.SB).play.history[t-1]&&(0,y.SU)(b.SB).play.history[t-1].color==e.color?((0,y.wg)(),(0,y.iD)("span",nb,[e.color==(0,y.SU)(N.Il).white?((0,y.wg)(),(0,y.iD)("span",nv," ... ")):((0,y.wg)(),(0,y.iD)("span",nS,(0,y.zw)((0,y.SU)(Q).number(e))+"...",1))])):(0,y.kq)("",!0),e.color==(0,y.SU)(N.Il).black&&0==t?((0,y.wg)(),(0,y.iD)("span",nw,(0,y.zw)((0,y.SU)(Q).number(e))+"...",1)):(0,y.kq)("",!0),e.color==(0,y.SU)(N.Il).white?((0,y.wg)(),(0,y.iD)("span",n_,(0,y.zw)((0,y.SU)(Q).number(e))+".",1)):(0,y.kq)("",!0),(0,y._)("span",{class:(0,y.C_)(["btn step px-1 py-0",{active:t==(0,y.SU)(b.SB).play.moveNumber}]),onClick:e=>(0,y.SU)(Q).move(t)},(0,y.zw)((0,y.SU)(Q).format(e)),11,nk)]))),128)),(0,y.SU)(b.SB).play.mode!=(0,y.SU)(N.jl).retro?((0,y.wg)(),(0,y.iD)(y.HY,{key:0},[(0,y.SU)(b.SB).play.over==(0,y.SU)(nc.U).checkmate?((0,y.wg)(),(0,y.iD)("span",nU,"Checkmate.")):(0,y.kq)("",!0),(0,y.SU)(b.SB).play.over==(0,y.SU)(nc.U).draw?((0,y.wg)(),(0,y.iD)("span",nx,"Draw.")):(0,y.kq)("",!0)],64)):(0,y.kq)("",!0)])):(0,y.kq)("",!0)]),(0,y._)("div",nB,[(0,y._)("button",{class:"btn btn-secondary",onClick:a[5]||(a[5]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,y.SU)(Q).exit&&(0,y.SU)(Q).exit(...t)})}," Exit playing "),(0,y.Wm)(e2,{factory:(0,y.SU)(Q).copyGame,class:"btn-primary"},{default:(0,y.w5)(()=>a[31]||(a[31]=[(0,y.Uk)(" Copy game ")])),_:1},8,["factory"]),(0,y.Wm)(e2,{factory:(0,y.SU)(Q).copyPGN,class:"btn-primary"},{default:(0,y.w5)(()=>a[32]||(a[32]=[(0,y.Uk)(" Copy PGN ")])),_:1},8,["factory"]),(0,y.SU)(x.O).canPaste?((0,y.wg)(),(0,y.iD)("button",{key:0,class:"btn btn-secondary",onClick:a[6]||(a[6]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,y.SU)(Q).pasteMoves&&(0,y.SU)(Q).pasteMoves(...t)})},a[33]||(a[33]=[(0,y._)("i",{class:"fa-solid fa-paste"},null,-1),(0,y.Uk)(" Paste moves ")]))):(0,y.kq)("",!0)]),(0,y._)("div",nC,[a[37]||(a[37]=(0,y._)("span",{class:"me-3"},"Symbol:",-1)),(0,y._)("div",nD,[(0,y._)("input",{class:"form-check-input",type:"radio",checked:null==(0,y.SU)(b.h).PLAY.symbol,onChange:a[7]||(a[7]=e=>(0,y.SU)(b.h).PLAY.symbol=null),name:"SYM",id:"sEng"},null,40,nA),a[34]||(a[34]=(0,y._)("label",{class:"form-check-label",for:"sEng"}," English ",-1))]),(0,y._)("div",nP,[(0,y._)("input",{class:"form-check-input",type:"radio",checked:"german"==(0,y.SU)(b.h).PLAY.symbol,onChange:a[8]||(a[8]=e=>(0,y.SU)(b.h).PLAY.symbol="german"),name:"SYM",id:"sGer"},null,40,nN),a[35]||(a[35]=(0,y._)("label",{class:"form-check-label",for:"sGer"}," German ",-1))]),(0,y._)("div",nE,[(0,y._)("input",{class:"form-check-input",type:"radio",checked:"unicode"==(0,y.SU)(b.h).PLAY.symbol,onChange:a[9]||(a[9]=e=>(0,y.SU)(b.h).PLAY.symbol="unicode"),name:"SYM",id:"sUni"},null,40,nI),a[36]||(a[36]=(0,y._)("label",{class:"form-check-label",for:"sUni"}," Unicode ",-1))])]),t()?(0,y.kq)("",!0):((0,y.wg)(),(0,y.iD)("div",nR,[(0,y.Wm)(tC,{modelValue:(0,y.SU)(b.h).PLAY.ep,"onUpdate:modelValue":a[10]||(a[10]=e=>(0,y.SU)(b.h).PLAY.ep=e)},{default:(0,y.w5)(()=>a[38]||(a[38]=[(0,y.Uk)("Add ep to en passant moves")])),_:1},8,["modelValue"])])),(0,y._)("div",nO,[(0,y.Wm)(tC,{modelValue:(0,y.SU)(b.h).PLAY.zero,"onUpdate:modelValue":a[11]||(a[11]=e=>(0,y.SU)(b.h).PLAY.zero=e)},{default:(0,y.w5)(()=>a[39]||(a[39]=[(0,y.Uk)("Use number 0 for castling notation")])),_:1},8,["modelValue"])]),t()?((0,y.wg)(),(0,y.iD)("div",nW,[(0,y.Wm)(tC,{modelValue:(0,y.SU)(b.h).PLAY.negative,"onUpdate:modelValue":a[12]||(a[12]=e=>(0,y.SU)(b.h).PLAY.negative=e)},{default:(0,y.w5)(()=>a[40]||(a[40]=[(0,y.Uk)("Use negative numbers in retro mode")])),_:1},8,["modelValue"])])):(0,y.kq)("",!0)])):((0,y.wg)(),(0,y.iD)(y.HY,{key:1},[(0,y._)("div",nM,[(0,y._)("button",{class:"btn btn-primary",onClick:a[13]||(a[13]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,y.SU)(Q).start&&(0,y.SU)(Q).start(...t)}),disabled:(0,y.SU)(b.SB).popeye.playing},"Start playing",8,nj),(0,y._)("button",{type:"button",class:"btn btn-secondary",onClick:a[14]||(a[14]=e=>(0,y.SU)(S.X4).reset(!0)),disabled:(0,y.SU)(b.SB).popeye.playing},a[41]||(a[41]=[(0,y._)("i",{class:"fa-solid fa-flag-checkered"},null,-1),(0,y.Uk)("  Starting position ")]),8,nV),(0,y._)("button",{class:"btn btn-secondary",onClick:a[15]||(a[15]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,y.SU)(Q).pasteGame&&(0,y.SU)(Q).pasteGame(...t)}),disabled:(0,y.SU)(b.SB).popeye.playing},a[42]||(a[42]=[(0,y._)("i",{class:"fa-solid fa-paste"},null,-1),(0,y.Uk)(" Paste PGN ")]),8,nT)]),(0,y._)("div",nz,[(0,y._)("div",nL,[(0,y._)("div",nq,[(0,y._)("div",nF,[(0,y.Wm)(ns,{modelValue:(0,y.SU)(b.SB).play.turn,"onUpdate:modelValue":a[16]||(a[16]=e=>(0,y.SU)(b.SB).play.turn=e),label:"Turn:",text:["White","Black"],value:["w","b"],disabled:(0,y.SU)(b.SB).play.mode==(0,y.SU)(N.jl).pass},null,8,["modelValue","disabled"])]),(0,y._)("div",nQ,[(0,y._)("div",nY,[a[44]||(a[44]=(0,y._)("label",{class:"col-auto col-form-label"},"Mode:",-1)),(0,y._)("div",nK,[(0,y.wy)((0,y._)("select",{class:"form-select","onUpdate:modelValue":a[17]||(a[17]=e=>(0,y.SU)(b.SB).play.mode=e),onChange:a[18]||(a[18]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,y.SU)(k.wY)&&(0,y.SU)(k.wY)(...t)})},a[43]||(a[43]=[(0,y._)("option",{value:"normal"},"Normal",-1),(0,y._)("option",{value:"pass"},"Allow passing move",-1),(0,y._)("option",{value:"retro"},"Retro",-1)]),544),[[y.bM,(0,y.SU)(b.SB).play.mode]])])])])]),(0,y._)("div",nG,[a[49]||(a[49]=(0,y.Uk)(" Castling: ")),(0,y._)("span",nH,[(0,y.Wm)(tC,{class:"ms-2 d-inline-block",modelValue:(0,y.SU)(b.SB).play.castle.K,"onUpdate:modelValue":a[19]||(a[19]=e=>(0,y.SU)(b.SB).play.castle.K=e),disabled:t()},{default:(0,y.w5)(()=>a[45]||(a[45]=[(0,y.Uk)("WK")])),_:1},8,["modelValue","disabled"]),(0,y.Wm)(tC,{class:"ms-2 d-inline-block",modelValue:(0,y.SU)(b.SB).play.castle.Q,"onUpdate:modelValue":a[20]||(a[20]=e=>(0,y.SU)(b.SB).play.castle.Q=e),disabled:t()},{default:(0,y.w5)(()=>a[46]||(a[46]=[(0,y.Uk)("WQ")])),_:1},8,["modelValue","disabled"])]),(0,y._)("span",nZ,[(0,y.Wm)(tC,{class:"ms-2 d-inline-block",modelValue:(0,y.SU)(b.SB).play.castle.k,"onUpdate:modelValue":a[21]||(a[21]=e=>(0,y.SU)(b.SB).play.castle.k=e),disabled:t()},{default:(0,y.w5)(()=>a[47]||(a[47]=[(0,y.Uk)("BK")])),_:1},8,["modelValue","disabled"]),(0,y.Wm)(tC,{class:"ms-2 d-inline-block",modelValue:(0,y.SU)(b.SB).play.castle.q,"onUpdate:modelValue":a[22]||(a[22]=e=>(0,y.SU)(b.SB).play.castle.q=e),disabled:t()},{default:(0,y.w5)(()=>a[48]||(a[48]=[(0,y.Uk)("BQ")])),_:1},8,["modelValue","disabled"])])])]),(0,y._)("div",n$,[(0,y._)("div",nX,[a[50]||(a[50]=(0,y._)("label",{class:"col-auto col-form-label"},"En passant square: ",-1)),(0,y._)("div",nJ,[(0,y.wy)((0,y._)("input",{type:"text",class:"form-control",maxlength:"2","onUpdate:modelValue":a[23]||(a[23]=e=>(0,y.SU)(b.SB).play.enPassant=e),disabled:t()},null,8,n0),[[y.nr,(0,y.SU)(b.SB).play.enPassant]])])]),(0,y._)("div",n1,[(0,y._)("div",n2,[(0,y._)("div",n3,[a[51]||(a[51]=(0,y._)("label",{class:"col-auto col-form-label"},"Half moves: ",-1)),(0,y._)("div",n8,[(0,y.wy)((0,y._)("input",{type:"number",class:"form-control",min:"0","onUpdate:modelValue":a[24]||(a[24]=e=>(0,y.SU)(b.SB).play.halfMove=e),disabled:t()},null,8,n4),[[y.nr,(0,y.SU)(b.SB).play.halfMove,void 0,{number:!0}]])])])]),(0,y._)("div",n5,[(0,y._)("div",n7,[a[52]||(a[52]=(0,y._)("label",{class:"col-auto col-form-label"},"Full moves: ",-1)),(0,y._)("div",n6,[(0,y.wy)((0,y._)("input",{type:"number",class:"form-control",min:"1","onUpdate:modelValue":a[25]||(a[25]=e=>(0,y.SU)(b.SB).play.fullMove=e),disabled:t()},null,8,n9),[[y.nr,(0,y.SU)(b.SB).play.fullMove,void 0,{number:!0}]])])])])]),(0,y._)("div",oe,[(0,y._)("button",{class:"btn btn-secondary",onClick:a[26]||(a[26]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,y.SU)(S.Wc)&&(0,y.SU)(S.Wc)(...t)})},"Reset settings")])])])],64))],2))}}),on=(0,y.XI)(""),oo={async fetch(e){try{gtag("event","fen_pdb_get"),e.disabled=!0,e.value="Fetching...";let t=oa+encodeURIComponent("PROBID='".concat(on.value,"'")),n=await fetch("https://corsproxy.io/?"+t),o=await n.text();(0,S.dd)(o.match(/<b>FEN:<\/b> (.+)/)[1],!0)}catch{(0,B.Z)("An error has occurred. Please try again later.")}finally{e.disabled=!1,e.value="Get FEN"}},search(){gtag("event","fen_pdb_search"),window.open(oa+encodeURIComponent(or()))},copyQuery:()=>(gtag("event","fen_pdb_copy"),or()),copyEdit:()=>(gtag("event","fen_pdb_copyEdit"),function(){let e={},{w:t,h:n}=b.h.board;for(let o=0;o<n;o++)for(let n=0;n<t;n++){let a;let l=S.xG[o*t+n].value,i=l.match(/^(-?)(?:\*(\d))?([kqbsnrpxc])$/i);if(i){if("x"==i[3])a="sY";else{let e=ol[A.V5.indexOf(i[3].toLowerCase().replace("s","n"))],t=i[1]?"n":os(l);a=t+e+oi[Number(i[2]||0)]}e[a]=(e[a]||"")+(0,P.MA)(o,n)}}let o=[];for(let t in e)o.push(t+e[t]);return o.join(" ")}())},oa="https://pdb.dieschwalbe.de/search.jsp?expression=",ol=["K","D","L","S","T","B","I"],oi=["","R","U","L"];function or(){let e=[],{w:t,h:n}=b.h.board;for(let o=0;o<n;o++)for(let n=0;n<t;n++){let a=S.xG[o*t+n].value;if(!a.match(/^[kqbsnrp]$/i))continue;let l=ol[A.V5.indexOf(a.toLowerCase().replace("s","n"))],i=os(a);e.push(i+l+(0,P.MA)(o,n))}let o="POSITION='".concat(e.join(" "),"'");return b.h.DB.exact&&(o+=" AND APIECES=".concat(e.length)),o}function os(e){return e==e.toLowerCase()?"s":"w"}let oc={copyFEN(){gtag("event","fen_yacpdb_copyFEN");let{w:e,h:t}=b.h.board,n=S.xG.map(e=>(0,P.sV)(e.value));return(0,P.N0)(n,e,t)},async fetch(e){try{gtag("event","fen_yacpdb_get"),e.disabled=!0,e.value="Fetching...";let n="https://yacpdb.org/gateway/ql?q="+encodeURIComponent("Id('".concat(on.value,"')")),o=await fetch("https://corsproxy.io/?"+n),a=await o.json();if(a.success){let{w:e,h:n}=b.h.board,o=a.result.entries[0].algebraic,l=(0,P.Q5)(e*n);function t(t){let o=t.charCodeAt(1)-E.oh,a=Number(t[2]);l[(n-a)*e+o]=t[0]}for(let e of o.black)t(e.toLowerCase());for(let e of o.white)t(e);(0,S.dd)((0,P.N0)(l,e,n))}}catch{(0,B.Z)("An error has occurred. Please try again later.")}finally{e.disabled=!1,e.value="Get FEN"}},search(){gtag("event","fen_yacpdb_search"),window.open("https://yacpdb.org/#q/"+encodeURIComponent(ou())+"/1")},copyQuery:()=>(gtag("event","fen_yacpdb_copy"),ou()),copyEdit:()=>(gtag("event","fen_yacpdb_copyEdit"),function(){let e={w:[],b:[],n:[]},{w:t,h:n}=b.h.board;for(let o=0;o<n;o++)for(let n=0;n<t;n++){let a=S.xG[o*t+n].value,l=a.match(/^(-?)([kqbsnrp])$/i);if(!l)continue;let i=(0,P.hv)(l[2],!1,!0).toUpperCase();e[l[1]?"n":od(a)].push(i+(0,P.MA)(o,n))}let o=[];return e.w.length&&o.push("    white: [".concat(e.w.join(", "),"]")),e.b.length&&o.push("    black: [".concat(e.b.join(", "),"]")),e.n.length&&o.push("    neutral: [".concat(e.n.join(", "),"]")),o.join("\n")}())};function ou(){let e=[],{w:t,h:n}=b.h.board;for(let o=0;o<n;o++)for(let n=0;n<t;n++){let a=(0,P.sV)(S.xG[o*t+n].value).replace("(","").replace(")","");if(!!a)!a.match(/\d/)&&(a=a.startsWith("!")?"n"+a.toUpperCase():od(a)+a.toUpperCase(),e.push(a+(0,P.MA)(o,n)))}let o='MatrixExtended("'.concat(e.join(" "),'", false, false, "None")');return b.h.DB.exact&&(o+=" AND PCount(*) = "+e.length),o}function od(e){return e==e.toLowerCase()?"b":"w"}let of={class:"row gx-3 mb-2 align-items-center"},op={class:"col"},om={class:"form-check d-inline-block me-3"},oh=["checked"],og={class:"form-check d-inline-block"},oy=["checked"],ob={class:"mb-3 btn-gap"},ov={class:"row gx-3 mb-3"},oS={class:"col"},ow=["readonly"],o_={class:"col-auto"},ok=["disabled"],oU={class:"row align-items-center flex-wrap"},ox={class:"col-auto mb-2"},oB={class:"col text-end btn-gap",style:{"flex-basis":"24rem"}},oC=(0,y.aZ)({__name:"database",setup(e){let t=(0,y.Fl)(()=>"PDB"==b.h.DB.use?oo:oc);return(e,n)=>((0,y.wg)(),(0,y.iD)("section",{class:(0,y.C_)({show:2==(0,y.SU)(b.SB).tab})},[(0,y._)("div",of,[n[8]||(n[8]=(0,y._)("label",{class:"col-auto col-form-label"},"Use database: ",-1)),(0,y._)("div",op,[(0,y._)("div",om,[(0,y._)("input",{class:"form-check-input",type:"radio",checked:"PDB"==(0,y.SU)(b.h).DB.use,onChange:n[0]||(n[0]=e=>(0,y.SU)(b.h).DB.use="PDB"),name:"DB",id:"rPDB"},null,40,oh),n[6]||(n[6]=(0,y._)("label",{class:"form-check-label",for:"rPDB"}," PDB ",-1))]),(0,y._)("div",og,[(0,y._)("input",{class:"form-check-input",type:"radio",checked:"YACPDB"==(0,y.SU)(b.h).DB.use,onChange:n[1]||(n[1]=e=>(0,y.SU)(b.h).DB.use="YACPDB"),name:"DB",id:"rYACPDB"},null,40,oy),n[7]||(n[7]=(0,y._)("label",{class:"form-check-label",for:"rYACPDB"}," YACPDB ",-1))])])]),(0,y._)("div",ob,[(0,y.Wm)(e2,{factory:t.value.copyEdit,class:"btn-primary"},{default:(0,y.w5)(()=>n[9]||(n[9]=[(0,y.Uk)(" Copy board edit syntax ")])),_:1},8,["factory"]),"YACPDB"==(0,y.SU)(b.h).DB.use?((0,y.wg)(),(0,y.j4)(e2,{key:0,factory:(0,y.SU)(oc).copyFEN,class:"btn-secondary"},{default:(0,y.w5)(()=>n[10]||(n[10]=[(0,y.Uk)(" Copy YACPDB FEN ")])),_:1},8,["factory"])):(0,y.kq)("",!0)]),(0,y._)("div",ov,[n[11]||(n[11]=(0,y._)("label",{class:"col-auto col-form-label"},"Problem Id:",-1)),(0,y._)("div",oS,[(0,y.wy)((0,y._)("input",{type:"text",class:"form-control","onUpdate:modelValue":n[2]||(n[2]=e=>(0,y.dq)(on)?on.value=e:null),readonly:(0,y.SU)(b.I3)()||void 0},null,8,ow),[[y.nr,(0,y.SU)(on)]])]),(0,y._)("div",o_,[(0,y._)("input",{type:"button",class:"btn btn-primary",value:"Get FEN",onClick:n[3]||(n[3]=e=>t.value.fetch(e.target)),disabled:(0,y.SU)(b.I3)()},null,8,ok)])]),(0,y._)("div",oU,[(0,y._)("div",ox,[(0,y.Wm)(tC,{modelValue:(0,y.SU)(b.h).DB.exact,"onUpdate:modelValue":n[4]||(n[4]=e=>(0,y.SU)(b.h).DB.exact=e)},{default:(0,y.w5)(()=>n[12]||(n[12]=[(0,y.Uk)("Search exactly these pieces")])),_:1},8,["modelValue"])]),(0,y._)("div",oB,[(0,y.Wm)(e2,{factory:t.value.copyQuery,class:"btn-secondary"},{default:(0,y.w5)(()=>n[13]||(n[13]=[(0,y.Uk)(" Copy search query ")])),_:1},8,["factory"]),(0,y._)("button",{class:"btn btn-primary nowrap",onClick:n[5]||(n[5]=function(){for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];return t.value.search&&t.value.search(...n)})},n[14]||(n[14]=[(0,y._)("i",{class:"fa-solid fa-magnifying-glass"},null,-1),(0,y.Uk)(" Search position ")]))])])],2))}});var oD=n("4119"),oA=n("7737");function oP(){return n.e("946").then(n.bind(n,4587))}function oN(e){try{let t=JSON.parse(e);if("number"!=typeof t.version||!Array.isArray(t.project))throw Error();return t.project}catch{return null}}function oE(e){let t=e.match(/[kqbnrp1-8]{1,8}(?:\/[kqbnrp1-8]{1,8}){7}(?: [wb] (?:-|[kq]{1,4}) (?:-|[a-h][1-8]) \d+ \d+)?/gi);if(!t||!t.length)return null;let n=[];for(let[e,o]of t.entries())n.push((0,oA.E)({fen:o},e));return n}let oI={async reset(){b.h.project.length&&await (0,B.i)("Are you sure you want to clear all entries?")&&b.h.project.length&&(b.h.project=[])},async add(e){if(e){let e=await oP(),t=b.SB.popeye.input,n=(0,G.U_)(t);t=e.normalizeInput(t,n),b.h.project.push((0,oA.E)({fen:n.fen,popeye:t}))}else b.h.project.push((0,oA.E)({fen:S.RI.value}))},remove(e){b.h.project.splice(e,1)},async open(e){let t=await function(e){return new Promise((t,n)=>{let o=new FileReader;o.onload=e=>t(e.target.result),o.onerror=e=>n(e),o.readAsText(e)})}(e);for(let e of[oN,(await oP()).parseOliveFormat,oE]){let n=e(t);if(n){b.h.project=n;return}}(0,B.Z)("Unable to parse the file. The format cannot be recognized.")},link:(0,y.XI)("")};(0,y.m0)(()=>{let e=new Blob([JSON.stringify({version:1,project:b.h.project})],{type:"application/fen.tool.project+json"}),t=URL.createObjectURL(e);oI.link.value&&URL.revokeObjectURL(oI.link.value),oI.link.value=t});var oR=n("6033");let oO={class:"btn-gap"},oW={class:"btn-group"},oM={class:"dropdown-menu"},oj=["href"],oV={key:0,class:"p-1"},oT=["fen","onClick"],oz=["onClick"],oL=(0,y.aZ)({__name:"project",setup(e){let t=(0,y.XI)(!1);function n(e){var t;return(null===(t=e.popeye)||void 0===t?void 0:t.includes("Forsyth"))?(0,oR.Vl)(e.fen):e.fen}return(e,o)=>((0,y.wg)(),(0,y.iD)("section",{class:(0,y.C_)({show:8==(0,y.SU)(b.SB).tab})},[(0,y._)("input",{type:"file",class:"d-none",id:"project_file",onChange:o[0]||(o[0]=e=>(function(e){var t;let n=null===(t=e.files)||void 0===t?void 0:t[0];n&&(e.value="",oI.open(n))})(e.target)),accept:".fentool,.olv"},null,32),(0,y._)("div",oO,[(0,y._)("div",oW,[(0,y._)("button",{type:"button",class:"btn btn-primary pe-2",onClick:o[1]||(o[1]=e=>(0,y.SU)(oI).add())},o[9]||(o[9]=[(0,y._)("i",{class:"fa-solid fa-plus"},null,-1),(0,y.Uk)(" Add ")])),o[10]||(o[10]=(0,y._)("button",{type:"button",class:"ps-2 btn btn-primary dropdown-toggle dropdown-toggle-split","data-bs-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},[(0,y._)("span",{class:"visually-hidden"},"Toggle Dropdown")],-1)),(0,y._)("div",oM,[(0,y._)("div",{class:"dropdown-item",onClick:o[2]||(o[2]=e=>(0,y.SU)(oI).add(!0))},"As a Popeye problem")])]),o[13]||(o[13]=(0,y._)("label",{for:"project_file",class:"btn btn-secondary",title:"Open a project file"},[(0,y._)("i",{class:"fa-regular fa-folder-open"}),(0,y.Uk)(" Open ")],-1)),(0,y._)("a",{href:(0,y.SU)(b.i7).envReady?(0,y.SU)(oI).link.value:void 0,download:"project.fentool",class:"btn btn-secondary",title:"Save project file"},o[11]||(o[11]=[(0,y._)("i",{class:"fa-solid fa-download"},null,-1),(0,y.Uk)(" Save ")]),8,oj),(0,y._)("button",{class:"btn btn-secondary",onClick:o[3]||(o[3]=e=>(0,y.SU)(oI).reset()),title:"Clear all positions in the project"},o[12]||(o[12]=[(0,y._)("i",{class:"fa-regular fa-file"},null,-1),(0,y.Uk)(" Clear ")]))]),(0,y.SU)(b.i7).envReady?((0,y.wg)(),(0,y.iD)("div",{key:0,onMousedown:o[8]||(o[8]=(0,y.iM)(()=>{},["stop"])),class:"mt-3"},[(0,y.SU)(b.h).project.length?(0,y.kq)("",!0):((0,y.wg)(),(0,y.iD)("div",oV,o[14]||(o[14]=[(0,y._)("div",{class:"d-flex flex-wrap"},[(0,y._)("div",{style:{"flex-basis":"max-content"}}," No positions in the project yet.\xa0 "),(0,y._)("div",{style:{"flex-basis":"max-content"}},' Click "Add" to add position. ')],-1)]))),(0,y.Wm)((0,y.SU)(oD.jP),{axis:"xy",list:(0,y.SU)(b.h).project,"onUpdate:list":o[5]||(o[5]=e=>(0,y.SU)(b.h).project=e),distance:(0,y.SU)(x.O).isTouch?0:10,class:(0,y.C_)(["thumbnail-container",{sorting:t.value}]),onSortStart:o[6]||(o[6]=e=>t.value=!0),onSortEnd:o[7]||(o[7]=e=>t.value=!1),"press-delay":(0,y.SU)(x.O).isTouch?200:0,"helper-class":"thumbnail-ghost"},{default:(0,y.w5)(()=>[((0,y.wg)(!0),(0,y.iD)(y.HY,null,(0,y.Ko)((0,y.SU)(b.h).project,(e,t)=>((0,y.wg)(),(0,y.j4)((0,y.SU)(oD.cU),{index:t,key:e.id},{default:(0,y.w5)(()=>[(0,y._)("div",{class:(0,y.C_)(["thumbnail-wrapper",{touch:(0,y.SU)(x.O).isTouch}]),onDragstart:o[4]||(o[4]=(0,y.iM)(()=>{},["prevent"]))},[(0,y._)("img",{fen:n(e),onClick:t=>{var o;return o=e,void(!(0,b.I3)()&&((0,S.dd)(n(o)),o.popeye&&(b.SB.tab=7,b.SB.compute="py",b.SB.popeye.input=o.popeye),x.O.isTouch&&document.body.scrollTo({behavior:"smooth",top:0})))},class:(0,y.C_)(["thumbnail",{disabled:(0,y.SU)(b.I3)()}])},null,10,oT),(0,y._)("i",{class:"fa-solid fa-circle-xmark text-danger",onClick:e=>(0,y.SU)(oI).remove(t)},null,8,oz)],34)]),_:2},1032,["index"]))),128))]),_:1},8,["list","distance","class","press-delay"])],32)):(0,y.kq)("",!0)],2))}}),oq={async copy(){if(b.h.board.w!=E.Dm||b.h.board.h!=E.Dm)throw(0,B.Z)("只支援標準棋盤"),Error();return gtag("event","fen_bbs_copy"),(await n.e("936").then(n.bind(n,4816))).generate((0,S.xL)(),eX(),on.value,b.h.BBS,b.h.board,x.O.isTouch)}},oF={class:"row gx-3"},oQ={class:"col flex-grow-1 mb-3",style:{"flex-basis":"max-content"}},oY={class:"col flex-grow-1 text-end"},oK=(0,y.aZ)({__name:"bbs",setup:e=>(e,t)=>(0,y.SU)(b.i7).envReady&&(0,y.SU)(x.O).isTaiwan?((0,y.wg)(),(0,y.iD)("section",{key:0,class:(0,y.C_)({show:4==(0,y.SU)(b.SB).tab})},[(0,y._)("div",oF,[(0,y._)("div",oQ,[(0,y.Wm)(tC,{modelValue:(0,y.SU)(b.h).BBS.Id,"onUpdate:modelValue":t[0]||(t[0]=e=>(0,y.SU)(b.h).BBS.Id=e)},{default:(0,y.w5)(()=>t[5]||(t[5]=[(0,y.Uk)("Include database Id")])),_:1},8,["modelValue"]),(0,y.Wm)(tC,{modelValue:(0,y.SU)(b.h).BBS.coordinates,"onUpdate:modelValue":t[1]||(t[1]=e=>(0,y.SU)(b.h).BBS.coordinates=e)},{default:(0,y.w5)(()=>t[6]||(t[6]=[(0,y.Uk)("Include Coordinates")])),_:1},8,["modelValue"]),(0,y.Wm)(tC,{modelValue:(0,y.SU)(b.h).BBS.notes,"onUpdate:modelValue":t[2]||(t[2]=e=>(0,y.SU)(b.h).BBS.notes=e)},{default:(0,y.w5)(()=>t[7]||(t[7]=[(0,y.Uk)("Include Notes")])),_:1},8,["modelValue"]),(0,y.Wm)(tC,{modelValue:(0,y.SU)(b.h).BBS.uncoloredNotes,"onUpdate:modelValue":t[3]||(t[3]=e=>(0,y.SU)(b.h).BBS.uncoloredNotes=e)},{default:(0,y.w5)(()=>t[8]||(t[8]=[(0,y.Uk)("Uncolored Note")])),_:1},8,["modelValue"]),(0,y.Wm)(tC,{modelValue:(0,y.SU)(b.h).BBS.redBlue,"onUpdate:modelValue":t[4]||(t[4]=e=>(0,y.SU)(b.h).BBS.redBlue=e)},{default:(0,y.w5)(()=>t[9]||(t[9]=[(0,y.Uk)("Use Red and Blue in BBS Code")])),_:1},8,["modelValue"])]),(0,y._)("div",oY,[(0,y.Wm)(e2,{factory:(0,y.SU)(oq).copy,class:"btn-primary"},{default:(0,y.w5)(()=>t[10]||(t[10]=[(0,y.Uk)("Copy BBS Code")])),_:1},8,["factory"])])])],2)):(0,y.kq)("",!0)}),oG=["disabled"],oH={class:"mb-3 row gx-2"},oZ={class:"col"},o$={class:"w-passive-100"},oX=["disabled"],oJ={class:"col-auto text-end"},o0={class:"btn-gap"},o1=["disabled"],o2={key:1},o3=["title"],o8={key:0},o4={class:"mb-3 row"},o5={class:"col"},o7={class:"btn-gap"},o6={class:"col-auto text-end"},o9={key:1,class:"mb-3 row"},ae={class:"col"},at={class:"btn-gap"},an=["disabled"],ao=["disabled"],aa=["disabled"],al=["disabled"],ai={class:"col-auto text-end"},ar=["innerHTML"],as=(0,y.aZ)({__name:"popeye",setup:e=>(e,t)=>(0,y.wy)(((0,y.wg)(),(0,y.iD)("div",null,[(0,y.wy)((0,y._)("div",null,[(0,y.wy)((0,y._)("textarea",{class:"form-control mb-2",rows:"5","onUpdate:modelValue":t[0]||(t[0]=e=>(0,y.SU)(b.SB).popeye.input=e),disabled:(0,y.SU)(b.SB).popeye.running,placeholder:"For example:\n=============\nStipulation #2\nOption Variation"},null,8,oG),[[y.nr,(0,y.SU)(b.SB).popeye.input]]),(0,y._)("div",oH,[(0,y._)("div",oZ,[(0,y._)("div",o$,[(0,y._)("button",{type:"button",class:"btn btn-secondary",onClick:t[1]||(t[1]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,y.SU)(G.wD).editMap&&(0,y.SU)(G.wD).editMap(...t)}),disabled:(0,y.SU)(b.SB).popeye.running,style:{overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis","max-width":"100%"}},t[15]||(t[15]=[(0,y._)("i",{class:"fa-solid fa-pen-to-square"},null,-1),(0,y.Uk)(" Fairy piece mapping ")]),8,oX)])]),(0,y._)("div",oJ,[(0,y._)("div",o0,[!(0,y.SU)(b.SB).popeye.running&&(0,y.SU)(b.SB).popeye.output?((0,y.wg)(),(0,y.iD)("button",{key:0,type:"button",class:"btn btn-secondary",onClick:t[2]||(t[2]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,y.SU)(G.wD).play&&(0,y.SU)(G.wD).play(...t)}),disabled:(0,y.SU)(b.SB).popeye.error}," Play solution ",8,o1)):(0,y.kq)("",!0),(0,y.SU)(b.SB).popeye.running?((0,y.wg)(),(0,y.iD)("button",{key:2,type:"button",class:"btn btn-secondary",onClick:t[4]||(t[4]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,y.SU)(G.wD).cancel&&(0,y.SU)(G.wD).cancel(...t)})},t[18]||(t[18]=[(0,y._)("i",{class:"fa-solid fa-stop"},null,-1),(0,y.Uk)(" Cancel ")]))):((0,y.wg)(),(0,y.iD)("span",o2,[(0,y.SU)(b.SB).play.playing||!(0,y.SU)(b.SB).popeye.input.trim()?((0,y.wg)(),(0,y.iD)("button",{key:0,type:"button",class:"btn btn-primary disabled",title:(0,y.SU)(b.SB).play.playing?"Need to exit play mode first":"Input instructions first"},t[16]||(t[16]=[(0,y._)("i",{class:"fa-solid fa-play"},null,-1),(0,y.Uk)(" Run ")]),8,o3)):((0,y.wg)(),(0,y.iD)("button",{key:1,type:"button",class:"btn btn-primary",onClick:t[3]||(t[3]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,y.SU)(G.wD).run&&(0,y.SU)(G.wD).run(...t)}),title:"Run Popeye on your device!"},t[17]||(t[17]=[(0,y._)("i",{class:"fa-solid fa-play"},null,-1),(0,y.Uk)(" Run ")])))]))])])])],512),[[y.F8,!(0,y.SU)(b.SB).popeye.playing&&!(0,y.SU)(b.SB).popeye.editMap]]),!(0,y.SU)(b.SB).popeye.playing&&(0,y.SU)(b.SB).popeye.editMap?((0,y.wg)(),(0,y.iD)("div",o8,[(0,y.wy)((0,y._)("textarea",{class:"form-control mb-2",rows:"5","onUpdate:modelValue":t[5]||(t[5]=e=>(0,y.SU)(b.SB).popeye.mapping=e),placeholder:"Use the format like *2Q=G for each line."},null,512),[[y.nr,(0,y.SU)(b.SB).popeye.mapping]]),(0,y._)("div",o4,[(0,y._)("div",o5,[(0,y._)("div",o7,[(0,y._)("button",{type:"button",class:"btn btn-primary",onClick:t[6]||(t[6]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,y.SU)(G.wD).saveMap&&(0,y.SU)(G.wD).saveMap(...t)})}," Save setting "),(0,y._)("button",{type:"button",class:"btn btn-secondary",onClick:t[7]||(t[7]=e=>(0,y.SU)(b.SB).popeye.editMap=!1)}," Cancel ")])]),(0,y._)("div",o6,[(0,y._)("button",{type:"button",class:"btn btn-secondary",onClick:t[8]||(t[8]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,y.SU)(G.wD).resetMap&&(0,y.SU)(G.wD).resetMap(...t)})}," Reset ")])])])):(0,y.kq)("",!0),(0,y.SU)(b.SB).popeye.playing?((0,y.wg)(),(0,y.iD)("div",o9,[(0,y._)("div",ae,[(0,y._)("div",at,[(0,y._)("button",{type:"button",class:"btn btn-secondary",onClick:t[9]||(t[9]=e=>(0,y.SU)(G.wD).move(0)),disabled:(0,y.SU)(b.SB).popeye.index<=0},t[19]||(t[19]=[(0,y._)("i",{class:"fa-solid fa-angles-left fa-fw"},null,-1)]),8,an),(0,y._)("button",{type:"button",class:"btn btn-secondary",onClick:t[10]||(t[10]=e=>(0,y.SU)(G.wD).moveBy(-1)),disabled:(0,y.SU)(b.SB).popeye.index<=0},t[20]||(t[20]=[(0,y._)("i",{class:"fa-solid fa-angle-left fa-fw"},null,-1)]),8,ao),(0,y._)("button",{type:"button",class:"btn btn-secondary",onClick:t[11]||(t[11]=e=>(0,y.SU)(G.wD).moveBy(1)),disabled:(0,y.SU)(b.SB).popeye.index>=(0,y.SU)(b.SB).popeye.steps.length-1},t[21]||(t[21]=[(0,y._)("i",{class:"fa-solid fa-angle-right fa-fw"},null,-1)]),8,aa),(0,y._)("button",{type:"button",class:"btn btn-secondary",onClick:t[12]||(t[12]=e=>(0,y.SU)(G.wD).move((0,y.SU)(b.SB).popeye.steps.length-1)),disabled:(0,y.SU)(b.SB).popeye.index>=(0,y.SU)(b.SB).popeye.steps.length-1},t[22]||(t[22]=[(0,y._)("i",{class:"fa-solid fa-angles-right fa-fw"},null,-1)]),8,al)])]),(0,y._)("div",ai,[(0,y._)("button",{type:"button",class:"btn btn-secondary",onClick:t[13]||(t[13]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,y.SU)(G.wD).exit&&(0,y.SU)(G.wD).exit(...t)})}," Exit playing ")])])):(0,y.kq)("",!0),(0,y.wy)((0,y._)("div",{id:"Output",class:"form-control",innerHTML:(0,y.SU)(b.SB).popeye.output,onClick:t[14]||(t[14]=e=>(0,y.SU)(G.wD).step(e))},null,8,ar),[[y.F8,(0,y.SU)(b.SB).popeye.output&&7==(0,y.SU)(b.SB).tab]]),t[23]||(t[23]=(0,y._)("div",{class:"mt-2"},[(0,y._)("a",{href:"https://github.com/thomas-maeder/popeye/blob/master/py-engl.txt",target:"_blank"}," Popeye documentation ")],-1))],512)),[[y.F8,"py"==(0,y.SU)(b.SB).compute]])}),ac={key:0},au={key:1,type:"button",class:"btn btn-primary",disabled:""},ad={key:1},af={key:2},ap={key:0,class:"row align-items-baseline"},am={class:"col",style:{"flex-basis":"12rem"}},ah={class:"row gx-3 mb-2"},ag={class:"col"},ay={class:"col",style:{"flex-basis":"11rem"}},ab={class:"row gx-3 mb-2"},av={class:"col"},aS={class:"col mb-2",style:{"flex-basis":"10rem"}},aw={class:"btn-gap"},a_={key:1,disabled:"",class:"btn btn-primary"},ak={class:"mt-3"},aU={key:0},ax={key:0},aB={key:1},aC={key:2},aD={key:3},aA={class:"table"},aP={class:"align-top"},aN={class:"nowrap"},aE={class:"mt-2"},aI=["onClick"],aR=["textContent"],aO=(0,y.aZ)({__name:"stockfish",setup:e=>(e,t)=>(0,y.wy)(((0,y.wg)(),(0,y.iD)("div",null,[(0,y.SU)(b.i7).stockfish.status<(0,y.SU)(N.KO).needReload?((0,y.wg)(),(0,y.iD)("div",ac,[t[8]||(t[8]=(0,y._)("div",{class:"mb-3"},"To use this feature, we need to download Stockfish modules first.",-1)),(0,y.SU)(b.i7).stockfish.status==(0,y.SU)(N.KO).notDownloaded?((0,y.wg)(),(0,y.iD)("button",{key:0,type:"button",class:"btn btn-primary",onClick:t[0]||(t[0]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,y.SU)(ek).download&&(0,y.SU)(ek).download(...t)})},t[6]||(t[6]=[(0,y._)("i",{class:"fa-solid fa-download"},null,-1),(0,y.Uk)(" Download now! (39.5MB) ")]))):((0,y.wg)(),(0,y.iD)("button",au,t[7]||(t[7]=[(0,y._)("i",{class:"fa-solid fa-download"},null,-1),(0,y.Uk)(" Downloading... "),(0,y._)("i",{class:"fa-solid fa-spinner fa-spin"},null,-1)])))])):(0,y.SU)(b.i7).stockfish.status==(0,y.SU)(N.KO).needReload?((0,y.wg)(),(0,y.iD)("div",ad,t[9]||(t[9]=[(0,y._)("div",{class:"mb-3"},"Download complete. Please restart FEN Tool.",-1),(0,y._)("button",{type:"button",class:"btn btn-primary",onclick:"location.reload()"},[(0,y._)("i",{class:"fa-solid fa-rotate-right"}),(0,y.Uk)(" Restart FEN Tool now ")],-1)]))):((0,y.wg)(),(0,y.iD)("div",af,[(0,y.SU)(b.i7).stockfish.running<(0,y.SU)(N.MI).running?((0,y.wg)(),(0,y.iD)("div",ap,[(0,y._)("div",am,[(0,y._)("div",ah,[t[10]||(t[10]=(0,y._)("label",{class:"col-auto col-form-label"},"Depth:",-1)),(0,y._)("div",ag,[(0,y.Wm)(tE,{modelValue:(0,y.SU)(b.h).Stockfish.depth,"onUpdate:modelValue":t[1]||(t[1]=e=>(0,y.SU)(b.h).Stockfish.depth=e),min:1,title:"Search depth"},null,8,["modelValue"])])])]),(0,y._)("div",ay,[(0,y._)("div",ab,[t[11]||(t[11]=(0,y._)("label",{class:"col-auto col-form-label"},"Lines:",-1)),(0,y._)("div",av,[(0,y.Wm)(tE,{modelValue:(0,y.SU)(b.h).Stockfish.lines,"onUpdate:modelValue":t[2]||(t[2]=e=>(0,y.SU)(b.h).Stockfish.lines=e),min:1,title:"Number of lines to search"},null,8,["modelValue"])])])]),(0,y._)("div",aS,[(0,y.Wm)(tC,{modelValue:(0,y.SU)(b.h).Stockfish.study,"onUpdate:modelValue":t[3]||(t[3]=e=>(0,y.SU)(b.h).Stockfish.study=e),disabled:(0,y.SU)(b.h).Stockfish.lines<=1},{default:(0,y.w5)(()=>t[12]||(t[12]=[(0,y.Uk)("Study mode")])),_:1},8,["modelValue","disabled"])])])):(0,y.kq)("",!0),(0,y._)("div",aw,[(0,y.SU)(b.i7).stockfish.running?(0,y.SU)(b.i7).stockfish.running==(0,y.SU)(N.MI).starting?((0,y.wg)(),(0,y.iD)("button",a_,t[14]||(t[14]=[(0,y._)("i",{class:"fa-solid fa-play"},null,-1),(0,y.Uk)(" Initializing... ")]))):((0,y.wg)(),(0,y.iD)("button",{key:2,type:"button",class:"btn btn-secondary",onClick:t[5]||(t[5]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,y.SU)(ek).stop&&(0,y.SU)(ek).stop(...t)})},t[15]||(t[15]=[(0,y._)("i",{class:"fa-solid fa-stop"},null,-1),(0,y.Uk)(" Stop ")]))):((0,y.wg)(),(0,y.iD)("button",{key:0,type:"button",class:"btn btn-primary",onClick:t[4]||(t[4]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,y.SU)(ek).analyze&&(0,y.SU)(ek).analyze(...t)})},t[13]||(t[13]=[(0,y._)("i",{class:"fa-solid fa-play"},null,-1),(0,y.Uk)(" Analyze with Stockfish 16 ")])))]),(0,y._)("div",ak,[(0,y.SU)(b.SB).stockfish.depth?((0,y.wg)(),(0,y.iD)("div",aU,[(0,y._)("span",null,"Depth: "+(0,y.zw)((0,y.SU)(b.SB).stockfish.depth),1),(0,y.SU)(b.i7).stockfish.running==(0,y.SU)(N.MI).running?((0,y.wg)(),(0,y.iD)("span",ax,[(0,y.Uk)(" /"+(0,y.zw)((0,y.SU)(b.h).Stockfish.depth)+" ",1),t[16]||(t[16]=(0,y._)("i",{class:"fa-solid fa-spinner fa-spin ms-2"},null,-1))])):(0,y.kq)("",!0)])):(0,y.kq)("",!0),(0,y.SU)(b.SB).stockfish.mate?((0,y.wg)(),(0,y.iD)("div",aB,(0,y.zw)(((0,y.SU)(b.SB).stockfish.mate||"")[0])+" has mate in "+(0,y.zw)(((0,y.SU)(b.SB).stockfish.mate||"")[1])+". ",1)):(0,y.SU)(b.SB).stockfish.score?((0,y.wg)(),(0,y.iD)("div",aC," Score: "+(0,y.zw)((0,y.SU)(b.SB).stockfish.score),1)):(0,y.kq)("",!0),(0,y.SU)(b.SB).stockfish.header.length?((0,y.wg)(),(0,y.iD)("div",aD,[t[17]||(t[17]=(0,y.Uk)(" Solution is unique against best defense up to:")),t[18]||(t[18]=(0,y._)("br",null,null,-1)),(0,y.Uk)(" "+(0,y.zw)((0,y.SU)(ek).format((0,y.SU)(b.SB).stockfish.header)),1),t[19]||(t[19]=(0,y._)("br",null,null,-1)),t[20]||(t[20]=(0,y.Uk)(" And then: "))])):(0,y.kq)("",!0),(0,y._)("table",aA,[(0,y._)("tbody",null,[((0,y.wg)(!0),(0,y.iD)(y.HY,null,(0,y.Ko)((0,y.SU)(b.SB).stockfish.lines.filter(e=>e&&e.moves.length),e=>((0,y.wg)(),(0,y.iD)("tr",{key:e.pgn},[(0,y._)("td",aP,[(0,y._)("div",aN,(0,y.zw)(e.score),1),(0,y._)("div",aE,[(0,y._)("button",{type:"button",class:"btn btn-primary px-2 py-0 m-0",title:"Play this line",onClick:t=>(0,y.SU)(ek).play(e)},t[21]||(t[21]=[(0,y._)("i",{class:"fa-solid fa-play"},null,-1)]),8,aI)])]),(0,y._)("td",{class:"align-top w-100",textContent:(0,y.zw)((0,y.SU)(ek).format(e.moves))},null,8,aR)]))),128))])])])]))],512)),[[y.F8,"sf"==(0,y.SU)(b.SB).compute]])}),aW={class:"mb-3"},aM=["innerHTML"],aj={key:1,class:"mt-3 table"},aV={class:"align-top py-1"},aT=["onClick"],az={key:0,class:"fa-solid fa-spinner fa-spin ms-2"},aL=(0,y.aZ)({__name:"syzygy",setup:e=>(e,t)=>(0,y.wy)(((0,y.wg)(),(0,y.iD)("div",null,[(0,y._)("div",aW,[(0,y.SU)(b.i7).syzygy.running?((0,y.wg)(),(0,y.iD)("button",{key:1,class:"btn btn-secondary me-3",onClick:t[1]||(t[1]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,y.SU)(eI).stop&&(0,y.SU)(eI).stop(...t)})},t[3]||(t[3]=[(0,y._)("i",{class:"fa-solid fa-stop"},null,-1),(0,y.Uk)(" Stop ")]))):((0,y.wg)(),(0,y.iD)("button",{key:0,type:"button",class:"btn btn-primary",onClick:t[0]||(t[0]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,y.SU)(eI).run&&(0,y.SU)(eI).run(...t)})},t[2]||(t[2]=[(0,y._)("i",{class:"fa-solid fa-play"},null,-1),(0,y.Uk)(" Analyze with Syzygy tablebase ")])))]),(0,y.SU)(b.SB).syzygy.header?((0,y.wg)(),(0,y.iD)("div",{key:0,innerHTML:(0,y.SU)(b.SB).syzygy.header},null,8,aM)):(0,y.kq)("",!0),(0,y.SU)(b.SB).syzygy.lines?((0,y.wg)(),(0,y.iD)("table",aj,[((0,y.wg)(!0),(0,y.iD)(y.HY,null,(0,y.Ko)((0,y.SU)(b.SB).syzygy.lines,e=>((0,y.wg)(),(0,y.iD)("tr",{key:e.pgn},[(0,y._)("td",aV,[e.leaf?((0,y.wg)(),(0,y.iD)("button",{key:0,type:"button",class:"btn btn-primary px-2 py-0 m-0",title:"Play this line",onClick:t=>(0,y.SU)(eI).play(e)},t[4]||(t[4]=[(0,y._)("i",{class:"fa-solid fa-play"},null,-1)]),8,aT)):(0,y.kq)("",!0)]),(0,y._)("td",{class:"align-top w-100 py-1",style:(0,y.j5)("padding-left:".concat(e.indent+.5,"rem"))},[(0,y.Uk)((0,y.zw)((0,y.SU)(eI).format(e))+" ",1),e.searching?((0,y.wg)(),(0,y.iD)("i",az)):(0,y.kq)("",!0)],4)]))),128))])):(0,y.kq)("",!0)],512)),[[y.F8,"sy"==(0,y.SU)(b.SB).compute]])}),aq={class:"mb-3"},aF=(0,y.aZ)({__name:"compute",setup:e=>(e,t)=>(0,y.wy)(((0,y.wg)(),(0,y.iD)("section",{class:(0,y.C_)({show:7==(0,y.SU)(b.SB).tab})},[(0,y._)("div",aq,[(0,y.Wm)(ns,{modelValue:(0,y.SU)(b.SB).compute,"onUpdate:modelValue":t[0]||(t[0]=e=>(0,y.SU)(b.SB).compute=e),label:"Tool:",text:["Popeye","Stockfish","Syzygy"],value:["py","sf","sy"]},null,8,["modelValue"])]),(0,y.Wm)(as),(0,y.Wm)(aO),(0,y.Wm)(aL)],2)),[[y.F8,7==(0,y.SU)(b.SB).tab]])}),aQ={class:"mb-2 btn-gap"},aY={class:"mb-2 btn-gap"},aK={class:"btn-gap"},aG=(0,y.aZ)({__name:"api",setup(e){let t=!location.protocol.startsWith("http");return(e,n)=>((0,y.wg)(),(0,y.iD)("section",{class:(0,y.C_)({show:5==(0,y.SU)(b.SB).tab})},[(0,y._)("div",aQ,[(0,y.Wm)(e2,{factory:(0,y.SU)(e0).copyBase64,class:"btn-secondary",disabled:t},{default:(0,y.w5)(()=>n[0]||(n[0]=[(0,y.Uk)(" Copy base64 link ")])),_:1},8,["factory"]),(0,y.Wm)(e2,{factory:(0,y.SU)(e0).copyBase64Img,class:"btn-secondary",disabled:t},{default:(0,y.w5)(()=>n[1]||(n[1]=[(0,y.Uk)(" Copy base64 <img> code ")])),_:1},8,["factory"])]),n[6]||(n[6]=(0,y._)("h6",null,"Embed mode",-1)),(0,y._)("div",aY,[(0,y.Wm)(e2,{factory:(0,y.SU)(e0).copyEmbed,class:"btn-secondary"},{default:(0,y.w5)(()=>n[2]||(n[2]=[(0,y.Uk)(" Copy embed HTML code ")])),_:1},8,["factory"]),(0,y.Wm)(e2,{factory:(0,y.SU)(e0).copyEmbedUrl,class:"btn-secondary"},{default:(0,y.w5)(()=>n[3]||(n[3]=[(0,y.Uk)(" Copy just the URL ")])),_:1},8,["factory"])]),n[7]||(n[7]=(0,y._)("h6",null,"SDK mode",-1)),(0,y._)("div",aK,[(0,y.Wm)(e2,{factory:(0,y.SU)(e0).copySDK,class:"btn-secondary"},{default:(0,y.w5)(()=>n[4]||(n[4]=[(0,y.Uk)(" Copy SDK script tag ")])),_:1},8,["factory"]),(0,y.Wm)(e2,{factory:(0,y.SU)(e0).copyImg,class:"btn-secondary"},{default:(0,y.w5)(()=>n[5]||(n[5]=[(0,y.Uk)(" Copy SDK <img> code ")])),_:1},8,["factory"])])],2))}}),aH={class:"d-flex mb-4"},aZ=(0,y.aZ)({__name:"sections",setup:e=>(e,t)=>((0,y.wg)(),(0,y.iD)("div",aH,[(0,y.Wm)(tU),(0,y.Wm)(oL),(0,y.Wm)(na),(0,y.Wm)(aG),(0,y.Wm)(oC),(0,y.Wm)(ot),(0,y.Wm)(aF),(0,y.Wm)(oK)]))}),a$={class:"w-passive-100"},aX={class:"row gx-3 mb-1"},aJ={class:"col mb-2",style:{"flex-basis":"15rem","flex-grow":"1000"}},a0={class:"col ps-0 mb-2 text-end",style:{"white-space":"nowrap","flex-basis":"max-content"}},a1=["textContent"],a2={key:0,class:"btn-group"},a3=["disabled"],a8=(0,y.aZ)({__name:"header",setup(e){function t(){gtag("event","fen_copy"),navigator.clipboard.writeText(S.RI.value)}async function n(){gtag("event","fen_paste"),(0,S.dd)(await D(),!0)}return(e,o)=>((0,y.wg)(),(0,y.iD)("header",a$,[(0,y._)("div",aX,[(0,y._)("div",aJ,[(0,y.wy)((0,y._)("input",{type:"text",class:"form-control",placeholder:"Enter FEN here","onUpdate:modelValue":o[0]||(o[0]=e=>(0,y.dq)(S.RI)?S.RI.value=e:null),onChange:o[1]||(o[1]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,y.SU)(S.X4).update&&(0,y.SU)(S.X4).update(...t)})},null,544),[[y.nr,(0,y.SU)(S.RI)]])]),(0,y._)("div",a0,[(0,y._)("label",{class:"col-form-label pe-2",textContent:(0,y.zw)((0,y.SU)(b.i7).pieceCount)},null,8,a1),(0,y.SU)(b.i7).envReady&&(0,y.SU)(x.O).canCopy?((0,y.wg)(),(0,y.iD)("div",a2,[(0,y._)("button",{class:"btn btn-secondary",title:"Copy",onClick:t},o[2]||(o[2]=[(0,y._)("i",{class:"fa-solid fa-clipboard"},null,-1)])),(0,y.SU)(x.O).canPaste?((0,y.wg)(),(0,y.iD)("button",{key:0,class:"btn btn-secondary",disabled:(0,y.SU)(b.I3)(),title:"Paste",onClick:n},o[3]||(o[3]=[(0,y._)("i",{class:"fa-solid fa-paste"},null,-1)]),8,a3)):(0,y.kq)("",!0)])):(0,y.kq)("",!0)])])]))}}),a4={class:"text-center"},a5={class:"d-inline-block",style:{overflow:"hidden"}},a7={class:"d-inline-block position-relative"},a6={id:"Squares"},a9={class:"play-mask"},le={id:"DragZone",class:"flex-grow-0 pb-4"},lt=(0,y.aZ)({__name:"zone",setup:e=>(e,t)=>((0,y.wg)(),(0,y.iD)("div",a4,[(0,y._)("div",a5,[(0,y._)("div",{id:"Zone",class:(0,y.C_)(["d-inline-flex justify-content-center text-center collapse flex-wrap-reverse",{collapse:(0,y.SU)(b.i7).collapse}])},[(0,y._)("div",{id:"EditZone",class:"flex-grow-0 pb-4",style:(0,y.j5)({textAlign:b.i7.collapse?b.i7.hor?"center":"start":"unset"})},[(0,y._)("div",a7,[t[0]||(t[0]=(0,y._)("canvas",{id:"SN"},null,-1)),(0,y._)("div",a6,[(0,y.wy)((0,y._)("div",a9,null,512),[[y.F8,(0,y.SU)(b.I3)()]])])])],4),(0,y._)("div",le,[(0,y._)("div",{class:(0,y.C_)(["position-relative d-inline-block",{"mb-3":(0,y.SU)(b.i7).hor}]),style:{"line-height":"0"},role:"application"},[t[2]||(t[2]=(0,y._)("canvas",{id:"CN"},null,-1)),(0,y._)("div",{class:(0,y.C_)(["loader",{show:(0,y.SU)(b.i7).loading}])},t[1]||(t[1]=[(0,y._)("div",{class:"h-100 d-flex align-items-center justify-content-center"},[(0,y._)("i",{class:"display-1 fa-solid fa-spinner fa-spin"})],-1)]),2),t[3]||(t[3]=(0,y._)("img",{id:"PV"},null,-1))],2),(0,y.wy)((0,y._)("canvas",{id:"TP",class:(0,y.C_)({"ms-4":!(0,y.SU)(b.i7).hor}),role:"menu"},null,2),[[y.F8,!(0,y.SU)(b.u8)()]])])],2)])]))}),ln={class:"mb-4 row small"};var lo=n("2176");let la=(0,lo.default)({},[["render",function(e,t){return(0,y.wg)(),(0,y.iD)("footer",ln,t[0]||(t[0]=[(0,y._)("div",{class:"col flex-grow-1",style:{"flex-basis":"max-content"}},[(0,y.Uk)(" For more information and API, see "),(0,y._)("a",{href:"https://github.com/MuTsunTsai/fen-tool",target:"_blank"},"README"),(0,y.Uk)(". ")],-1),(0,y._)("div",{class:"col-auto text-end"},"Copyright \xa9 2023-2024 Mu-Tsun Tsai",-1)]))}]]),ll={style:{display:"contents"}},li={class:"d-flex justify-content-center p-3"},lr={class:"flex-grow-0 text-start",style:{"max-width":"100%"}},ls={class:"w-passive-100"},lc={key:0,src:"."},lu=(0,y.aZ)({__name:"app",setup:e=>(e,t)=>((0,y.wg)(),(0,y.iD)("div",ll,[(0,y._)("main",li,[(0,y._)("div",lr,[(0,y.Wm)(a8),(0,y.Wm)(lt),(0,y._)("div",ls,[(0,y.Wm)(eZ),(0,y.Wm)(aZ)]),t[0]||(t[0]=(0,y._)("hr",null,null,-1)),(0,y.Wm)(la)])]),(0,y.Wm)(eL),(0,y.Wm)(eq),(0,y.SU)(b.SB).split?((0,y.wg)(),(0,y.iD)("iframe",lc)):(0,y.kq)("",!0)]))});(0,ed.S)({getDefault:()=>b.h.board,getTitle:e=>e}),document.addEventListener("mousedown",e=>{var t;let n=null===(t=document.activeElement)||void 0===t?void 0:t.nodeName.toLowerCase();"input"!=n&&"textarea"!=n&&e.detail>1&&e.preventDefault()},!1),addEventListener("keydown",e=>{var t;if(!b.SB.play.playing&&!b.SB.popeye.playing)return;let n=null===(t=document.activeElement)||void 0===t?void 0:t.nodeName.toLowerCase();if("input"==n||"textarea"==n)return;let o=e.key;("a"==o||"ArrowLeft"==o)&&(e.preventDefault(),b.SB.play.playing?R(-1):G.wD.moveBy(-1)),("d"==o||"ArrowRight"==o)&&(e.preventDefault(),b.SB.play.playing?R(1):G.wD.moveBy(1))}),(0,y.vr)(lu).mount("#app"),b.i7.envReady=!0,(0,b.wH)(),(0,w.q_)(),_.fr.onmousedown=es,_.fr.ontouchstart=es,_.fr.ondragstart=e=>e.preventDefault(),_.fr.onwheel=ei,_.in.onmousedown=es,_.in.ontouchstart=es,document.body.onmousedown=e=>{!(0,b.I3)()&&e.target!=_.in&&e.target!=_.fr&&ea()},document.body.onmousemove=eo,document.body.ontouchmove=eo,document.body.onmouseleave=el,document.body.onmouseup=el,document.body.ontouchend=el,(0,y.m0)(()=>{document.body.classList.toggle("split",b.SB.split),Promise.resolve().then(()=>(0,w.l)({}))}),(0,y.m0)(S.tZ)},4097:function(e,t,n){function o(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!(t instanceof Object))return e;for(let l of Object.keys(t)){if(n&&e instanceof Object&&!(l in e))continue;let i=t[l];i instanceof Object?e[l]instanceof Object&&e[l]!=i?e[l]=o(e[l],i,n):e[l]=a(i):e[l]=i}return e}function a(e){return o(Array.isArray(e)?[]:{},e)}n.d(t,{d:function(){return l},n:function(){return o}});let l="function"==typeof structuredClone?structuredClone:a},2506:function(e,t,n){n.d(t,{Dm:function(){return a},WT:function(){return o},_N:function(){return l},cb:function(){return i},oh:function(){return r}});let o=1e3,a=8,l=3,i=64,r=97},375:function(e,t,n){function o(){let e;let t=async function(t){return await n,e(t)},n=new Promise(n=>{t.setup=function(t){e=t,n()}});return t}n.d(t,{Z:function(){return a},i:function(){return l}});let a=o(),l=o()},899:function(e,t,n){n.d(t,{Ab:function(){return s},S8:function(){return r},fr:function(){return c},in:function(){return i},m8:function(){return a},ut:function(){return l}});let o=document.createElement("canvas"),a=document.getElementById("CN")||o,l=document.getElementById("SN")||o,i=document.getElementById("TP")||o,r=document.getElementById("CanvasGhost")||o,s=document.getElementById("TemplateGhost")||o,c=document.getElementById("PV")},3276:function(e,t,n){n.d(t,{Il:function(){return g},KO:function(){return f},MI:function(){return p},Nm:function(){return m},V1:function(){return b},jl:function(){return y},mQ:function(){return w},mi:function(){return h},wg:function(){return S}});var o,a,l,i,r,s,c,u,d,f=((o={})[o.notDownloaded=0]="notDownloaded",o[o.downloading=1]="downloading",o[o.needReload=2]="needReload",o[o.ready=3]="ready",o);var p=((a={})[a.stop=0]="stop",a[a.starting=1]="starting",a[a.running=2]="running",a);var m=((l={})[l.counterclockwise=-1]="counterclockwise",l[l.clockwise=1]="clockwise",l[l.turn=2]="turn",l);var h=((i={})[i.r90=1]="r90",i[i.r180=2]="r180",i[i.r270=3]="r270",i[i.full=4]="full",i);var g=((r={}).black="b",r.white="w",r.neutral="n",r);var y=((s={}).normal="normal",s.pass="pass",s.retro="retro",s);var b=((c={})[c.bK=0]="bK",c[c.wK=1]="wK",c[c.nK=2]="nK",c[c.bQ=3]="bQ",c[c.wQ=4]="wQ",c[c.nQ=5]="nQ",c[c.bB=6]="bB",c[c.wB=7]="wB",c[c.nB=8]="nB",c[c.bN=9]="bN",c[c.wN=10]="wN",c[c.nN=11]="nN",c[c.bR=12]="bR",c[c.wR=13]="wR",c[c.nR=14]="nR",c[c.bP=15]="bP",c[c.wP=16]="wP",c[c.nP=17]="nP",c[c.bC=18]="bC",c[c.wC=19]="wC",c[c.nC=20]="nC",c[c.bX=21]="bX",c[c.wX=22]="wX",c[c.nX=23]="nX",c);var S=((u={})[u.k=0]="k",u[u.q=1]="q",u[u.b=2]="b",u[u.n=3]="n",u[u.r=4]="r",u[u.p=5]="p",u[u.c=6]="c",u[u.x=7]="x",u);var w=((d={})[d.edit=0]="edit",d[d.options=1]="options",d[d.database=2]="database",d[d.bbs=4]="bbs",d[d.api=5]="api",d[d.play=6]="play",d[d.compute=7]="compute",d[d.project=8]="project",d)},9683:function(e,t,n){n.d(t,{O:function(){return r},u:function(){return l}});let o=navigator.clipboard,a="canShare"in navigator,l=Math.min(2,Math.floor(devicePixelRatio)),i=matchMedia("(hover: none), (pointer: coarse)").matches,r={isTop:top==self,thread:"undefined"!=typeof SharedArrayBuffer,canShare:a,canSharePng:function(){if(!a)return!1;let e=atob("iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII"),t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);let n=new File([new Blob([t])],"1.png",{type:"image/png"});return navigator.canShare({files:[n]})}(),canCopy:o&&"writeText"in o,canPaste:o&&"readText"in o,canCopyImg:o&&"write"in o,isTouch:i,isTaiwan:navigator.languages.includes("zh-TW")}},6919:function(e,t,n){n.d(t,{A1:function(){return h},C3:function(){return m},Di:function(){return x},Fv:function(){return S},J7:function(){return l},MA:function(){return k},N0:function(){return b},Nv:function(){return d},Q5:function(){return B},S3:function(){return y},TP:function(){return a},U1:function(){return A},U_:function(){return P},_n:function(){return U},hD:function(){return D},hv:function(){return _},sV:function(){return w},uY:function(){return C}});var o=n(2506);let a="8/8/8/8/8/8/8/8",l="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",i="\\p{Extended_Pictographic}",r="\\p{Emoji_Modifier}",s="".concat("\\p{Regional_Indicator}","{2}|").concat(i,"\\uFE0F?").concat(r,"?(\\u200D").concat(i,"\\uFE0F?").concat(r,"?)*"),c="\\((!?)([kqbnrp])(\\d?)\\)",u="[-~]?(\\*\\d)?(".concat("[kqbnrpcxstadg]","|").concat("'(".concat(s,"|[^'])|''.."),")"),d=RegExp("^(?:".concat(s,")$"),"u"),f=RegExp("^(?:".concat(c,"|").concat(u,")$"),"iu"),p=RegExp("\\/|\\d+|".concat(c,"|").concat(u,"|."),"iug");function m(e){let t=e.match(p)||[];if(!t.some(e=>e.match(/^\d\d+$/)))return e;let n=[0],o=0;for(let e=0;e<t.length;e++){let a=t[e];if("/"==a)n[++o]=0;else if(a.match(/^\d+$/)){if(1==a.length)n[o]+=Number(a);else{let l=a.split("").map(e=>Number(e)).reduce((e,t)=>e+t,0);n[o]+=l,t[e]=l.toString()}}else n[o]++}return g(n)?t.join(""):e}function h(e){let t=e.match(p)||[],n=[0],o=0;for(let e of t)"/"==e?n[++o]=0:e.match(/^\d+$/)?n[o]+=Number(e):n[o]++;let a=n.length;if(1!=a){if(g(n))return{w:n[0],h:a}}}function g(e){let t=e[0];for(let n=1;n<e.length;n++)if(e[n]!=t)return!1;return!0}function y(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.Dm,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.Dm,a=e.match(p)||[],l=[],i=!1;for(let e of a){if("/"==e){if(!i){let e=l.length+t-l.length%t;for(;l.length<e;)l.push("")}}else if(e.match(/^\d+$/)){let t=Number(e);for(let e=0;e<t;e++)l.push("")}else l.push(e);if(i="/"!=e&&l.length%t==0,l.length==t*n)break}for(;l.length<t*n;)l.push("");return l}function b(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.Dm,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.Dm,a=0,l="";function i(){a&&(l+=a),a=0}for(let o=0;o<n;o++){for(let n=0;n<t;n++){let r=o*t+n;""==e[r]?a++:(i(),l+=e[r])}i(),o<n-1&&(l+="/")}return l}function S(e,t,n){if(!e.match(f)){if(e.match(d))e="'"+e;else{let t=[...e].length;e=1==t&&"'"!=e?"'"+e:2==t?"''"+e:""}}return(e=(e=e.replace(RegExp("^".concat(c,"$"),"i"),(e,t,n,o)=>{let a=n;return o&&(a="*"+o+a),t&&(a="-"+a),a})).replace(/^~/,"-").replace(/^-(?=.*')/,"")).startsWith("-")&&(e=e.toLowerCase()),e=_(e,t,n)}function w(e){let t=(e=_(e,!1,!0)).match(/^(-?)(?:\*(\d))?([kqbnrp])$/i);if(!t)return"";let n=_(t[3],!0);return t[1]||t[2]?"("+(t[1]?"!":"")+n+(t[2]||"")+")":n}function _(e,t,n){return e.match(/^-?(\*\d)?[sng]$/i)?(t?(n&&(e=e.replace("s","g").replace("S","G")),e=e.replace("n","s").replace("N","S")):(n&&(e=e.replace("s","n").replace("S","N")),e=e.replace("g","s").replace("G","S")),e):e}function k(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.Dm;return void 0===t&&(t=e%o.Dm,e=(e-t)/o.Dm),String.fromCharCode(o.oh+t)+(n-e)}function U(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.Dm;return{x:e.charCodeAt(0)-o.oh,y:t-Number(e[1])}}function x(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.Dm,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.Dm,{x:a,y:l}=U(e,n);return l*t+a}function B(e){return Array.from({length:e},e=>"")}function C(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:o.Dm,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:o.Dm,i=B(a*l);i.anime="";for(let o=0;o<l;o++)for(let r=0;r<a;r++){let s=r+t,c=o+n,u=0<=s&&s<a&&0<=c&&c<l;e[o*a+r]&&(i[c*a+s]=u?e[o*a+r]:"",i.anime+=k(o,r,l)+k(c,s,l))}return i}function D(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.Dm,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:o.Dm,l=B(n*a);l.anime="";for(let o=0;o<a;o++)for(let i=0;i<n;i++){let r=i,s=o;if("-"==t&&(r=n-1-r),("|"==t||"/"==t)&&(s=a-1-s),"/"==t||"\\"==t){let e=s-r;r+=e,s-=e}"/"==t&&(s=a-1-s),e[s*n+r]&&(l[o*n+i]=e[s*n+r],l.anime+=k(s,r,a)+k(o,i,a))}return l}function A(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.Dm,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:o.Dm,l=B(n*a);n==a&&(l.anime="");for(let o=0;o<n;o++)for(let i=0;i<a;i++){let{x:r,y:s}=function(e,t,n,o,a){return 1==a?{x:e,y:o-1-t}:2==a?{x:o-1-t,y:n-1-e}:{x:n-1-e,y:t}}(o,i,n,a,t);e[s*n+r]&&(l[o*a+i]=e[s*n+r],n==a&&(l.anime+=k(s,r,a)+k(o,i,a)))}return l}function P(e,t){return e.map(e=>{if(""==e||e.startsWith("-")||!t&&e.startsWith("'"))return e;let n=e.toLowerCase();return e=e==n?e.toUpperCase():n})}},737:function(e,t,n){n.d(t,{By:function(){return u},Cd:function(){return f},Cg:function(){return a},D_:function(){return d},n6:function(){return i},t_:function(){return p},z6:function(){return l}});var o=n(2506);let a=44,l="1echecs",i={pattern:void 0,bg:void 0,exHigh:!0,border:"1",blackWhite:!1,knightOffset:.6,SN:!1,size:44,w:o.Dm,h:o.Dm,fullFEN:!1,coordinates:!1,set:l,collapse:!0},r=/^\d+(,\d+)*$/,s=[26,32,38,44],c=["1echecs","alpha","goodCompanion","kilfiger","merida","mpchess","skak"];function u(e){if("string"==typeof e){if((e=e.replace(/\D/g,",").replace(/,+/g,",").replace(/^,/,"").replace(/,$/,"")).match(r))return e}}function d(e){let t=Object.assign({},i);if(e){let n=Number(e.size);s.includes(n)&&(t.size=n),e.set&&c.includes(e.set)&&(t.set=e.set),e.border=u(e.border),e.border&&(t.border=e.border),e.knightOffset&&0<e.knightOffset&&e.knightOffset<1&&(t.knightOffset=e.knightOffset),t.blackWhite=!!e.blackWhite,t.pattern=e.pattern,t.bg=e.bg,t.SN=e.SN||!1;let o=Math.floor(Number(e.w)),a=Math.floor(Number(e.h));o>0&&(t.w=o),a>0&&(t.h=a)}return t}let f=20;function p(e,t){let n=function(e){let t=e.split(",").map(e=>{let t=Number(e);return isNaN(t)?0:Math.abs(Math.floor(t))}),n=t.reduce((e,t)=>e+t,0);return{array:t,size:n}}(e.border),o=e.coordinates?{x:f,y:f}:{x:0,y:0};!0===t&&(o.y=0),!1===t&&(o.x=0);let a=e.w*e.size+2*n.size+o.x,l=e.h*e.size+2*n.size+o.y,i={x:n.size+o.x,y:n.size};return{w:a,h:l,border:n,offset:i,margin:o}}},2539:function(e,t,n){n.d(t,{$I:function(){return B},BC:function(){return U},Dd:function(){return A},Gh:function(){return g},LW:function(){return h},Os:function(){return D},P:function(){return d},PH:function(){return y},PX:function(){return p},SQ:function(){return u},Wh:function(){return C},h8:function(){return w},i9:function(){return _},nU:function(){return k},or:function(){return b}});var o=n(3421),a=n(6919),l=n(1671);function i(){let e=(0,o._)(["[[^]]+]"],["\\[[^\\]]+\\]"]);return i=function(){return e},e}function r(){let e=(0,o._)(["(+)?[a-z]) (S[ S]+S)"],["(\\+)?[a-z]\\) (\\S[ \\S]+\\S)"]);return r=function(){return e},e}function s(){let e=(0,o._)(["(?<mod>hcc)?(?:(?<move>0-0(?:-0)?|",")(?:",")*(?:",")?(?:=(?<cc>[nwb]))?)(?:",")*"]);return s=function(){return e},e}function c(){let e=(0,o._)(["(?<count>d+.(?:..)?)?(?<main>","(?:/",")*)(?: [+#=])?"],["(?<count>\\d+\\.(?:\\.\\.)?)?(?<main>","(?:\\/",")*)(?: [+#=])?"]);return c=function(){return e},e}let u="[a-h][1-8]",d="(?:[0-9A-Z][0-9A-Z]|[A-Z])",f=String.raw(i()),p=String.raw(r()),m="(?:[nwb])?r?".concat(d,"?(?<from>").concat(u,")[-*](?<to>").concat(u,")(?<ep> ep\\.)?(?<then>([-*]").concat(u,"(=[nwb]?").concat(d,")?)*)"),h="=(?<pc>[nwb])?(?<p>".concat(d,")"),g=["condition","2option","3stipulation","2sstipulation","3forsyth","2pieces","2twin"].map(l.d).join("|"),y=RegExp(g,"ig"),b=String.raw(s(),m,f,h,f),S=b.replace(/\?<[^>]+>/g,""),w=String.raw(c(),S,S);function _(e,t,n,o){return n=C(n),"w"==o&&(n=n.toUpperCase()),"b"==o&&(n=n.toLowerCase()),"n"==o&&(n="-"+n.toLowerCase()),e[(0,a.Di)(t)]=n,n}function k(e,t,n,o){o&&o.push(t+n);let l=(0,a.Di)(t),i=(0,a.Di)(n);return e[i]=e[l],e[l]="",e[i]}let U={"*2Q":"G","*2N":"N","*1N":"Z","*3N":"CA","*3B":"GI","*3Q":"LI","*1Q":"EQ","*2P":"BP","*1B":"AN","*1K":"PO","*2K":"ST","*3K":"DU","*2R":"WE","*3R":"PA",C:"I"},x={"*1B":"25,37,AL,AN,BM,C,CT,DB,GN,GY,NH","*1K":"PO","*1N":"36,AO,BK,BN,DR,GR,KP,LS,MA,MS,OH,RK,S1,S2,S3,S4,SQ,SS,SW,UU,Z,ZE,ZH,ZR","*1P":"BS,CP,MP","*1Q":"EQ,HA,KH,L,LE,NE","*1R":"DA,DK,EK,GT,MH,RM,RO,RR,SH,WA","*2B":"15,AR,BH,BT,BU,BW,ND,PR","*2K":"ST","*2N":"N","*2P":"BP","*2Q":"G","*2R":"DG,EM,RA,RF,RH,RW,WE","*3B":"BE,BL,FE,GI,LO,OK,RB,VA","*3K":"DU","*3N":"24,35,AH,CA,DS,GH,MO,OA,SA","*3P":"O,SP","*3Q":"16,AM,EH,KA,LI,M,OR,SE,SI","*3R":"BR,CH,CR,EA,FA,PA,RE,RL,TR",A:"AG,B1,B2,B3,BI,BO,CG,CY,DO,ET,F,FR,G2,G3,GE,GF,GL,KL,KO,LB,LH,LN,LR,MG,ML,MM,NA,NL,NO,PP,QE,QF,QN,QQ,RN,RP,RT,SK,SO,TH,WR",C:"I",N:"S"},B={custom:()=>({}),default:{}};for(let e in x)for(let t of x[e].split(","))B.default[t]=e;function C(e){let t=e.toUpperCase(),n=function(e){let t=B.custom();for(let n in t)if(t[n]==e)return n}(t)||B.default[t];return n?e==t?n:n.toLowerCase():e}function D(e){let t=e.startsWith("-")?"=":"";t&&(e=e.substring(1));let n=e.toUpperCase();if(function(e){return/^[KQBNRP]$/.test(e)}(n))e=e.replace("n","s").replace("N","S");else{let o=n==e,a=B.custom();if(!(n in a))return null;let l=a[n];2==(e=o?l:l.toLowerCase()).length&&(e="."+e),l.match(/^\d+$/)&&!t&&(t=o?"+":"-")}return t+e}function A(e,t,n){let o=(0,a.Di)(t),l=(0,a.Di)(n),i=e[l];e[l]=e[o],e[o]=i}},6281:function(e,t,n){n.d(t,{F:function(){return g},w:function(){return h}});var o=n(3421),a=n(2506),l=n(3276),i=n(6919),r=n(1671),s=n(2539);function c(){let e=(0,o._)(["s+(?<c>",")(?:s+(?:","))?(?<l>(?:s+",")+)"],["\\s+(?<c>",")(?:\\s+(?:","))?(?<l>(?:\\s+",")+)"]);return c=function(){return e},e}function u(){let e=(0,o._)(["","(?:",")+(?=s+(?:",")|$)"],["","(?:",")+(?=\\s+(?:",")|$)"]);return u=function(){return e},e}let d=["1Black","1Neutral","1White"].map(r.d).join("|"),f=["1Chameleon","2FrischAuf","2Functionary","2HalfNeutral","2HurdleColourChanging","1Jigger","1Kamikaze","1Magic","2Paralysing","2Protean","1Royal","1Uncapturable","1Volage"].map(r.d).join("|"),p="(?<p>".concat(s.P,")(?<sq>(?:").concat(s.SQ,")+)"),m=String.raw(c(),d,f,p),h=String.raw(u(),(0,r.d)("2pieces"),m,s.Gh);function g(e){let t=e.match(RegExp(h,"ig"));if(!t)return null;let n=(0,i.Q5)(a.cb);for(let e of t)for(let t of e.match(RegExp(m,"ig"))){let e=t.match(RegExp(m,"i")).groups,o=e.c[0].toLowerCase();for(let t of e.l.match(RegExp(p,"ig"))){let e=t.match(RegExp(p,"i")).groups,a=e.p.toUpperCase();for(let t of e.sq.match(RegExp(s.SQ,"g")))n[(0,i.Di)(t)]=function(e,t){if(2==t.length&&(t="."+t),e==l.Il.neutral)return"="+t;let n=e==l.Il.white;return t.match(/[A-Z]/)?n?t:t.toLowerCase():(n?"+":"-")+t}(o,a)}}return(0,i.N0)(n)}},6033:function(e,t,n){n.d(t,{Vl:()=>$,l5:()=>L});var o=n("3421"),a=n("4097"),l=n("6919"),i=n("1671"),r=n("2539"),s=n("3276");function c(){let e=(0,o._)(["^+(?<c>[nwb])(?<is>",")(?<at>",")(=(?<p>","))?$"],["^\\+(?<c>[nwb])(?<is>",")(?<at>",")(=(?<p>","))?$"]);return c=function(){return e},e}function u(){let e=(0,o._)(["^-([nwb]",")?(?<at>",")$"]);return u=function(){return e},e}let d=new RegExp(String.raw(c(),r.P,r.SQ,r.P)),f=new RegExp(String.raw(u(),r.P,r.SQ)),p=new RegExp("^(?<c>[nwb])".concat(r.P,"(?<from>").concat(r.SQ,")-&gt;(?<to>").concat(r.SQ,")(=(?<p>").concat(r.P,"))?$")),m=new RegExp("^".concat(r.P,"(?<from>").concat(r.SQ,")&lt;-&gt;").concat(r.P,"(?<to>").concat(r.SQ,")$")),h=new RegExp("^(?<at>".concat(r.SQ,")=(?<c>[nwb])?(?:r?(?<p>").concat(r.P,"))?$")),g=new RegExp("^I".concat(r.SQ,"(,").concat(r.SQ,")*$")),y=new RegExp(r.or),b=new RegExp(r.h8);function S(e){return e.pg?l.J7:e.fen}let w=new RegExp("^[nwb](?:hcc)?".concat(r.P,"(").concat(r.SQ,")--&gt;(").concat(r.SQ,")$")),_=new RegExp("^[nwb](?:hcc)?".concat(r.P,"(").concat(r.SQ,")&lt;--&gt;[nwb](?:hcc)?").concat(r.P,"(").concat(r.SQ,")$")),k=new RegExp("^([+-]?)([nwb])(?:hcc)?(".concat(r.P,")(").concat(r.SQ,")$")),U=new RegExp("^(".concat(r.P,")==&gt;(").concat(r.P,")$")),x=new RegExp("^mirror(".concat(r.SQ,")&lt;--&gt;(").concat(r.SQ,")$")),B=new RegExp("^shift(".concat(r.SQ,")==&gt;(").concat(r.SQ,")$")),C=/^rotate(90|180|270)$/;function D(e,t){let n=e.match(w);return!!n&&((0,r.nU)(t,n[1],n[2]),!0)}function A(e,t){let n=e.match(_);return!!n&&((0,r.Dd)(t,n[1],n[2]),!0)}function P(e,t){let n=e.match(k);return!!n&&("+"==n[1]||""==n[1]?(0,r.i9)(t,n[4],n[3],n[2]):(0,r.i9)(t,n[4],""),!0)}function N(e,t){let n;let o=e.match(x);if(!o)return!1;let a=(0,l._n)(o[1]),i=(0,l._n)(o[2]);return n=a.x==i.x?"|":a.y==i.y?"-":(a.x-i.x)*(a.y-i.y)>0?"\\":"/",W(t,(0,l.hD)(t,n)),!0}function E(e,t){let n=e.match(B);if(!n)return!1;let o=(0,l._n)(n[1]),a=(0,l._n)(n[2]);return W(t,(0,l.uY)(t,a.x-o.x,a.y-o.y)),!0}function I(e,t){let n=e.match(U);if(!n)return!1;let o=(0,r.Wh)(n[1]),a=o.toLowerCase(),l=(0,r.Wh)(n[2]),i=l.toLowerCase();for(let e=0;e<t.length;e++)t[e]==o&&(t[e]=l),t[e]==a&&(t[e]=i),t[e]=="-"+a&&(t[e]="-"+i);return!0}function R(e,t){let n=e.match(C);return!!n&&(W(t,(0,l.U1)(t,function(e){return"90"==e?s.Nm.counterclockwise:"180"==e?s.Nm.turn:s.Nm.clockwise}(n[1]))),!0)}function O(e,t){return"PolishType"==e&&(W(t,(0,l.U_)(t)),!0)}function W(e,t){e.length=0,e.push(...t)}function M(){let e=(0,o._)(["\n\n+|(?:",")|(?:",")"],["\\n\\n+|(?:",")|(?:",")"]);return M=function(){return e},e}function j(){let e=(0,o._)(["","s+(S*(?:d|[^ds]s+d+(?:.[05])?))"],["","\\s+(\\S*(?:\\d|[^\\d\\s]\\s+\\d+(?:\\.[05])?))"]);return j=function(){return e},e}function V(){let e=(0,o._)(["\bimitw*s+(?:",")+"],["\\bimit\\w*\\s+(?:",")+"]);return V=function(){return e},e}let T=new RegExp(r.PX),z=RegExp(String.raw(M(),r.PX,r.h8),"g");function L(e,t,n){return function(e,t,n,o){if(!t)return n;console.log(n);let c=function(e,t,n){var o;let a=function(e){var t;let n=e.replace(/\n/g," ").replace(r.PH,"\n$&").split("\n"),o=n.filter(e=>e.match((0,i.M)("2option","^"))).join(" ");return{imitators:(null===(t=n.filter(e=>e.match((0,i.d)("condition"))).join(" ").match(Q))||void 0===t?void 0:t.join(" ").match(RegExp(r.SQ,"g")))||[],duplex:Y.test(o),halfDuplex:K.test(o)}}(e),s=function(e){return e.split((0,i.M)("2twin","\\b","\\b")).map(e=>{var t;return null===(t=e.match(q))||void 0===t?void 0:t[1].replace(/\s/g,"")}).filter(e=>e)}(e),c={pg:/dia/i.test(s[0]),fen:function(e,t){if(!t)return e;let n=(0,l.S3)(e);for(let e of t)n[(0,l.Di)(e)]="-"+(0,r.Wh)("i");return(0,l.N0)(n)}($(t),a.imitators),imitators:a.imitators,ordering:F(s[0],a.halfDuplex)},u={stack:[],stipIndex:0,solutionPrinted:!1,currentProblem:c,board:(0,l.S3)(S(c)),ordering:c.ordering,imitators:null===(o=c.imitators)||void 0===o?void 0:o.concat()};return{duplexSeparator:a.duplex?function(e){let t=/^\n\n+ +1\./,n=e.replace(/\n\nsolution finished./,"\n  1.").match(/\n\n+[^\n]+/g).filter((e,n,o)=>n>0&&e.match(t)&&o[n-1].match(t)).map(e=>e.match(/^\n+/)[0].length);return"\n".repeat(Math.max(...n))}(n):"",initProblem:c,stipulations:s,options:a,state:u}}(e,t,n=n.replace(/<br>/g,"\n")),u=!1;return(n=n.replace(z,e=>{if(u)return e;try{if(function(e,t){let{state:n,duplexSeparator:o}=e;return!!t.match(/^\n+$/)&&(n.stack.length=0,n.board=(0,l.S3)(S(n.currentProblem)),t==o&&n.solutionPrinted&&(n.ordering=G(n.ordering)),!0)}(c,e)||function(e,t){let{state:n,stipulations:o,options:i,initProblem:r}=e,s=t.match(T);if(!s)return!1;n.solutionPrinted=!1,n.currentProblem=(0,a.d)(s[1]?n.currentProblem:r);let c=o[++n.stipIndex];c&&(n.currentProblem.ordering=F(c,i.halfDuplex),n.currentProblem.pg=/dia/i.test(c)),n.ordering=n.currentProblem.ordering,n.stack.length=0;let{fen:u,board:d}=function(e,t){let n=(0,l.S3)(e);for(let e of t.replace(/(mirror|shift|rotate) /g,"$1").replace(/ ==&gt; /g,"==&gt;").split(" "))(function(e,t){for(let n of[D,A,P,N,E,I,R,O])if(n(t,e))return})(n,e);return{fen:(0,l.N0)(n),board:n}}(n.currentProblem.fen,s[2]);return n.currentProblem.fen=u,n.board=n.currentProblem.pg?(0,l.S3)(l.J7):d,!0}(c,e))return e;return c.state.solutionPrinted=!0,function(e,t,n){let o;let{stack:a,ordering:i}=t,c=e.match(b).groups,u=c.count,w=S(t.currentProblem);if(u){let e=a.findIndex(e=>e.move==u||parseInt(e.move)>parseInt(u));e>=0&&(o=function(e,t,n){let o=t>0?e.stack[t-1].fen:n;return e.board=(0,l.S3)(o),e.imitators&&(e.imitators=(t>0?e.stack[t-1].imitators:e.currentProblem.imitators).concat()),e.stack.length=t,o}(t,e,w))}let _=i[!u||u.endsWith("...")?1:0],{imitators:k,board:U}=t,x=null==k?void 0:k.concat();if(k){for(let e of k)(0,r.i9)(U,e,"");k.length=0}let B=[];for(let e of c.main.split("/")){var C;(function(e,t,n,o,a){let l,i;if(n.move.startsWith("0-0")){let o=t==s.Il.white?"1":"8",c="0-0"==n.move?["g","h","f"]:["c","a","d"];(0,r.nU)(e,"e"+o,c[0]+o,a),i=(0,r.nU)(e,c[1]+o,l=c[2]+o,a)}else i=(0,r.nU)(e,n.from,l=n.to,a),n.ep&&(0,r.i9)(e,function(e){return e.replace("3","4").replace("6","5")}(n.to),""),n.then&&function(e,t,n){let o=t.to;for(let a of t.then.match(RegExp("".concat(r.LW,"|").concat(r.SQ),"g"))){let t=a.match(new RegExp(r.LW));if(t){let a=(0,r.i9)(e,o,t.groups.p,t.groups.pc);n&&(n[n.length-1]+="="+a)}else(0,r.nU)(e,o,a,n),o=a}}(e,n,a);"I"==n.p?(o.push(l),(0,r.i9)(e,l,"I",s.Il.neutral)):n.p&&(0,r.i9)(e,l,i=n.p,n.pc?n.pc:t),n.cc&&(0,r.i9)(e,l,i,n.cc)})(U,_,e.match(y).groups,k,B);let t=null===(C=e.match(/\[[^[\]]+(?=\])/g))||void 0===C?void 0:C.map(e=>e.substring(1));t&&t.forEach(e=>(function(e,t,n){var o,a,i,c,u;let y=null===(o=t.match(d))||void 0===o?void 0:o.groups;if(y)return(0,r.i9)(e,y.at,y.p||y.is,y.c);if(y=null===(a=t.match(f))||void 0===a?void 0:a.groups)return(0,r.i9)(e,y.at,"");if(y=null===(i=t.match(p))||void 0===i?void 0:i.groups){(0,r.nU)(e,y.from,y.to),y.p&&(0,r.i9)(e,y.to,y.p,y.c);return}if(y=null===(c=t.match(m))||void 0===c?void 0:c.groups)return(0,r.Dd)(e,y.from,y.to);if(y=null===(u=t.match(h))||void 0===u?void 0:u.groups)return(0,r.i9)(e,y.at,y.p||function(e,t){return e[(0,l.Di)(t)].match(RegExp("^(\\*\\d)?"+r.P+"$","i"))[0].toUpperCase()}(e,y.at),y.c||function(e,t){let n=e[(0,l.Di)(t)];return r.P.startsWith("-")?s.Il.neutral:n==n.toLowerCase()?s.Il.black:s.Il.white}(e,y.at));if(t.match(g))for(let o of(n.push(...t.match(RegExp(r.SQ,"g"))),n))(0,r.i9)(e,o,"I",s.Il.neutral)})(U,e,k))}let D=(0,l.N0)(U);return u&&a.push({move:u,color:_,fen:D,imitators:null==k?void 0:k.concat()}),x&&function(e,t){for(let n=0;n<t.length;n++){let[o,a]=t[n].match(/[a-z]\d/g).map(e=>(0,l._n)(e)),i=a.x-o.x,r=a.y-o.y;for(let o of e){let e=(0,l._n)(o);t[n]+=o+(0,l.MA)(e.y+r,e.x+i)}}}(x,B),(1==a.length&&u?n("*",w)+" ":"")+n(e,D,B,o)}(e,c.state,o)}catch(t){return console.log(t,e),u=!0,e}})).replace(/ {2} ?<span init/g,"<span").replace(/\n/g,"<br>")}(e,t,n,H)}let q=RegExp(String.raw(j(),(0,i.d)("3stipulation")),"i");function F(e){var t;let n,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return"wb";let a=e.match(/^(\d+-&gt;)?(?:exact-)?(?:(?:ser|pser|phser|semi|reci)-)?(hs|hr|h|s|r)?/i);return n=!a||a[1]?"wb":(null===(t=a[2])||void 0===t?void 0:t.toLowerCase())=="h"?"bw":"wb",o?G(n):n}let Q=RegExp(String.raw(V(),r.SQ),"ig"),Y=(0,i.M)("3duplex"),K=(0,i.M)("3halfDuplex");function G(e){return"wb"==e?"bw":"wb"}function H(e,t,n,o){let a="*"==e?"init ":"";t=t.replace(/-/g,"&#45;").replace(/"/g,"&#34;");let l="";return n&&n.length&&(l+=' data-anime="'.concat(n.join(","),'"')),o&&(l+=' data-before="'.concat(o,'"')),"<span ".concat(a,'class="step btn px-1 py-0" data-fen="').concat(t,'"').concat(l,">").concat(e,"</span>")}let Z=/[-+=]?(\.[0-9A-Z][0-9A-Z]|[A-Z])|\d+|\//ig;function $(e){return e.match(Z).map(e=>{if("/"==e||e.match(/^\d+$/))return e;let t=e.match(/^[-+=]/)?e[0]:null;return t&&(e=e.substring(1)),e.startsWith(".")&&(e=e.substring(1)),e=(0,r.Wh)(e),"+"==t&&(e=e.toUpperCase()),"-"==t&&(e=e.toLowerCase()),"="==t&&(e="-"+e.toLowerCase()),e}).join("")}},1671:function(e,t,n){n.d(t,{M:function(){return l},d:function(){return i}});var o=n(3421);function a(){let e=(0,o._)(["(?:","","|\b)"],["(?:","","|\\b)"]);return a=function(){return e},e}function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return RegExp(t+i(e)+n,"i")}function i(e){let t=4;return(e.match(/^\d/)&&(t=Number(e[0]),e=e.substring(1)),e.length<=t)?"\\b"+e+"\\b":"\\b"+e.substring(0,t)+function e(t){return""==t?"":String.raw(a(),t[0],e(t.substring(1)))}(e.substring(t))}},1528:function(e,t,n){n.d(t,{U:function(){return a}});var o,a=((o={})[o.notYet=0]="notYet",o[o.checkmate=1]="checkmate",o[o.draw=2]="draw",o)},9391:function(e,t,n){n.d(t,{u8:()=>D,h:()=>m,t4:()=>_,bi:()=>y,nj:()=>B,wH:()=>k,yC:()=>f,I3:()=>C,SB:()=>S,i7:()=>g});var o=n("4881"),a=n("737"),l=n("899"),i=n("9683"),r=n("4097"),s=n("2539"),c=n("2506"),u=n("3276"),d=n("7739");let f=new URL(location.href).searchParams,p={BBS:{Id:!0,coordinates:!0,notes:!0,uncoloredNotes:!1,redBlue:!1},DB:{use:"PDB",exact:!1},PLAY:d.CS,Stockfish:{study:!1,downloaded:!1,depth:50,lines:3},feature:{janko:!1},popeye:{pieceMap:s.BC},board:a.n6,project:[]},m=(0,o.qj)(p);s.$I.custom=()=>m.popeye.pieceMap;let h=matchMedia("(prefers-color-scheme: dark)");h.onchange=()=>g.isDark=h.matches;let g=(0,o.qj)({module:{chess:!1},envReady:!1,loading:!0,isDark:h.matches,pieceCount:"(0+0)",hor:!1,collapse:!1,dragging:!1,selection:null,stockfish:{status:u.KO.notDownloaded,running:u.MI.stop},syzygy:{running:!1}}),y={depth:0,score:null,mate:null,lines:[],header:[]},b={split:!1,tab:0,compute:"py",play:d.tu,popeye:{initFEN:"",index:0,steps:[],playing:!1,error:!1,running:!1,editMap:!1,mapping:"",input:"",output:"",intInput:"",intOutput:""},stockfish:y,syzygy:{header:null,lines:null}},S=(0,o.qj)(b),w=[];function _(e){w.push(e)}function k(){let e=JSON.parse(localStorage.getItem("settings")||"{}");(0,r.n)(p,e,!0),e.project&&(p.project=e.project),e.popeye&&(p.popeye.pieceMap=e.popeye.pieceMap),f.has("janko")&&(p.feature.janko=!0);let t=i.O.isTop?JSON.parse(sessionStorage.getItem("state")||"null"):null;for(let e of(t&&(0,r.n)(S,t),g.stockfish.status=m.Stockfish.downloaded?u.KO.ready:u.KO.notDownloaded,w))e();(0,o.m0)(U),(0,o.m0)(x)}function U(){localStorage.setItem("settings",JSON.stringify(m))}function x(){i.O.isTop&&sessionStorage.setItem("state",JSON.stringify(S))}function B(e,t,n){let{size:o,w:i}=m.board,{border:r,margin:s}=(0,a.t_)(m.board,t),u=r.size,d=t?c.Dm:c._N,f=e?d:i,p=(e||l.m8).clientWidth/(o*f+2*u+s.x),h={x:(u+s.x)*p,y:u*p,r:u*p,b:(u+s.y)*p},g=((n||i)*o+2*r.size+s.x)*p;return{s:o*p,offset:h,width:g}}function C(){return S.play.playing||S.popeye.playing}function D(){return g.hor&&S.popeye.playing}},7739:function(e,t,n){n.d(t,{CS:function(){return a},TF:function(){return r},th:function(){return f},tu:function(){return l},zi:function(){return i}});var o=n(3276);let a={symbol:null,ep:!0,negative:!1,zero:!1},l={initFEN:"",playing:!1,pendingPromotion:!1,moveNumber:-1,game:"",history:[],turn:"w",castle:{K:!0,Q:!0,k:!0,q:!0},retro:{uncapture:void 0,unpromote:!1,ep:!1},enPassant:"",halfMove:0,fullMove:1,mode:o.jl.normal,over:void 0},i=1,r=8,s=[o.V1.wQ,o.V1.wB,o.V1.wN,o.V1.wR],c=[o.V1.bQ,o.V1.bB,o.V1.bN,o.V1.bR],u=c.concat(o.V1.bP,o.V1.wP,o.V1.bC),d=s.concat(o.V1.bP,o.V1.wP,o.V1.wC),f={w:s,b:c,wr:u,br:d}},2519:function(e,t,n){let o,a,l,i,r;n.d(t,{U_:function(){return L},dS:function(){return T},wD:function(){return Q}});var s=n(3421),c=n(4881),u=n(3369),d=n(9391),f=n(6033),p=n(4109),m=n(5547),h=n(6919),g=n(1671),y=n(2539),b=n(6384),S=n(6281),w=n(2506),_=n(375);function k(){let e=(0,s._)(["(?:",")s.+$"],["(?:",")\\s.+$"]);return k=function(){return e},e}function U(){let e=(0,s._)(["","s+S+"],["","\\s+\\S+"]);return U=function(){return e},e}function x(){let e=(0,s._)(["","s+(S+)"],["","\\s+(\\S+)"]);return x=function(){return e},e}(0,d.t4)(()=>{d.SB.popeye.running=!1,d.SB.popeye.editMap=!1,d.SB.popeye.playing&&(0,m.zD)().then(()=>(0,c.Y3)(()=>q(!0)))});let B=!1,C=document.getElementById("Output");function D(){d.SB.popeye.output=d.SB.popeye.intOutput+'<br><i class="fa-solid fa-spinner fa-spin"></i>',A()}function A(){B&&(B=!1,(0,c.Y3)(()=>C.scrollTop=C.scrollHeight-C.clientHeight))}function P(e){o&&o.terminate(),o=void 0;let t=500-(performance.now()-l);A(),clearInterval(i),e?E():(d.SB.popeye.output=d.SB.popeye.intOutput,setTimeout(()=>d.SB.popeye.running=!1,Math.max(0,t)),N())}function N(){if(o)return o;let e=new Worker(new URL(n.p+n.u("10"),n.b),Object.assign({},{name:"py"},{type:void 0}));return o=e,e.onerror=t=>{let n;t.preventDefault(),clearInterval(i),d.SB.popeye.running=!1,t.filename?(e.terminate(),n="An error occur in the Popeye module. Please submit an issue about this.\n"+t.message):n="Unable to load the Popeye module; please check your network connection.",d.SB.popeye.output=I(n),o=void 0},e.onmessage=e=>{let t=e.data;if(++r>3e3)d.SB.popeye.intOutput+="<br>".concat(I("Too much output. Please modify the input to prevent excessive output."),"<br>"),P();else if(-2===t)(a/=2)<16&&(d.SB.popeye.intOutput+="<br>".concat(I("Not enough memory to run Popeye."),"<br>")),P(a>=16);else if(null===t)P();else if(B=B||function(){return!!C&&C.scrollTop+C.clientHeight+30>C.scrollHeight}(),"string"==typeof t.text&&(d.SB.popeye.intOutput+=R(t.text)+"<br>"),"string"==typeof t.err){if("Calling stub instead of signal()"==t.err)return;d.SB.popeye.error=!0,d.SB.popeye.intOutput+=I(R(t.err))}},e}function E(){let e=N(),t=d.SB.popeye;r=0,t.intOutput="",t.error=!1,t.running=!0,i=setInterval(D,500),l=performance.now(),e.postMessage({mem:a,input:"Opti NoBoard\n"+t.intInput})}function I(e){return'<span class="text-danger">'.concat(e,"</span>")}function R(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}let O=RegExp(String.raw(k(),["remark","2author","2origin","3title"].map(g.d).join("|")),"igm"),W=RegExp(String.raw(U(),(0,g.d)("5protocol")),"i"),M=(0,g.M)("3beginProblem"),j=(0,g.M)("3endProblem"),V=/\bnext\s[\s\S]+$/i,T=(0,g.d)("3forsyth"),z=(0,g.d)("2pieces");function L(e){if(RegExp("".concat(T,"|").concat(z),"i").test(e)){var t;let n=(0,S.F)(e)||(null===(t=e.match(RegExp(String.raw(x(),T),"i")))||void 0===t?void 0:t[1]);if(n)return{fen:n,imitators:[],fromInput:!0}}let{w:n,h:o}=d.h.board;if(n!=w.Dm||o!=w.Dm)throw Error();let a=[],l=(0,u.Ox)().map((e,t)=>{if(""==e)return e;let n=d.h.board.SN?e.replace("s","n").replace("S","N").replace("g","s").replace("G","S"):e;if(!(n=(0,y.Os)(n)))throw(0,_.Z)("Unspecified fairy piece: "+e);return n.match(/^=?i$/i)?(a.push((0,h.MA)(t)),""):n});return{fen:(0,h.N0)(l),imitators:a,fromInput:!1}}async function q(e){let t=d.SB.popeye;t.steps=[...C.querySelectorAll("span")],0!=t.steps.length&&(F(0,!0),t.playing=!0,e&&await (0,m.zD)(),(0,m.t1)([]),(0,c.Y3)(p.SI))}async function F(e,t){let n=d.SB.popeye,o=n.steps[e],a=n.steps[n.index];if(a&&a.dataset.anime&&(e==n.index-1&&!a.dataset.before||o.dataset.fen==a.dataset.before))await (0,b.jt)(o.dataset.fen,a.dataset.fen,a.dataset.anime,!0);else{var l;let t=o.dataset.before||(null===(l=n.steps[e-1])||void 0===l?void 0:l.dataset.fen);o.dataset.anime&&t?await (0,b.jt)(t,o.dataset.fen,o.dataset.anime):((0,b.p_)(),(0,u.dd)(o.dataset.fen))}!t&&a.classList.remove("active"),n.index=e,o.classList.add("active"),(0,c.Y3)(()=>(function(e){let t=e.offsetTop-10;C.scrollTop>t&&(C.scrollTop=t);let n=e.offsetTop+e.clientHeight-C.clientHeight+10;C.scrollTop<n&&(C.scrollTop=n);let o=e.offsetLeft-10;C.scrollLeft>o&&(C.scrollLeft=o);let a=e.offsetLeft+e.clientWidth-C.clientWidth+10;C.scrollLeft<a&&(C.scrollLeft=a)})(o))}let Q={run(){gtag("event","fen_popeye_run"),a=512;try{let e=d.SB.popeye;e.intInput=function(e){e=e.replace(O,"").replace(W,"").replace(M,"").replace(V,"").replace(j,"");let t=d.SB.popeye,{fen:n,imitators:o,fromInput:a}=L(e);return(t.initFEN=n,a)?((0,u.dd)((0,f.Vl)(n)),e):(o.length&&(e+="\ncond imitator "+o.join("")),"fors ".concat(n,"\n").concat(e))}(e.input),E()}catch{}},cancel(){o&&P()},play(){let e=d.SB.popeye;C.scrollTop=C.scrollLeft=0,gtag("event","fen_popeye_play"),e.output=(0,f.l5)(e.intInput,e.initFEN,e.intOutput),(0,c.Y3)(q)},step(e){let t=d.SB.popeye;if(!t.playing)return;let n=t.steps.indexOf(e.target);n>=0&&n!=t.index&&(e.preventDefault(),F(n))},exit(){let e=d.SB.popeye;(0,u.dd)(e.steps[0].dataset.fen),e.output=e.intOutput,e.playing=!1,(0,m.t1)([]),(0,c.Y3)(p.SI)},moveBy(e){let t=d.SB.popeye,n=t.index;(n+=e)<0&&(n=0),n>t.steps.length-1&&(n=t.steps.length-1),Q.move(n)},move(e){e!=d.SB.popeye.index&&F(e)},editMap(){gtag("event","fen_popeye_edit_map"),d.SB.popeye.mapping=Y(d.h.popeye.pieceMap),d.SB.popeye.editMap=!0},resetMap(){d.SB.popeye.mapping=Y(y.BC)},saveMap(){let e=d.SB.popeye.mapping.toUpperCase().split("\n"),t={};for(let n of e){let[e,o]=n.replace(/\s/g,"").split("=");e.match(K)&&o&&o.match(G)&&(t[e]=o)}d.h.popeye.pieceMap=t,d.SB.popeye.editMap=!1}};function Y(e){let t=[];for(let n in e)t.push("".concat(n,"=").concat(e[n]));return t.join("\n")}let K=/^(\*[1-3][KQBNRP]|(\*[1-3])?[CXSTAD]|''..|'.)$/,G=new RegExp("^".concat(y.P,"$"))},7737:function(e,t,n){n.d(t,{E:function(){return o}});function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return{id:Date.now()+t,...e}}},6384:function(e,t,n){let o;n.d(t,{jt:function(){return d},n4:function(){return u},p_:function(){return f}});var a=n(3438),l=n(1019),i=n(9857),r=n(9683),s=n(6919),c=n(737);let u={};function d(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return f(),(o=new p(e,t,n,a)).promise}function f(e){o&&o.stop(e?u.callback:void 0)}class p{stop(e){cancelAnimationFrame(this.request),o=void 0,e&&e(this.after),this.resolve()}step(e){let{ctx:t,options:n,callback:o}=u;!this.startTime&&(this.startTime=e);let a=(e-this.startTime)/150,s=Math.floor(a);if(s>=this.stages.length)return this.stop(o);let d=this.reverse?this.stages.length-1-s:s;s>this.cursor?(this.cursor=s,(0,i.DW)(t,this.stages[d].board,n,r.u),this.background=t.getImageData(0,0,t.canvas.width,t.canvas.height)):t.putImageData(this.background,0,0);let f=(0,c.t_)(n);t.save(),t.translate(f.offset.x,f.offset.y);let p=(0,l.N)(n,r.u),m=a-Math.floor(a);for(let e of(this.reverse&&(m=1-m),this.stages[d].moves)){let o=e.from.x*(1-m)+e.to.x*m,a=e.from.y*(1-m)+e.to.y*m;(0,i.am)(t,a,o,e.p,{assets:p,options:n,dpr:r.u})}t.restore(),this.request=requestAnimationFrame(this.anime)}constructor(e,t,n,o){(0,a._)(this,"promise",void 0),(0,a._)(this,"after",void 0),(0,a._)(this,"reverse",void 0),(0,a._)(this,"resolve",void 0),(0,a._)(this,"cursor",void 0),(0,a._)(this,"stages",void 0),(0,a._)(this,"anime",void 0),(0,a._)(this,"request",void 0),(0,a._)(this,"background",void 0),(0,a._)(this,"startTime",void 0),this.after=o?e:t,this.reverse=o,this.promise=new Promise(e=>this.resolve=e),this.cursor=-1,this.stages=[];let l=n.split(","),i=(0,s.S3)(e),{h:r,w:c}=u.options;for(let e of l){let t=[],n=e.match(/[`a-z]\d(=(\*\d)?[A-Z])?/g);for(let e=0;e<n.length;e+=2){var d;let o=n[e],a=n[e+1],l=(0,s.Di)(o,c,r),u={p:i[l],promo:null===(d=a.match(/[=](.+)$/))||void 0===d?void 0:d[1],from:(0,s._n)(o,r),to:(0,s._n)(a,r)};i[l]="",t.push(u)}for(let e of(this.stages.push({board:i.concat(),moves:t}),t))i[e.to.y*c+e.to.x]=e.promo||e.p}this.anime=this.step.bind(this),this.request=requestAnimationFrame(this.anime)}}},1019:function(e,t,n){n.d(t,{$:function(){return s},N:function(){return r}});var o=n(2506);let a=document.createElement("canvas"),l=a.getContext("2d"),i=new Map;function r(e,t){let n=e.set+e.size*t;return i.get(n)}async function s(e,t,n){let o=t.set+t.size*n;if(i.has(o))return i.get(o);let a=await c(e,t,n),l=await u(a);return i.set(o,l),l}async function c(e,t,n){let{set:i,size:r}=t;e+="/x"+n;let[s,c]=await Promise.all([u("".concat(e,"/").concat(i).concat(r,".png")),u("".concat(e,"/symbol").concat(r,".png"))]);return a.width=r*n*o._N,a.height=r*n*12,l.drawImage(s,0,0),l.drawImage(c,0,r*n*6),a.toDataURL()}function u(e){return new Promise((t,n)=>{let o=new Image;o.onload=()=>t(o),o.onerror=()=>{console.log("failed",e,location.href),n()},o.src=e})}},9857:function(e,t,n){n.d(t,{DW:function(){return h},V5:function(){return s},am:function(){return g}});var o=n(6919),a=n(1019),l=n(737),i=n(2506),r=n(3276);let s=["k","q","b","n","r","p","c","x","s","t","a","d"],c=document.createElement("canvas"),u=c.getContext("2d"),d=document.createElement("canvas"),f=d.getContext("2d"),p={26:"YdVh1QDVYdVh",32:"AAAKAAAAo/+jAAr/AP8KAKP/owAAAAoAAA==",38:"AAw+DAAM3P/cDD7/AP8+DNz/3AwADD4MAA==",44:"AC9yLwAv+f/5L3L/AP9yL/n/+S8AL3IvAA==",52:"A3i2eAN4////eLb/AP+2eP///3gDeLZ4Aw==",64:"AAAEHgQAAAA/5v/mPwAE5v///+YEHv//AP//HgTm////5gQAP+b/5j8AAAAEHgQAAA==",76:"AARZhFkEAAS7////uwRZ//////9ZhP//AP//hFn//////1kEu////7sEAARZhFkEAA==",88:"AEfE68RHAEf8/////EfE///////E6///AP//68T//////8RH/P////xHAEfE68RHAA=="},m={};function h(e,t,n,o,r,s){let{w:h,h:b,border:S,offset:w,margin:_}=(0,l.t_)(n,s),k=(0,a.N)(n,o);e.canvas.width=h*o,e.canvas.height=b*o,e.save(),e.scale(o,o);let U="classic"==n.bg,x=r||U;e.translate(w.x,w.y);for(let a=0;a<n.h;a++)for(let l=0;l<n.w;l++)!x&&y(e,a,l,n),g(e,a,l,t[a*n.w+l],{assets:k,options:n,dpr:o});if(e.restore(),U&&!r){(function(e,t,n){let o=e.canvas;d.width=c.width=o.width,d.height=c.height=o.height,u.drawImage(o,0,0),e.save(),e.fillStyle="white",e.fillRect(0,0,o.width,o.height),e.globalCompositeOperation="destination-in",e.drawImage(c,0,0),e.restore(),e.save();let a=function(e){if(!(e in m)){let t=atob(p[e]),n=[];for(let e=0;e<t.length;e++)n.push(t.charCodeAt(e));m[e]=n}return m[e]}(t*n),l=Math.sqrt(a.length),i=(l-1)/2;for(let t=0;t<l;t++)for(let n=0;n<l;n++){let r=a[n*l+t];0!=r&&(e.globalAlpha=r/255,f.drawImage(o,t-i,n-i))}e.restore()})(e,n.size,o),e.save(),e.scale(o,o),e.translate(w.x,w.y);for(let t=0;t<n.h;t++)for(let o=0;o<n.w;o++)y(e,t,o,n);e.restore(),e.drawImage(d,0,0),e.drawImage(d,0,0),e.drawImage(d,0,0),e.drawImage(c,0,0)}e.scale(o,o),void 0===s&&n.coordinates&&(e.save(),e.translate(w.x,w.y),function(e,t,n){let{size:o,w:a,h:r}=t;e.font="15px sans-serif",e.strokeStyle="black",e.lineWidth=2,e.fillStyle="white",e.lineJoin="round";for(let t=0;t<r;t++){let a=(t+1).toString(),i=e.measureText(a),s=o*(r-t)-o/2+5,c=(l.Cd-i.width)/2-l.Cd-n;e.strokeText(a,c,s),e.fillText(a,c,s)}for(let t=0;t<a&&t<26;t++){let a=String.fromCharCode(i.oh+t),s=e.measureText(a),c=o*r+l.Cd+n-5,u=o*t+(o-s.width)/2;e.strokeText(a,u,c),e.fillText(a,u,c)}}(e,n,S.size),e.restore()),!r&&function(e,t,n,o,a){e.save(),e.translate(a.x,0),n-=a.x,o-=a.y;let l=0;for(let a=0;a<t.array.length;a++){let i=t.array[a];if(e.strokeStyle=a%2?"white":"black",0==i)continue;e.lineWidth=i;let r=t.size-l-i/2;e.strokeRect(r,r,n-2*r,o-2*r),l+=i}e.restore()}(e,S,h,b,_)}function g(e,t,n,a,l){let{assets:i,options:c,dpr:u}=l,d=function(e,t){void 0===e&&(e="");let n=!!e&&e.startsWith("-");n&&(e=e.substring(1));let a=e.match(/^\*(\d)/),l=a&&a[1]?Number(a[1]):void 0;void 0!==l&&(e=e.substring(2)),l=Number(l)%r.mi.full,t.SN&&(e=(0,o.hv)(e,!1,!0));let i=e.toLowerCase(),c=s.indexOf(i),u=e.startsWith("'");return c<0&&!u?null:{neutral:n,rotate:l,isText:u,value:e,lower:i,typeIndex:c}}(a,c);if(!d)return;let{neutral:f,rotate:p,isText:m,value:h,lower:g,typeIndex:y}=d;e.save();let b=c.blackWhite,S=function(e,t){let{neutral:n,value:o,lower:a}=e;return n?t?0:2:o==a?0:1}(d,b),w=function(e,t,n,o){return e&&n?"n"==t?o.knightOffset:.5:1}(f,g,b,c),[_,k]=[p+1&2?1:0,2&p?1:0],{size:U}=c;e.translate((n+_)*U,(t+k)*U),0!==p&&e.rotate(Math.PI/2*p),m?function(e,t,n){var a;e.save();let l=o.Nv.test(t),i=n-4;e.font="".concat(i,"px sans-serif");let r=n-2,s=e.measureText(t);if(l&&s.width>r){let n=r/s.width;e.font="".concat(i*n,"px sans-serif"),s=e.measureText(t)}let c=(a=l?e.measureText("M"):s).actualBoundingBoxAscent-a.actualBoundingBoxDescent,u=(n-Math.min(s.width,r))/2,d=Math.max((n-c)/2,0);e.fillStyle="black",e.fillText(t,u,n-d,r),e.restore()}(e,h.substring(h.startsWith("''")?2:1),U):(e.drawImage(i,S*U*u,y*U*u,U*w*u,U*u,0,0,U*w,U),f&&b&&e.drawImage(i,(1+w)*U*u,y*U*u,U*(1-w)*u,U*u,U*w,0,U*(1-w),U)),e.restore()}function y(e,t,n,o){let a=function(e,t,n){if("mono"==e)return 1;let o=(t+n)%2;return"inverted"!=e&&(o=1-o),o}(o.pattern,t,n),l=o.size;e.save(),e.translate(n*l,t*l),"classic"==o.bg?(e.strokeStyle="black",e.lineWidth=l/60,e.fillStyle="#fff",e.fillRect(0,0,l,l),!a&&function(e,t){e.beginPath();let n=t/7.5;for(let o=0;o<t;o+=n)e.moveTo(t-o,0),e.lineTo(0,t-o),o>0&&(e.moveTo(o,t),e.lineTo(t,o));e.stroke()}(e,l)):(e.fillStyle=function(e,t){if("classic"==t)return"none";if("gray"==t)return e?"#fff":"#bbb";if("green"==t)return e?"#EEEED2":"#769656";else return e?"#FFCE9E":"#D18B47"}(a,o.bg),e.fillRect(0,0,l,l)),e.restore()}},5547:function(e,t,n){n.d(t,{Br:function(){return E},G2:function(){return O},Kv:function(){return h},Sk:function(){return N},Uw:function(){return U},ii:function(){return P},pz:function(){return R},t1:function(){return C},wY:function(){return I},zD:function(){return b}});var o=n(899),a=n(9391),l=n(3369),i=n(9857),r=n(1019),s=n(737),c=n(9683),u=n(6384),d=n(6919),f=n(9843),p=n(2506),m=n(3276);let h="k,K,-k,q,Q,-q,b,B,-b,n,N,-n,r,R,-r,p,P,-p,c,C,-c,x,X,-x".split(","),g="k,q,b,n,r,p,c,x,K,Q,B,N,R,P,C,X,-k,-q,-b,-n,-r,-p,-c,-x".split(",");function y(){return a.h.board.exHigh?2:1}async function b(){a.i7.loading=!0;let e=[(0,r.$)("assets",a.h.board,c.u)],t=y();c.u!=t&&e.push((0,r.$)("assets",a.h.board,t)),await Promise.all(e),a.i7.loading=!1}let S=o.m8.getContext("2d"),w=o.S8.getContext("2d"),_=o.in.getContext("2d"),k=o.Ab.getContext("2d"),U=document.createElement("canvas"),x=U.getContext("2d"),B={except:void 0,data:void 0};function C(e){e?B.except=e:e=B.except;let t=Object.assign({},a.h.board,a.i7.hor?{w:p.Dm,h:p._N}:{w:p._N,h:p.Dm}),n=function(){let e=a.i7.hor?g:h;return a.SB.play.playing&&"retro"==a.SB.play.mode&&(e=e.concat(),a.i7.hor?(e[6]="p",e[14]="P"):(e[18]="p",e[19]="P")),e}();(0,i.DW)(_,n,t,c.u,!1,a.i7.hor);let{size:o}=a.h.board;if((0,a.I3)()){let t="retro"==a.SB.play.mode;_.save();let{offset:n}=(0,s.t_)(a.h.board,a.i7.hor);_.translate(n.x,n.y),t&&function(e){_.save(),_.font="".concat(e/2,"px sans-serif"),_.strokeStyle="black",_.lineWidth=e/12,_.fillStyle="white",_.lineJoin="round",D(1,m.wg.x),D(2,m.wg.x),_.restore()}(o),function(e,t){_.save(),_.globalAlpha=a.i7.isDark?.5:.4,_.fillStyle="black";for(let n=0;n<p._N;n++)for(let o=0;o<p.Dm;o++){if(null==e?void 0:e.includes(o*p._N+n))continue;let[l,i]=a.i7.hor?[o,n]:[n,o];_.fillRect(l*t,i*t,t,t)}_.restore()}(e,o),t&&function(e,t){_.save();let n=a.SB.play.retro,o=e[0]==m.V1.bQ?0:1;_.lineWidth=t/12,_.strokeStyle="#0d6efd",n.uncapture&&A(o,i.V5.indexOf(n.uncapture)),n.unpromote&&A(1-o,5),_.restore()}(e,o),_.restore()}else if((0,i.DW)(k,n,t,c.u,!0,a.i7.hor),a.i7.selection){_.save();let{offset:e}=(0,s.t_)(a.h.board,a.i7.hor);_.lineWidth=o/12,_.strokeStyle="#0d6efd",_.translate(e.x,e.y);let t=h.indexOf(a.i7.selection),n=t%p._N,l=(t-n)/p._N;A(n,l),_.restore()}}u.n4.ctx=S;function D(e,t){let{size:n}=a.h.board,o=n/15;a.i7.hor&&([e,t]=[t,e]);let l=_.measureText("ep"),i=l.width,r=l.actualBoundingBoxDescent;_.strokeText("ep",e*n-i-o,t*n-r-o),_.fillText("ep",e*n-i-o,t*n-r-o)}function A(e,t){let{size:n}=a.h.board,o=n/8;a.i7.hor&&([e,t]=[t,e]);_.beginPath(),!function(){for(var a=arguments.length,l=Array(a),i=0;i<a;i++)l[i]=arguments[i];for(let a of l){_.moveTo(e*n+o*(a[0][0]+.5),t*n+o*(a[0][1]+.5));for(let l=1;l<a.length;l++)_.lineTo(e*n+o*(a[l][0]+.5),t*n+o*(a[l][1]+.5))}}([[0,2],[0,0],[2,0]],[[5,0],[7,0],[7,2]],[[7,5],[7,7],[5,7]],[[0,5],[0,7],[2,7]]),_.stroke()}async function P(e){e?B.data=e:e=B.data||(0,l.Ox)();let t=a.h.board;if((0,i.DW)(S,e,t,c.u),(0,i.DW)(x,e,t,y()),function(e){let t=0,n=0,o=0,l=0;for(let a of e)""!=a&&(a.startsWith("'")?l++:a.startsWith("-")?o++:a==a.toUpperCase()?t++:n++);a.i7.pieceCount="(".concat(t,"+").concat(n).concat(o>0?"+"+o:"").concat(l>0?"+"+l:"",")")}(e),!a.i7.dragging&&((0,i.DW)(w,e,t,c.u,!0),(0,l.qA)()),location.protocol.startsWith("http")){let e=document.getElementById("Save");e.href&&URL.revokeObjectURL(e.href),o.fr.src=e.href=URL.createObjectURL(await E())}}function N(e){let{w:t,h:n}=a.h.board;(0,i.DW)(e,(0,d.Q5)(t*n),a.h.board,c.u)}function E(){return new Promise(e=>U.toBlob(e))}function I(){N(o.ut.getContext("2d")),R()}function R(){P(),C(),a.h.project.length&&(0,f.O)()}async function O(){await b(),P()}}},t={};function n(o){var a=t[o];if(void 0!==a)return a.exports;var l=t[o]={exports:{}};return e[o].call(l.exports,l,l.exports,n),l.exports}n.m=e,n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.f={},n.e=function(e){return Promise.all(Object.keys(n.f).reduce(function(t,o){return n.f[o](e,t),t},[]))},n.u=function(e){return"471"===e?"static/js/async/chess.ccd03eb4.js":"946"===e?"static/js/async/olive.bca279fb.js":"936"===e?"static/js/async/ptt.6c7ebf7d.js":"10"===e?"static/js/async/py.dcb1f199.js":""+e+".javascript"},n.miniCssF=function(e){return""+e+".css"},n.h=function(){return"3140719d086c795c"},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},(()=>{var e={},t="fen-tool:";n.l=function(o,a,l,i){if(e[o]){e[o].push(a);return}if(void 0!==l){for(var r,s,c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var d=c[u];if(d.getAttribute("src")==o||d.getAttribute("data-webpack")==t+l){r=d;break}}}!r&&(s=!0,(r=document.createElement("script")).charset="utf-8",r.timeout=120,n.nc&&r.setAttribute("nonce",n.nc),r.setAttribute("data-webpack",t+l),r.src=o),e[o]=[a];var f=function(t,n){r.onerror=r.onload=null,clearTimeout(p);var a=e[o];if(delete e[o],r.parentNode&&r.parentNode.removeChild(r),a&&a.forEach(function(e){return e(n)}),t)return t(n)},p=setTimeout(f.bind(null,void 0,{type:"timeout",target:r}),12e4);r.onerror=f.bind(null,r.onerror),r.onload=f.bind(null,r.onload),s&&document.head.appendChild(r)}})(),n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e=[];n.O=function(t,o,a,l){if(o){l=l||0;for(var i=e.length;i>0&&e[i-1][2]>l;i--)e[i]=e[i-1];e[i]=[o,a,l];return}for(var r=1/0,i=0;i<e.length;i++){for(var o=e[i][0],a=e[i][1],l=e[i][2],s=!0,c=0;c<o.length;c++)(!1&l||r>=l)&&Object.keys(n.O).every(function(e){return n.O[e](o[c])})?o.splice(c--,1):(s=!1,l<r&&(r=l));if(s){e.splice(i--,1);var u=a();void 0!==u&&(t=u)}}return t}})(),(()=>{n.p="/";var e,t,o={max:2,addQuery:!0},a=o.max||3,l={},i=/[?#].*$/;function r(e,t,n,a,l){var r,s;return e.replace(t,n).replace(i,"")+(r=a+1,s=l,!0===o.addQuery?""!==s?"".concat(s,"&retry=").concat(r):"?retry=".concat(r):"function"==typeof o.addQuery?o.addQuery({times:r,originalQuery:s}):"")}var s={},c=n.e,u=n.u,d=null!==(e=null!==(t=n.miniCssF)&&void 0!==t?t:n.k)&&void 0!==e?e:function(){return null},f=n.l,p="[@rsbuild/plugin-assets-retry] ";function m(e,t,i,f,h,g,y,b){for(var S=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{count:0},w=arguments.length,_=Array(w>9?w-9:0),k=9;k<w;k++)_[k-9]=arguments[k];var U=c.apply(void 0,[e,t,i,f,h,g,y,b,S].concat(_));try{var x=u(e),B=d(e);"undefined"!=typeof window&&(x&&(window.__RB_ASYNC_CHUNKS__[x]=!0),B&&(window.__RB_ASYNC_CHUNKS__[B]=!0))}catch(e){console.error(p,"get original script or css filename error",e)}return"number"!=typeof(null==S?void 0:S.count)?U:(S.count+=1,U.catch(function(c){var d,w,k,U,x=S.count-1;try{var B=function(e,t){var a,i,c,d,f=(a=e,i=t,null===(c=l[a])||void 0===c?void 0:c[i]),p=t+1;if(0===t||void 0===f)d=function(e){var t,a,l,i=u(e),s=n.p,c=s.startsWith("/")?window.origin+s+i:s+i,d=(t=c.split("?")[1])?"?".concat(t.split("#")[0]):"",f=null!==(a=null===(l=o.domain)||void 0===l?void 0:l[0])&&void 0!==a?a:window.origin;return{nextDomain:f,nextRetryUrl:r(c,f,f,0,d),originalScriptFilename:i,originalSrcUrl:c,originalQuery:d}}(e),l[e]=[];else{var m,h,g,y,b,S=f.originalScriptFilename,w=f.originalSrcUrl,_=f.originalQuery,k=(m=f.nextDomain,g=null!==(h=o.domain)&&void 0!==h?h:[],y=function(e){for(var t,n=null!==(t=o.domain)&&void 0!==t?t:[],a="",l=0;l<n.length;l++)if(-1!==e.indexOf(n[l])){a=n[l];break}return a||window.origin}(m),b=g.indexOf(y),g[(b+1)%g.length]||m);d={nextDomain:k,nextRetryUrl:r(f.nextRetryUrl,f.nextDomain,k,t,_),originalScriptFilename:S,originalSrcUrl:w,originalQuery:_}}return l[e][p]=d,s[e]=d,d}(e,x);w=B.originalScriptFilename,k=B.nextRetryUrl,U=B.nextDomain}catch(e){throw console.error(p,"failed to get nextRetryUrl",e),c}var C,D=!!(null==c||null===(d=c.message)||void 0===d?void 0:d.includes("CSS chunk")),A=function(e){return{times:e,domain:U,url:k,tagName:D?"link":"script",isAsyncChunk:!0}},P=A(x);if(x>=a)throw c.message=null!==(C=c.message)&&void 0!==C&&C.includes("retries:")?c.message:"Loading chunk ".concat(e,' from "').concat(w,'" failed after ').concat(a,' retries: "').concat(c.message,'"'),"function"==typeof o.onFail&&o.onFail(P),c;var N=o.test;if(N){if("string"==typeof N){var E=new RegExp(N);N=function(e){return E.test(e)}}if("function"!=typeof N||!N(k))throw c}if(o.domain&&o.domain.length>0&&-1===o.domain.indexOf(U))throw c;return"function"==typeof o.onRetry&&o.onRetry(P),m.apply(void 0,[e,t,i,f,h,g,y,b,S].concat(_)).then(function(e){var t=(null==S?void 0:S.count)===x+2;if("function"==typeof o.onSuccess&&t){var n=A(x+1);o.onSuccess(n)}return e})}))}function h(e,t,n,o){for(var a=s[o],l=arguments.length,i=Array(l>4?l-4:0),r=4;r<l;r++)i[r-4]=arguments[r];return f.apply(void 0,[a?a.nextRetryUrl:e,t,n,o].concat(i))}!function(){"undefined"==typeof window||window.__RB_ASYNC_CHUNKS__||(window.__RB_ASYNC_CHUNKS__={});try{n.e=m,n.l=h}catch(e){console.error(p,"Register async chunk retry runtime failed",e)}}()})(),n.rv=function(){return"1.1.8"},(()=>{n.b=document.baseURI||self.location.href;var e={980:0};n.f.j=function(t,o){var a=n.o(e,t)?e[t]:void 0;if(0!==a){if(a)o.push(a[2]);else{var l=new Promise(function(n,o){a=e[t]=[n,o]});o.push(a[2]=l);var i=n.p+n.u(t),r=Error();n.l(i,function(o){if(n.o(e,t)&&(0!==(a=e[t])&&(e[t]=void 0),a)){var l=o&&("load"===o.type?"missing":o.type),i=o&&o.target&&o.target.src;r.message="Loading chunk "+t+" failed.\n("+l+": "+i+")",r.name="ChunkLoadError",r.type=l,r.request=i,a[1](r)}},"chunk-"+t,t)}}},n.O.j=function(t){return 0===e[t]};var t=function(t,o){var a=o[0],l=o[1],i=o[2],r,s,c=0;if(a.some(function(t){return 0!==e[t]})){for(r in l)n.o(l,r)&&(n.m[r]=l[r]);if(i)var u=i(n)}for(t&&t(o);c<a.length;c++)s=a[c],n.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return n.O(u)},o=self.webpackChunkfen_tool=self.webpackChunkfen_tool||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))})(),n.ruid="bundler=rspack@1.1.8";var o=n.O(void 0,["454","165"],function(){return n("3813")});o=n.O(o)})();