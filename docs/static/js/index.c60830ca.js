(()=>{"use strict";var e={5753:function(e,t,n){let a;n.d(t,{O:()=>p,S:()=>d});var o=n(5420),l=n(9898);let i=document.currentScript,r="img[fen]",s=document.createElement("iframe");function c(e){let t=new MessageChannel;t.port1.onmessage=t=>{e.src=t.data,e.title=a.getTitle(n,e.dataset)};let n=e.getAttribute("fen"),i=(0,l.D_)(Object.assign({},a.getDefault(),e.dataset)),r=(0,o.A1)(n);r&&Object.assign(i,r);let{w:c,h:u}=(0,l.t_)(i);e.width=c,e.height=u,s.contentWindow.postMessage({fen:n,options:i},"*",[t.port2])}function u(e){e instanceof Element&&(e.matches(r)?c(e):e.querySelectorAll(r).forEach(e=>c(e)))}async function d(e){let t=new URL(i.src).origin,n=new URL(t+"/fen-tool/api/");a=e,document.head.appendChild(s),await new Promise(e=>{let t=n=>{n.source==s.contentWindow&&(removeEventListener("message",t),e())};addEventListener("message",t),s.src=n.toString()});let o=document.documentElement;new MutationObserver(e=>{for(let t of e)if("attributes"==t.type){let e=t.attributeName.toLowerCase(),n=e.startsWith("data");t.target==i&&n&&u(document.body),"IMG"==t.target.nodeName&&("fen"==e||n)&&c(t.target)}else for(let e of t.addedNodes)u(e)}).observe(o,{childList:!0,attributes:!0,subtree:!0}),u(o)}function p(){u(document.body)}s.style.display="none"},8002:function(e,t,n){n.d(t,{Ar:()=>U,SI:()=>S,l:()=>y,q_:()=>_});var a=n(6770),o=n(4189),l=n(6871),i=n(7536),r=n(7955),s=n(864),c=n(9898),u=n(2526),d=n(5753),p=n(4791);let f=document.getElementById("Zone"),m=document.getElementById("DragZone"),h=document.getElementById("EditZone");function g(){return document.body.clientWidth/(i.SB.split?2:1)}async function y(e,t){var n,o,f;let m,h,y=i.h.board,b={};for(let t in e)b[t]=e[t]!==y[t];Object.assign(y,e);let{border:_,margin:k,w:U,h:x}=(0,c.t_)(y),B=function(e,t,n){let a=w();return g()<(e.w+p._N)*e.size+t.x+4*n.size+4.2*a}(y,k,_);b.mode=B!==i.i7.hor,i.i7.hor=B;let C=b.w||b.h;(C||t)&&(0,s.co)();let D=t||b.set||b.size,A=D||b.border,N=A||C,P=A||b.mode;P&&(n=y.size,o=_.size,f=k,m=(p._N*n+2*o)*u.uN,h=(p.Dm*n+2*o)*u.uN,i.i7.hor?[m,h]=[h+f.x*u.uN,m]:h+=f.y*u.uN,(l.in.width!==m||l.in.height!==h)&&(l.Ab.width=l.in.width=m,l.Ab.height=l.in.height=h)),N&&function(e,t){let n=e*u.uN,a=t*u.uN;(l.m8.width!==n||l.m8.height!==a)&&(l.ut.width=l.S8.width=l.m8.width=n,l.ut.height=l.S8.height=l.m8.height=a),(0,r.Sk)(l.ut.getContext("2d"))}(U,x),S(),D&&(await (0,r.zD)(),i.h.project.length&&(0,d.O)()),N&&(0,r.ii)(),P&&(0,r.t1)(),(0,a.Y3)(S)}function b(e){let{w:t,h:n}=i.h.board,a=(0,s.Ox)();y(e),(0,s.v)(a,t,n)}function S(){f.style.maxWidth="calc(".concat(g(),"px + 1rem)"),l.m8.style.width=l.m8.width/u.uN+"px",l.in.style.width=l.in.width/u.uN+"px";let{w:e}=i.h.board,t=(0,i.nj)(void 0,void 0,p.Dm);if(i.i7.hor){if(e>p.Dm)l.in.style.width=t.width+"px";else if(e<p.Dm){let{width:t}=(0,i.nj)(l.in,!0,e);l.m8.style.width=t+"px"}}s.nC.style.borderWidth="".concat(t.offset.y,"px ").concat(t.offset.r,"px ").concat(t.offset.b,"px ").concat(t.offset.x,"px");let n=w();i.h.board.collapse?(f.style.width="120%",f.style.width=m.clientWidth+4*n+"px"):f.style.width="unset",l.S8.style.width=l.m8.clientWidth+"px",l.S8.style.height=l.m8.clientHeight+"px",l.Ab.style.width=l.in.clientWidth+"px",l.Ab.style.height=l.in.clientHeight+"px",(0,s.gg)(t.s),f.clientWidth<m.clientWidth+l.m8.clientWidth+6*n?(h.style.marginTop=-m.clientHeight+"px",h.style.width=m.clientWidth+"px",i.i7.collapse=!0):(h.style.marginTop="0",h.style.width="unset",i.i7.collapse=!1)}function w(){return parseFloat(getComputedStyle(document.documentElement).fontSize)}async function _(){window.addEventListener("resize",()=>y({}));let e=i.yC.get("fen");await y({},!0),s.uz.draw=r.ii,s.uz.setOption=y,e?((0,s.dd)(e,!0),(0,s.qA)()):(0,s.uu)(),setTimeout(S,p.WT)}if(document.addEventListener("visibilitychange",()=>{"visible"==document.visibilityState&&((0,r.ii)(),(0,r.t1)())}),u.OB.isTop)window.resizeIframe=function(){let e=document.getElementsByTagName("iframe")[0];e&&(e.style.minHeight=e.contentDocument.body.scrollHeight+"px")};else{function k(){try{parent.resizeIframe()}catch{}}"undefined"!=typeof ResizeObserver?new ResizeObserver(k).observe(document.body):new MutationObserver(k).observe(document.body,{childList:!0}),k()}let U={setDimension:b,setBorder(e){let t=(0,c.By)(e.value);t?(e.value=t,y({border:t})):e.value=i.h.board.border},get set(){return i.h.board.set},set set(v){y({set:v})},get size(){return i.h.board.size},set size(v){y({size:v})},get height(){return i.h.board.h},set height(v){b({h:v})},get width(){return i.h.board.w},set width(v){b({w:v})}};addEventListener("storage",e=>{if(e.storageArea==localStorage&&"settings"==e.key){let e=localStorage.getItem("settings"),t=e?JSON.parse(e):null;(0,o.n)(i.h,t,!0),y({},!0)}})},864:function(e,t,n){n.d(t,{Ox:()=>D,Qt:()=>j,RI:()=>m,Wc:()=>T,X4:()=>L,ZD:()=>W,co:()=>y,dd:()=>x,gg:()=>g,gx:()=>V,mj:()=>I,nC:()=>p,oO:()=>M,qA:()=>C,tZ:()=>E,uu:()=>P,uz:()=>f,v:()=>N,xG:()=>d,xL:()=>A,zF:()=>U});var a=n(6770),o=n(6871),l=n(5420),i=n(7536),r=n(6476),s=n(4791),c=n(7683);let u=["K","Q","k","q"],d=Array(s.cb),p=document.getElementById("Squares"),f={},m=(0,a.XI)("");function h(e){var t;null==(t=f.draw)||t.call(f,e)}function g(e){for(let t of(p.style.width=o.m8.clientWidth+"px",p.style.height=o.m8.clientHeight+"px",d))t.style.fontSize=e-10+"px",t.style.lineHeight=e-10+"px"}function y(){let{w:e,h:t}=i.h.board,n=e*t;p.style.gridTemplateColumns="repeat(".concat(e,", 1fr)"),p.style.gridTemplateRows="repeat(".concat(t,", 1fr)");for(let e=0;e<n||e<d.length;e++){if(!d[e]){let t=document.createElement("input");d[e]=t,t.type="text",t.addEventListener("input",_),t.addEventListener("change",w),t.addEventListener("focus",b),t.addEventListener("blur",S),t.classList.add("square"),p.appendChild(t)}d[e].style.display=e<n?"block":"none"}}function b(){if(this.style.zIndex="10",i.i7.collapse){let e=D();e[d.indexOf(this)]="",h(e)}this.select()}function S(){this.style.zIndex="unset",k(this)?P():i.i7.collapse&&h(D())}function w(){k(this),i.i7.collapse&&this.blur(),P()}function _(){if(!i.i7.collapse){let e=D();e[d.indexOf(this)]=(0,l.Fv)(this.value,i.h.board.SN),h(e)}}function k(e,t){let n=(0,l.Fv)(e.value,i.h.board.SN,t),a=n!==e.value;return e.value=n,a}function U(e,t){let n=e.value!==t;e.value=t,k(e),n&&P()}function x(e,t){m.value=B(e)[0]+(i.h.board.fullFEN?R():""),O(t)}function B(e){let t=e.split(" ");if(t[1]&&t[1].match(/^[wb]$/)&&(i.SB.play.turn=t[1]),t[2]&&t[2].match(/^(-|[kq]+)$/i))for(let e in i.SB.play.castle)i.SB.play.castle[e]=t[2].includes(e);return t[3]&&t[3].match(/^[a-h][36]$/)&&(i.SB.play.enPassant=t[3]),t[4]&&t[4].match(/^\d+$/)&&(i.SB.play.halfMove=Number(t[4])),t[5]&&t[5].match(/^\d+$/)&&(i.SB.play.fullMove=Number(t[5])),t}function C(){let e=new URL(location.href).searchParams.get("fen")||l.TP,t=m.value.split(" ")[0],n=t==l.TP?"":"?fen="+encodeURIComponent(t);t!==e&&history.pushState(null,"",n||".")}function D(){let{w:e,h:t}=i.h.board;return d.slice(0,e*t).map(e=>e.value)}function A(){return D().map(e=>(0,l.hv)(e,!1,!0))}function N(e,t,n){let{w:a,h:o}=i.h.board;for(let l=0;l<o;l++)for(let o=0;o<a;o++){let i=d[l*a+o];l<n&&o<t?i.value=e[l*t+o]:i.value=""}P()}function P(){h(E())}function E(){let{w:e,h:t,fullFEN:n}=i.h.board,a=D();return m.value=(0,l.N0)(a,e,t)+(n?R():""),a}function I(){let e=function(){let{w:e,h:t}=i.h.board;if(e!=s.Dm||t!=s.Dm)return null;let n=A();for(let e of n)if(""!=e&&!e.match(/^[kqbsnrp]$/i))return null;return(0,l.N0)(n)}();return e?e+R(!0):null}function R(e){let t=i.SB.play;t.enPassant.match(/^[a-h][36]$/)||(t.enPassant=""),e&&"pass"==t.mode&&t.enPassant&&"3"==t.enPassant[1]!=("b"==t.turn)&&(t.turn="b"==t.turn?"w":"b");let n="retro"==t.mode;e&&((n||!Number.isSafeInteger(t.halfMove)||t.halfMove<0)&&(t.halfMove=0),(n||!Number.isSafeInteger(t.fullMove)||t.fullMove<1)&&(t.fullMove=1));let a=n?"-":function(e){let t=D(),n="",a=i.SB.play.castle;return e?("K"==t[60]&&(a.K&&"R"==t[63]&&(n+="K"),a.Q&&"R"==t[56]&&(n+="Q")),"k"==t[4]&&(a.k&&"r"==t[7]&&(n+="k"),a.q&&"r"==t[0]&&(n+="q"))):(a.K&&(n+="K"),a.Q&&(n+="Q"),a.k&&(n+="k"),a.q&&(n+="q")),""==n?"-":n}(e),o=n?"-":t.enPassant||"-";return" ".concat(t.turn," ").concat(a," ").concat(o," ").concat(t.halfMove," ").concat(t.fullMove)}function O(e){var t;let n=m.value;W(n);let a=(0,l.C3)(n),o=(0,l.A1)(a),{w:r,h:s}=o||i.h.board,c=(0,l.S3)(a,r,s);null==(t=f.setOption)||t.call(f,{w:r,h:s});let u=a!=n;for(let e=0;e<r*s;e++)d[e].value=c[e],u=k(d[e])||u;u||e||!o?P():h(D())}function W(e){let t=i.SB.play,n=e.split(" ");if(1!=n.length){if(("w"==n[1]||"b"==n[1])&&(t.turn=n[1]),n[2])for(let e of u)t.castle[e]=n[2].includes(e);t.enPassant=n[3]&&"-"!=n[3]?n[3]:"","retro"!=t.mode&&(t.halfMove=Number(n[4]||0),t.fullMove=Number(n[5]||1))}}function M(){let e=!1;for(let t of d)e=k(t,!0)||e;e&&P()}function j(e){for(let t of d)t.readOnly=e}function V(e){if(e.anime){let t=(0,l.N0)(e,i.h.board.w,i.h.board.h);(0,r.jt)(m.value,t,e.anime)}else e.forEach((e,t)=>d[t].value=e),P()}function T(){for(let e of(Object.assign(i.SB.play,{turn:c.Il.white,enPassant:"",halfMove:0,fullMove:1}),u))i.SB.play.castle[e]=!0}r.n4.options=i.h.board,r.n4.callback=x,addEventListener("popstate",function(){if(i.SB.play.playing)return;let e=new URL(location.href).searchParams.get("fen");e&&x(e,!0)});let L={update:()=>{B(m.value),O(!0)},empty(){for(let e of d)e.value="";P()},reset(e){var t;null==(t=f.setOption)||t.call(f,{w:8,h:8}),(i.h.board.fullFEN||e)&&T(),x(l.J7)},color(e){for(let t of d){let n=t.value;n.startsWith("'")||""==n||(n.startsWith("-")&&(n=n.substr(1)),n=n.toLowerCase(),0==e&&(n="-"+n),1==e&&(n=n.toUpperCase()),t.value=n)}P()},fixSN(){for(let e of(gtag("event","fen_fix_sn"),d)){let t=e.value;t.startsWith("'")||""==t||(e.value=t.replace("s","n").replace("S","N"))}P()},invert(e){V((0,l.U_)(D(),e))}}},3620:function(e,t,n){let a,o,l,i,r,s,c,u,d,p,f,m,h,g,y,b,S,w,_;var k=n(6770),U=n(7536),x=n(864),B=n(8002),C=n(6871),D=n(7955),A=n(6476),N=n(2526),P=n(3879);async function E(e){if(N.OB.canCopyImg){let t=await e();return navigator.clipboard.write([new ClipboardItem({"image/png":t})])}throw(0,P.Z)('Image copying is not enabled in your browser.\n\nIf you\'re using Firefox, this can be enabled by the following.\n1. Visit "about:config" in your address bar.\n2. Search for "dom.events.asyncClipboard.clipboardItem".\n3. Toggle its value to true.\n4. Reload this tool.'),Error()}async function I(){if(N.OB.canPaste)return await navigator.clipboard.readText();throw(0,P.Z)('Pasting text is not enabled in your browser.\n\nIf you\'re using Firefox on desktops or Firefox Nightly on Android, this can be enabled by the following.\n1. Visit "about:config" in your address bar.\n2. Search for "dom.events.asyncClipboard.readText".\n3. Toggle its value to true.\n4. Reload this tool.'),Error()}var R=n(6883),O=n(5420),W=n(7683),M=n(4791),j=n(8662);function V(e){let t=U.SB.play,n=t.moveNumber;(n+=e)<-1&&(n=-1),n>t.history.length-1&&(n=t.history.length-1),n!=t.moveNumber&&T(n)}function T(e){let t=U.SB.play,n=t.moveNumber,a=e>=0||0==n;if(Z.goto(t.history[e],a),a){let a=e==n-1,o=t.history[a?n:e],l=o.from+o.to;("k"==o.flags||"q"==o.flags)&&(l+=","+z(o)),(0,A.jt)(o.before,o.after,l,a!=(U.SB.play.mode==W.jl.retro))}}function L(e,t,n){let a=(0,O.MA)(e),l=(0,O.MA)(t);if(U.SB.play.mode==W.jl.retro){let e=o.retract({from:a,to:l,...U.SB.play.retro});return e&&(K(),G()),e}try{let e=o.move({from:a,to:l,promotion:n});if(!e)return!1;if("k"==e.flags||"q"==e.flags){var i=e;let t=(0,O.S3)(i.before),n=i.color==W.Il.white;return t[(0,O.Di)(i.from)]="",t[(0,O.Di)(i.to)]=n?"K":"k",{before:(0,O.N0)(t),after:i.after,move:z(i)}}return!0}catch{return!1}}function z(e){let t=e.color==W.Il.white,n="k"==e.flags,a=t?j.zi:j.TF;return(n?"h":"a")+a+(n?"f":"d")+a}function F(){(0,x.dd)(o.fen())}function q(e){return o.get((0,O.MA)(e)).color}async function Q(){if(!a){let e=await n.e("471").then(n.bind(n,5881));a||((a=e).Chess.options=U.h.PLAY,o=new a.Chess(U.SB.play),U.i7.module.chess=!0)}return a}function Y(){Object.assign(U.SB.play,{playing:!0,pendingPromotion:!1}),(0,x.Qt)(!0),U.SB.play.mode==W.jl.retro?(K(),G()):(0,D.t1)([])}function K(){U.SB.play.retro={uncapture:void 0,unpromote:!1,ep:!1}}function G(){(0,D.t1)(o.turn()==W.Il.black?j.th.wr:j.th.br)}async function H(e){await Q();try{o.loadGame(e),F(),Y()}catch(e){e instanceof Error&&(0,P.Z)(e.message)}}(0,U.t4)(()=>{if(U.SB.play.playing){let e=U.SB.play;e.playing=!1,Promise.all([(0,D.zD)(),Q()]).then(()=>{Y(),Z.goto(e.history[e.moveNumber])})}});let Z={async start(){try{let e=(0,x.mj)();if(!e)throw Error("Only orthodox chess is supported.");await Q(),o.init(e),U.SB.play.over=o.overState(),Y()}catch(e){e instanceof Error&&(0,P.Z)(e.message)}gtag("event","fen_play_"+U.SB.play.mode)},exit(){let e=U.SB.play.initFEN;U.SB.play.playing=!1,U.SB.play.game="",(0,x.dd)(e),(0,x.ZD)(e),(0,x.Qt)(!1),(0,D.t1)([])},goto(e,t){U.SB.play.pendingPromotion&&(U.SB.play.pendingPromotion=!1,(0,D.t1)([]));let n=o.goto(e);t||((0,A.p_)(),(0,x.dd)(n)),U.SB.play.mode==W.jl.retro&&(K(),G())},move(e){e!=U.SB.play.moveNumber&&T(e)},moveBy(e){V(e)},copyGame:()=>o.copyGame(),copyPGN:()=>o.copyPGN(),number:e=>a.number(e,U.SB.play.mode),format:e=>a.format(e,U.SB.play.mode),async pasteMoves(){let e=await I();try{o.addMoves(a.parseMoves(e))}catch(e){e instanceof Error&&(0,P.Z)(e.message)}F()},async pasteGame(){let e=await I();await H(e)}},$=new URL(location.href).searchParams.get("play");null!==$&&setTimeout(()=>{U.SB.tab=W.mQ.play,H($)},0);var X=n(9898),J=n(388);function ee(e){if(e.targetTouches){let t=e.target.getBoundingClientRect(),n=e.targetTouches[0]||e.changedTouches[0];e.clientX=n.clientX,e.clientY=n.clientY,e.offsetX=e.clientX-t.x,e.offsetY=e.clientY-t.y}return e}function et(e,t){let{s:n,offset:a}=(0,U.nj)(),o=t.getBoundingClientRect(),l=Math.floor((e.clientY-o.top-a.y)/n);return{x:Math.floor((e.clientX-o.left-a.x)/n),y:l}}function en(e,t,n){return(t.x-e.x)*(n.y-e.y)-(n.x-e.x)*(t.y-e.y)}let ea={x:0,y:0},eo={x:0,y:0},el=0,ei=0,er=performance.now();function es(e){var t,n;let a=ee(e);"pending"==U.i7.dragging&&function(e,t){let n=e.offsetX-t.x,a=e.offsetY-t.y;return Math.sqrt(n*n+a*a)}(a,ea)>5&&(ei=0,s?(u=N.OB.isTouch?[]:null,t=a,n=i,ec(),r.style.display="block",n&&(n.value="",(0,x.uu)()),U.i7.dragging=!0,ef(t)):U.i7.dragging=!1),!0===U.i7.dragging&&(u&&u.push({x:a.clientX,y:a.clientY}),ef(a))}function ec(){U.i7.selection=null,(0,D.t1)([])}function eu(e){(function(e){if(i&&"pending"==U.i7.dragging&&!U.SB.play.playing&&e.target==C.fr){let t=performance.now();t-el<300&&i.focus(),el=t,e.preventDefault(),U.i7.dragging=!1}})(e),r&&(r.style.display="none");let t=ee(e);if(function(e){if(performance.now()-ei>=250)return!1;if(e.target!=C.in||(0,U.I3)()){if(e.target==C.fr&&U.SB.popeye.playing){let{x:t}=et(e,C.fr);return t<3&&J.wD.moveBy(-1),t>4&&J.wD.moveBy(1),!0}}else{let{x:t,y:n}=et(e,C.in);if(U.i7.hor&&([t,n]=[n,t]),em(t,n,M._N,M.Dm)){let e=D.Kv[n*M._N+t];U.i7.selection==e?U.i7.selection=null:U.i7.selection=e,(0,D.t1)([])}else ec();return U.i7.dragging=!1,!0}return!1}(t)||U.SB.popeye.playing||!U.i7.dragging||(U.i7.dragging=!1,!s))return;let{w:n,h:a}=U.h.board,{x:d,y:p}=et(t,C.m8),f=p*n+d,m=em(d,p,n,a);if(U.SB.play.playing){let e;if(m)if(function(e,t){let n=U.SB.play.mode;return n!=W.jl.retro&&(n==W.jl.pass&&q(e)!=o.turn()&&o.switchSide(),!!o.checkPromotion((0,O.MA)(e),(0,O.MA)(t))&&(l=t,U.SB.play.pendingPromotion=!0,(0,D.t1)(o.turn()==W.Il.black?j.th.b:j.th.w),!0))}(c,f))return(0,x.zF)(x.xG[f],s);else c!=f&&(e=L(c,f));"object"==typeof e?(0,A.jt)(e.before,e.after,e.move):F()}else if(m){var h;(0,x.zF)(x.xG[f],s),i&&u&&u.length>10&&ed(i,function(e,t){let n=0;for(let a=0,o=t.length-1;a<t.length;o=a++){let l=t[a],i=t[o];i.y<=e.y?l.y>e.y&&en(i,l,e)>0&&n++:l.y<=e.y&&0>en(i,l,e)&&n--}return n}(function(e){let t=0,n=0;for(let a of e)t+=a.x,n+=a.y;return{x:t/=e.length,y:n/=e.length}}(h=u),h)>0?W.mi.r90:W.mi.r270)}else(0,x.qA)()}function ed(e,t){e.value=e.value.replace(/(^-?)(?:\*(\d))?([^-].*$)/,(e,n,a,o)=>{let l=(Number(a||0)+t)%W.mi.full;return n+(l?"*"+l:"")+o}),(0,x.uu)()}function ep(e){if(ei=performance.now(),U.SB.popeye.playing||U.i7.loading||0!=e.button&&!e.targetTouches||e.targetTouches&&e.targetTouches.length>1)return;let t=ee(e);document.activeElement&&document.activeElement.blur();let n=this!=C.in,{offset:a,s:u}=n?(0,U.nj)():(0,U.nj)(C.in,U.i7.hor),{w:d,h:p}=U.h.board;ea.x=t.offsetX,ea.y=t.offsetY;let[f,m]=[a.x,a.y];eo.x=Math.floor((ea.x-f)/u),eo.y=Math.floor((ea.y-m)/u);let h=eo.y*(n?d:M._N)+eo.x;r=n?C.S8:C.Ab;let g=U.i7.selection;if(n&&g){var y=t,b=d,S=p,w=g,_=h;if(y.preventDefault(),em(eo.x,eo.y,b,S)){let e=x.xG[_];e.value==w?e.value="":e.value=w,(0,x.uu)()}else ec();return}(!U.SB.play.playing||(n||function(e){if(U.SB.play.pendingPromotion){var t,n;U.i7.hor&&([eo.x,eo.y]=[eo.y,eo.x]);let e=+("p"!=s);eo.y>W.wg.k&&eo.y<W.wg.p&&eo.x==e&&(t=c,n=R.V[eo.y],L(t,l,n)?(l<M.Dm&&(n=n.toUpperCase()),(0,x.zF)(x.xG[l],n)):F(),U.SB.play.pendingPromotion=!1,(0,D.t1)([]))}"retro"==U.SB.play.mode&&(e.preventDefault(),U.i7.hor&&([eo.x,eo.y]=[eo.y,eo.x]),function(e,t){if(2==e)return;let n=U.SB.play.retro;if(0==e==(o.turn()==W.Il.black)){var a;W.wg.k<t&&t<W.wg.x&&(a=R.V[t],n.uncapture=n.uncapture==a?void 0:a),(t==W.wg.p||t==W.wg.c)&&(n.unpromote=!1)}else t==W.wg.p&&(n.unpromote=!n.unpromote,("p"==n.uncapture||"c"==n.uncapture)&&(n.uncapture=void 0));G()}(eo.x,eo.y))}(t),n&&function(e){let t=U.SB.play.mode;if(U.SB.play.pendingPromotion||t!=W.jl.retro&&o.isGameOver())return!1;let n=q(e)==o.turn();return t==W.jl.pass||n==(t==W.jl.normal)}(h)))&&(n?(c=h,i=x.xG[h],U.i7.dragging="pending",s=void 0):i=void 0,i&&""==i.value||function(e,t,n,a){let[o,l]=[n.x,n.y];e.preventDefault(),r.style.clip="rect(".concat(eo.y*t+l+1,"px,").concat((eo.x+1)*t+o-1,"px,").concat((eo.y+1)*t+l-1,"px,").concat(eo.x*t+o+1,"px)"),i?s=i.value:(s=U.i7.hor?D.Kv[eo.x*M._N+eo.y]:D.Kv[a],U.i7.dragging="pending")}(t,u,a,h))}function ef(e){let{offset:t,s:n}=(0,U.nj)(),{w:a,h:o,coordinates:l}=U.h.board,i=C.m8.getBoundingClientRect(),s=r==C.Ab&&l&&!U.i7.hor?i.left+X.Cd:i.left,c=Math.floor((e.clientY-i.top-t.y)/n),d=Math.floor((e.clientX-i.left-t.x)/n);(d!==eo.x||c!==eo.y)&&(u=null);let{scrollLeft:p,scrollTop:f}=document.documentElement;em(d,c,a,o)?(r.style.left=s+(d-eo.x)*n+p+"px",r.style.top=i.top+(c-eo.y)*n+f+"px"):(r.style.left=e.clientX+p+1-ea.x+"px",r.style.top=e.clientY+f-ea.y+"px")}function em(e,t,n,a){return t>-1&&t<a&&e>-1&&e<n}var eh=n(5753),eg=n(4640);function ey(){if(d)return d;let e=new Worker(new URL(n.p+n.u("10"),n.b),Object.assign({},{name:"py"},{type:void 0}));return d=e,e.onerror=t=>{let n;t.preventDefault(),clearInterval(m),U.SB.popeye.running=!1,t.filename?(e.terminate(),n="An error occur in the Popeye module. Please submit an issue about this.\n"+t.message):n="Unable to load the Popeye module; please check your network connection.",U.SB.popeye.output=ew(n),d=void 0},e.onmessage=e=>{let t=e.data;if(++h>3e3)U.SB.popeye.intOutput+="<br>".concat(ew("Too much output. Please modify the input to prevent excessive output."),"<br>"),eS();else if(-2===t)(p/=2)<16&&(U.SB.popeye.intOutput+="<br>".concat(ew("Not enough memory to run Popeye."),"<br>")),eS(p>=16);else if(null===t)eS();else{if((0,eg.zX)(),"string"==typeof t.text){let e=e_(t.text);e.match(/\s+\d+\s+\([^)]+Time = [^)]+s\)/)&&(e='<span class="text-secondary">'.concat(e,"</span>")),U.SB.popeye.intOutput+=e+"<br>"}if("string"==typeof t.err){if("Calling stub instead of signal()"==t.err)return;U.SB.popeye.error=!0,U.SB.popeye.intOutput+=ew(e_(t.err))}}},e}function eb(){let e=ey(),t=U.SB.popeye;h=0,t.intOutput="",t.error=!1,t.running=!0,m=setInterval(ev,500),f=performance.now(),e.postMessage({mem:p,input:"Opti NoBoard\n"+t.intInput})}function ev(){U.SB.popeye.output=U.SB.popeye.intOutput+'<br><i class="fa-solid fa-spinner fa-spin"></i>',(0,eg.u6)()}function eS(e){d&&d.terminate(),d=void 0;let t=500-(performance.now()-f);(0,eg.u6)(),clearInterval(m),e?eb():(U.SB.popeye.output=U.SB.popeye.intOutput,setTimeout(()=>U.SB.popeye.running=!1,Math.max(0,t)),ey())}function ew(e){return'<span class="text-danger">'.concat(e,"</span>")}function e_(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}J.Jn.cancel=function(){d&&eS()},J.Jn.initMemory=function(){p=512},J.Jn.start=eb;var ek=n(4189),eU=n(6230);function ex(e){g.postMessage(e)}(0,U.t4)(()=>{if(U.SB.stockfish.lines.length){let e=U.SB.stockfish.lines,t=U.SB.stockfish.header;U.SB.stockfish.lines=[],U.SB.stockfish.header=[],Q().then(n=>{y=n,U.SB.stockfish.lines=e,U.SB.stockfish.header=t})}}),window.cmd=ex;let eB="(".concat(eU.SQ,")(").concat(eU.SQ,")([qrbn]?)"),eC="modules/stockfish/",eD=N.OB.thread?"":"-single",eA=["".concat(eC,"stockfish-nnue-16.js#stockfish-nnue-16.wasm,worker"),"".concat(eC,"stockfish-nnue-16.wasm"),"".concat(eC,"stockfish-nnue-16-single.js#stockfish-nnue-16-single.wasm,worker"),"".concat(eC,"stockfish-nnue-16-single.wasm"),"".concat(eC,"nn-5af11540bbfe.nnue")];function eN(e){return g?Promise.resolve():new Promise((t,n)=>{U.i7.stockfish.running=W.MI.starting,(g=new Worker("".concat(eC,"stockfish-nnue-16").concat(eD,".js#stockfish-nnue-16").concat(eD,".wasm"))).onmessage=e=>{let n=e.data;console.info(n),"readyok"==n&&(U.i7.stockfish.running=W.MI.running,t()),n.startsWith("info ")&&function(e){let t;if(U.i7.stockfish.running!=W.MI.running)return;let n=e.match(/multipv (\d+)/);if(!n)return;let a=Number(n[1])-1,o=e.match(/mate (-?)(\d+)/),l=e.match(/score cp (-?\d+)/),i=Number(l&&l[1]||0)/100;if(o){let e="w"==S.split(" ")[1]==!!o[1]?"Black":"White";t=Number(o[2])+U.SB.stockfish.header.length/2,0==a&&(U.SB.stockfish.mate=[e,t])}if(0==a){let t=e.match(/depth (\d+)/);t&&(U.SB.stockfish.depth=t[1]),l&&(U.SB.stockfish.score=i)}let r=e.match(new RegExp("pv (".concat(eB,"(?: ").concat(eB,")*)")));if(r){var s,c,u;if((null==(s=U.SB.stockfish.lines[a])?void 0:s.raw)==r[1])return;let e=r[1].split(" ").map(e=>e.match(new RegExp(eB)));U.SB.stockfish.moves=[];let t=U.SB.stockfish.header;for(let n of(b.init(t.length?t[t.length-1].after:S),e))if(b.move({from:n[1],to:n[2],promotion:n[3]}).san.endsWith("=")){i=0;break}let n={rawScore:(c=o,u=i,c?c[1]?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY:u),score:o?o[1]+"#"+o[2]:i.toFixed(2),raw:r[1],moves:b.state.history.concat(),pgn:b.copyPGN(t)};U.SB.stockfish.lines[a]=n}U.h.Stockfish.study&&eP()}(n.substring(5)),n.match(new RegExp("^bestmove ".concat(eB)))&&function(){let e=U.h.Stockfish.depth;if(U.h.Stockfish.study&&!(e<4)&&eP()){let t=U.SB.stockfish.header;t.push(...U.SB.stockfish.lines["0"].moves.slice(0,2)),ex("position fen "+t[t.length-1].after),ex("go depth "+e)}else eR.stop()}()},g.onerror=e=>{e.message.includes("RangeError")?n(-1):e.message.includes("memory")?n("Not enough memory."):n("Unknown error has occurred.")},ex("uci"),ex("setoption name Use NNUE value true"),N.OB.thread&&ex("setoption name Threads value "+Math.max(2,navigator.hardwareConcurrency-4)),ex("setoption name Hash value "+e),ex("isready")})}function eP(){let e=U.SB.stockfish.lines.filter(e=>e&&e.moves.length);if(e.length<=1)return!1;e.forEach(e=>e.moves[0]&&(e.moves[0].annotation=void 0));let t=e.filter(e=>e.rawScore>1);if(t.length>1)return!1;if(1==t.length)return t[0].moves[0].annotation="!",!0;let n=e.filter(e=>e.rawScore>-1);return 1==n.length&&(n[0].moves[0].annotation="!",!0)}async function eE(e){if(200!=(await fetch(e)).status)throw Error()}async function eI(e,t){try{await e}catch(e){if(-1!==e)throw e;if(eR.stop(),(t/=2)<4)throw Error("Not enough memory.");await eI(eN(t),t)}}let eR={async download(){gtag("event","fen_stockfish_download"),U.i7.stockfish.status=W.KO.downloading,isHttps&&"serviceWorker"in navigator&&await navigator.serviceWorker.ready;try{await Promise.all(eA.map(e=>eE(e)))}catch{(0,P.Z)("Download failed. Please check your network connection."),U.i7.stockfish.status=W.KO.notDownloaded;return}U.h.Stockfish.downloaded=!0,U.i7.stockfish.status=W.KO.needReload},async analyze(){try{gtag("event","fen_stockfish_run");let e=eN(128);if(!(S=(0,x.mj)()))throw Error("Only orthodox chess is supported.");if(!y){let e=await Q();y||(y=e)}(b=new y.Chess).init(S),await eI(e,128),U.SB.stockfish=(0,ek.d)(U.bi),ex("setoption name MultiPV value "+U.h.Stockfish.lines),ex("ucinewgame"),ex("position fen "+S),ex("go depth "+U.h.Stockfish.depth)}catch(e){eR.stop(),(0,P.Z)(e instanceof Error?e.message:e),U.i7.stockfish.running=W.MI.stop}},play(e){gtag("event","fen_stockfish_play"),U.SB.play.mode="normal",U.SB.tab=6,H(e.pgn)},stop(){g&&g.terminate(),g=void 0,U.i7.stockfish.running=W.MI.stop},format:e=>y.formatGame(e)};(0,U.t4)(()=>{if(U.SB.syzygy.lines){let e=U.SB.syzygy.lines;e.forEach(e=>e.searching=!1),U.SB.syzygy.lines=[],Q().then(t=>{w=t,U.SB.syzygy.lines=e})}});let eO=new Set;function eW(e){return new Promise(t=>{eO.add(t),setTimeout(()=>{eO.delete(t),t()},e*M.WT)})}async function eM(e,t){try{if(!t.running)return null;let n=t.ready;if(t.ready=n.then(()=>eW(1)),await n,!t.running)return null;let a=await fetch("https://tablebase.lichess.ovh/standard?fen="+e);if(429==a.status)return await eW(61),await eM(e,t);return await a.json()}catch{throw Error("Unable to connect to the server. Please check your network connection.")}}async function ej(e){var t;let n=new(w=await Q()).Chess;n.init(e.fen);let a=await eM(n.fen(),e),o="w"==n.turn()?"White":"Black",l=a.category;if(U.SB.syzygy.header="The position is a ".concat(l," for ").concat(o,"."),"unknown"==l||l.includes("loss")||!e.running)return;for(let o of(U.SB.syzygy.lines=[],e.outcome=l,e.op="draw"==(t=l)?t:eF[ez.indexOf(t)],a.moves.filter(t=>t.category==e.op))){n.init(e.fen);let[t,a,l]=o.uci.match(/..|./g);n.move({from:t,to:a,promotion:l});let i=n.fen();e.positions.add(eV(i));let r={fen:i,dtm:o.dtm,indent:0,history:n.state.history.concat(),leaf:!0,moves:n.state.history.concat(),pgn:n.copyPGN(),transpose:!1,searching:!n.isGameOver()};U.SB.syzygy.lines.push(r)}if(!e.running)return;let i=U.SB.syzygy.lines.filter(e=>e.searching);if(!(i.length>1))for(i[0].moves[0].annotation="!";i.length;){let t=i.map(t=>eT(t,e));if(await Promise.all(t),i=U.SB.syzygy.lines.filter(e=>e.searching),!e.running)return}}function eV(e){return e.replace(/ \d+ \d+$/,"")}async function eT(e,t){let n=new w.Chess;n.init(e.fen);let a="number"==typeof e.dtm,o=n.moves({verbose:!0}),l=new Set((await eM(e.fen,t)).moves.filter(e=>e.category==t.outcome).map(e=>e.uci)),i=o.filter(e=>l.has(e.from+e.to+(e.promotion||""))).map(e=>eL(e,t,a)),r=(await Promise.all(i)).filter(e=>e).sort((e,t)=>t.score-e.score).filter((e,t,n)=>e.score==n[0].score);if(e.searching&&(e.searching=!1),!t.running)return;let s=r.filter(e=>"draw"!=t.op&&e.moves.length>0||1==e.moves.length);if(0==s.length)return;let c=1==s.length,u=s.map(a=>(function(e,t,n,a,o){a.init(t.fen);let l=a.move(e.defense);n&&(l.annotation="!");let[i,r,s]=e.moves[0].uci.match(/..|./g),c=a.move({from:i,to:r,promotion:s});1==e.moves.length&&(c.annotation="!");let u=a.fen(),d=eV(u),p=o.positions.has(d);p||o.positions.add(d);let f=a.state.history.concat();return{dtm:"number"==typeof e.dtm?1-e.dtm:null,fen:u,transpose:p,leaf:!0,indent:t.indent+ +!n,history:t.history.concat(f),moves:n?t.moves.concat(f):f,pgn:a.copyPGN(t.history),searching:!a.isGameOver()&&!p}})(a,e,c,n,t)),d=U.SB.syzygy.lines.concat(),p=d.indexOf(e);c?d.splice(p,1,...u):(e.leaf=!1,d.splice(p+1,0,...u)),U.SB.syzygy.lines=d}async function eL(e,t,n){let a=await eM(e.after,t);if(!t.running)return null;let o=a.moves.filter(e=>e.category==t.op);return{score:(n?a.dtm:0)-o.length,json:a,dtm:a.dtm,defense:e,moves:o}}let ez=["win","maybe-win","cursed-win"],eF=["loss","maybe-loss","blessed-loss"],eq={async run(){let e={positions:new Set,running:!0,ready:Promise.resolve()};_=e;try{var t;if(gtag("event","fen_syzygy_run"),U.i7.syzygy.running=!0,U.SB.syzygy.header=null,U.SB.syzygy.lines=null,e.fen=(0,x.mj)(),!e.fen)throw Error("Only orthodox chess is supported.");if((null==(t=e.fen.split(" ")[0].match(/[a-z]/ig))?void 0:t.length)>7)throw Error("Only supports position with up to ".concat(7," pieces."));await ej(e)}catch(e){(0,P.Z)(e instanceof Error?e.message:e)}finally{e.running&&eq.stop()}},play(e){gtag("event","fen_syzygy_play"),U.SB.play.mode="normal",U.SB.tab=6,H(e.pgn)},stop(){var e;for(let e of(_&&(_.running=!1),eO))e();eO.clear(),null==(e=U.SB.syzygy.lines)||e.forEach(e=>e.searching=!1),U.i7.syzygy.running=!1},format(e){let t=w.formatGame(e.moves);return e.searching?t+=" ...":e.transpose&&(t+=" (transpose)"),t}};var eQ=n(9111),eY=n.n(eQ);let eK={class:"modal-dialog modal-dialog-centered"},eG={class:"modal-content"},eH=["innerHTML"],eZ={class:"modal-footer"},e$=Promise.resolve(),eX=(0,k.aZ)({name:"DialogModal",__name:"dialog",setup(e,t){let n,{expose:a}=t,o=(0,k.XI)();(0,k.bv)(()=>{n=new(eY())(o.value,{backdrop:"static"})});let l=(0,k.XI)("");return a({show:async function(e,t){let a,i=e$;return e$=new Promise(e=>{a=e}),await i,new Promise(i=>{l.value=e.replace(/\n/g,"<br>"),o.value.addEventListener("hide.bs.modal",()=>{i()},{once:!0}),o.value.addEventListener("hidden.bs.modal",a,{once:!0}),null==t||t(),n.show()})},hide:()=>n.hide()}),(e,t)=>((0,k.wg)(),(0,k.iD)("div",{class:"modal fade modal-second",ref_key:"el",ref:o},[(0,k._)("div",eK,[(0,k._)("div",eG,[(0,k._)("div",{class:"modal-body",innerHTML:l.value},null,8,eH),(0,k._)("div",eZ,[(0,k.WI)(e.$slots,"default")])])])],512))}}),eJ=(0,k.aZ)({name:"Alert",__name:"alert",setup(e,t){let{expose:n}=t,a=(0,k.XI)();function o(e){return a.value.show(e)}return(0,k.bv)(()=>P.Z.setup(o)),n({show:o}),(e,t)=>((0,k.wg)(),(0,k.j4)(eX,{ref_key:"dialog",ref:a},{default:(0,k.w5)(()=>t[0]||(t[0]=[(0,k._)("button",{type:"button",class:"btn btn-primary","data-bs-dismiss":"modal"},"OK",-1)])),_:1,__:[0]},512))}}),e0=(0,k.aZ)({name:"Confirm",__name:"confirm",setup(e,t){let{expose:n}=t,a=!1,o=(0,k.XI)();async function l(e){return await o.value.show(e,()=>a=!1),a}function i(){a=!0,o.value.hide()}return(0,k.bv)(()=>P.i.setup(l)),n({show:l}),(e,t)=>((0,k.wg)(),(0,k.j4)(eX,{ref_key:"dialog",ref:o},{default:(0,k.w5)(()=>[t[0]||(t[0]=(0,k._)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"No",-1)),(0,k._)("button",{type:"button",class:"btn btn-primary",onClick:i},"Yes")]),_:1,__:[0]},512))}}),e1={class:"nav-item"},e2=["title"],e3={class:"d-sm-none"},e8={class:"d-none d-sm-inline"},e5=(0,k.aZ)({__name:"menuTab",props:{index:{},icon:{},title:{}},setup:e=>(e,t)=>((0,k.wg)(),(0,k.iD)("li",e1,[(0,k._)("div",{class:(0,k.C_)(["nav-link",{active:(0,k.SU)(U.SB).tab==e.index}]),onClick:t[0]||(t[0]=t=>(0,k.SU)(U.SB).tab=e.index),title:e.title},[(0,k._)("span",e3,[(0,k._)("i",{class:(0,k.C_)(e.icon)},null,2)]),(0,k._)("span",e8,[(0,k.WI)(e.$slots,"default")])],10,e2)]))}),e4={class:"nav nav-tabs pe-1",style:{"flex-wrap":"nowrap"}},e7=(0,k.aZ)({__name:"menu",setup:e=>(e,t)=>((0,k.wg)(),(0,k.iD)("div",{class:(0,k.C_)(["mb-3 nav-container",{"mt-n3":(0,k.SU)(U.u8)()}])},[(0,k._)("ul",e4,[(0,k.Wm)(e5,{index:0,icon:"fa-solid fa-pen-to-square",title:"Edit"},{default:(0,k.w5)(()=>t[0]||(t[0]=[(0,k.Uk)("Edit")])),_:1,__:[0]}),(0,k.Wm)(e5,{index:8,icon:"fa-solid fa-chess-board",title:"Project"},{default:(0,k.w5)(()=>t[1]||(t[1]=[(0,k.Uk)("Project")])),_:1,__:[1]}),(0,k.Wm)(e5,{index:1,icon:"fa-solid fa-gear",title:"Options"},{default:(0,k.w5)(()=>t[2]||(t[2]=[(0,k.Uk)("Options")])),_:1,__:[2]}),(0,k.Wm)(e5,{index:7,icon:"fa-solid fa-calculator",title:"Compute"},{default:(0,k.w5)(()=>t[3]||(t[3]=[(0,k.Uk)("Compute")])),_:1,__:[3]}),(0,k.Wm)(e5,{index:6,icon:"fa-solid fa-gamepad",title:"Play"},{default:(0,k.w5)(()=>t[4]||(t[4]=[(0,k.Uk)("Play")])),_:1,__:[4]}),(0,k.Wm)(e5,{index:2,icon:"fa-solid fa-database",title:"Database"},{default:(0,k.w5)(()=>t[5]||(t[5]=[(0,k.Uk)("DB")])),_:1,__:[5]}),(0,k.SU)(U.i7).envReady&&(0,k.SU)(N.OB).isTaiwan?((0,k.wg)(),(0,k.j4)(e5,{key:0,index:4,icon:"fa-solid fa-terminal",title:"BBS"},{default:(0,k.w5)(()=>t[6]||(t[6]=[(0,k.Uk)("BBS")])),_:1,__:[6]})):(0,k.kq)("",!0),(0,k.Wm)(e5,{index:5,icon:"fa-solid fa-share-from-square",title:"API"},{default:(0,k.w5)(()=>t[7]||(t[7]=[(0,k.Uk)("API")])),_:1,__:[7]})])],2))});function e6(e){return new URL(e,location.href).toString()}function e9(){let{SN:e,w:t,h:n}=U.h.board;return e?(0,O.N0)((0,x.xL)(),t,n):x.RI.value}function te(){let e=U.h.board,t=e9(),n=e6("gen/?fen="+t);return e.size!=X.Cg&&(n+="&size="+e.size),e.set!=X.z6&&(n+="&set="+e.set),e.pattern&&(n+="&pattern="+e.pattern),e.bg&&(n+="&bg="+e.bg),"1"!=e.border&&(n+="&border="+e.border),e.blackWhite&&(n+="&blackWhite&knightOffset="+e.knightOffset),(0,O.A1)(t)||(n+="&w=".concat(e.w,"&h=").concat(e.h)),n}let tt={copyJanko:()=>(gtag("event","fen_copy_janko"),"https://www.janko.at/Retros/d.php?ff="+e9()),copyBase64:()=>(gtag("event","fen_link_copy64"),D.Uw.toDataURL()),copyBase64Img:()=>(gtag("event","fen_link_copy64img"),'<img fen="'.concat(D.Uw.toDataURL(),'">')),async copyUrl(){gtag("event","fen_gen_link");let e=new FormData,t=await (0,D.Br)();e.append("key","7802c5da1788f2315222d44bfba20519"),e.append("image",t,"fen");try{let t=await fetch("https://api.imgbb.com/1/upload",{method:"post",body:e}),n=await t.json();if(!n.success)throw n.error.message;return n.data.url+"?="+e9()}catch(e){throw(0,P.Z)("string"==typeof e?e:"Internet connection failed. Please try again later."),e}},copyEmbed(){gtag("event","fen_copy_embed");let e=U.h.board,t=te(),{w:n,h:a}=(0,X.t_)(e);return'<iframe src="'.concat(t,'" style="border:none;width:').concat(n,"px;height:").concat(a,'px"></iframe>')},copyEmbedUrl:()=>(gtag("event","fen_copy_embedUrl"),te()),copyImg:()=>(gtag("event","fen_copy_sdkImg"),'<img fen="'.concat(e9(),'">')),copySDK(){gtag("event","fen_copy_sdk");let e=U.h.board,t="";return e.size!=X.Cg&&(t+=' data-size="'.concat(e.size,'"')),e.set!=X.z6&&(t+=' data-set="'.concat(e.set,'"')),e.bg&&(t+=' data-bg="'.concat(e.bg,'"')),"1"!=e.border&&(t+=' data-border="'.concat(e.border,'"')),e.blackWhite&&(t+=' data-black-white="true" data-knight-offset="'.concat(e.knightOffset,'"')),'<script src="'.concat(e6("sdk.js"),'"').concat(t,"><\/script>")}},tn=["disabled"],ta=(0,k.aZ)({__name:"copyButton",props:{class:{},factory:{type:Function},disabled:{type:Boolean}},setup(e){let t=(0,k.XI)(0);async function n(){t.value=1;try{let n=e.factory;for(;"function"==typeof n;)n=await n();"string"==typeof n&&function(e){if(N.OB.canCopy)navigator.clipboard.writeText(e);else{let t=document.createElement("input");document.body.appendChild(t),t.value=e,t.select(),document.execCommand("copy"),document.body.removeChild(t)}}(n),t.value=2,setTimeout(()=>t.value=0,M.WT)}catch(e){t.value=0}}return(a,o)=>((0,k.wg)(),(0,k.iD)("button",{type:"button",class:(0,k.C_)(["btn nowrap",e.class]),onClick:n,disabled:a.disabled||1==t.value},[(0,k._)("i",{class:(0,k.C_)(["fa-solid fa-clipboard","fa-spin fa-solid fa-spinner","fa-solid fa-check"][t.value])},null,2),o[0]||(o[0]=(0,k.Uk)(" ")),(0,k.WI)(a.$slots,"default")],10,tn))}}),to=["disabled"],tl=(0,k.aZ)({__name:"shareButton",setup(e){let t=(0,k.XI)(!1);async function n(){if(gtag("event","fen_img_share"),N.OB.canSharePng){let e=[new File([await (0,D.Br)()],"board.png",{type:"image/png"})];navigator.share({files:e})}else{t.value=!0;try{let e=await tt.copyUrl();navigator.share({url:e,text:e9()})}finally{t.value&&(t.value=!1)}}}return(e,a)=>(0,k.SU)(U.i7).envReady&&(0,k.SU)(N.OB).canShare?((0,k.wg)(),(0,k.iD)("button",{key:0,class:"btn btn-primary",disabled:t.value,onClick:n},[(0,k._)("i",{class:(0,k.C_)(t.value?"fa-spin fa-solid fa-spinner":"fa-solid fa-share-nodes")},null,2),a[0]||(a[0]=(0,k.Uk)(" Share image "))],8,to)):(0,k.kq)("",!0)}}),ti={class:"mb-3 btn-gap"},tr={class:"d-inline-block"},ts=["disabled"],tc=["disabled"],tu={class:"btn-group"},td=["disabled"],tp=["disabled"],tf=["disabled"],tm=["disabled"],th={class:"btn-group"},tg=["disabled"],ty=["disabled"],tb=["disabled"],tv=["disabled"],tS={class:"btn-group"},tw=["disabled"],t_=["disabled"],tk={key:0,class:"fa-solid fa-chess-king fa-fw shadow-neutral",style:{color:"gray"}},tU=["disabled"],tx={class:"btn-group"},tB=["disabled"],tC=["disabled"],tD=["disabled"],tA={class:"text-end btn-gap"},tN={class:"d-inline-block"},tP={class:"d-inline-block"},tE={key:0,class:"mt-3 d-none d-md-block text-end"},tI={class:"d-inline-block"},tR={class:"form-check form-switch"},tO=(0,k.aZ)({__name:"edit",setup(e){function t(e,t){(0,A.p_)(!0);let{w:n,h:a}=U.h.board;(0,x.gx)((0,O.uY)((0,x.Ox)(),e,t,n,a))}function n(e){(0,A.p_)(!0);let{w:t,h:n}=U.h.board;(0,x.gx)((0,O.hD)((0,x.Ox)(),e,t,n))}function a(e){(0,A.p_)(!0);let{w:t,h:n}=U.h.board;t!==n&&(0,B.l)({w:n,h:t}),(0,x.gx)((0,O.U1)((0,x.Ox)(),e,t,n))}return(e,o)=>((0,k.wg)(),(0,k.iD)("section",{class:(0,k.C_)({show:0==(0,k.SU)(U.SB).tab})},[(0,k._)("div",ti,[(0,k._)("span",tr,[(0,k._)("button",{type:"button",class:"btn btn-secondary",onClick:o[0]||(o[0]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,k.SU)(x.X4).empty&&(0,k.SU)(x.X4).empty(...t)}),disabled:(0,k.SU)(U.I3)(),title:"Empty board"},o[17]||(o[17]=[(0,k._)("i",{class:"fa-solid fa-trash-can"},null,-1),(0,k._)("span",null," Empty board",-1)]),8,ts),(0,k._)("button",{type:"button",class:"btn btn-secondary",onClick:o[1]||(o[1]=e=>(0,k.SU)(x.X4).reset()),disabled:(0,k.SU)(U.I3)(),title:"Starting position"},o[18]||(o[18]=[(0,k._)("i",{class:"fa-solid fa-flag-checkered"},null,-1),(0,k._)("span",null," Starting position",-1)]),8,tc)]),(0,k._)("span",tu,[(0,k._)("button",{type:"button",class:"btn btn-secondary",title:"Shift leftwards",onClick:o[2]||(o[2]=e=>t(-1,0)),disabled:(0,k.SU)(U.I3)()},o[19]||(o[19]=[(0,k._)("i",{class:"fa-solid fa-arrow-left"},null,-1)]),8,td),(0,k._)("button",{type:"button",class:"btn btn-secondary",title:"Shift rightwards",onClick:o[3]||(o[3]=e=>t(1,0)),disabled:(0,k.SU)(U.I3)()},o[20]||(o[20]=[(0,k._)("i",{class:"fa-solid fa-arrow-right"},null,-1)]),8,tp),(0,k._)("button",{type:"button",class:"btn btn-secondary",title:"Shift upwards",onClick:o[4]||(o[4]=e=>t(0,-1)),disabled:(0,k.SU)(U.I3)()},o[21]||(o[21]=[(0,k._)("i",{class:"fa-solid fa-arrow-up"},null,-1)]),8,tf),(0,k._)("button",{type:"button",class:"btn btn-secondary",title:"Shift downwards",onClick:o[5]||(o[5]=e=>t(0,1)),disabled:(0,k.SU)(U.I3)()},o[22]||(o[22]=[(0,k._)("i",{class:"fa-solid fa-arrow-down"},null,-1)]),8,tm)]),(0,k._)("span",th,[(0,k._)("button",{type:"button",class:"btn btn-secondary",title:"Rotate counterclockwise",onClick:o[6]||(o[6]=e=>a(-1)),disabled:(0,k.SU)(U.I3)()},o[23]||(o[23]=[(0,k._)("i",{class:"fa-solid fa-rotate-left"},null,-1)]),8,tg),(0,k._)("button",{type:"button",class:"btn btn-secondary",title:"Rotate clockwise",onClick:o[7]||(o[7]=e=>a(1)),disabled:(0,k.SU)(U.I3)()},o[24]||(o[24]=[(0,k._)("i",{class:"fa-solid fa-rotate-right"},null,-1)]),8,ty),(0,k._)("button",{type:"button",class:"btn btn-secondary",title:"Mirror horizontally",onClick:o[8]||(o[8]=e=>n("-")),disabled:(0,k.SU)(U.I3)()},o[25]||(o[25]=[(0,k._)("i",{class:"fa-solid fa-arrows-left-right"},null,-1)]),8,tb),(0,k._)("button",{type:"button",class:"btn btn-secondary",title:"Mirror vertically",onClick:o[9]||(o[9]=e=>n("|")),disabled:(0,k.SU)(U.I3)()},o[26]||(o[26]=[(0,k._)("i",{class:"fa-solid fa-arrows-up-down"},null,-1)]),8,tv)]),(0,k._)("span",tS,[(0,k._)("button",{type:"button",class:"btn btn-secondary px-2",title:"All Black",onClick:o[10]||(o[10]=e=>(0,k.SU)(x.X4).color(-1)),disabled:(0,k.SU)(U.I3)()},o[27]||(o[27]=[(0,k._)("i",{class:"fa-solid fa-chess-king fa-fw text-black shadow-white"},null,-1)]),8,tw),(0,k._)("button",{type:"button",class:"btn btn-secondary px-2",title:"All Neutral",onClick:o[11]||(o[11]=e=>(0,k.SU)(x.X4).color(0)),disabled:(0,k.SU)(U.I3)()},[(0,k.SU)(U.h).board.blackWhite?((0,k.wg)(),(0,k.iD)(k.HY,{key:1},[o[28]||(o[28]=(0,k._)("i",{class:"fa-solid fa-chess-king fa-fw text-black shadow-white"},null,-1)),o[29]||(o[29]=(0,k._)("i",{class:"fa-solid fa-chess-king fa-fw text-white shadow-black",style:{"margin-left":"-1.25em","clip-path":"polygon(51.5% 0, 100% 0, 100% 100%, 51.5% 100%)"}},null,-1))],64)):((0,k.wg)(),(0,k.iD)("i",tk))],8,t_),(0,k._)("button",{type:"button",class:"btn btn-secondary px-2",title:"All White",onClick:o[12]||(o[12]=e=>(0,k.SU)(x.X4).color(1)),disabled:(0,k.SU)(U.I3)()},o[30]||(o[30]=[(0,k._)("i",{class:"fa-solid fa-chess-king fa-fw text-white shadow-black"},null,-1)]),8,tU)]),(0,k._)("span",tx,[(0,k._)("button",{type:"button",class:"btn btn-secondary",title:"Switch side",onClick:o[13]||(o[13]=e=>(0,k.SU)(x.X4).invert(!1)),disabled:(0,k.SU)(U.I3)()},o[31]||(o[31]=[(0,k._)("i",{class:"fa-solid fa-chess-king text-black shadow-white"},null,-1),(0,k.Uk)(" "),(0,k._)("i",{class:"fa-solid fa-arrows-left-right"},null,-1),(0,k.Uk)(" "),(0,k._)("i",{class:"fa-solid fa-chess-king text-white shadow-black"},null,-1)]),8,tB),(0,k._)("button",{type:"button",class:"btn btn-secondary",title:"Switch case (including text)",onClick:o[14]||(o[14]=e=>(0,k.SU)(x.X4).invert(!0)),disabled:(0,k.SU)(U.I3)()},o[32]||(o[32]=[(0,k.Uk)(" A "),(0,k._)("i",{class:"fa-solid fa-arrows-left-right"},null,-1),(0,k.Uk)(" a ")]),8,tC),(0,k.SU)(U.h).board.SN?(0,k.kq)("",!0):((0,k.wg)(),(0,k.iD)("button",{key:0,type:"button",class:"btn btn-secondary",title:"Change all S to N when 'Use S for knight' mode is off",onClick:o[15]||(o[15]=e=>(0,k.SU)(x.X4).fixSN()),disabled:(0,k.SU)(U.I3)()},o[33]||(o[33]=[(0,k.Uk)(" S "),(0,k._)("i",{class:"fa-solid fa-arrow-right"},null,-1),(0,k.Uk)(" N ")]),8,tD))])]),(0,k._)("div",tA,[(0,k._)("span",tN,[(0,k.SU)(U.h).feature.janko?((0,k.wg)(),(0,k.j4)(ta,{key:0,factory:(0,k.SU)(tt).copyJanko,class:"btn-primary"},{default:(0,k.w5)(()=>o[34]||(o[34]=[(0,k.Uk)("Create Janko URL")])),_:1,__:[34]},8,["factory"])):(0,k.kq)("",!0),(0,k.SU)(U.i7).envReady&&!(0,k.SU)(N.OB).isTouch?((0,k.wg)(),(0,k.j4)(ta,{key:1,factory:()=>(0,k.SU)(E)((0,k.SU)(D.Br)),class:"btn-primary"},{default:(0,k.w5)(()=>o[35]||(o[35]=[(0,k.Uk)("Copy image ")])),_:1,__:[35]},8,["factory"])):(0,k.kq)("",!0),(0,k.Wm)(ta,{factory:(0,k.SU)(tt).copyUrl,class:"btn-primary"},{default:(0,k.w5)(()=>o[36]||(o[36]=[(0,k.Uk)("Create image URL")])),_:1,__:[36]},8,["factory"])]),(0,k._)("span",tP,[(0,k.Wm)(tl),o[37]||(o[37]=(0,k._)("a",{class:"btn btn-primary",download:"board.png",id:"Save",onclick:"gtag('event', 'img_save')"},[(0,k._)("i",{class:"fa-solid fa-download"}),(0,k.Uk)(" Save image ")],-1))])]),(0,k.SU)(U.i7).envReady&&(0,k.SU)(N.OB).isTop?((0,k.wg)(),(0,k.iD)("div",tE,[(0,k._)("div",tI,[(0,k._)("div",tR,[(0,k.wy)((0,k._)("input",{class:"form-check-input",type:"checkbox",role:"switch",id:"sSplit","onUpdate:modelValue":o[16]||(o[16]=e=>(0,k.SU)(U.SB).split=e)},null,512),[[k.e8,(0,k.SU)(U.SB).split]]),o[38]||(o[38]=(0,k._)("label",{class:"form-check-label",for:"sSplit"},"Split window",-1))])])])):(0,k.kq)("",!0)],2))}}),tW={class:"form-check"},tM=["checked","disabled"],tj=(0,k.aZ)({__name:"checkbox",props:{modelValue:{type:Boolean},disabled:{type:Boolean}},emits:["update:modelValue","change"],setup(e){let t="chk"+(0,k.FN)().uid;return(e,n)=>((0,k.wg)(),(0,k.iD)("div",tW,[(0,k._)("input",{type:"checkbox",class:"form-check-input",id:t,checked:e.modelValue,onChange:n[0]||(n[0]=t=>{e.$emit("update:modelValue",!e.modelValue),e.$emit("change")}),disabled:e.disabled},null,40,tM),(0,k._)("label",{class:"form-check-label",for:t},[(0,k.WI)(e.$slots,"default")])]))}}),tV={class:"input-group"},tT=["disabled"],tL=["title","value"],tz=["disabled"],tF=(0,k.aZ)({__name:"inputNumber",props:{title:{},min:{},max:{},modelValue:{}},emits:["update:modelValue"],setup(e,t){let{emit:n}=t;function a(t){n("update:modelValue",e.modelValue+t)}let o=()=>e.modelValue<=e.min,l=()=>void 0!==e.max&&e.modelValue>=e.max;return(t,i)=>((0,k.wg)(),(0,k.iD)("div",tV,[(0,k._)("button",{class:"btn btn-secondary px-2",disabled:o(),type:"button",onClick:i[0]||(i[0]=e=>a(-1))},i[3]||(i[3]=[(0,k._)("i",{class:"fa-solid fa-minus"},null,-1)]),8,tT),(0,k._)("input",{type:"number",class:"form-control text-center px-0",min:"1",title:t.title,value:e.modelValue,onChange:i[1]||(i[1]=t=>(function(t){let a=t.target,o=e.modelValue,l=Math.round(Number(a.value));isNaN(l)||l<e.min||void 0!==e.max&&l>e.max?a.value=o.toString():n("update:modelValue",l)})(t)),onfocus:"this.select()"},null,40,tL),(0,k._)("button",{class:"btn btn-secondary px-2",disabled:l(),type:"button",onClick:i[2]||(i[2]=e=>a(1))},i[4]||(i[4]=[(0,k._)("i",{class:"fa-solid fa-plus"},null,-1)]),8,tz)]))}}),tq={class:"row mb-2"},tQ={class:"col flex-grow-1",style:{"flex-basis":"18rem"}},tY={class:"row gx-3"},tK={class:"col",style:{"flex-basis":"15rem"}},tG={class:"row gx-3 mb-2"},tH={class:"col"},tZ={class:"col",style:{"flex-basis":"13rem"}},t$={class:"row gx-3 mb-2"},tX={class:"col"},tJ={class:"row gx-3"},t0={class:"col",style:{"flex-basis":"15rem"}},t1={class:"row gx-3 mb-2"},t2={class:"col"},t3={class:"col",style:{"flex-basis":"16rem"}},t8={class:"row gx-3 mb-2"},t5={class:"col"},t4={class:"col flex-grow-1 mb-2",style:{"flex-basis":"22rem"}},t7={class:"row gx-3"},t6={class:"col",style:{"flex-basis":"22rem"}},t9={class:"row gx-3"},ne={class:"col mb-2",style:{"flex-basis":"14rem","flex-grow":"10000"}},nt={class:"row gx-3"},nn={class:"col"},na={class:"col"},no={class:"col mb-2 text-end"},nl={class:"col",style:{"flex-basis":"14rem"}},ni={class:"row gx-3 mb-2"},nr={class:"col"},ns=["value"],nc={class:"row gx-3 align-items-baseline"},nu={class:"col",style:{"flex-basis":"15rem"}},nd={class:"col",style:{"flex-basis":"15rem"}},np={class:"row align-items-center"},nf={class:"col"},nm={class:"d-none d-md-block"},nh=(0,k.aZ)({__name:"options",setup(e){let t=(0,k.XI)(!1);function n(){(0,B.l)({},!0)}return(0,k.bv)(()=>setTimeout(()=>t.value=!0,50)),(e,a)=>((0,k.wg)(),(0,k.iD)("section",{class:(0,k.C_)({show:1==(0,k.SU)(U.SB).tab})},[(0,k._)("div",tq,[(0,k._)("div",tQ,[(0,k._)("div",tY,[(0,k._)("div",tK,[(0,k._)("div",tG,[a[19]||(a[19]=(0,k._)("label",{class:"col-auto col-form-label"},"Chess set:",-1)),(0,k._)("div",tH,[(0,k.wy)((0,k._)("select",{class:"form-select","onUpdate:modelValue":a[0]||(a[0]=e=>(0,k.SU)(B.Ar).set=e)},a[18]||(a[18]=[(0,k.uE)('<option value="1echecs">1Echecs</option><option value="alpha">Alpha</option><option value="goodCompanion">Good Companion</option><option value="kilfiger">Kilfiger</option><option value="merida">Merida</option><option value="mpchess">MPChess</option><option value="skak">Skak</option>',7)]),512),[[k.bM,(0,k.SU)(B.Ar).set]])])])]),(0,k._)("div",tZ,[(0,k._)("div",t$,[a[21]||(a[21]=(0,k._)("label",{class:"col-auto col-form-label"},"Square size:",-1)),(0,k._)("div",tX,[(0,k.wy)((0,k._)("select",{class:"form-select","onUpdate:modelValue":a[1]||(a[1]=e=>(0,k.SU)(B.Ar).size=e)},a[20]||(a[20]=[(0,k._)("option",{value:"26"},"26px",-1),(0,k._)("option",{value:"32"},"32px",-1),(0,k._)("option",{value:"38"},"38px",-1),(0,k._)("option",{value:"44"},"44px",-1)]),512),[[k.bM,(0,k.SU)(B.Ar).size,void 0,{number:!0}]])])])])]),(0,k.Wm)(tj,{class:"mb-2",modelValue:(0,k.SU)(U.h).board.exHigh,"onUpdate:modelValue":a[2]||(a[2]=e=>(0,k.SU)(U.h).board.exHigh=e),onChange:(0,k.SU)(D.G2)},{default:(0,k.w5)(()=>a[22]||(a[22]=[(0,k.Uk)("Export to high-resolution image ")])),_:1,__:[22]},8,["modelValue","onChange"]),(0,k._)("div",tJ,[(0,k._)("div",t0,[(0,k._)("div",t1,[a[24]||(a[24]=(0,k._)("label",{class:"col-auto col-form-label"},"Background:",-1)),(0,k._)("div",t2,[(0,k.wy)((0,k._)("select",{class:"form-select","onUpdate:modelValue":a[3]||(a[3]=e=>(0,k.SU)(U.h).board.bg=e),onChange:a[4]||(a[4]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,k.SU)(D.wY)&&(0,k.SU)(D.wY)(...t)})},a[23]||(a[23]=[(0,k._)("option",{value:void 0},"Default",-1),(0,k._)("option",{value:"gray"},"Gray",-1),(0,k._)("option",{value:"green"},"Green",-1),(0,k._)("option",{value:"classic"},"Classic",-1)]),544),[[k.bM,(0,k.SU)(U.h).board.bg]])])])]),(0,k._)("div",t3,[(0,k._)("div",t8,[a[26]||(a[26]=(0,k._)("label",{class:"col-auto col-form-label"},"Board pattern:",-1)),(0,k._)("div",t5,[(0,k.wy)((0,k._)("select",{class:"form-select","onUpdate:modelValue":a[5]||(a[5]=e=>(0,k.SU)(U.h).board.pattern=e),onChange:a[6]||(a[6]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,k.SU)(D.wY)&&(0,k.SU)(D.wY)(...t)})},a[25]||(a[25]=[(0,k._)("option",{value:void 0},"Normal",-1),(0,k._)("option",{value:"inverted"},"Inverted",-1),(0,k._)("option",{value:"mono"},"Uncolored",-1)]),544),[[k.bM,(0,k.SU)(U.h).board.pattern]])])])])])]),(0,k._)("div",t4,[(0,k._)("div",t7,[(0,k._)("div",t6,[(0,k._)("div",t9,[(0,k._)("div",ne,[(0,k._)("div",nt,[(0,k._)("div",nn,[(0,k.Wm)(tF,{modelValue:(0,k.SU)(B.Ar).width,"onUpdate:modelValue":a[7]||(a[7]=e=>(0,k.SU)(B.Ar).width=e),min:1,title:"Files"},null,8,["modelValue"])]),a[27]||(a[27]=(0,k._)("label",{class:"col-auto col-form-label"},"x",-1)),(0,k._)("div",na,[(0,k.Wm)(tF,{modelValue:(0,k.SU)(B.Ar).height,"onUpdate:modelValue":a[8]||(a[8]=e=>(0,k.SU)(B.Ar).height=e),min:1,title:"Ranks"},null,8,["modelValue"])])])]),(0,k._)("div",no,[(0,k._)("button",{type:"button",class:"btn btn-secondary",onClick:a[9]||(a[9]=e=>(0,k.SU)(B.Ar).setDimension({w:8,h:8}))},"Reset")])])]),(0,k._)("div",nl,[(0,k._)("div",ni,[a[28]||(a[28]=(0,k._)("label",{class:"col-auto col-form-label"},"Border pattern:",-1)),(0,k._)("div",nr,[(0,k._)("input",{type:"text",placeholder:"Use comma-separated numbers",title:"Use comma-separated numbers",class:"form-control",value:(0,k.SU)(U.h).board.border,onChange:a[10]||(a[10]=e=>(0,k.SU)(B.Ar).setBorder(e.target))},null,40,ns)])])])]),(0,k.Wm)(tj,{modelValue:(0,k.SU)(U.h).board.SN,"onUpdate:modelValue":a[11]||(a[11]=e=>(0,k.SU)(U.h).board.SN=e),onChange:(0,k.SU)(x.oO)},{default:(0,k.w5)(()=>a[29]||(a[29]=[(0,k.Uk)("Use S for knight")])),_:1,__:[29]},8,["modelValue","onChange"]),(0,k._)("div",nc,[(0,k._)("div",nu,[(0,k.Wm)(tj,{modelValue:(0,k.SU)(U.h).board.blackWhite,"onUpdate:modelValue":a[12]||(a[12]=e=>(0,k.SU)(U.h).board.blackWhite=e),onChange:(0,k.SU)(D.pz)},{default:(0,k.w5)(()=>a[30]||(a[30]=[(0,k.Uk)("Black/White neutral piece")])),_:1,__:[30]},8,["modelValue","onChange"])]),(0,k.wy)((0,k._)("div",nd,[(0,k._)("div",np,[a[31]||(a[31]=(0,k._)("label",{class:"col-auto col-form-label"},"Knight offset:",-1)),(0,k._)("div",nf,[(0,k.wy)((0,k._)("input",{type:"range",class:"form-range",min:"0.25",max:"0.75",step:"0.025","onUpdate:modelValue":a[13]||(a[13]=e=>(0,k.SU)(U.h).board.knightOffset=e),onInput:a[14]||(a[14]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,k.SU)(D.pz)&&(0,k.SU)(D.pz)(...t)})},null,544),[[k.nr,(0,k.SU)(U.h).board.knightOffset,void 0,{number:!0}]])])])],512),[[k.F8,t.value&&(0,k.SU)(U.h).board.blackWhite]])]),(0,k._)("div",nm,[(0,k.Wm)(tj,{modelValue:(0,k.SU)(U.h).board.collapse,"onUpdate:modelValue":a[15]||(a[15]=e=>(0,k.SU)(U.h).board.collapse=e),onChange:(0,k.SU)(B.SI)},{default:(0,k.w5)(()=>a[32]||(a[32]=[(0,k.Uk)("Always collapse boards")])),_:1,__:[32]},8,["modelValue","onChange"])]),(0,k.Wm)(tj,{modelValue:(0,k.SU)(U.h).board.coordinates,"onUpdate:modelValue":a[16]||(a[16]=e=>(0,k.SU)(U.h).board.coordinates=e),onChange:n},{default:(0,k.w5)(()=>a[33]||(a[33]=[(0,k.Uk)("Show coordinate labels")])),_:1,__:[33]},8,["modelValue"]),(0,k.Wm)(tj,{modelValue:(0,k.SU)(U.h).board.fullFEN,"onUpdate:modelValue":a[17]||(a[17]=e=>(0,k.SU)(U.h).board.fullFEN=e),onChange:(0,k.SU)(x.uu)},{default:(0,k.w5)(()=>a[34]||(a[34]=[(0,k.Uk)("Show full FEN")])),_:1,__:[34]},8,["modelValue","onChange"])])])],2))}}),ng={class:"me-3"},ny=["checked","disabled","onChange","id"],nb=["for","textContent"],nv=(0,k.aZ)({__name:"radio",props:{label:{},text:{},value:{},modelValue:{},disabled:{type:Boolean}},emits:["update:modelValue"],setup(e,t){let{emit:n}=t,a="rdo"+(0,k.FN)().uid;return(t,o)=>((0,k.wg)(),(0,k.iD)(k.HY,null,[(0,k._)("span",ng,(0,k.zw)(t.label),1),((0,k.wg)(!0),(0,k.iD)(k.HY,null,(0,k.Ko)(t.text,(o,l)=>((0,k.wg)(),(0,k.iD)("div",{class:"form-check d-inline-block me-3",key:l},[(0,k._)("input",{class:"form-check-input",type:"radio",checked:e.modelValue===e.value[l],disabled:t.disabled,onChange:t=>{n("update:modelValue",e.value[l])},name:a,id:a+"_"+l},null,40,ny),(0,k._)("label",{class:"form-check-label",for:a+"_"+l,textContent:(0,k.zw)(o)},null,8,nb)]))),128))],64))}});var nS=n(793);let nw={key:0},n_={class:"mb-3"},nk={class:"btn-gap"},nU=["disabled"],nx=["disabled"],nB=["disabled"],nC=["disabled"],nD={key:0,class:"btn-gap"},nA={key:0},nN={key:0},nP={key:1},nE={key:1,class:"ms-2"},nI={key:2,class:"ms-2"},nR=["onClick"],nO={key:0},nW={key:1},nM={class:"btn-gap"},nj={class:"mt-2"},nV={class:"form-check d-inline-block me-3"},nT=["checked"],nL={class:"form-check d-inline-block me-3"},nz=["checked"],nF={class:"form-check d-inline-block"},nq=["checked"],nQ={key:0,class:"mt-2"},nY={class:"mt-2"},nK={key:1,class:"mt-2"},nG={class:"btn-gap"},nH=["disabled"],nZ=["disabled"],n$=["disabled"],nX={class:"mt-2 gx-3 row"},nJ={class:"col flex-grow-1",style:{"flex-basis":"22rem"}},n0={class:"d-flex align-items-center flex-wrap-reverse mb-2"},n1={class:"flex-grow-1 col-form-label",style:{"flex-basis":"max-content"}},n2={class:"flex-grow-1",style:{"flex-basis":"max-content"}},n3={class:"row gx-3"},n8={class:"col"},n5={class:"mb-2"},n4={class:"d-inline-block"},n7={class:"d-inline-block"},n6={class:"col flex-grow-1",style:{"flex-basis":"22rem"}},n9={class:"row gx-3 mb-2"},ae={class:"col"},at=["disabled"],an={class:"row gx-3"},aa={class:"col mb-2",style:{"flex-basis":"10.5rem"}},ao={class:"row gx-3"},al={class:"col"},ai=["disabled"],ar={class:"col mb-2",style:{"flex-basis":"10.5rem"}},as={class:"row gx-3"},ac={class:"col"},au=["disabled"],ad={class:"text-end"},ap=(0,k.aZ)({__name:"play",setup(e){let t=()=>U.SB.play.mode==W.jl.retro,n=()=>U.SB.play.moveNumber<0,a=()=>U.SB.play.moveNumber>=U.SB.play.history.length-1;return(e,o)=>((0,k.wg)(),(0,k.iD)("section",{class:(0,k.C_)({show:6==(0,k.SU)(U.SB).tab})},[(0,k.SU)(U.SB).play.playing?((0,k.wg)(),(0,k.iD)("div",nw,[(0,k._)("div",n_,[(0,k._)("span",nk,[(0,k._)("button",{type:"button",class:"py-0 btn btn-secondary",onClick:o[0]||(o[0]=e=>(0,k.SU)(Z).move(-1)),disabled:n()},o[27]||(o[27]=[(0,k._)("i",{class:"fa-solid fa-angles-left fa-fw"},null,-1)]),8,nU),(0,k._)("button",{type:"button",class:"py-0 btn btn-secondary",onClick:o[1]||(o[1]=e=>(0,k.SU)(Z).moveBy(-1)),disabled:n()},o[28]||(o[28]=[(0,k._)("i",{class:"fa-solid fa-angle-left fa-fw"},null,-1)]),8,nx),(0,k._)("button",{type:"button",class:"py-0 btn btn-secondary",onClick:o[2]||(o[2]=e=>(0,k.SU)(Z).moveBy(1)),disabled:a()},o[29]||(o[29]=[(0,k._)("i",{class:"fa-solid fa-angle-right fa-fw"},null,-1)]),8,nB),(0,k._)("button",{type:"button",class:"py-0 btn btn-secondary",onClick:o[3]||(o[3]=e=>(0,k.SU)(Z).move((0,k.SU)(U.SB).play.history.length-1)),disabled:a()},o[30]||(o[30]=[(0,k._)("i",{class:"fa-solid fa-angles-right fa-fw"},null,-1)]),8,nC)]),(0,k._)("span",null,[(0,k._)("span",{class:(0,k.C_)(["btn step px-1 py-0 ms-3",{active:-1==(0,k.SU)(U.SB).play.moveNumber}]),onClick:o[4]||(o[4]=e=>(0,k.SU)(Z).goto())},"*",2)]),(0,k.SU)(U.i7).module.chess?((0,k.wg)(),(0,k.iD)("span",nD,[((0,k.wg)(!0),(0,k.iD)(k.HY,null,(0,k.Ko)((0,k.SU)(U.SB).play.history,(e,t)=>((0,k.wg)(),(0,k.iD)("span",{key:t},[(0,k.SU)(U.SB).play.history[t-1]&&(0,k.SU)(U.SB).play.history[t-1].color==e.color?((0,k.wg)(),(0,k.iD)("span",nA,[e.color==(0,k.SU)(W.Il).white?((0,k.wg)(),(0,k.iD)("span",nN," ... ")):((0,k.wg)(),(0,k.iD)("span",nP,(0,k.zw)((0,k.SU)(Z).number(e))+"...",1))])):(0,k.kq)("",!0),e.color==(0,k.SU)(W.Il).black&&0==t?((0,k.wg)(),(0,k.iD)("span",nE,(0,k.zw)((0,k.SU)(Z).number(e))+"...",1)):(0,k.kq)("",!0),e.color==(0,k.SU)(W.Il).white?((0,k.wg)(),(0,k.iD)("span",nI,(0,k.zw)((0,k.SU)(Z).number(e))+".",1)):(0,k.kq)("",!0),(0,k._)("span",{class:(0,k.C_)(["btn step px-1 py-0",{active:t==(0,k.SU)(U.SB).play.moveNumber}]),onClick:e=>(0,k.SU)(Z).move(t)},(0,k.zw)((0,k.SU)(Z).format(e)),11,nR)]))),128)),(0,k.SU)(U.SB).play.mode!=(0,k.SU)(W.jl).retro?((0,k.wg)(),(0,k.iD)(k.HY,{key:0},[(0,k.SU)(U.SB).play.over==(0,k.SU)(nS.U).checkmate?((0,k.wg)(),(0,k.iD)("span",nO,"Checkmate.")):(0,k.kq)("",!0),(0,k.SU)(U.SB).play.over==(0,k.SU)(nS.U).draw?((0,k.wg)(),(0,k.iD)("span",nW,"Draw.")):(0,k.kq)("",!0)],64)):(0,k.kq)("",!0)])):(0,k.kq)("",!0)]),(0,k._)("div",nM,[(0,k._)("button",{class:"btn btn-secondary",onClick:o[5]||(o[5]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,k.SU)(Z).exit&&(0,k.SU)(Z).exit(...t)})}," Exit playing "),(0,k.Wm)(ta,{factory:(0,k.SU)(Z).copyGame,class:"btn-primary"},{default:(0,k.w5)(()=>o[31]||(o[31]=[(0,k.Uk)(" Copy game ")])),_:1,__:[31]},8,["factory"]),(0,k.Wm)(ta,{factory:(0,k.SU)(Z).copyPGN,class:"btn-primary"},{default:(0,k.w5)(()=>o[32]||(o[32]=[(0,k.Uk)(" Copy PGN ")])),_:1,__:[32]},8,["factory"]),(0,k.SU)(N.OB).canPaste?((0,k.wg)(),(0,k.iD)("button",{key:0,class:"btn btn-secondary",onClick:o[6]||(o[6]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,k.SU)(Z).pasteMoves&&(0,k.SU)(Z).pasteMoves(...t)})},o[33]||(o[33]=[(0,k._)("i",{class:"fa-solid fa-paste"},null,-1),(0,k.Uk)(" Paste moves ")]))):(0,k.kq)("",!0)]),(0,k._)("div",nj,[o[37]||(o[37]=(0,k._)("span",{class:"me-3"},"Symbol:",-1)),(0,k._)("div",nV,[(0,k._)("input",{class:"form-check-input",type:"radio",checked:null==(0,k.SU)(U.h).PLAY.symbol,onChange:o[7]||(o[7]=e=>(0,k.SU)(U.h).PLAY.symbol=null),name:"SYM",id:"sEng"},null,40,nT),o[34]||(o[34]=(0,k._)("label",{class:"form-check-label",for:"sEng"}," English ",-1))]),(0,k._)("div",nL,[(0,k._)("input",{class:"form-check-input",type:"radio",checked:"german"==(0,k.SU)(U.h).PLAY.symbol,onChange:o[8]||(o[8]=e=>(0,k.SU)(U.h).PLAY.symbol="german"),name:"SYM",id:"sGer"},null,40,nz),o[35]||(o[35]=(0,k._)("label",{class:"form-check-label",for:"sGer"}," German ",-1))]),(0,k._)("div",nF,[(0,k._)("input",{class:"form-check-input",type:"radio",checked:"unicode"==(0,k.SU)(U.h).PLAY.symbol,onChange:o[9]||(o[9]=e=>(0,k.SU)(U.h).PLAY.symbol="unicode"),name:"SYM",id:"sUni"},null,40,nq),o[36]||(o[36]=(0,k._)("label",{class:"form-check-label",for:"sUni"}," Unicode ",-1))])]),t()?(0,k.kq)("",!0):((0,k.wg)(),(0,k.iD)("div",nQ,[(0,k.Wm)(tj,{modelValue:(0,k.SU)(U.h).PLAY.ep,"onUpdate:modelValue":o[10]||(o[10]=e=>(0,k.SU)(U.h).PLAY.ep=e)},{default:(0,k.w5)(()=>o[38]||(o[38]=[(0,k.Uk)("Add ep to en passant moves")])),_:1,__:[38]},8,["modelValue"])])),(0,k._)("div",nY,[(0,k.Wm)(tj,{modelValue:(0,k.SU)(U.h).PLAY.zero,"onUpdate:modelValue":o[11]||(o[11]=e=>(0,k.SU)(U.h).PLAY.zero=e)},{default:(0,k.w5)(()=>o[39]||(o[39]=[(0,k.Uk)("Use number 0 for castling notation")])),_:1,__:[39]},8,["modelValue"])]),t()?((0,k.wg)(),(0,k.iD)("div",nK,[(0,k.Wm)(tj,{modelValue:(0,k.SU)(U.h).PLAY.negative,"onUpdate:modelValue":o[12]||(o[12]=e=>(0,k.SU)(U.h).PLAY.negative=e)},{default:(0,k.w5)(()=>o[40]||(o[40]=[(0,k.Uk)("Use negative numbers in retro mode")])),_:1,__:[40]},8,["modelValue"])])):(0,k.kq)("",!0)])):((0,k.wg)(),(0,k.iD)(k.HY,{key:1},[(0,k._)("div",nG,[(0,k._)("button",{class:"btn btn-primary",onClick:o[13]||(o[13]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,k.SU)(Z).start&&(0,k.SU)(Z).start(...t)}),disabled:(0,k.SU)(U.SB).popeye.playing},"Start playing",8,nH),(0,k._)("button",{type:"button",class:"btn btn-secondary",onClick:o[14]||(o[14]=e=>(0,k.SU)(x.X4).reset(!0)),disabled:(0,k.SU)(U.SB).popeye.playing},o[41]||(o[41]=[(0,k._)("i",{class:"fa-solid fa-flag-checkered"},null,-1),(0,k.Uk)("  Starting position ")]),8,nZ),(0,k._)("button",{class:"btn btn-secondary",onClick:o[15]||(o[15]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,k.SU)(Z).pasteGame&&(0,k.SU)(Z).pasteGame(...t)}),disabled:(0,k.SU)(U.SB).popeye.playing},o[42]||(o[42]=[(0,k._)("i",{class:"fa-solid fa-paste"},null,-1),(0,k.Uk)(" Paste PGN ")]),8,n$)]),(0,k._)("div",nX,[(0,k._)("div",nJ,[(0,k._)("div",n0,[(0,k._)("div",n1,[(0,k.Wm)(nv,{modelValue:(0,k.SU)(U.SB).play.turn,"onUpdate:modelValue":o[16]||(o[16]=e=>(0,k.SU)(U.SB).play.turn=e),label:"Turn:",text:["White","Black"],value:["w","b"],disabled:(0,k.SU)(U.SB).play.mode==(0,k.SU)(W.jl).pass},null,8,["modelValue","disabled"])]),(0,k._)("div",n2,[(0,k._)("div",n3,[o[44]||(o[44]=(0,k._)("label",{class:"col-auto col-form-label"},"Mode:",-1)),(0,k._)("div",n8,[(0,k.wy)((0,k._)("select",{class:"form-select","onUpdate:modelValue":o[17]||(o[17]=e=>(0,k.SU)(U.SB).play.mode=e),onChange:o[18]||(o[18]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,k.SU)(D.wY)&&(0,k.SU)(D.wY)(...t)})},o[43]||(o[43]=[(0,k._)("option",{value:"normal"},"Normal",-1),(0,k._)("option",{value:"pass"},"Allow passing move",-1),(0,k._)("option",{value:"retro"},"Retro",-1)]),544),[[k.bM,(0,k.SU)(U.SB).play.mode]])])])])]),(0,k._)("div",n5,[o[49]||(o[49]=(0,k.Uk)(" Castling: ")),(0,k._)("span",n4,[(0,k.Wm)(tj,{class:"ms-2 d-inline-block",modelValue:(0,k.SU)(U.SB).play.castle.K,"onUpdate:modelValue":o[19]||(o[19]=e=>(0,k.SU)(U.SB).play.castle.K=e),disabled:t()},{default:(0,k.w5)(()=>o[45]||(o[45]=[(0,k.Uk)("WK")])),_:1,__:[45]},8,["modelValue","disabled"]),(0,k.Wm)(tj,{class:"ms-2 d-inline-block",modelValue:(0,k.SU)(U.SB).play.castle.Q,"onUpdate:modelValue":o[20]||(o[20]=e=>(0,k.SU)(U.SB).play.castle.Q=e),disabled:t()},{default:(0,k.w5)(()=>o[46]||(o[46]=[(0,k.Uk)("WQ")])),_:1,__:[46]},8,["modelValue","disabled"])]),(0,k._)("span",n7,[(0,k.Wm)(tj,{class:"ms-2 d-inline-block",modelValue:(0,k.SU)(U.SB).play.castle.k,"onUpdate:modelValue":o[21]||(o[21]=e=>(0,k.SU)(U.SB).play.castle.k=e),disabled:t()},{default:(0,k.w5)(()=>o[47]||(o[47]=[(0,k.Uk)("BK")])),_:1,__:[47]},8,["modelValue","disabled"]),(0,k.Wm)(tj,{class:"ms-2 d-inline-block",modelValue:(0,k.SU)(U.SB).play.castle.q,"onUpdate:modelValue":o[22]||(o[22]=e=>(0,k.SU)(U.SB).play.castle.q=e),disabled:t()},{default:(0,k.w5)(()=>o[48]||(o[48]=[(0,k.Uk)("BQ")])),_:1,__:[48]},8,["modelValue","disabled"])])])]),(0,k._)("div",n6,[(0,k._)("div",n9,[o[50]||(o[50]=(0,k._)("label",{class:"col-auto col-form-label"},"En passant square: ",-1)),(0,k._)("div",ae,[(0,k.wy)((0,k._)("input",{type:"text",class:"form-control",maxlength:"2","onUpdate:modelValue":o[23]||(o[23]=e=>(0,k.SU)(U.SB).play.enPassant=e),disabled:t()},null,8,at),[[k.nr,(0,k.SU)(U.SB).play.enPassant]])])]),(0,k._)("div",an,[(0,k._)("div",aa,[(0,k._)("div",ao,[o[51]||(o[51]=(0,k._)("label",{class:"col-auto col-form-label"},"Half moves: ",-1)),(0,k._)("div",al,[(0,k.wy)((0,k._)("input",{type:"number",class:"form-control",min:"0","onUpdate:modelValue":o[24]||(o[24]=e=>(0,k.SU)(U.SB).play.halfMove=e),disabled:t()},null,8,ai),[[k.nr,(0,k.SU)(U.SB).play.halfMove,void 0,{number:!0}]])])])]),(0,k._)("div",ar,[(0,k._)("div",as,[o[52]||(o[52]=(0,k._)("label",{class:"col-auto col-form-label"},"Full moves: ",-1)),(0,k._)("div",ac,[(0,k.wy)((0,k._)("input",{type:"number",class:"form-control",min:"1","onUpdate:modelValue":o[25]||(o[25]=e=>(0,k.SU)(U.SB).play.fullMove=e),disabled:t()},null,8,au),[[k.nr,(0,k.SU)(U.SB).play.fullMove,void 0,{number:!0}]])])])])]),(0,k._)("div",ad,[(0,k._)("button",{class:"btn btn-secondary",onClick:o[26]||(o[26]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,k.SU)(x.Wc)&&(0,k.SU)(x.Wc)(...t)})},"Reset settings")])])])],64))],2))}}),af=(0,k.XI)(""),am={async fetch(e){try{gtag("event","fen_pdb_get"),e.disabled=!0,e.value="Fetching...";let t=ah+encodeURIComponent("PROBID='".concat(af.value,"'")),n=await fetch("https://corsproxy.io/?"+t),a=await n.text();(0,x.dd)(a.match(/<b>FEN:<\/b> (.+)/)[1],!0)}catch{(0,P.Z)("An error has occurred. Please try again later.")}finally{e.disabled=!1,e.value="Get FEN"}},search(){gtag("event","fen_pdb_search"),window.open(ah+encodeURIComponent(ab()))},copyQuery:()=>(gtag("event","fen_pdb_copy"),ab()),copyEdit:()=>(gtag("event","fen_pdb_copyEdit"),function(){let e={},{w:t,h:n}=U.h.board;for(let a=0;a<n;a++)for(let n=0;n<t;n++){let o,l=x.xG[a*t+n].value,i=l.match(/^(-?)(?:\*(\d))?([kqbsnrpxc])$/i);if(i){if("x"==i[3])o="sY";else{let e=ag[R.V.indexOf(i[3].toLowerCase().replace("s","n"))];o=(i[1]?"n":av(l))+e+ay[Number(i[2]||0)]}e[o]=(e[o]||"")+(0,O.MA)(a,n)}}let a=[];for(let t in e)a.push(t+e[t]);return a.join(" ")}())},ah="https://pdb.dieschwalbe.de/search.jsp?expression=",ag=["K","D","L","S","T","B","I"],ay=["","R","U","L"];function ab(){let e=[],{w:t,h:n}=U.h.board;for(let a=0;a<n;a++)for(let n=0;n<t;n++){let o=x.xG[a*t+n].value;if(!o.match(/^[kqbsnrp]$/i))continue;let l=ag[R.V.indexOf(o.toLowerCase().replace("s","n"))],i=av(o);e.push(i+l+(0,O.MA)(a,n))}let a="POSITION='".concat(e.join(" "),"'");return U.h.DB.exact&&(a+=" AND APIECES=".concat(e.length)),a}function av(e){return e==e.toLowerCase()?"s":"w"}let aS={copyFEN(){gtag("event","fen_yacpdb_copyFEN");let{w:e,h:t}=U.h.board,n=x.xG.map(e=>(0,O.sV)(e.value));return(0,O.N0)(n,e,t)},async fetch(e){try{gtag("event","fen_yacpdb_get"),e.disabled=!0,e.value="Fetching...";let n="https://yacpdb.org/gateway/ql?q="+encodeURIComponent("Id('".concat(af.value,"')")),a=await fetch("https://corsproxy.io/?"+n),o=await a.json();if(o.success){let{w:e,h:n}=U.h.board,a=o.result.entries[0].algebraic,l=(0,O.Q5)(e*n);function t(t){let a=t.charCodeAt(1)-M.oh,o=Number(t[2]);l[(n-o)*e+a]=t[0]}for(let e of a.black)t(e.toLowerCase());for(let e of a.white)t(e);(0,x.dd)((0,O.N0)(l,e,n))}}catch{(0,P.Z)("An error has occurred. Please try again later.")}finally{e.disabled=!1,e.value="Get FEN"}},search(){gtag("event","fen_yacpdb_search"),window.open("https://yacpdb.org/#q/"+encodeURIComponent(aw())+"/1")},copyQuery:()=>(gtag("event","fen_yacpdb_copy"),aw()),copyEdit:()=>(gtag("event","fen_yacpdb_copyEdit"),function(){let e={w:[],b:[],n:[]},{w:t,h:n}=U.h.board;for(let a=0;a<n;a++)for(let n=0;n<t;n++){let o=x.xG[a*t+n].value,l=o.match(/^(-?)([kqbsnrp])$/i);if(!l)continue;let i=(0,O.hv)(l[2],!1,!0).toUpperCase();e[l[1]?"n":a_(o)].push(i+(0,O.MA)(a,n))}let a=[];return e.w.length&&a.push("    white: [".concat(e.w.join(", "),"]")),e.b.length&&a.push("    black: [".concat(e.b.join(", "),"]")),e.n.length&&a.push("    neutral: [".concat(e.n.join(", "),"]")),a.join("\n")}())};function aw(){let e=[],{w:t,h:n}=U.h.board;for(let a=0;a<n;a++)for(let n=0;n<t;n++){let o=(0,O.sV)(x.xG[a*t+n].value).replace("(","").replace(")","");o&&(o.match(/\d/)||(o=o.startsWith("!")?"n"+o.toUpperCase():a_(o)+o.toUpperCase(),e.push(o+(0,O.MA)(a,n))))}let a='MatrixExtended("'.concat(e.join(" "),'", false, false, "None")');return U.h.DB.exact&&(a+=" AND PCount(*) = "+e.length),a}function a_(e){return e==e.toLowerCase()?"b":"w"}let ak={class:"row gx-3 mb-2 align-items-center"},aU={class:"col"},ax={class:"form-check d-inline-block me-3"},aB=["checked"],aC={class:"form-check d-inline-block"},aD=["checked"],aA={class:"mb-3 btn-gap"},aN={class:"row gx-3 mb-3"},aP={class:"col"},aE=["readonly"],aI={class:"col-auto"},aR=["disabled"],aO={class:"row align-items-center flex-wrap"},aW={class:"col-auto mb-2"},aM={class:"col text-end btn-gap",style:{"flex-basis":"24rem"}},aj=(0,k.aZ)({__name:"database",setup(e){let t=(0,k.Fl)(()=>"PDB"==U.h.DB.use?am:aS);return(e,n)=>((0,k.wg)(),(0,k.iD)("section",{class:(0,k.C_)({show:2==(0,k.SU)(U.SB).tab})},[(0,k._)("div",ak,[n[8]||(n[8]=(0,k._)("label",{class:"col-auto col-form-label"},"Use database: ",-1)),(0,k._)("div",aU,[(0,k._)("div",ax,[(0,k._)("input",{class:"form-check-input",type:"radio",checked:"PDB"==(0,k.SU)(U.h).DB.use,onChange:n[0]||(n[0]=e=>(0,k.SU)(U.h).DB.use="PDB"),name:"DB",id:"rPDB"},null,40,aB),n[6]||(n[6]=(0,k._)("label",{class:"form-check-label",for:"rPDB"}," PDB ",-1))]),(0,k._)("div",aC,[(0,k._)("input",{class:"form-check-input",type:"radio",checked:"YACPDB"==(0,k.SU)(U.h).DB.use,onChange:n[1]||(n[1]=e=>(0,k.SU)(U.h).DB.use="YACPDB"),name:"DB",id:"rYACPDB"},null,40,aD),n[7]||(n[7]=(0,k._)("label",{class:"form-check-label",for:"rYACPDB"}," YACPDB ",-1))])])]),(0,k._)("div",aA,[(0,k.Wm)(ta,{factory:t.value.copyEdit,class:"btn-primary"},{default:(0,k.w5)(()=>n[9]||(n[9]=[(0,k.Uk)(" Copy board edit syntax ")])),_:1,__:[9]},8,["factory"]),"YACPDB"==(0,k.SU)(U.h).DB.use?((0,k.wg)(),(0,k.j4)(ta,{key:0,factory:(0,k.SU)(aS).copyFEN,class:"btn-secondary"},{default:(0,k.w5)(()=>n[10]||(n[10]=[(0,k.Uk)(" Copy YACPDB FEN ")])),_:1,__:[10]},8,["factory"])):(0,k.kq)("",!0)]),(0,k._)("div",aN,[n[11]||(n[11]=(0,k._)("label",{class:"col-auto col-form-label"},"Problem Id:",-1)),(0,k._)("div",aP,[(0,k.wy)((0,k._)("input",{type:"text",class:"form-control","onUpdate:modelValue":n[2]||(n[2]=e=>(0,k.dq)(af)?af.value=e:null),readonly:(0,k.SU)(U.I3)()||void 0},null,8,aE),[[k.nr,(0,k.SU)(af)]])]),(0,k._)("div",aI,[(0,k._)("input",{type:"button",class:"btn btn-primary",value:"Get FEN",onClick:n[3]||(n[3]=e=>t.value.fetch(e.target)),disabled:(0,k.SU)(U.I3)()},null,8,aR)])]),(0,k._)("div",aO,[(0,k._)("div",aW,[(0,k.Wm)(tj,{modelValue:(0,k.SU)(U.h).DB.exact,"onUpdate:modelValue":n[4]||(n[4]=e=>(0,k.SU)(U.h).DB.exact=e)},{default:(0,k.w5)(()=>n[12]||(n[12]=[(0,k.Uk)("Search exactly these pieces")])),_:1,__:[12]},8,["modelValue"])]),(0,k._)("div",aM,[(0,k.Wm)(ta,{factory:t.value.copyQuery,class:"btn-secondary"},{default:(0,k.w5)(()=>n[13]||(n[13]=[(0,k.Uk)(" Copy search query ")])),_:1,__:[13]},8,["factory"]),(0,k._)("button",{class:"btn btn-primary nowrap",onClick:n[5]||(n[5]=function(){for(var e=arguments.length,n=Array(e),a=0;a<e;a++)n[a]=arguments[a];return t.value.search&&t.value.search(...n)})},n[14]||(n[14]=[(0,k._)("i",{class:"fa-solid fa-magnifying-glass"},null,-1),(0,k.Uk)(" Search position ")]))])])],2))}});var aV=n(6342),aT=n(5057);function aL(){return n.e("946").then(n.bind(n,4078))}function az(e){try{let t=JSON.parse(e);if("number"!=typeof t.version||!Array.isArray(t.project))throw Error();return t.project}catch{return null}}function aF(e){let t=e.match(/[kqbnrp1-8]{1,8}(?:\/[kqbnrp1-8]{1,8}){7}(?: [wb] (?:-|[kq]{1,4}) (?:-|[a-h][1-8]) \d+ \d+)?/gi);if(!t||!t.length)return null;let n=[];for(let[e,a]of t.entries())n.push((0,aT.E)({fen:a},e));return n}let aq={async reset(){U.h.project.length&&await (0,P.i)("Are you sure you want to clear all entries?")&&U.h.project.length&&(U.h.project=[])},async add(e){if(e){let e=await aL(),t=U.SB.popeye.input,n=(0,J.U_)(t);t=e.normalizeInput(t,n),U.h.project.push((0,aT.E)({fen:n.fen,popeye:t}))}else U.h.project.push((0,aT.E)({fen:x.RI.value}))},remove(e){U.h.project.splice(e,1)},async open(e){var t;let n=await (t=e,new Promise((e,n)=>{let a=new FileReader;a.onload=t=>e(t.target.result),a.onerror=e=>n(e),a.readAsText(t)}));for(let e of[az,(await aL()).parseOliveFormat,aF]){let t=e(n);if(t){U.h.project=t;return}}(0,P.Z)("Unable to parse the file. The format cannot be recognized.")},link:(0,k.XI)("")};(0,k.m0)(()=>{let e=new Blob([JSON.stringify({version:1,project:U.h.project})],{type:"application/fen.tool.project+json"}),t=URL.createObjectURL(e);aq.link.value&&URL.revokeObjectURL(aq.link.value),aq.link.value=t});var aQ=n(6042);let aY={class:"btn-gap"},aK={class:"btn-group"},aG={class:"dropdown-menu"},aH=["href"],aZ={key:0,class:"p-1"},a$=["fen","onClick"],aX=["onClick"],aJ=(0,k.aZ)({__name:"project",setup(e){let t=(0,k.XI)(!1);function n(e){var t;return(null==(t=e.popeye)?void 0:t.includes("Forsyth"))?(0,aQ.Vl)(e.fen):e.fen}return(e,a)=>((0,k.wg)(),(0,k.iD)("section",{class:(0,k.C_)({show:8==(0,k.SU)(U.SB).tab})},[(0,k._)("input",{type:"file",class:"d-none",id:"project_file",onChange:a[0]||(a[0]=e=>(function(e){var t;let n=null==(t=e.files)?void 0:t[0];n&&(e.value="",aq.open(n))})(e.target)),accept:".fentool,.olv"},null,32),(0,k._)("div",aY,[(0,k._)("div",aK,[(0,k._)("button",{type:"button",class:"btn btn-primary pe-2",onClick:a[1]||(a[1]=e=>(0,k.SU)(aq).add())},a[9]||(a[9]=[(0,k._)("i",{class:"fa-solid fa-plus"},null,-1),(0,k.Uk)(" Add ")])),a[10]||(a[10]=(0,k._)("button",{type:"button",class:"ps-2 btn btn-primary dropdown-toggle dropdown-toggle-split","data-bs-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},[(0,k._)("span",{class:"visually-hidden"},"Toggle Dropdown")],-1)),(0,k._)("div",aG,[(0,k._)("div",{class:"dropdown-item",onClick:a[2]||(a[2]=e=>(0,k.SU)(aq).add(!0))},"As a Popeye problem")])]),a[13]||(a[13]=(0,k._)("label",{for:"project_file",class:"btn btn-secondary",title:"Open a project file"},[(0,k._)("i",{class:"fa-regular fa-folder-open"}),(0,k.Uk)(" Open ")],-1)),(0,k._)("a",{href:(0,k.SU)(U.i7).envReady?(0,k.SU)(aq).link.value:void 0,download:"project.fentool",class:"btn btn-secondary",title:"Save project file"},a[11]||(a[11]=[(0,k._)("i",{class:"fa-solid fa-download"},null,-1),(0,k.Uk)(" Save ")]),8,aH),(0,k._)("button",{class:"btn btn-secondary",onClick:a[3]||(a[3]=e=>(0,k.SU)(aq).reset()),title:"Clear all positions in the project"},a[12]||(a[12]=[(0,k._)("i",{class:"fa-regular fa-file"},null,-1),(0,k.Uk)(" Clear ")]))]),(0,k.SU)(U.i7).envReady?((0,k.wg)(),(0,k.iD)("div",{key:0,onMousedown:a[8]||(a[8]=(0,k.iM)(()=>{},["stop"])),class:"mt-3"},[(0,k.SU)(U.h).project.length?(0,k.kq)("",!0):((0,k.wg)(),(0,k.iD)("div",aZ,a[14]||(a[14]=[(0,k._)("div",{class:"d-flex flex-wrap"},[(0,k._)("div",{style:{"flex-basis":"max-content"}}," No positions in the project yet.\xa0 "),(0,k._)("div",{style:{"flex-basis":"max-content"}},' Click "Add" to add position. ')],-1)]))),(0,k.Wm)((0,k.SU)(aV.jP),{axis:"xy",list:(0,k.SU)(U.h).project,"onUpdate:list":a[5]||(a[5]=e=>(0,k.SU)(U.h).project=e),distance:10*!(0,k.SU)(N.OB).isTouch,class:(0,k.C_)(["thumbnail-container",{sorting:t.value}]),onSortStart:a[6]||(a[6]=e=>t.value=!0),onSortEnd:a[7]||(a[7]=e=>t.value=!1),"press-delay":200*!!(0,k.SU)(N.OB).isTouch,"helper-class":"thumbnail-ghost"},{default:(0,k.w5)(()=>[((0,k.wg)(!0),(0,k.iD)(k.HY,null,(0,k.Ko)((0,k.SU)(U.h).project,(e,t)=>((0,k.wg)(),(0,k.j4)((0,k.SU)(aV.cU),{index:t,key:e.id},{default:(0,k.w5)(()=>[(0,k._)("div",{class:(0,k.C_)(["thumbnail-wrapper",{touch:(0,k.SU)(N.OB).isTouch}]),onDragstart:a[4]||(a[4]=(0,k.iM)(()=>{},["prevent"]))},[(0,k._)("img",{fen:n(e),onClick:t=>{!(0,U.I3)()&&((0,x.dd)(n(e)),e.popeye&&(U.SB.tab=7,U.SB.compute="py",U.SB.popeye.input=e.popeye),N.OB.isTouch&&document.body.scrollTo({behavior:"smooth",top:0}))},class:(0,k.C_)(["thumbnail",{disabled:(0,k.SU)(U.I3)()}])},null,10,a$),(0,k._)("i",{class:"fa-solid fa-circle-xmark text-danger",onClick:e=>(0,k.SU)(aq).remove(t)},null,8,aX)],34)]),_:2},1032,["index"]))),128))]),_:1},8,["list","distance","class","press-delay"])],32)):(0,k.kq)("",!0)],2))}}),a0={async copy(){if(U.h.board.w!=M.Dm||U.h.board.h!=M.Dm)throw(0,P.Z)("只支援標準棋盤"),Error();return gtag("event","fen_bbs_copy"),(await n.e("936").then(n.bind(n,4188))).generate((0,x.xL)(),e9(),af.value,U.h.BBS,U.h.board,N.OB.isTouch)}},a1={class:"row gx-3"},a2={class:"col flex-grow-1 mb-3",style:{"flex-basis":"max-content"}},a3={class:"col flex-grow-1 text-end"},a8=(0,k.aZ)({__name:"bbs",setup:e=>(e,t)=>(0,k.SU)(U.i7).envReady&&(0,k.SU)(N.OB).isTaiwan?((0,k.wg)(),(0,k.iD)("section",{key:0,class:(0,k.C_)({show:4==(0,k.SU)(U.SB).tab})},[(0,k._)("div",a1,[(0,k._)("div",a2,[(0,k.Wm)(tj,{modelValue:(0,k.SU)(U.h).BBS.Id,"onUpdate:modelValue":t[0]||(t[0]=e=>(0,k.SU)(U.h).BBS.Id=e)},{default:(0,k.w5)(()=>t[5]||(t[5]=[(0,k.Uk)("Include database Id")])),_:1,__:[5]},8,["modelValue"]),(0,k.Wm)(tj,{modelValue:(0,k.SU)(U.h).BBS.coordinates,"onUpdate:modelValue":t[1]||(t[1]=e=>(0,k.SU)(U.h).BBS.coordinates=e)},{default:(0,k.w5)(()=>t[6]||(t[6]=[(0,k.Uk)("Include Coordinates")])),_:1,__:[6]},8,["modelValue"]),(0,k.Wm)(tj,{modelValue:(0,k.SU)(U.h).BBS.notes,"onUpdate:modelValue":t[2]||(t[2]=e=>(0,k.SU)(U.h).BBS.notes=e)},{default:(0,k.w5)(()=>t[7]||(t[7]=[(0,k.Uk)("Include Notes")])),_:1,__:[7]},8,["modelValue"]),(0,k.Wm)(tj,{modelValue:(0,k.SU)(U.h).BBS.uncoloredNotes,"onUpdate:modelValue":t[3]||(t[3]=e=>(0,k.SU)(U.h).BBS.uncoloredNotes=e)},{default:(0,k.w5)(()=>t[8]||(t[8]=[(0,k.Uk)("Uncolored Note")])),_:1,__:[8]},8,["modelValue"]),(0,k.Wm)(tj,{modelValue:(0,k.SU)(U.h).BBS.redBlue,"onUpdate:modelValue":t[4]||(t[4]=e=>(0,k.SU)(U.h).BBS.redBlue=e)},{default:(0,k.w5)(()=>t[9]||(t[9]=[(0,k.Uk)("Use Red and Blue in BBS Code")])),_:1,__:[9]},8,["modelValue"])]),(0,k._)("div",a3,[(0,k.Wm)(ta,{factory:(0,k.SU)(a0).copy,class:"btn-primary"},{default:(0,k.w5)(()=>t[10]||(t[10]=[(0,k.Uk)("Copy BBS Code")])),_:1,__:[10]},8,["factory"])])])],2)):(0,k.kq)("",!0)}),a5=["disabled"],a4={class:"mb-3 row gx-2"},a7={class:"col"},a6={class:"w-passive-100"},a9=["disabled"],oe={class:"col-auto text-end"},ot={class:"btn-gap"},on=["disabled"],oa={key:1},oo=["title"],ol={key:0},oi={class:"mb-3 row"},or={class:"col"},os={class:"btn-gap"},oc={class:"col-auto text-end"},ou={key:1,class:"mb-3 row"},od={class:"col"},op={class:"btn-gap"},of=["disabled"],om=["disabled"],oh=["disabled"],og=["disabled"],oy={class:"col-auto text-end"},ob=["innerHTML"],ov=(0,k.aZ)({__name:"popeye",setup:e=>(e,t)=>(0,k.wy)(((0,k.wg)(),(0,k.iD)("div",null,[(0,k.wy)((0,k._)("div",null,[(0,k.wy)((0,k._)("textarea",{class:"form-control mb-2",rows:"5","onUpdate:modelValue":t[0]||(t[0]=e=>(0,k.SU)(U.SB).popeye.input=e),disabled:(0,k.SU)(U.SB).popeye.running,placeholder:"For example:\n=============\nStipulation #2\nOption Variation"},null,8,a5),[[k.nr,(0,k.SU)(U.SB).popeye.input]]),(0,k._)("div",a4,[(0,k._)("div",a7,[(0,k._)("div",a6,[(0,k._)("button",{type:"button",class:"btn btn-secondary",onClick:t[1]||(t[1]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,k.SU)(J.wD).editMap&&(0,k.SU)(J.wD).editMap(...t)}),disabled:(0,k.SU)(U.SB).popeye.running,style:{overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis","max-width":"100%"}},t[15]||(t[15]=[(0,k._)("i",{class:"fa-solid fa-pen-to-square"},null,-1),(0,k.Uk)(" Fairy piece mapping ")]),8,a9)])]),(0,k._)("div",oe,[(0,k._)("div",ot,[!(0,k.SU)(U.SB).popeye.running&&(0,k.SU)(U.SB).popeye.output?((0,k.wg)(),(0,k.iD)("button",{key:0,type:"button",class:"btn btn-secondary",onClick:t[2]||(t[2]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,k.SU)(J.wD).play&&(0,k.SU)(J.wD).play(...t)}),disabled:(0,k.SU)(U.SB).popeye.error}," Play solution ",8,on)):(0,k.kq)("",!0),(0,k.SU)(U.SB).popeye.running?((0,k.wg)(),(0,k.iD)("button",{key:2,type:"button",class:"btn btn-secondary",onClick:t[4]||(t[4]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,k.SU)(J.wD).cancel&&(0,k.SU)(J.wD).cancel(...t)})},t[18]||(t[18]=[(0,k._)("i",{class:"fa-solid fa-stop"},null,-1),(0,k.Uk)(" Cancel ")]))):((0,k.wg)(),(0,k.iD)("span",oa,[(0,k.SU)(U.SB).play.playing||!(0,k.SU)(U.SB).popeye.input.trim()?((0,k.wg)(),(0,k.iD)("button",{key:0,type:"button",class:"btn btn-primary disabled",title:(0,k.SU)(U.SB).play.playing?"Need to exit play mode first":"Input instructions first"},t[16]||(t[16]=[(0,k._)("i",{class:"fa-solid fa-play"},null,-1),(0,k.Uk)(" Run ")]),8,oo)):((0,k.wg)(),(0,k.iD)("button",{key:1,type:"button",class:"btn btn-primary",onClick:t[3]||(t[3]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,k.SU)(J.wD).run&&(0,k.SU)(J.wD).run(...t)}),title:"Run Popeye on your device!"},t[17]||(t[17]=[(0,k._)("i",{class:"fa-solid fa-play"},null,-1),(0,k.Uk)(" Run ")])))]))])])])],512),[[k.F8,!(0,k.SU)(U.SB).popeye.playing&&!(0,k.SU)(U.SB).popeye.editMap]]),!(0,k.SU)(U.SB).popeye.playing&&(0,k.SU)(U.SB).popeye.editMap?((0,k.wg)(),(0,k.iD)("div",ol,[(0,k.wy)((0,k._)("textarea",{class:"form-control mb-2",rows:"5","onUpdate:modelValue":t[5]||(t[5]=e=>(0,k.SU)(U.SB).popeye.mapping=e),placeholder:"Use the format like *2Q=G for each line."},null,512),[[k.nr,(0,k.SU)(U.SB).popeye.mapping]]),(0,k._)("div",oi,[(0,k._)("div",or,[(0,k._)("div",os,[(0,k._)("button",{type:"button",class:"btn btn-primary",onClick:t[6]||(t[6]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,k.SU)(J.wD).saveMap&&(0,k.SU)(J.wD).saveMap(...t)})}," Save setting "),(0,k._)("button",{type:"button",class:"btn btn-secondary",onClick:t[7]||(t[7]=e=>(0,k.SU)(U.SB).popeye.editMap=!1)}," Cancel ")])]),(0,k._)("div",oc,[(0,k._)("button",{type:"button",class:"btn btn-secondary",onClick:t[8]||(t[8]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,k.SU)(J.wD).resetMap&&(0,k.SU)(J.wD).resetMap(...t)})}," Reset ")])])])):(0,k.kq)("",!0),(0,k.SU)(U.SB).popeye.playing?((0,k.wg)(),(0,k.iD)("div",ou,[(0,k._)("div",od,[(0,k._)("div",op,[(0,k._)("button",{type:"button",class:"btn btn-secondary",onClick:t[9]||(t[9]=e=>(0,k.SU)(J.wD).move(0)),disabled:(0,k.SU)(U.SB).popeye.index<=0},t[19]||(t[19]=[(0,k._)("i",{class:"fa-solid fa-angles-left fa-fw"},null,-1)]),8,of),(0,k._)("button",{type:"button",class:"btn btn-secondary",onClick:t[10]||(t[10]=e=>(0,k.SU)(J.wD).moveBy(-1)),disabled:(0,k.SU)(U.SB).popeye.index<=0},t[20]||(t[20]=[(0,k._)("i",{class:"fa-solid fa-angle-left fa-fw"},null,-1)]),8,om),(0,k._)("button",{type:"button",class:"btn btn-secondary",onClick:t[11]||(t[11]=e=>(0,k.SU)(J.wD).moveBy(1)),disabled:(0,k.SU)(U.SB).popeye.index>=(0,k.SU)(U.SB).popeye.steps.length-1},t[21]||(t[21]=[(0,k._)("i",{class:"fa-solid fa-angle-right fa-fw"},null,-1)]),8,oh),(0,k._)("button",{type:"button",class:"btn btn-secondary",onClick:t[12]||(t[12]=e=>(0,k.SU)(J.wD).move((0,k.SU)(U.SB).popeye.steps.length-1)),disabled:(0,k.SU)(U.SB).popeye.index>=(0,k.SU)(U.SB).popeye.steps.length-1},t[22]||(t[22]=[(0,k._)("i",{class:"fa-solid fa-angles-right fa-fw"},null,-1)]),8,og)])]),(0,k._)("div",oy,[(0,k._)("button",{type:"button",class:"btn btn-secondary",onClick:t[13]||(t[13]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,k.SU)(J.wD).exit&&(0,k.SU)(J.wD).exit(...t)})}," Exit playing ")])])):(0,k.kq)("",!0),(0,k.wy)((0,k._)("div",{id:"Output",class:"form-control",innerHTML:(0,k.SU)(U.SB).popeye.output,onClick:t[14]||(t[14]=e=>(0,k.SU)(J.wD).step(e))},null,8,ob),[[k.F8,(0,k.SU)(U.SB).popeye.output&&7==(0,k.SU)(U.SB).tab]]),t[23]||(t[23]=(0,k._)("div",{class:"mt-2"},[(0,k._)("a",{href:"https://github.com/thomas-maeder/popeye/blob/master/py-engl.txt",target:"_blank"}," Popeye documentation ")],-1))],512)),[[k.F8,"py"==(0,k.SU)(U.SB).compute]])}),oS={key:0},ow={key:1,type:"button",class:"btn btn-primary",disabled:""},o_={key:1},ok={key:2},oU={key:0,class:"row align-items-baseline"},ox={class:"col",style:{"flex-basis":"12rem"}},oB={class:"row gx-3 mb-2"},oC={class:"col"},oD={class:"col",style:{"flex-basis":"11rem"}},oA={class:"row gx-3 mb-2"},oN={class:"col"},oP={class:"col mb-2",style:{"flex-basis":"10rem"}},oE={class:"btn-gap"},oI={key:1,disabled:"",class:"btn btn-primary"},oR={class:"mt-3"},oO={key:0},oW={key:0},oM={key:1},oj={key:2},oV={key:3},oT={class:"table"},oL={class:"align-top"},oz={class:"nowrap"},oF={class:"mt-2"},oq=["onClick"],oQ=["textContent"],oY=(0,k.aZ)({__name:"stockfish",setup:e=>(e,t)=>(0,k.wy)(((0,k.wg)(),(0,k.iD)("div",null,[(0,k.SU)(U.i7).stockfish.status<(0,k.SU)(W.KO).needReload?((0,k.wg)(),(0,k.iD)("div",oS,[t[8]||(t[8]=(0,k._)("div",{class:"mb-3"},"To use this feature, we need to download Stockfish modules first.",-1)),(0,k.SU)(U.i7).stockfish.status==(0,k.SU)(W.KO).notDownloaded?((0,k.wg)(),(0,k.iD)("button",{key:0,type:"button",class:"btn btn-primary",onClick:t[0]||(t[0]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,k.SU)(eR).download&&(0,k.SU)(eR).download(...t)})},t[6]||(t[6]=[(0,k._)("i",{class:"fa-solid fa-download"},null,-1),(0,k.Uk)(" Download now! (39.5MB) ")]))):((0,k.wg)(),(0,k.iD)("button",ow,t[7]||(t[7]=[(0,k._)("i",{class:"fa-solid fa-download"},null,-1),(0,k.Uk)(" Downloading... "),(0,k._)("i",{class:"fa-solid fa-spinner fa-spin"},null,-1)])))])):(0,k.SU)(U.i7).stockfish.status==(0,k.SU)(W.KO).needReload?((0,k.wg)(),(0,k.iD)("div",o_,t[9]||(t[9]=[(0,k._)("div",{class:"mb-3"},"Download complete. Please restart FEN Tool.",-1),(0,k._)("button",{type:"button",class:"btn btn-primary",onclick:"location.reload()"},[(0,k._)("i",{class:"fa-solid fa-rotate-right"}),(0,k.Uk)(" Restart FEN Tool now ")],-1)]))):((0,k.wg)(),(0,k.iD)("div",ok,[(0,k.SU)(U.i7).stockfish.running<(0,k.SU)(W.MI).running?((0,k.wg)(),(0,k.iD)("div",oU,[(0,k._)("div",ox,[(0,k._)("div",oB,[t[10]||(t[10]=(0,k._)("label",{class:"col-auto col-form-label"},"Depth:",-1)),(0,k._)("div",oC,[(0,k.Wm)(tF,{modelValue:(0,k.SU)(U.h).Stockfish.depth,"onUpdate:modelValue":t[1]||(t[1]=e=>(0,k.SU)(U.h).Stockfish.depth=e),min:1,title:"Search depth"},null,8,["modelValue"])])])]),(0,k._)("div",oD,[(0,k._)("div",oA,[t[11]||(t[11]=(0,k._)("label",{class:"col-auto col-form-label"},"Lines:",-1)),(0,k._)("div",oN,[(0,k.Wm)(tF,{modelValue:(0,k.SU)(U.h).Stockfish.lines,"onUpdate:modelValue":t[2]||(t[2]=e=>(0,k.SU)(U.h).Stockfish.lines=e),min:1,title:"Number of lines to search"},null,8,["modelValue"])])])]),(0,k._)("div",oP,[(0,k.Wm)(tj,{modelValue:(0,k.SU)(U.h).Stockfish.study,"onUpdate:modelValue":t[3]||(t[3]=e=>(0,k.SU)(U.h).Stockfish.study=e),disabled:(0,k.SU)(U.h).Stockfish.lines<=1},{default:(0,k.w5)(()=>t[12]||(t[12]=[(0,k.Uk)("Study mode")])),_:1,__:[12]},8,["modelValue","disabled"])])])):(0,k.kq)("",!0),(0,k._)("div",oE,[(0,k.SU)(U.i7).stockfish.running?(0,k.SU)(U.i7).stockfish.running==(0,k.SU)(W.MI).starting?((0,k.wg)(),(0,k.iD)("button",oI,t[14]||(t[14]=[(0,k._)("i",{class:"fa-solid fa-play"},null,-1),(0,k.Uk)(" Initializing... ")]))):((0,k.wg)(),(0,k.iD)("button",{key:2,type:"button",class:"btn btn-secondary",onClick:t[5]||(t[5]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,k.SU)(eR).stop&&(0,k.SU)(eR).stop(...t)})},t[15]||(t[15]=[(0,k._)("i",{class:"fa-solid fa-stop"},null,-1),(0,k.Uk)(" Stop ")]))):((0,k.wg)(),(0,k.iD)("button",{key:0,type:"button",class:"btn btn-primary",onClick:t[4]||(t[4]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,k.SU)(eR).analyze&&(0,k.SU)(eR).analyze(...t)})},t[13]||(t[13]=[(0,k._)("i",{class:"fa-solid fa-play"},null,-1),(0,k.Uk)(" Analyze with Stockfish 16 ")])))]),(0,k._)("div",oR,[(0,k.SU)(U.SB).stockfish.depth?((0,k.wg)(),(0,k.iD)("div",oO,[(0,k._)("span",null,"Depth: "+(0,k.zw)((0,k.SU)(U.SB).stockfish.depth),1),(0,k.SU)(U.i7).stockfish.running==(0,k.SU)(W.MI).running?((0,k.wg)(),(0,k.iD)("span",oW,[(0,k.Uk)(" /"+(0,k.zw)((0,k.SU)(U.h).Stockfish.depth)+" ",1),t[16]||(t[16]=(0,k._)("i",{class:"fa-solid fa-spinner fa-spin ms-2"},null,-1))])):(0,k.kq)("",!0)])):(0,k.kq)("",!0),(0,k.SU)(U.SB).stockfish.mate?((0,k.wg)(),(0,k.iD)("div",oM,(0,k.zw)(((0,k.SU)(U.SB).stockfish.mate||"")[0])+" has mate in "+(0,k.zw)(((0,k.SU)(U.SB).stockfish.mate||"")[1])+". ",1)):(0,k.SU)(U.SB).stockfish.score?((0,k.wg)(),(0,k.iD)("div",oj," Score: "+(0,k.zw)((0,k.SU)(U.SB).stockfish.score),1)):(0,k.kq)("",!0),(0,k.SU)(U.SB).stockfish.header.length?((0,k.wg)(),(0,k.iD)("div",oV,[t[17]||(t[17]=(0,k.Uk)(" Solution is unique against best defense up to:")),t[18]||(t[18]=(0,k._)("br",null,null,-1)),(0,k.Uk)(" "+(0,k.zw)((0,k.SU)(eR).format((0,k.SU)(U.SB).stockfish.header)),1),t[19]||(t[19]=(0,k._)("br",null,null,-1)),t[20]||(t[20]=(0,k.Uk)(" And then: "))])):(0,k.kq)("",!0),(0,k._)("table",oT,[(0,k._)("tbody",null,[((0,k.wg)(!0),(0,k.iD)(k.HY,null,(0,k.Ko)((0,k.SU)(U.SB).stockfish.lines.filter(e=>e&&e.moves.length),e=>((0,k.wg)(),(0,k.iD)("tr",{key:e.pgn},[(0,k._)("td",oL,[(0,k._)("div",oz,(0,k.zw)(e.score),1),(0,k._)("div",oF,[(0,k._)("button",{type:"button",class:"btn btn-primary px-2 py-0 m-0",title:"Play this line",onClick:t=>(0,k.SU)(eR).play(e)},t[21]||(t[21]=[(0,k._)("i",{class:"fa-solid fa-play"},null,-1)]),8,oq)])]),(0,k._)("td",{class:"align-top w-100",textContent:(0,k.zw)((0,k.SU)(eR).format(e.moves))},null,8,oQ)]))),128))])])])]))],512)),[[k.F8,"sf"==(0,k.SU)(U.SB).compute]])}),oK={class:"mb-3"},oG=["innerHTML"],oH={key:1,class:"mt-3 table"},oZ={class:"align-top py-1"},o$=["onClick"],oX={key:0,class:"fa-solid fa-spinner fa-spin ms-2"},oJ=(0,k.aZ)({__name:"syzygy",setup:e=>(e,t)=>(0,k.wy)(((0,k.wg)(),(0,k.iD)("div",null,[(0,k._)("div",oK,[(0,k.SU)(U.i7).syzygy.running?((0,k.wg)(),(0,k.iD)("button",{key:1,class:"btn btn-secondary me-3",onClick:t[1]||(t[1]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,k.SU)(eq).stop&&(0,k.SU)(eq).stop(...t)})},t[3]||(t[3]=[(0,k._)("i",{class:"fa-solid fa-stop"},null,-1),(0,k.Uk)(" Stop ")]))):((0,k.wg)(),(0,k.iD)("button",{key:0,type:"button",class:"btn btn-primary",onClick:t[0]||(t[0]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,k.SU)(eq).run&&(0,k.SU)(eq).run(...t)})},t[2]||(t[2]=[(0,k._)("i",{class:"fa-solid fa-play"},null,-1),(0,k.Uk)(" Analyze with Syzygy tablebase ")])))]),(0,k.SU)(U.SB).syzygy.header?((0,k.wg)(),(0,k.iD)("div",{key:0,innerHTML:(0,k.SU)(U.SB).syzygy.header},null,8,oG)):(0,k.kq)("",!0),(0,k.SU)(U.SB).syzygy.lines?((0,k.wg)(),(0,k.iD)("table",oH,[((0,k.wg)(!0),(0,k.iD)(k.HY,null,(0,k.Ko)((0,k.SU)(U.SB).syzygy.lines,e=>((0,k.wg)(),(0,k.iD)("tr",{key:e.pgn},[(0,k._)("td",oZ,[e.leaf?((0,k.wg)(),(0,k.iD)("button",{key:0,type:"button",class:"btn btn-primary px-2 py-0 m-0",title:"Play this line",onClick:t=>(0,k.SU)(eq).play(e)},t[4]||(t[4]=[(0,k._)("i",{class:"fa-solid fa-play"},null,-1)]),8,o$)):(0,k.kq)("",!0)]),(0,k._)("td",{class:"align-top w-100 py-1",style:(0,k.j5)("padding-left:".concat(e.indent+.5,"rem"))},[(0,k.Uk)((0,k.zw)((0,k.SU)(eq).format(e))+" ",1),e.searching?((0,k.wg)(),(0,k.iD)("i",oX)):(0,k.kq)("",!0)],4)]))),128))])):(0,k.kq)("",!0)],512)),[[k.F8,"sy"==(0,k.SU)(U.SB).compute]])}),o0={class:"mb-3"},o1=(0,k.aZ)({__name:"compute",setup:e=>(e,t)=>(0,k.wy)(((0,k.wg)(),(0,k.iD)("section",{class:(0,k.C_)({show:7==(0,k.SU)(U.SB).tab})},[(0,k._)("div",o0,[(0,k.Wm)(nv,{modelValue:(0,k.SU)(U.SB).compute,"onUpdate:modelValue":t[0]||(t[0]=e=>(0,k.SU)(U.SB).compute=e),label:"Tool:",text:["Popeye","Stockfish","Syzygy"],value:["py","sf","sy"]},null,8,["modelValue"])]),(0,k.Wm)(ov),(0,k.Wm)(oY),(0,k.Wm)(oJ)],2)),[[k.F8,7==(0,k.SU)(U.SB).tab]])}),o2={class:"mb-2 btn-gap"},o3={class:"mb-2 btn-gap"},o8={class:"btn-gap"},o5=(0,k.aZ)({__name:"api",setup(e){let t=!location.protocol.startsWith("http");return(e,n)=>((0,k.wg)(),(0,k.iD)("section",{class:(0,k.C_)({show:5==(0,k.SU)(U.SB).tab})},[(0,k._)("div",o2,[(0,k.Wm)(ta,{factory:(0,k.SU)(tt).copyBase64,class:"btn-secondary",disabled:t},{default:(0,k.w5)(()=>n[0]||(n[0]=[(0,k.Uk)(" Copy base64 link ")])),_:1,__:[0]},8,["factory"]),(0,k.Wm)(ta,{factory:(0,k.SU)(tt).copyBase64Img,class:"btn-secondary",disabled:t},{default:(0,k.w5)(()=>n[1]||(n[1]=[(0,k.Uk)(" Copy base64 <img> code ")])),_:1,__:[1]},8,["factory"])]),n[6]||(n[6]=(0,k._)("h6",null,"Embed mode",-1)),(0,k._)("div",o3,[(0,k.Wm)(ta,{factory:(0,k.SU)(tt).copyEmbed,class:"btn-secondary"},{default:(0,k.w5)(()=>n[2]||(n[2]=[(0,k.Uk)(" Copy embed HTML code ")])),_:1,__:[2]},8,["factory"]),(0,k.Wm)(ta,{factory:(0,k.SU)(tt).copyEmbedUrl,class:"btn-secondary"},{default:(0,k.w5)(()=>n[3]||(n[3]=[(0,k.Uk)(" Copy just the URL ")])),_:1,__:[3]},8,["factory"])]),n[7]||(n[7]=(0,k._)("h6",null,"SDK mode",-1)),(0,k._)("div",o8,[(0,k.Wm)(ta,{factory:(0,k.SU)(tt).copySDK,class:"btn-secondary"},{default:(0,k.w5)(()=>n[4]||(n[4]=[(0,k.Uk)(" Copy SDK script tag ")])),_:1,__:[4]},8,["factory"]),(0,k.Wm)(ta,{factory:(0,k.SU)(tt).copyImg,class:"btn-secondary"},{default:(0,k.w5)(()=>n[5]||(n[5]=[(0,k.Uk)(" Copy SDK <img> code ")])),_:1,__:[5]},8,["factory"])])],2))}}),o4={class:"d-flex mb-4"},o7=(0,k.aZ)({__name:"sections",setup:e=>(e,t)=>((0,k.wg)(),(0,k.iD)("div",o4,[(0,k.Wm)(tO),(0,k.Wm)(aJ),(0,k.Wm)(nh),(0,k.Wm)(o5),(0,k.Wm)(aj),(0,k.Wm)(ap),(0,k.Wm)(o1),(0,k.Wm)(a8)]))}),o6={class:"w-passive-100"},o9={class:"row gx-3 mb-1"},le={class:"col mb-2",style:{"flex-basis":"15rem","flex-grow":"1000"}},lt={class:"col ps-0 mb-2 text-end",style:{"white-space":"nowrap","flex-basis":"max-content"}},ln=["textContent"],la={key:0,class:"btn-group"},lo=["disabled"],ll=(0,k.aZ)({__name:"header",setup(e){function t(){gtag("event","fen_copy"),navigator.clipboard.writeText(x.RI.value)}async function n(){gtag("event","fen_paste"),(0,x.dd)(await I(),!0)}return(e,a)=>((0,k.wg)(),(0,k.iD)("header",o6,[(0,k._)("div",o9,[(0,k._)("div",le,[(0,k.wy)((0,k._)("input",{type:"text",class:"form-control",placeholder:"Enter FEN here","onUpdate:modelValue":a[0]||(a[0]=e=>(0,k.dq)(x.RI)?x.RI.value=e:null),onChange:a[1]||(a[1]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,k.SU)(x.X4).update&&(0,k.SU)(x.X4).update(...t)})},null,544),[[k.nr,(0,k.SU)(x.RI)]])]),(0,k._)("div",lt,[(0,k._)("label",{class:"col-form-label pe-2",textContent:(0,k.zw)((0,k.SU)(U.i7).pieceCount)},null,8,ln),(0,k.SU)(U.i7).envReady&&(0,k.SU)(N.OB).canCopy?((0,k.wg)(),(0,k.iD)("div",la,[(0,k._)("button",{class:"btn btn-secondary",title:"Copy",onClick:t},a[2]||(a[2]=[(0,k._)("i",{class:"fa-solid fa-clipboard"},null,-1)])),(0,k.SU)(N.OB).canPaste?((0,k.wg)(),(0,k.iD)("button",{key:0,class:"btn btn-secondary",disabled:(0,k.SU)(U.I3)(),title:"Paste",onClick:n},a[3]||(a[3]=[(0,k._)("i",{class:"fa-solid fa-paste"},null,-1)]),8,lo)):(0,k.kq)("",!0)])):(0,k.kq)("",!0)])])]))}}),li={class:"text-center"},lr={class:"d-inline-block",style:{overflow:"hidden"}},ls={class:"d-inline-block position-relative"},lc={id:"Squares"},lu={class:"play-mask"},ld={id:"DragZone",class:"flex-grow-0 pb-4"},lp=(0,k.aZ)({__name:"zone",setup:e=>(e,t)=>((0,k.wg)(),(0,k.iD)("div",li,[(0,k._)("div",lr,[(0,k._)("div",{id:"Zone",class:(0,k.C_)(["d-inline-flex justify-content-center text-center collapse flex-wrap-reverse",{collapse:(0,k.SU)(U.i7).collapse}])},[(0,k._)("div",{id:"EditZone",class:"flex-grow-0 pb-4",style:(0,k.j5)({textAlign:U.i7.collapse?U.i7.hor?"center":"start":"unset"})},[(0,k._)("div",ls,[t[0]||(t[0]=(0,k._)("canvas",{id:"SN"},null,-1)),(0,k._)("div",lc,[(0,k.wy)((0,k._)("div",lu,null,512),[[k.F8,(0,k.SU)(U.I3)()]])])])],4),(0,k._)("div",ld,[(0,k._)("div",{class:(0,k.C_)(["position-relative d-inline-block",{"mb-3":(0,k.SU)(U.i7).hor}]),style:{"line-height":"0"},role:"application"},[t[2]||(t[2]=(0,k._)("canvas",{id:"CN"},null,-1)),(0,k._)("div",{class:(0,k.C_)(["loader",{show:(0,k.SU)(U.i7).loading}])},t[1]||(t[1]=[(0,k._)("div",{class:"h-100 d-flex align-items-center justify-content-center"},[(0,k._)("i",{class:"display-1 fa-solid fa-spinner fa-spin"})],-1)]),2),t[3]||(t[3]=(0,k._)("img",{id:"PV"},null,-1))],2),(0,k.wy)((0,k._)("canvas",{id:"TP",class:(0,k.C_)({"ms-4":!(0,k.SU)(U.i7).hor}),role:"menu"},null,2),[[k.F8,!(0,k.SU)(U.u8)()]])])],2)])]))}),lf={class:"mb-4"},lm=(0,n(5037).default)({},[["render",function(e,t){return(0,k.wg)(),(0,k.iD)("footer",lf,t[0]||(t[0]=[(0,k.uE)('<div class="row small"><div class="col flex-grow-1" style="flex-basis:max-content;"> For more information and API, see <a href="https://github.com/MuTsunTsai/fen-tool" target="_blank">README</a>. </div><div class="col-auto text-end">Copyright \xa9 2023-2025 Mu-Tsun Tsai</div></div><div class="text-center mt-3"><a href="https://www.buymeacoffee.com/mutsuntsai" target="_blank"><img width="235" height="50" src="https://img.buymeacoffee.com/button-api/?text=Buy me a coffee&amp;emoji=☕&amp;slug=mutsuntsai&amp;button_colour=6f431f&amp;font_colour=ffffff&amp;font_family=Lato&amp;outline_colour=ffffff&amp;coffee_colour=FFDD00&amp;v=1"></a></div>',2)]))}]]),lh={style:{display:"contents"}},lg={class:"d-flex justify-content-center p-3"},ly={class:"flex-grow-0 text-start",style:{"max-width":"100%"}},lb={class:"w-passive-100"},lv={key:0,src:"."},lS=(0,k.aZ)({__name:"app",setup:e=>(e,t)=>((0,k.wg)(),(0,k.iD)("div",lh,[(0,k._)("main",lg,[(0,k._)("div",ly,[(0,k.Wm)(ll),(0,k.Wm)(lp),(0,k._)("div",lb,[(0,k.Wm)(e7),(0,k.Wm)(o7)]),t[0]||(t[0]=(0,k._)("hr",null,null,-1)),(0,k.Wm)(lm)])]),(0,k.Wm)(eJ),(0,k.Wm)(e0),(0,k.SU)(U.SB).split?((0,k.wg)(),(0,k.iD)("iframe",lv)):(0,k.kq)("",!0)]))});(0,eh.S)({getDefault:()=>U.h.board,getTitle:e=>e}),document.addEventListener("mousedown",e=>{var t;let n=null==(t=document.activeElement)?void 0:t.nodeName.toLowerCase();"input"!=n&&"textarea"!=n&&e.detail>1&&e.preventDefault()},!1),addEventListener("keydown",e=>{var t;if(!U.SB.play.playing&&!U.SB.popeye.playing)return;let n=null==(t=document.activeElement)?void 0:t.nodeName.toLowerCase();if("input"==n||"textarea"==n)return;let a=e.key;("a"==a||"ArrowLeft"==a)&&(e.preventDefault(),U.SB.play.playing?V(-1):J.wD.moveBy(-1)),("d"==a||"ArrowRight"==a)&&(e.preventDefault(),U.SB.play.playing?V(1):J.wD.moveBy(1))}),(0,k.vr)(lS).mount("#app"),U.i7.envReady=!0,(0,U.wH)(),(0,B.q_)(),C.fr.onmousedown=ep,C.fr.ontouchstart=ep,C.fr.ondragstart=e=>e.preventDefault(),C.fr.onwheel=function(e){if((0,U.I3)())return;let{w:t,h:n}=U.h.board,{offset:a,s:o}=(0,U.nj)(),l=Math.floor((e.offsetX-a.x)/o),i=Math.floor((e.offsetY-a.y)/o);if(em(l,i,t,n)){let n=x.xG[i*t+l];if(""==n.value)return;e.preventDefault();let a=performance.now();if(a-er<50)return;er=a,ed(n,e.deltaY>0?W.mi.r90:W.mi.r270)}},C.in.onmousedown=ep,C.in.ontouchstart=ep,document.body.onmousedown=e=>{(0,U.I3)()||e.target==C.in||e.target==C.fr||ec()},document.body.onmousemove=es,document.body.ontouchmove=es,document.body.onmouseleave=eu,document.body.onmouseup=eu,document.body.ontouchend=eu,(0,k.m0)(()=>{document.body.classList.toggle("split",U.SB.split),Promise.resolve().then(()=>(0,B.l)({}))}),(0,k.m0)(x.tZ),(0,N.xN)()&&(0,P.Z)('It seems that you have turned on "privacy.resistFingerprinting" in your browser. FEN Tool would not work properly with this setting.\nPlease add "mutsuntsai.github.io" to "privacy.resistFingerprinting.exemptedDomains" and reload the tool to fix this.')},4189:function(e,t,n){function a(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!(t instanceof Object))return e;for(let l of Object.keys(t)){if(n&&e instanceof Object&&!(l in e))continue;let i=t[l];i instanceof Object?e[l]instanceof Object&&e[l]!=i?e[l]=a(e[l],i,n):e[l]=o(i):e[l]=i}return e}function o(e){return a(Array.isArray(e)?[]:{},e)}n.d(t,{d:()=>l,n:()=>a});let l="function"==typeof structuredClone?structuredClone:o},4791:function(e,t,n){n.d(t,{Dm:()=>o,WT:()=>a,_N:()=>l,cb:()=>i,oh:()=>r});let a=1e3,o=8,l=3,i=64,r=97},3879:function(e,t,n){function a(){let e,t=async function(t){return await n,e(t)},n=new Promise(n=>{t.setup=function(t){e=t,n()}});return t}n.d(t,{Z:()=>o,i:()=>l});let o=a(),l=a()},6871:function(e,t,n){n.d(t,{Ab:()=>s,S8:()=>r,fr:()=>c,in:()=>i,m8:()=>o,ut:()=>l});let a=document.createElement("canvas"),o=document.getElementById("CN")||a,l=document.getElementById("SN")||a,i=document.getElementById("TP")||a,r=document.getElementById("CanvasGhost")||a,s=document.getElementById("TemplateGhost")||a,c=document.getElementById("PV")},7683:function(e,t,n){n.d(t,{Il:()=>g,KO:()=>p,MI:()=>f,Nm:()=>m,V1:()=>b,jl:()=>y,mQ:()=>w,mi:()=>h,wg:()=>S});var a,o,l,i,r,s,c,u,d,p=((a={})[a.notDownloaded=0]="notDownloaded",a[a.downloading=1]="downloading",a[a.needReload=2]="needReload",a[a.ready=3]="ready",a),f=((o={})[o.stop=0]="stop",o[o.starting=1]="starting",o[o.running=2]="running",o),m=((l={})[l.counterclockwise=-1]="counterclockwise",l[l.clockwise=1]="clockwise",l[l.turn=2]="turn",l),h=((i={})[i.r90=1]="r90",i[i.r180=2]="r180",i[i.r270=3]="r270",i[i.full=4]="full",i),g=((r={}).black="b",r.white="w",r.neutral="n",r),y=((s={}).normal="normal",s.pass="pass",s.retro="retro",s),b=((c={})[c.bK=0]="bK",c[c.wK=1]="wK",c[c.nK=2]="nK",c[c.bQ=3]="bQ",c[c.wQ=4]="wQ",c[c.nQ=5]="nQ",c[c.bB=6]="bB",c[c.wB=7]="wB",c[c.nB=8]="nB",c[c.bN=9]="bN",c[c.wN=10]="wN",c[c.nN=11]="nN",c[c.bR=12]="bR",c[c.wR=13]="wR",c[c.nR=14]="nR",c[c.bP=15]="bP",c[c.wP=16]="wP",c[c.nP=17]="nP",c[c.bC=18]="bC",c[c.wC=19]="wC",c[c.nC=20]="nC",c[c.bX=21]="bX",c[c.wX=22]="wX",c[c.nX=23]="nX",c),S=((u={})[u.k=0]="k",u[u.q=1]="q",u[u.b=2]="b",u[u.n=3]="n",u[u.r=4]="r",u[u.p=5]="p",u[u.c=6]="c",u[u.x=7]="x",u),w=((d={})[d.edit=0]="edit",d[d.options=1]="options",d[d.database=2]="database",d[d.bbs=4]="bbs",d[d.api=5]="api",d[d.play=6]="play",d[d.compute=7]="compute",d[d.project=8]="project",d)},2526:function(e,t,n){n.d(t,{OB:()=>s,uN:()=>l,xN:()=>r});let a=navigator.clipboard,o="canShare"in navigator,l=Math.min(2,Math.floor(devicePixelRatio)),i=matchMedia("(hover: none), (pointer: coarse)").matches;function r(){let e=document.createElement("canvas").getContext("2d");e.fillStyle="rgb(255, 0, 0)",e.fillRect(0,0,1,1);let t=e.getImageData(0,0,2,2).data,n=[255,0,0,255];for(let e=0;e<n.length;e++)if(t[e]!=n[e])return!0;return!1}let s={isTop:top==self,thread:"undefined"!=typeof SharedArrayBuffer,canShare:o,canSharePng:function(){if(!o)return!1;let e=atob("iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII"),t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);let n=new File([new Blob([t])],"1.png",{type:"image/png"});return navigator.canShare({files:[n]})}(),canCopy:a&&"writeText"in a,canPaste:a&&"readText"in a,canCopyImg:a&&"write"in a,isTouch:i,isTaiwan:navigator.languages.includes("zh-TW")}},5420:function(e,t,n){n.d(t,{A1:()=>h,C3:()=>m,Di:()=>x,Fv:()=>S,J7:()=>l,MA:()=>k,N0:()=>b,Nv:()=>d,Q5:()=>B,S3:()=>y,TP:()=>o,U1:()=>A,U_:()=>N,_n:()=>U,hD:()=>D,hv:()=>_,sV:()=>w,uY:()=>C});var a=n(4791);let o="8/8/8/8/8/8/8/8",l="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",i="\\p{Extended_Pictographic}",r="\\p{Emoji_Modifier}",s="".concat("\\p{Regional_Indicator}","{2}|").concat(i,"\\uFE0F?").concat(r,"?(\\u200D").concat(i,"\\uFE0F?").concat(r,"?)*"),c="\\((!?)([kqbnrp])(\\d?)\\)",u="[-~]?(\\*\\d)?(".concat("[kqbnrpcxstadg]","|").concat("'(".concat(s,"|[^'])|''.."),")"),d=RegExp("^(?:".concat(s,")$"),"u"),p=RegExp("^(?:".concat(c,"|").concat(u,")$"),"iu"),f=RegExp("\\/|\\d+|".concat(c,"|").concat(u,"|."),"iug");function m(e){let t=e.match(f)||[];if(!t.some(e=>e.match(/^\d\d+$/)))return e;let n=[0],a=0;for(let e=0;e<t.length;e++){let o=t[e];if("/"==o)n[++a]=0;else if(o.match(/^\d+$/))if(1==o.length)n[a]+=Number(o);else{let l=o.split("").map(e=>Number(e)).reduce((e,t)=>e+t,0);n[a]+=l,t[e]=l.toString()}else n[a]++}return g(n)?t.join(""):e}function h(e){let t=e.match(f)||[],n=[0],a=0;for(let e of t)"/"==e?n[++a]=0:e.match(/^\d+$/)?n[a]+=Number(e):n[a]++;let o=n.length;if(1!=o&&g(n))return{w:n[0],h:o}}function g(e){let t=e[0];for(let n=1;n<e.length;n++)if(e[n]!=t)return!1;return!0}function y(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.Dm,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.Dm,o=e.match(f)||[],l=[],i=!1;for(let e of o){if("/"==e){if(!i){let e=l.length+t-l.length%t;for(;l.length<e;)l.push("")}}else if(e.match(/^\d+$/)){let t=Number(e);for(let e=0;e<t;e++)l.push("")}else l.push(e);if(i="/"!=e&&l.length%t==0,l.length==t*n)break}for(;l.length<t*n;)l.push("");return l}function b(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.Dm,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.Dm,o=0,l="";function i(){o&&(l+=o),o=0}for(let a=0;a<n;a++){for(let n=0;n<t;n++){let r=a*t+n;""==e[r]?o++:(i(),l+=e[r])}i(),a<n-1&&(l+="/")}return l}function S(e,t,n){if(!e.match(p))if(e.match(d))e="'"+e;else{let t=[...e].length;e=1==t&&"'"!=e?"'"+e:2==t?"''"+e:""}return(e=(e=e.replace(RegExp("^".concat(c,"$"),"i"),(e,t,n,a)=>{let o=n;return a&&(o="*"+a+o),t&&(o="-"+o),o})).replace(/^~/,"-").replace(/^-(?=.*')/,"")).startsWith("-")&&(e=e.toLowerCase()),e=_(e,t,n)}function w(e){let t=(e=_(e,!1,!0)).match(/^(-?)(?:\*(\d))?([kqbnrp])$/i);if(!t)return"";let n=_(t[3],!0);return t[1]||t[2]?"("+(t[1]?"!":"")+n+(t[2]||"")+")":n}function _(e,t,n){return e.match(/^-?(\*\d)?[sng]$/i)&&(t?(n&&(e=e.replace("s","g").replace("S","G")),e=e.replace("n","s").replace("N","S")):(n&&(e=e.replace("s","n").replace("S","N")),e=e.replace("g","s").replace("G","S"))),e}function k(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.Dm;return void 0===t&&(t=e%a.Dm,e=(e-t)/a.Dm),String.fromCharCode(a.oh+t)+(n-e)}function U(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.Dm;return{x:e.charCodeAt(0)-a.oh,y:t-Number(e[1])}}function x(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.Dm,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.Dm,{x:o,y:l}=U(e,n);return l*t+o}function B(e){return Array.from({length:e},e=>"")}function C(e,t,n){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:a.Dm,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:a.Dm,i=B(o*l);i.anime="";for(let a=0;a<l;a++)for(let r=0;r<o;r++){let s=r+t,c=a+n,u=0<=s&&s<o&&0<=c&&c<l;e[a*o+r]&&(i[c*o+s]=u?e[a*o+r]:"",i.anime+=k(a,r,l)+k(c,s,l))}return i}function D(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.Dm,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:a.Dm,l=B(n*o);l.anime="";for(let a=0;a<o;a++)for(let i=0;i<n;i++){let r=i,s=a;if("-"==t&&(r=n-1-r),("|"==t||"/"==t)&&(s=o-1-s),"/"==t||"\\"==t){let e=s-r;r+=e,s-=e}"/"==t&&(s=o-1-s),e[s*n+r]&&(l[a*n+i]=e[s*n+r],l.anime+=k(s,r,o)+k(a,i,o))}return l}function A(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.Dm,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:a.Dm,l=B(n*o);n==o&&(l.anime="");for(let a=0;a<n;a++)for(let d=0;d<o;d++){var i,r,s,c,u;let{x:p,y:f}=(i=a,r=d,s=n,c=o,1==(u=t)?{x:i,y:c-1-r}:2==u?{x:c-1-r,y:s-1-i}:{x:s-1-i,y:r});e[f*n+p]&&(l[a*o+d]=e[f*n+p],n==o&&(l.anime+=k(f,p,o)+k(a,d,o)))}return l}function N(e,t){return e.map(e=>{if(""==e||e.startsWith("-")||!t&&e.startsWith("'"))return e;let n=e.toLowerCase();return e=e==n?e.toUpperCase():n})}},9898:function(e,t,n){n.d(t,{By:()=>u,Cd:()=>p,Cg:()=>o,D_:()=>d,n6:()=>i,t_:()=>f,z6:()=>l});var a=n(4791);let o=44,l="1echecs",i={pattern:void 0,bg:void 0,exHigh:!0,border:"1",blackWhite:!1,knightOffset:.6,SN:!1,size:44,w:a.Dm,h:a.Dm,fullFEN:!1,coordinates:!1,set:l,collapse:!0},r=/^\d+(,\d+)*$/,s=[26,32,38,44],c=["1echecs","alpha","goodCompanion","kilfiger","merida","mpchess","skak"];function u(e){if("string"==typeof e&&(e=e.replace(/\D/g,",").replace(/,+/g,",").replace(/^,/,"").replace(/,$/,"")).match(r))return e}function d(e){let t=Object.assign({},i);if(e){let n=Number(e.size);s.includes(n)&&(t.size=n),e.set&&c.includes(e.set)&&(t.set=e.set),e.border=u(e.border),e.border&&(t.border=e.border),e.knightOffset&&0<e.knightOffset&&e.knightOffset<1&&(t.knightOffset=e.knightOffset),t.blackWhite=!!e.blackWhite,t.pattern=e.pattern,t.bg=e.bg,t.SN=e.SN||!1;let a=Math.floor(Number(e.w)),o=Math.floor(Number(e.h));a>0&&(t.w=a),o>0&&(t.h=o)}return t}let p=20;function f(e,t){let n=function(e){let t=e.split(",").map(e=>{let t=Number(e);return isNaN(t)?0:Math.abs(Math.floor(t))}),n=t.reduce((e,t)=>e+t,0);return{array:t,size:n}}(e.border),a=e.coordinates?{x:p,y:p}:{x:0,y:0};!0===t&&(a.y=0),!1===t&&(a.x=0);let o=e.w*e.size+2*n.size+a.x,l=e.h*e.size+2*n.size+a.y,i={x:n.size+a.x,y:n.size};return{w:o,h:l,border:n,offset:i,margin:a}}},6230:function(e,t,n){n.d(t,{$I:()=>B,BC:()=>U,Dd:()=>A,Gh:()=>g,LW:()=>h,Os:()=>D,P:()=>d,PH:()=>y,PX:()=>f,SQ:()=>u,Wh:()=>C,h8:()=>w,i9:()=>_,nU:()=>k,or:()=>b});var a=n(8531),o=n(5420),l=n(6595);function i(){let e=(0,a._)(["[[^]]+]"],["\\[[^\\]]+\\]"]);return i=function(){return e},e}function r(){let e=(0,a._)(["(+)?[a-z]) (S[ S]+S)"],["(\\+)?[a-z]\\) (\\S[ \\S]+\\S)"]);return r=function(){return e},e}function s(){let e=(0,a._)(["(?<mod>hcc)?(?:(?<move>0-0(?:-0)?|",")(?:",")*(?:",")?(?:=(?<cc>[nwb]))?)(?:",")*"]);return s=function(){return e},e}function c(){let e=(0,a._)(["(?<count>d+.(?:..)?)?(?<main>","(?:/",")*)(?: [+#=])?"],["(?<count>\\d+\\.(?:\\.\\.)?)?(?<main>","(?:\\/",")*)(?: [+#=])?"]);return c=function(){return e},e}let u="[a-h][1-8]",d="(?:[0-9A-Z][0-9A-Z]|[A-Z])",p=String.raw(i()),f=String.raw(r()),m="(?:[nwb])?r?".concat(d,"?(?<from>").concat(u,")[-*](?<to>").concat(u,")(?<ep> ep\\.)?(?<then>([-*]").concat(u,"(=[nwb]?").concat(d,")?)*)"),h="=(?<pc>[nwb])?(?<p>".concat(d,")"),g=["condition","2option","3stipulation","2sstipulation","3forsyth","2pieces","2twin"].map(l.d).join("|"),y=RegExp(g,"ig"),b=String.raw(s(),m,p,h,p),S=b.replace(/\?<[^>]+>/g,""),w=String.raw(c(),S,S);function _(e,t,n,a){return"w"==a&&(n=n.toUpperCase()),"b"==a&&(n=n.toLowerCase()),"n"==a&&(n="-"+n.toLowerCase()),e[(0,o.Di)(t)]=n,n}function k(e,t,n,a){a&&a.push(t+n);let l=(0,o.Di)(t),i=(0,o.Di)(n);return e[i]=e[l],e[l]="",e[i]}let U={"*2Q":"G","*2N":"N","*1N":"Z","*3N":"CA","*3B":"GI","*3Q":"LI","*1Q":"EQ","*2P":"BP","*1B":"AN","*1K":"PO","*2K":"ST","*3K":"DU","*2R":"WE","*3R":"PA",C:"I"},x={"*1B":"25,37,AL,AN,BM,C,CT,DB,GN,GY,NH","*1K":"PO","*1N":"36,AO,BK,BN,DR,GR,KP,LS,MA,MS,OH,RK,S1,S2,S3,S4,SQ,SS,SW,UU,Z,ZE,ZH,ZR","*1P":"BS,CP,MP","*1Q":"EQ,HA,KH,L,LE,NE","*1R":"DA,DK,EK,GT,MH,RM,RO,RR,SH,WA","*2B":"15,AR,BH,BT,BU,BW,ND,PR","*2K":"ST","*2N":"N","*2P":"BP","*2Q":"G","*2R":"DG,EM,RA,RF,RH,RW,WE","*3B":"BE,BL,FE,GI,LO,OK,RB,VA","*3K":"DU","*3N":"24,35,AH,CA,DS,GH,MO,OA,SA","*3P":"O,SP","*3Q":"16,AM,EH,KA,LI,M,OR,SE,SI","*3R":"BR,CH,CR,EA,FA,PA,RE,RL,TR",A:"AG,B1,B2,B3,BI,BO,CG,CY,DO,ET,F,FR,G2,G3,GE,GF,GL,KL,KO,LB,LH,LN,LR,MG,ML,MM,NA,NL,NO,PP,QE,QF,QN,QQ,RN,RP,RT,SK,SO,TH,WR",C:"I",N:"S"},B={custom:()=>({}),default:{}};for(let e in x)for(let t of x[e].split(","))B.default[t]=e;function C(e){if(!e)return e;let t=e.toUpperCase(),n=function(e){let t=B.custom();for(let n in t)if(t[n]==e)return n}(t)||B.default[t];return n?e==t?n:n.toLowerCase():e}function D(e){var t;let n=e.startsWith("-")?"=":"";n&&(e=e.substring(1));let a=e.toUpperCase();if(t=a,/^[KQBNRP]$/.test(t))e=e.replace("n","s").replace("N","S");else{let t=a==e,o=B.custom();if(!(a in o))return null;let l=o[a];2==(e=t?l:l.toLowerCase()).length&&(e="."+e),l.match(/^\d+$/)&&!n&&(n=t?"+":"-")}return n+e}function A(e,t,n){let a=(0,o.Di)(t),l=(0,o.Di)(n),i=e[l];e[l]=e[a],e[a]=i}},9130:function(e,t,n){n.d(t,{F:()=>g,w:()=>h});var a=n(8531),o=n(4791),l=n(7683),i=n(5420),r=n(6595),s=n(6230);function c(){let e=(0,a._)(["s+(?<c>",")(?:s+(?:","))?(?<l>(?:s+",")+)"],["\\s+(?<c>",")(?:\\s+(?:","))?(?<l>(?:\\s+",")+)"]);return c=function(){return e},e}function u(){let e=(0,a._)(["","(?:",")+(?=s+(?:",")|$)"],["","(?:",")+(?=\\s+(?:",")|$)"]);return u=function(){return e},e}let d=["1Black","1Neutral","1White"].map(r.d).join("|"),p=["1Chameleon","2FrischAuf","2Functionary","2HalfNeutral","2HurdleColourChanging","1Jigger","1Kamikaze","1Magic","2Paralysing","2Protean","1Royal","1Uncapturable","1Volage"].map(r.d).join("|"),f="(?<p>".concat(s.P,")(?<sq>(?:").concat(s.SQ,")+)"),m=String.raw(c(),d,p,f),h=String.raw(u(),(0,r.d)("2pieces"),m,s.Gh);function g(e){let t=(e=e.split("a=>b")[0]).match(RegExp(h,"ig"));if(!t)return null;let n=(0,i.Q5)(o.cb);for(let e of t)for(let t of e.match(RegExp(m,"ig"))){let e=t.match(RegExp(m,"i")).groups,a=e.c[0].toLowerCase();for(let t of e.l.match(RegExp(f,"ig"))){let e=t.match(RegExp(f,"i")).groups,o=e.p.toUpperCase();for(let t of e.sq.match(RegExp(s.SQ,"g")))n[(0,i.Di)(t)]=function(e,t){if(2==t.length&&(t="."+t),e==l.Il.neutral)return"="+t;let n=e==l.Il.white;return t.match(/[A-Z]/)?n?t:t.toLowerCase():(n?"+":"-")+t}(a,o)}}return(0,i.N0)(n)}},6042:function(e,t,n){n.d(t,{Vl:()=>$,l5:()=>z});var a=n(8531),o=n(4189),l=n(5420),i=n(6595),r=n(6230),s=n(7683);function c(){let e=(0,a._)(["^+(?<c>[nwb])(?<is>",")(?<at>",")(=(?<p>","))?$"],["^\\+(?<c>[nwb])(?<is>",")(?<at>",")(=(?<p>","))?$"]);return c=function(){return e},e}function u(){let e=(0,a._)(["^-([nwb]",")?(?<at>",")$"]);return u=function(){return e},e}let d=new RegExp(String.raw(c(),r.P,r.SQ,r.P)),p=new RegExp(String.raw(u(),r.P,r.SQ)),f=new RegExp("^(?<c>[nwb])".concat(r.P,"(?<from>").concat(r.SQ,")-&gt;(?<to>").concat(r.SQ,")(=(?<p>").concat(r.P,"))?$")),m=new RegExp("^".concat(r.P,"(?<from>").concat(r.SQ,")&lt;-&gt;").concat(r.P,"(?<to>").concat(r.SQ,")$")),h=new RegExp("^(?<at>".concat(r.SQ,")=(?<c>[nwb])?(?:r?(?<p>").concat(r.P,"))?$")),g=new RegExp("^I".concat(r.SQ,"(,").concat(r.SQ,")*$")),y=new RegExp(r.or),b=new RegExp(r.h8);function S(e){return e.pg?l.J7:e.fen}let w=new RegExp("^[nwb](?:hcc)?".concat(r.P,"(").concat(r.SQ,")--&gt;(").concat(r.SQ,")$")),_=new RegExp("^[nwb](?:hcc)?".concat(r.P,"(").concat(r.SQ,")&lt;--&gt;[nwb](?:hcc)?").concat(r.P,"(").concat(r.SQ,")$")),k=new RegExp("^([+-]?)([nwb])(?:hcc)?(".concat(r.P,")(").concat(r.SQ,")$")),U=new RegExp("^(".concat(r.P,")==&gt;(").concat(r.P,")$")),x=new RegExp("^mirror(".concat(r.SQ,")&lt;--&gt;(").concat(r.SQ,")$")),B=new RegExp("^shift(".concat(r.SQ,")==&gt;(").concat(r.SQ,")$")),C=/^rotate(90|180|270)$/;function D(e,t){let n=e.match(w);return!!n&&((0,r.nU)(t,n[1],n[2]),!0)}function A(e,t){let n=e.match(_);return!!n&&((0,r.Dd)(t,n[1],n[2]),!0)}function N(e,t){let n=e.match(k);return!!n&&("+"==n[1]||""==n[1]?(0,r.i9)(t,n[4],(0,r.Wh)(n[3]),n[2]):(0,r.i9)(t,n[4],""),!0)}function P(e,t){let n,a=e.match(x);if(!a)return!1;let o=(0,l._n)(a[1]),i=(0,l._n)(a[2]);return n=o.x==i.x?"|":o.y==i.y?"-":(o.x-i.x)*(o.y-i.y)>0?"\\":"/",W(t,(0,l.hD)(t,n)),!0}function E(e,t){let n=e.match(B);if(!n)return!1;let a=(0,l._n)(n[1]),o=(0,l._n)(n[2]);return W(t,(0,l.uY)(t,o.x-a.x,o.y-a.y)),!0}function I(e,t){let n=e.match(U);if(!n)return!1;let a=(0,r.Wh)(n[1]),o=a.toLowerCase(),l=(0,r.Wh)(n[2]),i=l.toLowerCase();for(let e=0;e<t.length;e++)t[e]==a&&(t[e]=l),t[e]==o&&(t[e]=i),t[e]=="-"+o&&(t[e]="-"+i);return!0}function R(e,t){var n;let a=e.match(C);return!!a&&(W(t,(0,l.U1)(t,"90"==(n=a[1])?s.Nm.counterclockwise:"180"==n?s.Nm.turn:s.Nm.clockwise)),!0)}function O(e,t){return"PolishType"==e&&(W(t,(0,l.U_)(t)),!0)}function W(e,t){e.length=0,e.push(...t)}function M(){let e=(0,a._)(["\n\n+|(?:",")|(?:",")"],["\\n\\n+|(?:",")|(?:",")"]);return M=function(){return e},e}function j(){let e=(0,a._)(["","s+(S*(?:d|[^ds]s+d+(?:.[05])?))"],["","\\s+(\\S*(?:\\d|[^\\d\\s]\\s+\\d+(?:\\.[05])?))"]);return j=function(){return e},e}function V(){let e=(0,a._)(["\bimitw*s+(?:",")+"],["\\bimit\\w*\\s+(?:",")+"]);return V=function(){return e},e}let T=new RegExp(r.PX),L=RegExp(String.raw(M(),r.PX,r.h8),"g");function z(e,t,n){var a=e,c=t,u=n,w=H;if(!c)return u;console.log(u);let _=function(e,t,n){var a;let o=function(e){var t;let n=e.replace(/\n/g," ").replace(r.PH,"\n$&").split("\n"),a=n.filter(e=>e.match((0,i.M)("2option","^"))).join(" ");return{imitators:(null==(t=n.filter(e=>e.match((0,i.d)("condition"))).join(" ").match(Q))?void 0:t.join(" ").match(RegExp(r.SQ,"g")))||[],duplex:Y.test(a),halfDuplex:K.test(a)}}(e),s=e.split((0,i.M)("2twin","\\b","\\b")).map(e=>{var t;return null==(t=e.match(F))?void 0:t[1].replace(/\s/g,"")}).filter(e=>e),c={pg:/dia/i.test(s[0]),fen:function(e,t){if(!t)return e;let n=(0,l.S3)(e);for(let e of t)n[(0,l.Di)(e)]="-"+(0,r.Wh)("i");return(0,l.N0)(n)}($(t),o.imitators),imitators:o.imitators,ordering:q(s[0],o.halfDuplex)},u={stack:[],stipIndex:0,solutionPrinted:!1,currentProblem:c,board:(0,l.S3)(S(c)),ordering:c.ordering,imitators:null==(a=c.imitators)?void 0:a.concat()};return{duplexSeparator:o.duplex?function(e){let t=/^\n\n+ +1\./,n=e.replace(/\n\nsolution finished./,"\n  1.").match(/\n\n+[^\n]+/g).filter((e,n,a)=>n>0&&e.match(t)&&a[n-1].match(t)).map(e=>e.match(/^\n+/)[0].length);return"\n".repeat(Math.max(...n))}(n):"",initProblem:c,stipulations:s,options:o,state:u}}(a,c,u=u.replace(/<br>/g,"\n").replace(/<span class="text-secondary">.+?<\/span>/g,"")),k=!1;return(u=u.replace(L,e=>{if(k)return e;try{if(function(e,t){let{state:n,duplexSeparator:a}=e;return!!t.match(/^\n+$/)&&(n.stack.length=0,n.board=(0,l.S3)(S(n.currentProblem)),t==a&&n.solutionPrinted&&(n.ordering=G(n.ordering)),!0)}(_,e)||function(e,t){let{state:n,stipulations:a,options:i,initProblem:r}=e,s=t.match(T);if(!s)return!1;n.solutionPrinted=!1,n.currentProblem=(0,o.d)(s[1]?n.currentProblem:r);let c=a[++n.stipIndex];c&&(n.currentProblem.ordering=q(c,i.halfDuplex),n.currentProblem.pg=/dia/i.test(c)),n.ordering=n.currentProblem.ordering,n.stack.length=0;let{fen:u,board:d}=function(e,t){let n=(0,l.S3)(e);for(let e of t.replace(/(mirror|shift|rotate) /g,"$1").replace(/ ==&gt; /g,"==&gt;").split(" "))!function(e,t){for(let n of[D,A,N,P,E,I,R,O])if(n(t,e))return}(n,e);return{fen:(0,l.N0)(n),board:n}}(n.currentProblem.fen,s[2]);return n.currentProblem.fen=u,n.board=n.currentProblem.pg?(0,l.S3)(l.J7):d,!0}(_,e))return e;return _.state.solutionPrinted=!0,function(e,t,n){let a,{stack:o,ordering:i}=t,c=e.match(b).groups,u=c.count,w=S(t.currentProblem);if(u){let e=o.findIndex(e=>e.move==u||parseInt(e.move)>parseInt(u));e>=0&&(a=function(e,t,n){let a=t>0?e.stack[t-1].fen:n;return e.board=(0,l.S3)(a),e.imitators&&(e.imitators=(t>0?e.stack[t-1].imitators:e.currentProblem.imitators).concat()),e.stack.length=t,a}(t,e,w))}let _=i[!u||u.endsWith("...")?1:0],{imitators:k,board:U}=t,x=null==k?void 0:k.concat();if(k){for(let e of k)(0,r.i9)(U,e,"");k.length=0}let B=[];for(let e of c.main.split("/")){var C;!function(e,t,n,a,o){let l,i;if(n.move.startsWith("0-0")){let a=t==s.Il.white?"1":"8",c="0-0"==n.move?["g","h","f"]:["c","a","d"];(0,r.nU)(e,"e"+a,c[0]+a,o),i=(0,r.nU)(e,c[1]+a,l=c[2]+a,o)}else i=(0,r.nU)(e,n.from,l=n.to,o),n.ep&&(0,r.i9)(e,n.to.replace("3","4").replace("6","5"),""),n.then&&function(e,t,n){let a=t.to;for(let o of t.then.match(RegExp("".concat(r.LW,"|").concat(r.SQ),"g"))){let t=o.match(new RegExp(r.LW));if(t){let o=(0,r.i9)(e,a,(0,r.Wh)(t.groups.p),t.groups.pc);n&&(n[n.length-1]+="="+o)}else(0,r.nU)(e,a,o,n),a=o}}(e,n,o);"I"==n.p?(a.push(l),(0,r.i9)(e,l,(0,r.Wh)("I"),s.Il.neutral)):n.p&&(0,r.i9)(e,l,i=(0,r.Wh)(n.p),n.pc?n.pc:t),n.cc&&(0,r.i9)(e,l,i,n.cc)}(U,_,e.match(y).groups,k,B);let t=null==(C=e.match(/\[[^[\]]+(?=\])/g))?void 0:C.map(e=>e.substring(1));t&&t.forEach(e=>(function(e,t,n){var a,o,i,c,u,y,b;let S=null==(a=t.match(d))?void 0:a.groups;if(S)return(0,r.i9)(e,S.at,(0,r.Wh)(S.p||S.is),S.c);if(S=null==(o=t.match(p))?void 0:o.groups)return(0,r.i9)(e,S.at,"");if(S=null==(i=t.match(f))?void 0:i.groups){(0,r.nU)(e,S.from,S.to),S.p&&(0,r.i9)(e,S.to,(0,r.Wh)(S.p),S.c);return}if(S=null==(c=t.match(m))?void 0:c.groups)return(0,r.Dd)(e,S.from,S.to);if(S=null==(u=t.match(h))?void 0:u.groups){return(0,r.i9)(e,S.at,(0,r.Wh)(S.p)||(y=e,b=S.at,y[(0,l.Di)(b)].match(RegExp("^(\\*\\d)?"+r.P+"$","i"))[0].toUpperCase()),S.c||function(e,t){let n=e[(0,l.Di)(t)];return r.P.startsWith("-")?s.Il.neutral:n==n.toLowerCase()?s.Il.black:s.Il.white}(e,S.at))}if(t.match(g))for(let a of(n.push(...t.match(RegExp(r.SQ,"g"))),n))(0,r.i9)(e,a,(0,r.Wh)("I"),s.Il.neutral)})(U,e,k))}let D=(0,l.N0)(U);return u&&o.push({move:u,color:_,fen:D,imitators:null==k?void 0:k.concat()}),x&&function(e,t){for(let n=0;n<t.length;n++){let[a,o]=t[n].match(/[a-z]\d/g).map(e=>(0,l._n)(e)),i=o.x-a.x,r=o.y-a.y;for(let a of e){let e=(0,l._n)(a);t[n]+=a+(0,l.MA)(e.y+r,e.x+i)}}}(x,B),(1==o.length&&u?n("*",w)+" ":"")+n(e,D,B,a)}(e,_.state,w)}catch(t){return console.log(t,e),k=!0,e}})).replace(/ {2} ?<span init/g,"<span").replace(/\n/g,"<br>")}let F=RegExp(String.raw(j(),(0,i.d)("3stipulation")),"i");function q(e){var t;let n,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return"wb";let o=e.match(/^(\d+-&gt;)?(?:exact-)?(?:(?:ser|pser|phser|semi|reci)-)?(hs|hr|h|s|r)?/i);return n=!o||o[1]?"wb":(null==(t=o[2])?void 0:t.toLowerCase())=="h"?"bw":"wb",a?G(n):n}let Q=RegExp(String.raw(V(),r.SQ),"ig"),Y=(0,i.M)("3duplex"),K=(0,i.M)("3halfDuplex");function G(e){return"wb"==e?"bw":"wb"}function H(e,t,n,a){let o="*"==e?"init ":"";t=t.replace(/-/g,"&#45;").replace(/"/g,"&#34;");let l="";return n&&n.length&&(l+=' data-anime="'.concat(n.join(","),'"')),a&&(l+=' data-before="'.concat(a,'"')),"<span ".concat(o,'class="step btn px-1 py-0" data-fen="').concat(t,'"').concat(l,">").concat(e,"</span>")}let Z=/[-+=]?(\.[0-9A-Z][0-9A-Z]|[A-Z])|\d+|\//ig;function $(e){return e.match(Z).map(e=>{if("/"==e||e.match(/^\d+$/))return e;let t=e.match(/^[-+=]/)?e[0]:null;return t&&(e=e.substring(1)),e.startsWith(".")&&(e=e.substring(1)),e=(0,r.Wh)(e),"+"==t&&(e=e.toUpperCase()),"-"==t&&(e=e.toLowerCase()),"="==t&&(e="-"+e.toLowerCase()),e}).join("")}},6595:function(e,t,n){n.d(t,{M:()=>l,d:()=>i});var a=n(8531);function o(){let e=(0,a._)(["(?:","","|\b)"],["(?:","","|\\b)"]);return o=function(){return e},e}function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return RegExp(t+i(e)+n,"i")}function i(e){let t=4;return(e.match(/^\d/)&&(t=Number(e[0]),e=e.substring(1)),e.length<=t)?"\\b"+e+"\\b":"\\b"+e.substring(0,t)+function e(t){return""==t?"":String.raw(o(),t[0],e(t.substring(1)))}(e.substring(t))}},793:function(e,t,n){n.d(t,{U:()=>o});var a,o=((a={})[a.notYet=0]="notYet",a[a.checkmate=1]="checkmate",a[a.draw=2]="draw",a)},7536:function(e,t,n){n.d(t,{u8:()=>D,h:()=>m,t4:()=>_,bi:()=>y,nj:()=>B,wH:()=>k,yC:()=>p,I3:()=>C,SB:()=>S,i7:()=>g});var a=n(6770),o=n(9898),l=n(6871),i=n(2526),r=n(4189),s=n(6230),c=n(4791),u=n(7683),d=n(8662);let p=new URL(location.href).searchParams,f={BBS:{Id:!0,coordinates:!0,notes:!0,uncoloredNotes:!1,redBlue:!1},DB:{use:"PDB",exact:!1},PLAY:d.CS,Stockfish:{study:!1,downloaded:!1,depth:50,lines:3},feature:{janko:!1},popeye:{pieceMap:s.BC},board:o.n6,project:[]},m=(0,a.qj)(f);s.$I.custom=()=>m.popeye.pieceMap;let h=matchMedia("(prefers-color-scheme: dark)");h.onchange=()=>g.isDark=h.matches;let g=(0,a.qj)({module:{chess:!1},envReady:!1,loading:!0,isDark:h.matches,pieceCount:"(0+0)",hor:!1,collapse:!1,dragging:!1,selection:null,stockfish:{status:u.KO.notDownloaded,running:u.MI.stop},syzygy:{running:!1}}),y={depth:0,score:null,mate:null,lines:[],header:[]},b={split:!1,tab:0,compute:"py",play:d.tu,popeye:{initFEN:"",index:0,steps:[],playing:!1,error:!1,running:!1,editMap:!1,mapping:"",input:"",output:"",intInput:"",intOutput:""},stockfish:y,syzygy:{header:null,lines:null}},S=(0,a.qj)(b),w=[];function _(e){w.push(e)}function k(){let e=JSON.parse(localStorage.getItem("settings")||"{}");(0,r.n)(f,e,!0),e.project&&(f.project=e.project),e.popeye&&(f.popeye.pieceMap=e.popeye.pieceMap),p.has("janko")&&(f.feature.janko=!0);let t=i.OB.isTop?JSON.parse(sessionStorage.getItem("state")||"null"):null;for(let e of(t&&(0,r.n)(S,t),g.stockfish.status=m.Stockfish.downloaded?u.KO.ready:u.KO.notDownloaded,w))e();(0,a.m0)(U),(0,a.m0)(x)}function U(){localStorage.setItem("settings",JSON.stringify(m))}function x(){i.OB.isTop&&sessionStorage.setItem("state",JSON.stringify(S))}function B(e,t,n){let{size:a,w:i}=m.board,{border:r,margin:s}=(0,o.t_)(m.board,t),u=r.size,d=t?c.Dm:c._N,p=e?d:i,f=(e||l.m8).clientWidth/(a*p+2*u+s.x),h={x:(u+s.x)*f,y:u*f,r:u*f,b:(u+s.y)*f},g=((n||i)*a+2*r.size+s.x)*f;return{s:a*f,offset:h,width:g}}function C(){return S.play.playing||S.popeye.playing}function D(){return g.hor&&S.popeye.playing}},8662:function(e,t,n){n.d(t,{CS:()=>o,TF:()=>r,th:()=>p,tu:()=>l,zi:()=>i});var a=n(7683);let o={symbol:null,ep:!0,negative:!1,zero:!1},l={initFEN:"",playing:!1,pendingPromotion:!1,moveNumber:-1,game:"",history:[],turn:"w",castle:{K:!0,Q:!0,k:!0,q:!0},retro:{uncapture:void 0,unpromote:!1,ep:!1},enPassant:"",halfMove:0,fullMove:1,mode:a.jl.normal,over:void 0},i=1,r=8,s=[a.V1.wQ,a.V1.wB,a.V1.wN,a.V1.wR],c=[a.V1.bQ,a.V1.bB,a.V1.bN,a.V1.bR],u=c.concat(a.V1.bP,a.V1.wP,a.V1.bC),d=s.concat(a.V1.bP,a.V1.wP,a.V1.wC),p={w:s,b:c,wr:u,br:d}},4640:function(e,t,n){n.d(t,{It:()=>u,X5:()=>s,pe:()=>c,u6:()=>r,zX:()=>i});var a=n(6770);let o=document.getElementById("Output"),l=!1;function i(){l=l||!!o&&o.scrollTop+o.clientHeight+30>o.scrollHeight}function r(){l&&(l=!1,(0,a.Y3)(()=>o.scrollTop=o.scrollHeight-o.clientHeight))}function s(e){let t=e.offsetTop-10;o.scrollTop>t&&(o.scrollTop=t);let n=e.offsetTop+e.clientHeight-o.clientHeight+10;o.scrollTop<n&&(o.scrollTop=n);let a=e.offsetLeft-10;o.scrollLeft>a&&(o.scrollLeft=a);let l=e.offsetLeft+e.clientWidth-o.clientWidth+10;o.scrollLeft<l&&(o.scrollLeft=l)}function c(){o.scrollTop=o.scrollLeft=0}function u(){return[...o.querySelectorAll("span")]}},388:function(e,t,n){n.d(t,{Jn:()=>_,U_:()=>N,dS:()=>D,wD:()=>I});var a=n(8531),o=n(6770),l=n(864),i=n(7536),r=n(6042),s=n(8002),c=n(7955),u=n(5420),d=n(6595),p=n(6230),f=n(6476),m=n(9130),h=n(4791),g=n(3879),y=n(4640);function b(){let e=(0,a._)(["(?:",")s.+$"],["(?:",")\\s.+$"]);return b=function(){return e},e}function S(){let e=(0,a._)(["","s+S+"],["","\\s+\\S+"]);return S=function(){return e},e}function w(){let e=(0,a._)(["","s+(S+)"],["","\\s+(\\S+)"]);return w=function(){return e},e}let _={};(0,i.t4)(()=>{i.SB.popeye.running=!1,i.SB.popeye.editMap=!1,i.SB.popeye.playing&&(0,c.zD)().then(()=>(0,o.Y3)(()=>P(!0)))});let k=RegExp(String.raw(b(),["remark","2author","2origin","3title"].map(d.d).join("|")),"igm"),U=RegExp(String.raw(S(),(0,d.d)("5protocol")),"i"),x=(0,d.M)("3beginProblem"),B=(0,d.M)("3endProblem"),C=/\bnext\s[\s\S]+$/i,D=(0,d.d)("3forsyth"),A=(0,d.d)("2pieces");function N(e){if(RegExp("".concat(D,"|").concat(A),"i").test(e)){var t;let n=(0,m.F)(e)||(null==(t=e.match(RegExp(String.raw(w(),D),"i")))?void 0:t[1]);if(n)return{fen:n,imitators:[],fromInput:!0}}let{w:n,h:a}=i.h.board;if(n!=h.Dm||a!=h.Dm)throw Error();let o=[],r=(0,l.Ox)().map((e,t)=>{if(""==e)return e;let n=i.h.board.SN?e.replace("s","n").replace("S","N").replace("g","s").replace("G","S"):e;if(!(n=(0,p.Os)(n)))throw(0,g.Z)("Unspecified fairy piece: "+e);return n.match(/^=?i$/i)?(o.push((0,u.MA)(t)),""):n});return{fen:(0,u.N0)(r),imitators:o,fromInput:!1}}async function P(e){let t=i.SB.popeye;t.steps=(0,y.It)(),0!=t.steps.length&&(E(0,!0),t.playing=!0,e&&await (0,c.zD)(),(0,c.t1)([]),(0,o.Y3)(s.SI))}async function E(e,t){let n=i.SB.popeye,a=n.steps[e],r=n.steps[n.index];if(r&&r.dataset.anime&&(e==n.index-1&&!r.dataset.before||a.dataset.fen==r.dataset.before))await (0,f.jt)(a.dataset.fen,r.dataset.fen,r.dataset.anime,!0);else{var s;let t=a.dataset.before||(null==(s=n.steps[e-1])?void 0:s.dataset.fen);a.dataset.anime&&t?await (0,f.jt)(t,a.dataset.fen,a.dataset.anime):((0,f.p_)(),(0,l.dd)(a.dataset.fen))}t||r.classList.remove("active"),n.index=e,a.classList.add("active"),(0,o.Y3)(()=>(0,y.X5)(a))}let I={run(){gtag("event","fen_popeye_run"),_.initMemory();try{let e=i.SB.popeye;e.intInput=function(e){e=e.replace(k,"").replace(U,"").replace(x,"").replace(C,"").replace(B,"");let t=i.SB.popeye,{fen:n,imitators:a,fromInput:o}=N(e);return(t.initFEN=n,o)?((0,l.dd)((0,r.Vl)(n)),e):(a.length&&(e+="\ncond imitator "+a.join("")),"fors ".concat(n,"\n").concat(e))}(e.input),_.start()}catch{}},cancel:()=>_.cancel(),play(){let e=i.SB.popeye;(0,y.pe)(),gtag("event","fen_popeye_play"),e.output=(0,r.l5)(e.intInput,e.initFEN,e.intOutput),(0,o.Y3)(P)},step(e){let t=i.SB.popeye;if(!t.playing)return;let n=t.steps.indexOf(e.target);n>=0&&n!=t.index&&(e.preventDefault(),E(n))},exit(){let e=i.SB.popeye;(0,l.dd)(e.steps[0].dataset.fen),e.output=e.intOutput,e.playing=!1,(0,c.t1)([]),(0,o.Y3)(s.SI)},moveBy(e){let t=i.SB.popeye,n=t.index;(n+=e)<0&&(n=0),n>t.steps.length-1&&(n=t.steps.length-1),I.move(n)},move(e){e!=i.SB.popeye.index&&E(e)},editMap(){gtag("event","fen_popeye_edit_map"),i.SB.popeye.mapping=R(i.h.popeye.pieceMap),i.SB.popeye.editMap=!0},resetMap(){i.SB.popeye.mapping=R(p.BC)},saveMap(){let e=i.SB.popeye.mapping.toUpperCase().split("\n"),t={};for(let n of e){let[e,a]=n.replace(/\s/g,"").split("=");e.match(O)&&a&&a.match(W)&&(t[e]=a)}i.h.popeye.pieceMap=t,i.SB.popeye.editMap=!1}};function R(e){let t=[];for(let n in e)t.push("".concat(n,"=").concat(e[n]));return t.join("\n")}let O=/^(\*[1-3][KQBNRP]|(\*[1-3])?[CXSTAD]|''..|'.)$/,W=new RegExp("^".concat(p.P,"$"))},5057:function(e,t,n){n.d(t,{E:()=>a});function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return{id:Date.now()+t,...e}}},6476:function(e,t,n){let a;n.d(t,{jt:()=>p,n4:()=>d,p_:()=>f});var o=n(833),l=n(3298),i=n(1892),r=n(2526),s=n(5420),c=n(9898),u=n(6883);let d={};function p(e,t,n){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return f(),(a=new m(e,t,n,o)).promise}function f(e){a&&a.stop(e?d.callback:void 0)}class m{stop(e){cancelAnimationFrame(this.request),a=void 0,e&&e(this.after),this.resolve()}step(e){let{ctx:t,options:n,callback:a}=d,o=this.stages.length-1;this.startTime||(this.startTime=e);let s=(e-this.startTime)/150,p=Math.floor(s);if(p>o)return this.stop(a);let f=this.reverse?o-p:p;p>this.cursor?(this.cursor=p,(0,i.D)(t,this.stages[f].board,n,r.uN),this.background=t.getImageData(0,0,t.canvas.width,t.canvas.height)):t.putImageData(this.background,0,0);let m=(0,c.t_)(n);t.save(),t.translate(m.offset.x,m.offset.y);let h=(0,l.N)(n,r.uN),g=s-Math.floor(s);for(let e of(this.reverse&&(g=1-g),this.stages[f].moves)){let a=e.from.x*(1-g)+e.to.x*g,o=e.from.y*(1-g)+e.to.y*g;(0,u.a)(t,o,a,e.p,{info:m,assets:h,options:n,dpr:r.uN})}t.restore(),this.request=requestAnimationFrame(this.anime)}constructor(e,t,n,a){(0,o._)(this,"promise",void 0),(0,o._)(this,"after",void 0),(0,o._)(this,"reverse",void 0),(0,o._)(this,"resolve",void 0),(0,o._)(this,"cursor",void 0),(0,o._)(this,"stages",void 0),(0,o._)(this,"anime",void 0),(0,o._)(this,"request",void 0),(0,o._)(this,"background",void 0),(0,o._)(this,"startTime",void 0),this.after=a?e:t,this.reverse=a,this.promise=new Promise(e=>this.resolve=e),this.cursor=-1,this.stages=[];let l=n.split(","),i=(0,s.S3)(e),{h:r,w:c}=d.options;for(let e of l){let t=[],n=e.match(/[`a-z]\d(=(\*\d)?[A-Z])?/g);for(let e=0;e<n.length;e+=2){var u;let a=n[e],o=n[e+1],l=(0,s.Di)(a,c,r),d={p:i[l],promo:null==(u=o.match(/[=](.+)$/))?void 0:u[1],from:(0,s._n)(a,r),to:(0,s._n)(o,r)};i[l]="",t.push(d)}for(let e of(this.stages.push({board:i.concat(),moves:t}),t))i[e.to.y*c+e.to.x]=e.promo||e.p}this.anime=this.step.bind(this),this.request=requestAnimationFrame(this.anime)}}},3298:function(e,t,n){n.d(t,{$:()=>s,N:()=>r});var a=n(4791);let o=document.createElement("canvas"),l=o.getContext("2d"),i=new Map;function r(e,t){let n=e.set+e.size*t;return i.get(n)}async function s(e,t,n){let a=t.set+t.size*n;if(i.has(a))return i.get(a);let o=await c(e,t,n),l=await u(o);return i.set(a,l),l}async function c(e,t,n){let{set:i,size:r}=t;e+="/x"+n;let[s,c]=await Promise.all([u("".concat(e,"/").concat(i).concat(r,".png")),u("".concat(e,"/symbol").concat(r,".png"))]);return o.width=r*n*a._N,o.height=r*n*12,l.drawImage(s,0,0),l.drawImage(c,0,r*n*6),o.toDataURL()}function u(e){return new Promise((t,n)=>{let a=new Image;a.onload=()=>t(a),a.onerror=e=>n(e),a.src=e})}},8430:function(e,t,n){n.d(t,{L:()=>d,l:()=>u});var a=n(2923);let o={26:"YdVh1QDVYdVh",32:"AAAKAAAAo/+jAAr/AP8KAKP/owAAAAoAAA==",38:"AAw+DAAM3P/cDD7/AP8+DNz/3AwADD4MAA==",44:"AC9yLwAv+f/5L3L/AP9yL/n/+S8AL3IvAA==",52:"A3i2eAN4////eLb/AP+2eP///3gDeLZ4Aw==",64:"AAAEHgQAAAA/5v/mPwAE5v///+YEHv//AP//HgTm////5gQAP+b/5j8AAAAEHgQAAA==",76:"AARZhFkEAAS7////uwRZ//////9ZhP//AP//hFn//////1kEu////7sEAARZhFkEAA==",88:"AEfE68RHAEf8/////EfE///////E6///AP//68T//////8RH/P////xHAEfE68RHAA=="},l={},[i,r]=(0,a.b)(),[s,c]=(0,a.b)();function u(e,t,n){let{dpr:a,options:u}=n;(function(e,t,n){s.width=i.width=e.width,s.height=i.height=e.height,r.fillStyle="white",r.fillRect(0,0,e.width,e.height),r.globalCompositeOperation="destination-in",r.drawImage(e,0,0);let a=function(e){if(!(e in l)){let t=atob(o[e]),n=[];for(let e=0;e<t.length;e++)n.push(t.charCodeAt(e));l[e]=n}return l[e]}(t*n),u=Math.sqrt(a.length),d=(u-1)/2;for(let e=0;e<u;e++)for(let t=0;t<u;t++){let n=a[t*u+e];0!=n&&(r.globalAlpha=n/255,c.drawImage(i,e-d,t-d))}})(t,u.size,a),e.drawImage(s,0,0),e.drawImage(s,0,0),e.drawImage(s,0,0)}function d(e,t,n){if(e.strokeStyle="black",e.lineWidth=t/60,e.fillStyle="#fff",e.fillRect(0,0,t,t),n)return;e.beginPath();let a=t/7.5;for(let n=0;n<t;n+=a)e.moveTo(t-n,0),e.lineTo(0,t-n),n>0&&(e.moveTo(n,t),e.lineTo(t,n));e.stroke()}},1892:function(e,t,n){n.d(t,{D:()=>d});var a=n(3298),o=n(9898),l=n(4791),i=n(2923),r=n(8430),s=n(6883);let[c,u]=(0,i.b)();function d(e,t,n,i,d,f){let m=(0,o.t_)(n,f),h={info:m,assets:(0,a.N)(n,i),options:n,dpr:i},g="classic"==n.bg;p(e,h),d||function(e,t){let{w:n,h:a}=t;for(let o=0;o<a;o++)for(let a=0;a<n;a++)!function(e,t,n,a){var o,l;let i=function(e,t,n){if("mono"==e)return 1;let a=(t+n)%2;return"inverted"!=e&&(a=1-a),a}(a.pattern,t,n),s=a.size;e.save(),e.translate(n*s,t*s),"classic"==a.bg?(0,r.L)(e,s,i):(o=i,e.fillStyle="classic"==(l=a.bg)?"none":"gray"==l?o?"#fff":"#bbb":"green"==l?o?"#EEEED2":"#769656":o?"#FFCE9E":"#D18B47",e.fillRect(0,0,s,s)),e.restore()}(e,o,a,t)}(e,n),e.restore(),p(u,h),function(e,t){let{w:n,h:a}=t.options;for(let o=0;o<a;o++)for(let a=0;a<n;a++)(0,s.a)(u,o,a,e[o*n+a],t)}(t,h),u.restore(),g&&!d&&(0,r.l)(e,c,h),e.drawImage(c,0,0),e.scale(i,i);let{w:y,h:b,offset:S,border:w,margin:_}=m;void 0===f&&n.coordinates&&(e.save(),e.translate(S.x,S.y),function(e,t,n){let{size:a,w:i,h:r}=t;e.font="15px sans-serif",e.strokeStyle="black",e.lineWidth=2,e.fillStyle="white",e.lineJoin="round";for(let t=0;t<r;t++){let l=(t+1).toString(),i=e.measureText(l),s=a*(r-t)-a/2+5,c=(o.Cd-i.width)/2-o.Cd-n;e.strokeText(l,c,s),e.fillText(l,c,s)}for(let t=0;t<i&&t<26;t++){let i=String.fromCharCode(l.oh+t),s=e.measureText(i),c=a*r+o.Cd+n-5,u=a*t+(a-s.width)/2;e.strokeText(i,u,c),e.fillText(i,u,c)}}(e,n,w.size),e.restore()),d||function(e,t,n,a,o){e.save(),e.translate(o.x,0),n-=o.x,a-=o.y;let l=0;for(let o=0;o<t.array.length;o++){let i=t.array[o];if(e.strokeStyle=o%2?"white":"black",0==i)continue;e.lineWidth=i;let r=t.size-l-i/2;e.strokeRect(r,r,n-2*r,a-2*r),l+=i}e.restore()}(e,w,y,b,_)}function p(e,t){let{dpr:n}=t,{w:a,h:o,offset:l}=t.info;e.canvas.width=a*n,e.canvas.height=o*n,e.save(),e.scale(n,n),e.translate(l.x,l.y)}},6883:function(e,t,n){n.d(t,{V:()=>l,a:()=>i});var a=n(5420),o=n(7683);let l=["k","q","b","n","r","p","c","x","s","t","a","d"];function i(e,t,n,i,r){var s,c,u,d;let{assets:p,options:f,dpr:m}=r,h=function(e,t){void 0===e&&(e="");let n=!!e&&e.startsWith("-");n&&(e=e.substring(1));let i=e.match(/^\*(\d)/),r=i&&i[1]?Number(i[1]):void 0;void 0!==r&&(e=e.substring(2)),r=Number(r)%o.mi.full,t.SN&&(e=(0,a.hv)(e,!1,!0));let s=e.toLowerCase(),c=l.indexOf(s),u=e.startsWith("'");return c<0&&!u?null:{neutral:n,rotate:r,isText:u,value:e,lower:s,typeIndex:c}}(i,f);if(!h)return;let{neutral:g,rotate:y,isText:b,value:S,lower:w,typeIndex:_}=h;e.save();let k=f.blackWhite,U=function(e,t){let{neutral:n,value:a,lower:o}=e;return n?2*!t:+(a!=o)}(h,k),x=(s=g,c=w,u=k,d=f,s&&u?"n"==c?d.knightOffset:.5:1),[B,C]=[y+1&2?1:0,2&y?1:0],{size:D}=f;e.translate((n+B)*D,(t+C)*D),0!==y&&e.rotate(Math.PI/2*y),b?function(e,t,n){var o;e.save();let l=a.Nv.test(t),i=n-4;e.font="".concat(i,"px sans-serif");let r=n-2,s=e.measureText(t);if(l&&s.width>r){let n=r/s.width;e.font="".concat(i*n,"px sans-serif"),s=e.measureText(t)}let c=(o=l?e.measureText("M"):s).actualBoundingBoxAscent-o.actualBoundingBoxDescent,u=(n-Math.min(s.width,r))/2,d=Math.max((n-c)/2,0);e.fillStyle="black",e.fillText(t,u,n-d,r),e.restore()}(e,S.substring(S.startsWith("''")?2:1),D):(e.drawImage(p,U*D*m,_*D*m,D*x*m,D*m,0,0,D*x,D),g&&k&&e.drawImage(p,(1+x)*D*m,_*D*m,D*(1-x)*m,D*m,D*x,0,D*(1-x),D)),e.restore()}},7955:function(e,t,n){n.d(t,{Br:()=>I,G2:()=>W,Kv:()=>g,Sk:()=>E,Uw:()=>x,ii:()=>P,pz:()=>O,t1:()=>D,wY:()=>R,zD:()=>S});var a=n(6871),o=n(7536),l=n(864),i=n(1892),r=n(3298),s=n(9898),c=n(2526),u=n(6476),d=n(5420),p=n(5753),f=n(4791),m=n(7683),h=n(6883);let g="k,K,-k,q,Q,-q,b,B,-b,n,N,-n,r,R,-r,p,P,-p,c,C,-c,x,X,-x".split(","),y="k,q,b,n,r,p,c,x,K,Q,B,N,R,P,C,X,-k,-q,-b,-n,-r,-p,-c,-x".split(",");function b(){return o.h.board.exHigh?2:1}async function S(){o.i7.loading=!0;let e=[(0,r.$)("./assets",o.h.board,c.uN)],t=b();c.uN!=t&&e.push((0,r.$)("./assets",o.h.board,t)),await Promise.all(e),o.i7.loading=!1}let w=a.m8.getContext("2d",{willReadFrequently:!0}),_=a.S8.getContext("2d"),k=a.in.getContext("2d"),U=a.Ab.getContext("2d"),x=document.createElement("canvas"),B=x.getContext("2d"),C={except:void 0,data:void 0};function D(e){let t;e?C.except=e:e=C.except;let n=Object.assign({},o.h.board,o.i7.hor?{w:f.Dm,h:f._N}:{w:f._N,h:f.Dm}),a=(t=o.i7.hor?y:g,o.SB.play.playing&&"retro"==o.SB.play.mode&&(t=t.concat(),o.i7.hor?(t[6]="p",t[14]="P"):(t[18]="p",t[19]="P")),t);(0,i.D)(k,a,n,c.uN,!1,o.i7.hor);let{size:l}=o.h.board;if((0,o.I3)()){var r;let t="retro"==o.SB.play.mode;k.save();let{offset:n}=(0,s.t_)(o.h.board,o.i7.hor);k.translate(n.x,n.y),t&&(r=l,k.save(),k.font="".concat(r/2,"px sans-serif"),k.strokeStyle="black",k.lineWidth=r/12,k.fillStyle="white",k.lineJoin="round",A(1,m.wg.x),A(2,m.wg.x),k.restore()),function(e,t){k.save(),k.globalAlpha=o.i7.isDark?.5:.4,k.fillStyle="black";for(let n=0;n<f._N;n++)for(let a=0;a<f.Dm;a++){if(null==e?void 0:e.includes(a*f._N+n))continue;let[l,i]=o.i7.hor?[a,n]:[n,a];k.fillRect(l*t,i*t,t,t)}k.restore()}(e,l),t&&function(e,t){k.save();let n=o.SB.play.retro,a=+(e[0]!=m.V1.bQ);k.lineWidth=t/12,k.strokeStyle="#0d6efd",n.uncapture&&N(a,h.V.indexOf(n.uncapture)),n.unpromote&&N(1-a,5),k.restore()}(e,l),k.restore()}else if((0,i.D)(U,a,n,c.uN,!0,o.i7.hor),o.i7.selection){k.save();let{offset:e}=(0,s.t_)(o.h.board,o.i7.hor);k.lineWidth=l/12,k.strokeStyle="#0d6efd",k.translate(e.x,e.y);let t=g.indexOf(o.i7.selection),n=t%f._N,a=(t-n)/f._N;N(n,a),k.restore()}}function A(e,t){let{size:n}=o.h.board,a=n/15;o.i7.hor&&([e,t]=[t,e]);let l=k.measureText("ep"),i=l.width,r=l.actualBoundingBoxDescent;k.strokeText("ep",e*n-i-a,t*n-r-a),k.fillText("ep",e*n-i-a,t*n-r-a)}function N(e,t){let{size:n}=o.h.board,a=n/8;o.i7.hor&&([e,t]=[t,e]),k.beginPath(),function(){for(var o=arguments.length,l=Array(o),i=0;i<o;i++)l[i]=arguments[i];for(let o of l){k.moveTo(e*n+a*(o[0][0]+.5),t*n+a*(o[0][1]+.5));for(let l=1;l<o.length;l++)k.lineTo(e*n+a*(o[l][0]+.5),t*n+a*(o[l][1]+.5))}}([[0,2],[0,0],[2,0]],[[5,0],[7,0],[7,2]],[[7,5],[7,7],[5,7]],[[0,5],[0,7],[2,7]]),k.stroke()}async function P(e){e?C.data=e:e=C.data||(0,l.Ox)();let t=o.h.board;if((0,i.D)(w,e,t,c.uN),(0,i.D)(B,e,t,b()),function(e){let t=0,n=0,a=0,l=0;for(let o of e)""!=o&&(o.startsWith("'")?l++:o.startsWith("-")?a++:o==o.toUpperCase()?t++:n++);o.i7.pieceCount="(".concat(t,"+").concat(n).concat(a>0?"+"+a:"").concat(l>0?"+"+l:"",")")}(e),o.i7.dragging||((0,i.D)(_,e,t,c.uN,!0),(0,l.qA)()),location.protocol.startsWith("http")){let e=document.getElementById("Save");e.href&&URL.revokeObjectURL(e.href),a.fr.src=e.href=URL.createObjectURL(await I())}}function E(e){let{w:t,h:n}=o.h.board;(0,i.D)(e,(0,d.Q5)(t*n),o.h.board,c.uN)}function I(){return new Promise(e=>x.toBlob(e))}function R(){E(a.ut.getContext("2d")),O()}function O(){P(),D(),o.h.project.length&&(0,p.O)()}async function W(){await S(),P()}u.n4.ctx=w},2923:function(e,t,n){n.d(t,{b:()=>a});function a(){let e=document.createElement("canvas");return[e,e.getContext("2d")]}}},t={};function n(a){var o=t[a];if(void 0!==o)return o.exports;var l=t[a]={exports:{}};return e[a].call(l.exports,l,l.exports,n),l.exports}n.m=e,n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce((t,a)=>(n.f[a](e,t),t),[])),n.u=e=>"471"===e?"static/js/async/chess.97f536b1.js":"946"===e?"static/js/async/olive.20b03029.js":"936"===e?"static/js/async/ptt.4ccac000.js":"10"===e?"static/js/async/py.a7321999.js":""+e+".javascript",n.miniCssF=e=>""+e+".css",n.h=()=>"22e689c98bd89193",n.g=(()=>{if("object"==typeof globalThis)return globalThis;try{return this||Function("return this")()}catch(e){if("object"==typeof window)return window}})(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="fen-tool:";n.l=function(a,o,l,i){if(e[a])return void e[a].push(o);if(void 0!==l)for(var r,s,c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var d=c[u];if(d.getAttribute("src")==a||d.getAttribute("data-webpack")==t+l){r=d;break}}r||(s=!0,(r=document.createElement("script")).charset="utf-8",r.timeout=120,n.nc&&r.setAttribute("nonce",n.nc),r.setAttribute("data-webpack",t+l),r.src=a),e[a]=[o];var p=function(t,n){r.onerror=r.onload=null,clearTimeout(f);var o=e[a];if(delete e[a],r.parentNode&&r.parentNode.removeChild(r),o&&o.forEach(function(e){return e(n)}),t)return t(n)},f=setTimeout(p.bind(null,void 0,{type:"timeout",target:r}),12e4);r.onerror=p.bind(null,r.onerror),r.onload=p.bind(null,r.onload),s&&document.head.appendChild(r)}})(),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e=[];n.O=(t,a,o,l)=>{if(a){l=l||0;for(var i=e.length;i>0&&e[i-1][2]>l;i--)e[i]=e[i-1];e[i]=[a,o,l];return}for(var r=1/0,i=0;i<e.length;i++){for(var[a,o,l]=e[i],s=!0,c=0;c<a.length;c++)(!1&l||r>=l)&&Object.keys(n.O).every(e=>n.O[e](a[c]))?a.splice(c--,1):(s=!1,l<r&&(r=l));if(s){e.splice(i--,1);var u=o();void 0!==u&&(t=u)}}return t}})(),(()=>{n.p="/fen-tool/";var e={max:2,addQuery:!0,test:e=>!e.includes("gtag")},t=e.max||3,a={},o={};function l(t){for(var n=e.domain||[],a="",o=0;o<n.length;o++)if(-1!==t.indexOf(n[o])){a=n[o];break}return a||window.origin}var i=/[?#].*$/;function r(t,n,a,o,l){var r;return t.replace(n,a).replace(i,"")+(r=o+1,!0===e.addQuery?""!==l?"".concat(l,"&retry=").concat(r):"?retry=".concat(r):"function"==typeof e.addQuery?e.addQuery({times:r,originalQuery:l}):"")}var s={},c={},u=n.e,d=n.u,p=n.miniCssF||n.k||function(){return null},f=n.l,m="[@rsbuild/plugin-assets-retry] ";function h(i){var f=Array.prototype.slice.call(arguments);f[10]||(f[10]={count:0,cssFailedCount:0});var g=f[10],y=u.apply(null,f);try{var b=d(i),S=p(i);"undefined"!=typeof window&&(b&&(window.__RB_ASYNC_CHUNKS__[b]=!0),S&&(window.__RB_ASYNC_CHUNKS__[S]=!0))}catch(e){console.error(m,"get original script or CSS filename error",e)}return g&&"number"==typeof g.count&&"number"==typeof g.cssFailedCount?(g.count+=1,y.catch(function(u){var y,b,S,w,_,k,U=g.count-1,x=g.cssFailedCount,B=!!(null==u||null==(y=u.message)?void 0:y.includes("CSS chunk"));B&&(g.cssFailedCount+=1);var C=B?x:U-x;try{var D=function(t,i,u){var f,m,h,g=u?null==(f=o[t])?void 0:f[i]:null==(m=a[t])?void 0:m[i],y=i+1;if(0===i||void 0===g)h=function(e,t){var a,o=t?p(e):d(e);if(!o)throw Error("only support cssExtract");var i=n.p,s="/"===i[0]&&"/"!==i[1]?window.origin+i+o:i+o,c=(a=s.split("?")[1])?"?".concat(a.split("#")[0]):"",u=l(s);return{nextDomain:u,nextRetryUrl:r(s,u,u,0,c),originalScriptFilename:o,originalSrcUrl:s,originalQuery:c}}(t,u),u?o[t]=[]:a[t]=[];else{var b,S,w,_,k=g.originalScriptFilename,U=g.originalSrcUrl,x=g.originalQuery,B=(b=g.nextDomain,S=e.domain||[],w=l(b),_=S.indexOf(w),S[(_+1)%S.length]||b);h={nextDomain:B,nextRetryUrl:r(g.nextRetryUrl,g.nextDomain,B,i,x),originalScriptFilename:k,originalSrcUrl:U,originalQuery:x}}return u?(o[t][y]=h,c[t]=h):(a[t][y]=h,s[t]=h),h}(i,C,B);b=D.originalScriptFilename,S=D.nextRetryUrl,w=D.nextDomain}catch(e){throw console.error(m,"failed to get nextRetryUrl",e),u}var A=function(e){return{times:e,domain:w,url:S,tagName:B?"link":"script",isAsyncChunk:!0}},N=A(C);if(C>=t)throw u.message=(null==(_=u.message)?void 0:_.includes("retries:"))?u.message:"Loading chunk ".concat(i,' from "').concat(b,'" failed after ').concat(t,' retries: "').concat(u.message,'"'),"function"==typeof e.onFail&&e.onFail(N),u;var P=e.test;if(P){if("string"==typeof P){var E=new RegExp(P);P=function(e){return E.test(e)}}if("function"!=typeof P||!P(S))throw u}if(e.domain&&-1===e.domain.indexOf(w))throw u;"function"==typeof e.onRetry&&e.onRetry(N);var I="function"==typeof e.delay?e.delay(N):null!=(k=e.delay)?k:0;return(I>0?new Promise(function(e){return setTimeout(e,I)}):Promise.resolve()).then(function(){return h.apply(h,f)}).then(function(t){var n=(null==g?void 0:g.count)===U+2;if("function"==typeof e.onSuccess&&n){var a=A(C+1);e.onSuccess(a)}return t})})):y}"undefined"==typeof window||window.__RB_ASYNC_CHUNKS__||(window.__RB_ASYNC_CHUNKS__={});try{n.e=h,n.l=function(){var e=Array.prototype.slice.call(arguments),t=s[e[3]];return t&&(e[0]=t.nextRetryUrl),f.apply(null,e)},n.rbLoadStyleSheet=function(e,t){var a=c[t];return a&&a.nextRetryUrl||n.p+e}}catch(e){console.error(m,"Register async chunk retry runtime failed",e)}})(),n.rv=()=>"1.3.10",(()=>{n.b=document.baseURI||self.location.href;var e={980:0};n.f.j=function(t,a){var o=n.o(e,t)?e[t]:void 0;if(0!==o)if(o)a.push(o[2]);else{var l=new Promise((n,a)=>o=e[t]=[n,a]);a.push(o[2]=l);var i=n.p+n.u(t),r=Error();n.l(i,function(a){if(n.o(e,t)&&(0!==(o=e[t])&&(e[t]=void 0),o)){var l=a&&("load"===a.type?"missing":a.type),i=a&&a.target&&a.target.src;r.message="Loading chunk "+t+" failed.\n("+l+": "+i+")",r.name="ChunkLoadError",r.type=l,r.request=i,o[1](r)}},"chunk-"+t,t)}},n.O.j=t=>0===e[t];var t=(t,a)=>{var o,l,[i,r,s]=a,c=0;if(i.some(t=>0!==e[t])){for(o in r)n.o(r,o)&&(n.m[o]=r[o]);if(s)var u=s(n)}for(t&&t(a);c<i.length;c++)l=i[c],n.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return n.O(u)},a=self.webpackChunkfen_tool=self.webpackChunkfen_tool||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))})(),n.ruid="bundler=rspack@1.3.10";var a=n.O(void 0,["454","687"],function(){return n(3620)});a=n.O(a)})();