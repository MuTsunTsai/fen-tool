(()=>{"use strict";var e,t,n,o,a,l={7889:function(e,t,n){let o;n.d(t,{T:()=>d,_:()=>p});var a=n(5345),l=n(3639);let r=document.currentScript,s="img[fen]",i=document.createElement("iframe");function c(e){let t=new MessageChannel;t.port1.onmessage=t=>{e.src=t.data,e.title=o.getTitle(n,e.dataset)};let n=e.getAttribute("fen"),r=(0,l.YY)(Object.assign({},o.getDefault(),e.dataset)),s=(0,a.bV)(n);s&&Object.assign(r,s);let{w:c,h:u}=(0,l.Eo)(r);e.width=c,e.height=u,i.contentWindow.postMessage({fen:n,options:r},"*",[t.port2])}function u(e){e instanceof Element&&(e.matches(s)?c(e):e.querySelectorAll(s).forEach(e=>c(e)))}async function d(e){let t=new URL(r.src).origin,n=new URL(t+"/fen-tool/api/");o=e,document.head.appendChild(i),await new Promise(e=>{let t=n=>{n.source==i.contentWindow&&(removeEventListener("message",t),e())};addEventListener("message",t),i.src=n.toString()});let a=document.documentElement;new MutationObserver(e=>{for(let t of e)if("attributes"==t.type){let e=t.attributeName.toLowerCase(),n=e.startsWith("data");t.target==r&&n&&u(document.body),"IMG"==t.target.nodeName&&("fen"==e||n)&&c(t.target)}else for(let e of t.addedNodes)u(e)}).observe(a,{childList:!0,attributes:!0,subtree:!0}),u(a)}function p(){u(document.body)}i.style.display="none"},1364:function(e,t,n){n.d(t,{D1:()=>w,PE:()=>x,XR:()=>g,qN:()=>y});var o=n(476),a=n(8041),l=n(3923),r=n(5944),s=n(9318),i=n(4848),c=n(3639),u=n(1167),d=n(7889);let p=document.getElementById("Zone"),f=document.getElementById("DragZone"),h=document.getElementById("EditZone");function m(){return document.body.clientWidth/(r.wk.split?2:1)}async function y(e,t){var n,a,p,f,h,y,b,w;let R,x,L,C,_,E=r.M_.board,S={};for(let t in e)S[t]=e[t]!==E[t];Object.assign(E,e);let{border:M,margin:B,w:A,h:P}=(0,c.Eo)(E),N=(n=E,a=B,p=M,R=k(),m()<(n.w+3)*n.size+a.x+4*p.size+4.2*R);S.mode=N!==r.h5.hor,r.h5.hor=N;let F=S.w||S.h;(F||t)&&(0,i.r_)();let W=t||S.set||S.size,V=W||S.border,T=V||F,D=V||S.mode;D&&(f=E.size,h=M.size,y=B,x=(3*f+2*h)*u.Be,L=(8*f+2*h)*u.Be,r.h5.hor?[x,L]=[L+y.x*u.Be,x]:L+=y.y*u.Be,(l.wJ.width!==x||l.wJ.height!==L)&&(l.Nd.width=l.wJ.width=x,l.Nd.height=l.wJ.height=L)),T&&(b=A,w=P,C=b*u.Be,_=w*u.Be,(l.BB.width!==C||l.BB.height!==_)&&(l.w4.width=l.hi.width=l.BB.width=C,l.w4.height=l.hi.height=l.BB.height=_),(0,s.kj)(l.w4.getContext("2d"))),g(),W&&(await (0,s.Hh)(),r.M_.project.length&&(0,d._)()),T&&(0,s.$2)(),D&&(0,s.L9)(),(0,o.dY)(g)}function b(e){let{w:t,h:n}=r.M_.board,o=(0,i.$p)();y(e),(0,i.oh)(o,t,n)}function g(){p.style.maxWidth="calc(".concat(m(),"px + 1rem)"),l.BB.style.width=l.BB.width/u.Be+"px",l.wJ.style.width=l.wJ.width/u.Be+"px";let{w:e}=r.M_.board,t=(0,r.IQ)(void 0,void 0,8);if(r.h5.hor){if(e>8)l.wJ.style.width=t.width+"px";else if(e<8){let{width:t}=(0,r.IQ)(l.wJ,!0,e);l.BB.style.width=t+"px"}}i.kL.style.borderWidth="".concat(t.offset.y,"px ").concat(t.offset.r,"px ").concat(t.offset.b,"px ").concat(t.offset.x,"px");let n=k();r.M_.board.collapse?(p.style.width="120%",p.style.width=f.clientWidth+4*n+"px"):p.style.width="unset",l.hi.style.width=l.BB.clientWidth+"px",l.hi.style.height=l.BB.clientHeight+"px",l.Nd.style.width=l.wJ.clientWidth+"px",l.Nd.style.height=l.wJ.clientHeight+"px",(0,i.P5)(t.s),p.clientWidth<f.clientWidth+l.BB.clientWidth+6*n?(h.style.marginTop=-f.clientHeight+"px",h.style.width=f.clientWidth+"px",r.h5.collapse=!0):(h.style.marginTop="0",h.style.width="unset",r.h5.collapse=!1)}function k(){return parseFloat(getComputedStyle(document.documentElement).fontSize)}async function w(){window.addEventListener("resize",()=>y({}));let e=r.$P.get("fen");await y({},!0),i.E2.draw=s.$2,i.E2.setOption=y,e?((0,i.w3)(e,!0),(0,i.c8)()):(0,i.fh)(),setTimeout(g,1e3)}if(document.addEventListener("visibilitychange",()=>{"visible"==document.visibilityState&&((0,s.$2)(),(0,s.L9)())}),u._K.isTop)window.resizeIframe=function(){let e=document.getElementsByTagName("iframe")[0];e&&(e.style.minHeight=e.contentDocument.body.scrollHeight+"px")};else{function R(){try{parent.resizeIframe()}catch{}}"undefined"!=typeof ResizeObserver?new ResizeObserver(R).observe(document.body):new MutationObserver(R).observe(document.body,{childList:!0}),R()}let x={setDimension:b,setBorder(e){let t=(0,c.I5)(e.value);t?(e.value=t,y({border:t})):e.value=r.M_.board.border},get set(){return r.M_.board.set},set set(v){y({set:v})},get size(){return r.M_.board.size},set size(v){y({size:v})},get height(){return r.M_.board.h},set height(v){b({h:v})},get width(){return r.M_.board.w},set width(v){b({w:v})}};addEventListener("storage",e=>{if(e.storageArea==localStorage&&"settings"==e.key){let e=localStorage.getItem("settings"),t=e?JSON.parse(e):null;(0,a.E)(r.M_,t,!0),y({},!0)}})},4848:function(e,t,n){n.d(t,{$p:()=>E,AS:()=>S,E2:()=>p,HC:()=>D,IF:()=>I,P5:()=>m,XJ:()=>V,YC:()=>Q,Zc:()=>P,c8:()=>_,cL:()=>A,eh:()=>W,fh:()=>B,kL:()=>d,oh:()=>M,pT:()=>u,r_:()=>y,ro:()=>f,sJ:()=>x,t7:()=>T,w3:()=>L});var o=n(476),a=n(3923),l=n(5345),r=n(5944),s=n(2906),i=n(227);let c=["K","Q","k","q"],u=Array(64),d=document.getElementById("Squares"),p={},f=(0,o.IJ)("");function h(e){var t;null==(t=p.draw)||t.call(p,e)}function m(e){for(let t of(d.style.width=a.BB.clientWidth+"px",d.style.height=a.BB.clientHeight+"px",u))t.style.fontSize=e-10+"px",t.style.lineHeight=e-10+"px"}function y(){let{w:e,h:t}=r.M_.board,n=e*t;d.style.gridTemplateColumns="repeat(".concat(e,", 1fr)"),d.style.gridTemplateRows="repeat(".concat(t,", 1fr)");for(let e=0;e<n||e<u.length;e++){if(!u[e]){let t=document.createElement("input");u[e]=t,t.type="text",t.addEventListener("input",w),t.addEventListener("change",k),t.addEventListener("focus",b),t.addEventListener("blur",g),t.classList.add("square"),d.appendChild(t)}u[e].style.display=e<n?"block":"none"}}function b(){if(this.style.zIndex="10",r.h5.collapse){let e=E();e[u.indexOf(this)]="",h(e)}this.select()}function g(){this.style.zIndex="unset",R(this)?B():r.h5.collapse&&h(E())}function k(){R(this),r.h5.collapse&&this.blur(),B()}function w(){if(!r.h5.collapse){let e=E();e[u.indexOf(this)]=(0,l.S8)(this.value,r.M_.board.SN),h(e)}}function R(e,t){let n=(0,l.S8)(e.value,r.M_.board.SN,t),o=n!==e.value;return e.value=n,o}function x(e,t){let n=e.value!==t;e.value=t,R(e),n&&B()}function L(e,t){f.value=C(e)[0]+(r.M_.board.fullFEN?N():""),F(t)}function C(e){let t=e.split(" ");if(t[1]&&t[1].match(/^[wb]$/)&&(r.wk.play.turn=t[1]),t[2]&&t[2].match(/^(-|[kq]+)$/i))for(let e in r.wk.play.castle)r.wk.play.castle[e]=t[2].includes(e);return t[3]&&t[3].match(/^[a-h][36]$/)&&(r.wk.play.enPassant=t[3]),t[4]&&t[4].match(/^\d+$/)&&(r.wk.play.halfMove=Number(t[4])),t[5]&&t[5].match(/^\d+$/)&&(r.wk.play.fullMove=Number(t[5])),t}function _(){let e=new URL(location.href).searchParams.get("fen")||l.qN,t=f.value.split(" ")[0],n=t==l.qN?"":"?fen="+encodeURIComponent(t);t!==e&&history.pushState(null,"",n||".")}function E(){let{w:e,h:t}=r.M_.board;return u.slice(0,e*t).map(e=>e.value)}function S(){return E().map(e=>(0,l.rX)(e,!1,!0))}function M(e,t,n){let{w:o,h:a}=r.M_.board;for(let l=0;l<a;l++)for(let a=0;a<o;a++){let r=u[l*o+a];l<n&&a<t?r.value=e[l*t+a]:r.value=""}B()}function B(){h(A())}function A(){let{w:e,h:t,fullFEN:n}=r.M_.board,o=E();return f.value=(0,l.KF)(o,e,t)+(n?N():""),o}function P(){let e=function(){let{w:e,h:t}=r.M_.board;if(8!=e||8!=t)return null;let n=S();for(let e of n)if(""!=e&&!e.match(/^[kqbsnrp]$/i))return null;return(0,l.KF)(n)}();return e?e+N(!0):null}function N(e){var t;let n,o,a,l=r.wk.play;l.enPassant.match(/^[a-h][36]$/)||(l.enPassant=""),e&&"pass"==l.mode&&l.enPassant&&"3"==l.enPassant[1]!=("b"==l.turn)&&(l.turn="b"==l.turn?"w":"b");let s="retro"==l.mode;e&&((s||!Number.isSafeInteger(l.halfMove)||l.halfMove<0)&&(l.halfMove=0),(s||!Number.isSafeInteger(l.fullMove)||l.fullMove<1)&&(l.fullMove=1));let i=s?"-":(t=e,n=E(),o="",a=r.wk.play.castle,t?("K"==n[60]&&(a.K&&"R"==n[63]&&(o+="K"),a.Q&&"R"==n[56]&&(o+="Q")),"k"==n[4]&&(a.k&&"r"==n[7]&&(o+="k"),a.q&&"r"==n[0]&&(o+="q"))):(a.K&&(o+="K"),a.Q&&(o+="Q"),a.k&&(o+="k"),a.q&&(o+="q")),""==o?"-":o),c=s?"-":l.enPassant||"-";return" ".concat(l.turn," ").concat(i," ").concat(c," ").concat(l.halfMove," ").concat(l.fullMove)}function F(e){var t;let n=f.value;W(n);let o=(0,l.L4)(n),a=(0,l.bV)(o),{w:s,h:i}=a||r.M_.board,c=(0,l.ls)(o,s,i);null==(t=p.setOption)||t.call(p,{w:s,h:i});let d=o!=n;for(let e=0;e<s*i;e++)u[e].value=c[e],d=R(u[e])||d;d||e||!a?B():h(E())}function W(e){let t=r.wk.play,n=e.split(" ");if(1!=n.length){if(("w"==n[1]||"b"==n[1])&&(t.turn=n[1]),n[2])for(let e of c)t.castle[e]=n[2].includes(e);t.enPassant=n[3]&&"-"!=n[3]?n[3]:"","retro"!=t.mode&&(t.halfMove=Number(n[4]||0),t.fullMove=Number(n[5]||1))}}function V(){let e=!1;for(let t of u)e=R(t,!0)||e;e&&B()}function T(e){for(let t of u)t.readOnly=e}function D(e){if(e.anime){let t=(0,l.KF)(e,r.M_.board.w,r.M_.board.h);(0,s.i0)(f.value,t,e.anime)}else e.forEach((e,t)=>u[t].value=e),B()}function I(){for(let e of(Object.assign(r.wk.play,{turn:i.Q1.white,enPassant:"",halfMove:0,fullMove:1}),c))r.wk.play.castle[e]=!0}s.IU.options=r.M_.board,s.IU.callback=L,addEventListener("popstate",function(){if(r.wk.play.playing)return;let e=new URL(location.href).searchParams.get("fen");e&&L(e,!0)});let Q={update:()=>{C(f.value),F(!0)},empty(){for(let e of u)e.value="";B()},reset(e){var t;null==(t=p.setOption)||t.call(p,{w:8,h:8}),(r.M_.board.fullFEN||e)&&I(),L(l.VX)},color(e){for(let t of u){let n=t.value;n.startsWith("'")||""==n||(n.startsWith("-")&&(n=n.substr(1)),n=n.toLowerCase(),0==e&&(n="-"+n),1==e&&(n=n.toUpperCase()),t.value=n)}B()},fixSN(){for(let e of(gtag("event","fen_fix_sn"),u)){let t=e.value;t.startsWith("'")||""==t||(e.value=t.replace("s","n").replace("S","N"))}B()},invert(e){D((0,l.B8)(E(),e))}}},4210:function(e,t,n){let o,a,l,r,s,i,c,u,d,p,f,h,m,y,b,g,k,w,R;var x=n(476),L=n(5944),C=n(4848),_=n(1364),E=n(3923),S=n(9318),M=n(2906),B=n(1167),A=n(5109);async function P(e){if(B._K.canCopyImg){let t=await e();return navigator.clipboard.write([new ClipboardItem({"image/png":t})])}throw(0,A.x)('Image copying is not enabled in your browser.\n\nIf you\'re using Firefox, this can be enabled by the following.\n1. Visit "about:config" in your address bar.\n2. Search for "dom.events.asyncClipboard.clipboardItem".\n3. Toggle its value to true.\n4. Reload this tool.'),Error()}async function N(){if(B._K.canPaste)return await navigator.clipboard.readText();throw(0,A.x)('Pasting text is not enabled in your browser.\n\nIf you\'re using Firefox on desktops or Firefox Nightly on Android, this can be enabled by the following.\n1. Visit "about:config" in your address bar.\n2. Search for "dom.events.asyncClipboard.readText".\n3. Toggle its value to true.\n4. Reload this tool.'),Error()}var F=n(7714),W=n(5345),V=n(227),T=n(7231);function D(e){let t=L.wk.play,n=t.moveNumber;(n+=e)<-1&&(n=-1),n>t.history.length-1&&(n=t.history.length-1),n!=t.moveNumber&&I(n)}function I(e){let t=L.wk.play,n=t.moveNumber,o=e>=0||0==n;if(G.goto(t.history[e],o),o){let o=e==n-1,a=t.history[o?n:e],l=a.from+a.to;("k"==a.flags||"q"==a.flags)&&(l+=","+U(a)),(0,M.i0)(a.before,a.after,l,o!=(L.wk.play.mode==V.ey.retro))}}function Q(e,t,n){let o=(0,W.Lw)(e),l=(0,W.Lw)(t);if(L.wk.play.mode==V.ey.retro){let e=a.retract({from:o,to:l,...L.wk.play.retro});return e&&(z(),Y()),e}try{let e=a.move({from:o,to:l,promotion:n});if(!e)return!1;if("k"==e.flags||"q"==e.flags){var r;let t,n;return r=e,t=(0,W.ls)(r.before),n=r.color==V.Q1.white,t[(0,W.Rr)(r.from)]="",t[(0,W.Rr)(r.to)]=n?"K":"k",{before:(0,W.KF)(t),after:r.after,move:U(r)}}return!0}catch{return!1}}function U(e){let t=e.color==V.Q1.white,n="k"==e.flags,o=t?T.GQ:T.YJ;return(n?"h":"a")+o+(n?"f":"d")+o}function X(){(0,C.w3)(a.fen())}function O(e){return a.get((0,W.Lw)(e)).color}async function j(){if(!o){let e=await n.e("230").then(n.bind(n,390));o||((o=e).Chess.options=L.M_.PLAY,a=new o.Chess(L.wk.play),L.h5.module.chess=!0)}return o}function K(){Object.assign(L.wk.play,{playing:!0,pendingPromotion:!1}),(0,C.t7)(!0),L.wk.play.mode==V.ey.retro?(z(),Y()):(0,S.L9)([])}function z(){L.wk.play.retro={uncapture:void 0,unpromote:!1,ep:!1}}function Y(){(0,S.L9)(a.turn()==V.Q1.black?T.v5.wr:T.v5.br)}async function $(e){await j();try{a.loadGame(e),X(),K()}catch(e){e instanceof Error&&(0,A.x)(e.message)}}(0,L.Qx)(()=>{if(L.wk.play.playing){let e=L.wk.play;e.playing=!1,Promise.all([(0,S.Hh)(),j()]).then(()=>{K(),G.goto(e.history[e.moveNumber])})}});let G={async start(){try{let e=(0,C.Zc)();if(!e)throw Error("Only orthodox chess is supported.");await j(),a.init(e),L.wk.play.over=a.overState(),K()}catch(e){e instanceof Error&&(0,A.x)(e.message)}gtag("event","fen_play_"+L.wk.play.mode)},exit(){let e=L.wk.play.initFEN;L.wk.play.playing=!1,L.wk.play.game="",(0,C.w3)(e),(0,C.eh)(e),(0,C.t7)(!1),(0,S.L9)([])},goto(e,t){L.wk.play.pendingPromotion&&(L.wk.play.pendingPromotion=!1,(0,S.L9)([]));let n=a.goto(e);t||((0,M.TV)(),(0,C.w3)(n)),L.wk.play.mode==V.ey.retro&&(z(),Y())},move(e){e!=L.wk.play.moveNumber&&I(e)},moveBy(e){D(e)},copyGame:()=>a.copyGame(),copyPGN:()=>a.copyPGN(),number:e=>o.number(e,L.wk.play.mode),format:e=>o.format(e,L.wk.play.mode),async pasteMoves(){let e=await N();try{a.addMoves(o.parseMoves(e))}catch(e){e instanceof Error&&(0,A.x)(e.message)}X()},async pasteGame(){let e=await N();await $(e)}},q=new URL(location.href).searchParams.get("play");null!==q&&setTimeout(()=>{L.wk.tab=6,$(q)},0);var H=n(3639),J=n(7173);function Z(e){if(e.targetTouches){let t=e.target.getBoundingClientRect(),n=e.targetTouches[0]||e.changedTouches[0];e.clientX=n.clientX,e.clientY=n.clientY,e.offsetX=e.clientX-t.x,e.offsetY=e.clientY-t.y}return e}function ee(e,t){let{s:n,offset:o}=(0,L.IQ)(),a=t.getBoundingClientRect(),l=Math.floor((e.clientY-a.top-o.y)/n);return{x:Math.floor((e.clientX-a.left-o.x)/n),y:l}}function et(e,t,n){return(t.x-e.x)*(n.y-e.y)-(n.x-e.x)*(t.y-e.y)}let en={x:0,y:0},eo={x:0,y:0},ea=0,el=0,er=performance.now();function es(e){var t,n;let o,a,l=Z(e);"pending"==L.h5.dragging&&(o=l.offsetX-en.x,Math.sqrt(o*o+(a=l.offsetY-en.y)*a)>5)&&(el=0,i?(u=B._K.isTouch?[]:null,t=l,n=r,ei(),s.style.display="block",n&&(n.value="",(0,C.fh)()),L.h5.dragging=!0,ep(t)):L.h5.dragging=!1),!0===L.h5.dragging&&(u&&u.push({x:l.clientX,y:l.clientY}),ep(l))}function ei(){L.h5.selection=null,(0,S.L9)([])}function ec(e){var t,n;(function(e){if(r&&"pending"==L.h5.dragging&&!L.wk.play.playing&&e.target==E.gf){let t=performance.now();t-ea<300&&r.focus(),ea=t,e.preventDefault(),L.h5.dragging=!1}})(e),s&&(s.style.display="none");let o=Z(e);if(function(e){if(performance.now()-el>=250)return!1;if(e.target!=E.wJ||(0,L.Sl)()){if(e.target==E.gf&&L.wk.popeye.playing){let{x:t}=ee(e,E.gf);return t<3&&J.DB.moveBy(-1),t>4&&J.DB.moveBy(1),!0}}else{let{x:t,y:n}=ee(e,E.wJ);if(L.h5.hor&&([t,n]=[n,t]),ef(t,n,3,8)){let e=S.nX[3*n+t];L.h5.selection==e?L.h5.selection=null:L.h5.selection=e,(0,S.L9)([])}else ei();return L.h5.dragging=!1,!0}return!1}(o)||L.wk.popeye.playing||!L.h5.dragging||(L.h5.dragging=!1,!i))return;let{w:d,h:p}=L.M_.board,{x:f,y:h}=ee(o,E.BB),m=h*d+f,y=ef(f,h,d,p);if(L.wk.play.playing){let e;if(y){let n;if(t=c,(n=L.wk.play.mode)!=V.ey.retro&&(n==V.ey.pass&&O(t)!=a.turn()&&a.switchSide(),a.checkPromotion((0,W.Lw)(t),(0,W.Lw)(m))&&(l=m,L.wk.play.pendingPromotion=!0,(0,S.L9)(a.turn()==V.Q1.black?T.v5.b:T.v5.w),1)))return(0,C.sJ)(C.pT[m],i);c!=m&&(e=Q(c,m))}"object"==typeof e?(0,M.i0)(e.before,e.after,e.move):X()}else y?((0,C.sJ)(C.pT[m],i),r&&u&&u.length>10&&eu(r,function(e,t){let n=0;for(let o=0,a=t.length-1;o<t.length;a=o++){let l=t[o],r=t[a];r.y<=e.y?l.y>e.y&&et(r,l,e)>0&&n++:l.y<=e.y&&0>et(r,l,e)&&n--}return n}(function(e){let t=0,n=0;for(let o of e)t+=o.x,n+=o.y;return{x:t/=e.length,y:n/=e.length}}(n=u),n)>0?1:3)):(0,C.c8)()}function eu(e,t){e.value=e.value.replace(/(^-?)(?:\*(\d))?([^-].*$)/,(e,n,o,a)=>{let l=(Number(o||0)+t)%4;return n+(l?"*"+l:"")+a}),(0,C.fh)()}function ed(e){if(el=performance.now(),L.wk.popeye.playing||L.h5.loading||0!=e.button&&!e.targetTouches||e.targetTouches&&e.targetTouches.length>1)return;let t=Z(e);document.activeElement&&document.activeElement.blur();let n=this!=E.wJ,{offset:o,s:u}=n?(0,L.IQ)():(0,L.IQ)(E.wJ,L.h5.hor),{w:d,h:p}=L.M_.board;en.x=t.offsetX,en.y=t.offsetY;let[f,h]=[o.x,o.y];eo.x=Math.floor((en.x-f)/u),eo.y=Math.floor((en.y-h)/u);let m=eo.y*(n?d:3)+eo.x;s=n?E.hi:E.Nd;let y=L.h5.selection;if(n&&y){var b=t,g=d,k=p,w=y,R=m;if(b.preventDefault(),ef(eo.x,eo.y,g,k)){let e=C.pT[R];e.value==w?e.value="":e.value=w,(0,C.fh)()}else ei();return}(!L.wk.play.playing||(n||function(e){if(L.wk.play.pendingPromotion){var t,n;L.h5.hor&&([eo.x,eo.y]=[eo.y,eo.x]);let e=+("p"!=i);eo.y>0&&eo.y<5&&eo.x==e&&(t=c,n=F.g[eo.y],Q(t,l,n)?(l<8&&(n=n.toUpperCase()),(0,C.sJ)(C.pT[l],n)):X(),L.wk.play.pendingPromotion=!1,(0,S.L9)([]))}"retro"==L.wk.play.mode&&(e.preventDefault(),L.h5.hor&&([eo.x,eo.y]=[eo.y,eo.x]),function(e,t){if(2==e)return;let n=L.wk.play.retro;if(0==e==(a.turn()==V.Q1.black)){var o;0<t&&t<7&&(o=F.g[t],n.uncapture=n.uncapture==o?void 0:o),(5==t||6==t)&&(n.unpromote=!1)}else 5==t&&(n.unpromote=!n.unpromote,("p"==n.uncapture||"c"==n.uncapture)&&(n.uncapture=void 0));Y()}(eo.x,eo.y))}(t),n&&function(e){let t=L.wk.play.mode;if(L.wk.play.pendingPromotion||t!=V.ey.retro&&a.isGameOver())return!1;let n=O(e)==a.turn();return t==V.ey.pass||n==(t==V.ey.normal)}(m)))&&(n?(c=m,r=C.pT[m],L.h5.dragging="pending",i=void 0):r=void 0,r&&""==r.value||function(e,t,n,o){let[a,l]=[n.x,n.y];e.preventDefault(),s.style.clip="rect(".concat(eo.y*t+l+1,"px,").concat((eo.x+1)*t+a-1,"px,").concat((eo.y+1)*t+l-1,"px,").concat(eo.x*t+a+1,"px)"),r?i=r.value:(i=L.h5.hor?S.nX[3*eo.x+eo.y]:S.nX[o],L.h5.dragging="pending")}(t,u,o,m))}function ep(e){let{offset:t,s:n}=(0,L.IQ)(),{w:o,h:a,coordinates:l}=L.M_.board,r=E.BB.getBoundingClientRect(),i=s==E.Nd&&l&&!L.h5.hor?r.left+H.eY:r.left,c=Math.floor((e.clientY-r.top-t.y)/n),d=Math.floor((e.clientX-r.left-t.x)/n);(d!==eo.x||c!==eo.y)&&(u=null);let{scrollLeft:p,scrollTop:f}=document.documentElement;ef(d,c,o,a)?(s.style.left=i+(d-eo.x)*n+p+"px",s.style.top=r.top+(c-eo.y)*n+f+"px"):(s.style.left=e.clientX+p+1-en.x+"px",s.style.top=e.clientY+f-en.y+"px")}function ef(e,t,n,o){return t>-1&&t<o&&e>-1&&e<n}var eh=n(7889),em=n(8752);function ey(){if(d)return d;let e=new Worker(new URL(n.p+n.u("267"),n.b),Object.assign({},{name:"py"},{type:void 0}));return d=e,e.onerror=t=>{let n;t.preventDefault(),clearInterval(h),L.wk.popeye.running=!1,t.filename?(e.terminate(),n="An error occur in the Popeye module. Please submit an issue about this.\n"+t.message):n="Unable to load the Popeye module; please check your network connection.",L.wk.popeye.output=ew(n),d=void 0},e.onmessage=e=>{let t=e.data;if(++m>3e3)L.wk.popeye.intOutput+="<br>".concat(ew("Too much output. Please modify the input to prevent excessive output."),"<br>"),ek();else if(-2===t)(p/=2)<16&&(L.wk.popeye.intOutput+="<br>".concat(ew("Not enough memory to run Popeye."),"<br>")),ek(p>=16);else if(null===t)ek();else{if((0,em.k4)(),"string"==typeof t.text){let e=ev(t.text);e.match(/\s+\d+\s+\([^)]+Time = [^)]+s\)/)&&(e='<span class="text-secondary">'.concat(e,"</span>")),L.wk.popeye.intOutput+=e+"<br>"}if("string"==typeof t.err){if("Calling stub instead of signal()"==t.err)return;L.wk.popeye.error=!0,L.wk.popeye.intOutput+=ew(ev(t.err))}}},e}function eb(){let e=ey(),t=L.wk.popeye;m=0,t.intOutput="",t.error=!1,t.running=!0,h=setInterval(eg,500),f=performance.now(),e.postMessage({mem:p,input:"Opti NoBoard\n"+t.intInput})}function eg(){L.wk.popeye.output=L.wk.popeye.intOutput+'<br><i class="fa-solid fa-spinner fa-spin"></i>',(0,em.Lm)()}function ek(e){d&&d.terminate(),d=void 0;let t=500-(performance.now()-f);(0,em.Lm)(),clearInterval(h),e?eb():(L.wk.popeye.output=L.wk.popeye.intOutput,setTimeout(()=>L.wk.popeye.running=!1,Math.max(0,t)),ey())}function ew(e){return'<span class="text-danger">'.concat(e,"</span>")}function ev(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}J.yS.cancel=function(){d&&ek()},J.yS.initMemory=function(){p=512},J.yS.start=eb;var eR=n(8041),ex=n(9916);function eL(e){y.postMessage(e)}(0,L.Qx)(()=>{if(L.wk.stockfish.lines.length){let e=L.wk.stockfish.lines,t=L.wk.stockfish.header;L.wk.stockfish.lines=[],L.wk.stockfish.header=[],j().then(n=>{b=n,L.wk.stockfish.lines=e,L.wk.stockfish.header=t})}}),window.cmd=eL;let eC="(".concat(ex.SQ,")(").concat(ex.SQ,")([qrbn]?)"),e_="modules/stockfish/",eE=B._K.thread?"":"-single",eS=["".concat(e_,"stockfish-nnue-16.js#stockfish-nnue-16.wasm,worker"),"".concat(e_,"stockfish-nnue-16.wasm"),"".concat(e_,"stockfish-nnue-16-single.js#stockfish-nnue-16-single.wasm,worker"),"".concat(e_,"stockfish-nnue-16-single.wasm"),"".concat(e_,"nn-5af11540bbfe.nnue")];function eM(e){return y?Promise.resolve():new Promise((t,n)=>{L.h5.stockfish.running=V.y9.starting,(y=new Worker("".concat(e_,"stockfish-nnue-16").concat(eE,".js#stockfish-nnue-16").concat(eE,".wasm"))).onmessage=e=>{let n=e.data;console.info(n),"readyok"==n&&(L.h5.stockfish.running=V.y9.running,t()),n.startsWith("info ")&&function(e){let t;if(L.h5.stockfish.running!=V.y9.running)return;let n=e.match(/multipv (\d+)/);if(!n)return;let o=Number(n[1])-1,a=e.match(/mate (-?)(\d+)/),l=e.match(/score cp (-?\d+)/),r=Number(l&&l[1]||0)/100;if(a){let e="w"==k.split(" ")[1]==!!a[1]?"Black":"White";t=Number(a[2])+L.wk.stockfish.header.length/2,0==o&&(L.wk.stockfish.mate=[e,t])}if(0==o){let t=e.match(/depth (\d+)/);t&&(L.wk.stockfish.depth=t[1]),l&&(L.wk.stockfish.score=r)}let s=e.match(new RegExp("pv (".concat(eC,"(?: ").concat(eC,")*)")));if(s){var i,c,u;if((null==(i=L.wk.stockfish.lines[o])?void 0:i.raw)==s[1])return;let e=s[1].split(" ").map(e=>e.match(new RegExp(eC)));L.wk.stockfish.moves=[];let t=L.wk.stockfish.header;for(let n of(g.init(t.length?t[t.length-1].after:k),e))if(g.move({from:n[1],to:n[2],promotion:n[3]}).san.endsWith("=")){r=0;break}let n={rawScore:(c=a,u=r,c?c[1]?-1/0:1/0:u),score:a?a[1]+"#"+a[2]:r.toFixed(2),raw:s[1],moves:g.state.history.concat(),pgn:g.copyPGN(t)};L.wk.stockfish.lines[o]=n}L.M_.Stockfish.study&&eB()}(n.substring(5)),n.match(new RegExp("^bestmove ".concat(eC)))&&function(){let e=L.M_.Stockfish.depth;if(L.M_.Stockfish.study&&!(e<4)&&eB()){let t=L.wk.stockfish.header;t.push(...L.wk.stockfish.lines["0"].moves.slice(0,2)),eL("position fen "+t[t.length-1].after),eL("go depth "+e)}else eN.stop()}()},y.onerror=e=>{e.message.includes("RangeError")?n(-1):e.message.includes("memory")?n("Not enough memory."):n("Unknown error has occurred.")},eL("uci"),eL("setoption name Use NNUE value true"),B._K.thread&&eL("setoption name Threads value "+Math.max(2,navigator.hardwareConcurrency-4)),eL("setoption name Hash value "+e),eL("isready")})}function eB(){let e=L.wk.stockfish.lines.filter(e=>e&&e.moves.length);if(e.length<=1)return!1;e.forEach(e=>e.moves[0]&&(e.moves[0].annotation=void 0));let t=e.filter(e=>e.rawScore>1);if(t.length>1)return!1;if(1==t.length)return t[0].moves[0].annotation="!",!0;let n=e.filter(e=>e.rawScore>-1);return 1==n.length&&(n[0].moves[0].annotation="!",!0)}async function eA(e){if(200!=(await fetch(e)).status)throw Error()}async function eP(e,t){try{await e}catch(e){if(-1!==e)throw e;if(eN.stop(),(t/=2)<4)throw Error("Not enough memory.");await eP(eM(t),t)}}let eN={async download(){gtag("event","fen_stockfish_download"),L.h5.stockfish.status=V.N8.downloading,isHttps&&"serviceWorker"in navigator&&await navigator.serviceWorker.ready;try{await Promise.all(eS.map(e=>eA(e)))}catch{(0,A.x)("Download failed. Please check your network connection."),L.h5.stockfish.status=V.N8.notDownloaded;return}L.M_.Stockfish.downloaded=!0,L.h5.stockfish.status=V.N8.needReload},async analyze(){try{gtag("event","fen_stockfish_run");let e=eM(128);if(!(k=(0,C.Zc)()))throw Error("Only orthodox chess is supported.");if(!b){let e=await j();b||(b=e)}(g=new b.Chess).init(k),await eP(e,128),L.wk.stockfish=(0,eR.o)(L.XS),eL("setoption name MultiPV value "+L.M_.Stockfish.lines),eL("ucinewgame"),eL("position fen "+k),eL("go depth "+L.M_.Stockfish.depth)}catch(e){eN.stop(),(0,A.x)(e instanceof Error?e.message:e),L.h5.stockfish.running=V.y9.stop}},play(e){gtag("event","fen_stockfish_play"),L.wk.play.mode="normal",L.wk.tab=6,$(e.pgn)},stop(){y&&y.terminate(),y=void 0,L.h5.stockfish.running=V.y9.stop},format:e=>b.formatGame(e)};(0,L.Qx)(()=>{if(L.wk.syzygy.lines){let e=L.wk.syzygy.lines;e.forEach(e=>e.searching=!1),L.wk.syzygy.lines=[],j().then(t=>{w=t,L.wk.syzygy.lines=e})}});let eF=new Set;function eW(e){return new Promise(t=>{eF.add(t),setTimeout(()=>{eF.delete(t),t()},1e3*e)})}async function eV(e,t){try{if(!t.running)return null;let n=t.ready;if(t.ready=n.then(()=>eW(1)),await n,!t.running)return null;let o=await fetch("https://tablebase.lichess.ovh/standard?fen="+e);if(429==o.status)return await eW(61),await eV(e,t);return await o.json()}catch{throw Error("Unable to connect to the server. Please check your network connection.")}}async function eT(e){var t;let n=new(w=await j()).Chess;n.init(e.fen);let o=await eV(n.fen(),e),a="w"==n.turn()?"White":"Black",l=o.category;if(L.wk.syzygy.header="The position is a ".concat(l," for ").concat(a,"."),"unknown"==l||l.includes("loss")||!e.running)return;for(let a of(L.wk.syzygy.lines=[],e.outcome=l,e.op="draw"==(t=l)?t:eX[eU.indexOf(t)],o.moves.filter(t=>t.category==e.op))){n.init(e.fen);let[t,o,l]=a.uci.match(/..|./g);n.move({from:t,to:o,promotion:l});let r=n.fen();e.positions.add(eD(r));let s={fen:r,dtm:a.dtm,indent:0,history:n.state.history.concat(),leaf:!0,moves:n.state.history.concat(),pgn:n.copyPGN(),transpose:!1,searching:!n.isGameOver()};L.wk.syzygy.lines.push(s)}if(!e.running)return;let r=L.wk.syzygy.lines.filter(e=>e.searching);if(!(r.length>1))for(r[0].moves[0].annotation="!";r.length;){let t=r.map(t=>eI(t,e));if(await Promise.all(t),r=L.wk.syzygy.lines.filter(e=>e.searching),!e.running)return}}function eD(e){return e.replace(/ \d+ \d+$/,"")}async function eI(e,t){let n=new w.Chess;n.init(e.fen);let o="number"==typeof e.dtm,a=n.moves({verbose:!0}),l=new Set((await eV(e.fen,t)).moves.filter(e=>e.category==t.outcome).map(e=>e.uci)),r=a.filter(e=>l.has(e.from+e.to+(e.promotion||""))).map(e=>eQ(e,t,o)),s=(await Promise.all(r)).filter(e=>e).sort((e,t)=>t.score-e.score).filter((e,t,n)=>e.score==n[0].score);if(e.searching&&(e.searching=!1),!t.running)return;let i=s.filter(e=>"draw"!=t.op&&e.moves.length>0||1==e.moves.length);if(0==i.length)return;let c=1==i.length,u=i.map(o=>(function(e,t,n,o,a){o.init(t.fen);let l=o.move(e.defense);n&&(l.annotation="!");let[r,s,i]=e.moves[0].uci.match(/..|./g),c=o.move({from:r,to:s,promotion:i});1==e.moves.length&&(c.annotation="!");let u=o.fen(),d=eD(u),p=a.positions.has(d);p||a.positions.add(d);let f=o.state.history.concat();return{dtm:"number"==typeof e.dtm?1-e.dtm:null,fen:u,transpose:p,leaf:!0,indent:t.indent+ +!n,history:t.history.concat(f),moves:n?t.moves.concat(f):f,pgn:o.copyPGN(t.history),searching:!o.isGameOver()&&!p}})(o,e,c,n,t)),d=L.wk.syzygy.lines.concat(),p=d.indexOf(e);c?d.splice(p,1,...u):(e.leaf=!1,d.splice(p+1,0,...u)),L.wk.syzygy.lines=d}async function eQ(e,t,n){let o=await eV(e.after,t);if(!t.running)return null;let a=o.moves.filter(e=>e.category==t.op);return{score:(n?o.dtm:0)-a.length,json:o,dtm:o.dtm,defense:e,moves:a}}let eU=["win","maybe-win","cursed-win"],eX=["loss","maybe-loss","blessed-loss"],eO={async run(){let e={positions:new Set,running:!0,ready:Promise.resolve()};R=e;try{var t;if(gtag("event","fen_syzygy_run"),L.h5.syzygy.running=!0,L.wk.syzygy.header=null,L.wk.syzygy.lines=null,e.fen=(0,C.Zc)(),!e.fen)throw Error("Only orthodox chess is supported.");if((null==(t=e.fen.split(" ")[0].match(/[a-z]/ig))?void 0:t.length)>7)throw Error("Only supports position with up to ".concat(7," pieces."));await eT(e)}catch(e){(0,A.x)(e instanceof Error?e.message:e)}finally{e.running&&eO.stop()}},play(e){gtag("event","fen_syzygy_play"),L.wk.play.mode="normal",L.wk.tab=6,$(e.pgn)},stop(){var e;for(let e of(R&&(R.running=!1),eF))e();eF.clear(),null==(e=L.wk.syzygy.lines)||e.forEach(e=>e.searching=!1),L.h5.syzygy.running=!1},format(e){let t=w.formatGame(e.moves);return e.searching?t+=" ...":e.transpose&&(t+=" (transpose)"),t}};var ej=n(8209),eK=n.n(ej);let ez={class:"modal-dialog modal-dialog-centered"},eY={class:"modal-content"},e$=["innerHTML"],eG={class:"modal-footer"},eq=Promise.resolve(),eH=(0,x.pM)({name:"DialogModal",__name:"dialog",setup(e,t){let n,{expose:o}=t,a=(0,x.IJ)();(0,x.sV)(()=>{n=new(eK())(a.value,{backdrop:"static"})});let l=(0,x.IJ)("");return o({show:async function(e,t){let o,r=eq;return eq=new Promise(e=>{o=e}),await r,new Promise(r=>{l.value=e.replace(/\n/g,"<br>"),a.value.addEventListener("hide.bs.modal",()=>{r()},{once:!0}),a.value.addEventListener("hidden.bs.modal",o,{once:!0}),null==t||t(),n.show()})},hide:()=>n.hide()}),(e,t)=>((0,x.uX)(),(0,x.CE)("div",{class:"modal fade modal-second",ref_key:"el",ref:a},[(0,x.Lk)("div",ez,[(0,x.Lk)("div",eY,[(0,x.Lk)("div",{class:"modal-body",innerHTML:l.value},null,8,e$),(0,x.Lk)("div",eG,[(0,x.RG)(e.$slots,"default")])])])],512))}}),eJ=(0,x.pM)({name:"Alert",__name:"alert",setup(e,t){let{expose:n}=t,o=(0,x.IJ)();function a(e){return o.value.show(e)}return(0,x.sV)(()=>A.x.setup(a)),n({show:a}),(e,t)=>((0,x.uX)(),(0,x.Wv)(eH,{ref_key:"dialog",ref:o},{default:(0,x.k6)(()=>[...t[0]||(t[0]=[(0,x.Lk)("button",{type:"button",class:"btn btn-primary","data-bs-dismiss":"modal"},"OK",-1)])]),_:1},512))}}),eZ=(0,x.pM)({name:"Confirm",__name:"confirm",setup(e,t){let{expose:n}=t,o=!1,a=(0,x.IJ)();async function l(e){return await a.value.show(e,()=>o=!1),o}function r(){o=!0,a.value.hide()}return(0,x.sV)(()=>A.l.setup(l)),n({show:l}),(e,t)=>((0,x.uX)(),(0,x.Wv)(eH,{ref_key:"dialog",ref:a},{default:(0,x.k6)(()=>[t[0]||(t[0]=(0,x.Lk)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"No",-1)),(0,x.Lk)("button",{type:"button",class:"btn btn-primary",onClick:r},"Yes")]),_:1},512))}}),e0={class:"nav-item"},e1=["title"],e2={class:"d-sm-none"},e3={class:"d-none d-sm-inline"},e5=(0,x.pM)({__name:"menuTab",props:{index:{},icon:{},title:{}},setup:e=>(t,n)=>((0,x.uX)(),(0,x.CE)("li",e0,[(0,x.Lk)("div",{class:(0,x.C4)(["nav-link",{active:(0,x.R1)(L.wk).tab==e.index}]),onClick:n[0]||(n[0]=t=>(0,x.R1)(L.wk).tab=e.index),title:e.title},[(0,x.Lk)("span",e2,[(0,x.Lk)("i",{class:(0,x.C4)(e.icon)},null,2)]),(0,x.Lk)("span",e3,[(0,x.RG)(t.$slots,"default")])],10,e1)]))}),e8={class:"nav nav-tabs pe-1",style:{"flex-wrap":"nowrap"}},e4=(0,x.pM)({__name:"menu",setup:e=>(e,t)=>((0,x.uX)(),(0,x.CE)("div",{class:(0,x.C4)(["mb-3 nav-container",{"mt-n3":(0,x.R1)(L.PO)()}])},[(0,x.Lk)("ul",e8,[(0,x.bF)(e5,{index:0,icon:"fa-solid fa-pen-to-square",title:"Edit"},{default:(0,x.k6)(()=>[...t[0]||(t[0]=[(0,x.eW)("Edit",-1)])]),_:1}),(0,x.bF)(e5,{index:8,icon:"fa-solid fa-chess-board",title:"Project"},{default:(0,x.k6)(()=>[...t[1]||(t[1]=[(0,x.eW)("Project",-1)])]),_:1}),(0,x.bF)(e5,{index:1,icon:"fa-solid fa-gear",title:"Options"},{default:(0,x.k6)(()=>[...t[2]||(t[2]=[(0,x.eW)("Options",-1)])]),_:1}),(0,x.bF)(e5,{index:7,icon:"fa-solid fa-calculator",title:"Compute"},{default:(0,x.k6)(()=>[...t[3]||(t[3]=[(0,x.eW)("Compute",-1)])]),_:1}),(0,x.bF)(e5,{index:6,icon:"fa-solid fa-gamepad",title:"Play"},{default:(0,x.k6)(()=>[...t[4]||(t[4]=[(0,x.eW)("Play",-1)])]),_:1}),(0,x.bF)(e5,{index:2,icon:"fa-solid fa-database",title:"Database"},{default:(0,x.k6)(()=>[...t[5]||(t[5]=[(0,x.eW)("DB",-1)])]),_:1}),(0,x.R1)(L.h5).envReady&&(0,x.R1)(B._K).isTaiwan?((0,x.uX)(),(0,x.Wv)(e5,{key:0,index:4,icon:"fa-solid fa-terminal",title:"BBS"},{default:(0,x.k6)(()=>[...t[6]||(t[6]=[(0,x.eW)("BBS",-1)])]),_:1})):(0,x.Q3)("",!0),(0,x.bF)(e5,{index:5,icon:"fa-solid fa-share-from-square",title:"API"},{default:(0,x.k6)(()=>[...t[7]||(t[7]=[(0,x.eW)("API",-1)])]),_:1})])],2))});function e6(e){return new URL(e,location.href).toString()}function e9(){let{SN:e,w:t,h:n}=L.M_.board;return e?(0,W.KF)((0,C.AS)(),t,n):C.ro.value}function e7(){let e=L.M_.board,t=e9(),n=e6("gen/?fen="+t);return e.size!=H._7&&(n+="&size="+e.size),e.set!=H.FU&&(n+="&set="+e.set),e.pattern&&(n+="&pattern="+e.pattern),e.bg&&(n+="&bg="+e.bg),"1"!=e.border&&(n+="&border="+e.border),e.blackWhite&&(n+="&blackWhite&knightOffset="+e.knightOffset),(0,W.bV)(t)||(n+="&w=".concat(e.w,"&h=").concat(e.h)),n}let te={copyJanko:()=>(gtag("event","fen_copy_janko"),"https://www.janko.at/Retros/d.php?ff="+e9()),copyBase64:()=>(gtag("event","fen_link_copy64"),S.u5.toDataURL()),copyBase64Img:()=>(gtag("event","fen_link_copy64img"),'<img fen="'.concat(S.u5.toDataURL(),'">')),async copyUrl(){gtag("event","fen_gen_link");let e=new FormData,t=await (0,S.qW)();e.append("key","7802c5da1788f2315222d44bfba20519"),e.append("image",t,"fen");try{let t=await fetch("https://api.imgbb.com/1/upload",{method:"post",body:e}),n=await t.json();if(!n.success)throw n.error.message;return n.data.url+"?="+e9()}catch(e){throw(0,A.x)("string"==typeof e?e:"Internet connection failed. Please try again later."),e}},copyEmbed(){gtag("event","fen_copy_embed");let e=L.M_.board,t=e7(),{w:n,h:o}=(0,H.Eo)(e);return'<iframe src="'.concat(t,'" style="border:none;width:').concat(n,"px;height:").concat(o,'px"></iframe>')},copyEmbedUrl:()=>(gtag("event","fen_copy_embedUrl"),e7()),copyImg:()=>(gtag("event","fen_copy_sdkImg"),'<img fen="'.concat(e9(),'">')),copySDK(){gtag("event","fen_copy_sdk");let e=L.M_.board,t="";return e.size!=H._7&&(t+=' data-size="'.concat(e.size,'"')),e.set!=H.FU&&(t+=' data-set="'.concat(e.set,'"')),e.bg&&(t+=' data-bg="'.concat(e.bg,'"')),"1"!=e.border&&(t+=' data-border="'.concat(e.border,'"')),e.blackWhite&&(t+=' data-black-white="true" data-knight-offset="'.concat(e.knightOffset,'"')),'<script src="'.concat(e6("sdk.js"),'"').concat(t,"><\/script>")}},tt=["disabled"],tn=(0,x.pM)({__name:"copyButton",props:{class:{},factory:{type:Function},disabled:{type:Boolean}},setup(e){let t=(0,x.IJ)(0);async function n(){t.value=1;try{let n=e.factory;for(;"function"==typeof n;)n=await n();"string"==typeof n&&function(e){if(B._K.canCopy)navigator.clipboard.writeText(e);else{let t=document.createElement("input");document.body.appendChild(t),t.value=e,t.select(),document.execCommand("copy"),document.body.removeChild(t)}}(n),t.value=2,setTimeout(()=>t.value=0,1e3)}catch(e){t.value=0}}return(o,a)=>((0,x.uX)(),(0,x.CE)("button",{type:"button",class:(0,x.C4)(["btn nowrap",e.class]),onClick:n,disabled:e.disabled||1==t.value},[(0,x.Lk)("i",{class:(0,x.C4)(["fa-solid fa-clipboard","fa-spin fa-solid fa-spinner","fa-solid fa-check"][t.value])},null,2),a[0]||(a[0]=(0,x.eW)(" ",-1)),(0,x.RG)(o.$slots,"default")],10,tt))}}),to=["disabled"],ta=(0,x.pM)({__name:"shareButton",setup(e){let t=(0,x.IJ)(!1);async function n(){if(gtag("event","fen_img_share"),B._K.canSharePng){let e=[new File([await (0,S.qW)()],"board.png",{type:"image/png"})];navigator.share({files:e})}else{t.value=!0;try{let e=await te.copyUrl();navigator.share({url:e,text:e9()})}finally{t.value&&(t.value=!1)}}}return(e,o)=>(0,x.R1)(L.h5).envReady&&(0,x.R1)(B._K).canShare?((0,x.uX)(),(0,x.CE)("button",{key:0,class:"btn btn-primary",disabled:t.value,onClick:n},[(0,x.Lk)("i",{class:(0,x.C4)(t.value?"fa-spin fa-solid fa-spinner":"fa-solid fa-share-nodes")},null,2),o[0]||(o[0]=(0,x.eW)(" Share image ",-1))],8,to)):(0,x.Q3)("",!0)}}),tl={class:"mb-3 btn-gap"},tr={class:"d-inline-block"},ts=["disabled"],ti=["disabled"],tc={class:"btn-group"},tu=["disabled"],td=["disabled"],tp=["disabled"],tf=["disabled"],th={class:"btn-group"},tm=["disabled"],ty=["disabled"],tb=["disabled"],tg=["disabled"],tk={class:"btn-group"},tw=["disabled"],tv=["disabled"],tR={key:0,class:"fa-solid fa-chess-king fa-fw shadow-neutral",style:{color:"gray"}},tx=["disabled"],tL={class:"btn-group"},tC=["disabled"],t_=["disabled"],tE=["disabled"],tS={class:"text-end btn-gap"},tM={class:"d-inline-block"},tB={class:"d-inline-block"},tA={key:0,class:"mt-3 d-none d-md-block text-end"},tP={class:"d-inline-block"},tN={class:"form-check form-switch"},tF=(0,x.pM)({__name:"edit",setup(e){function t(e,t){(0,M.TV)(!0);let{w:n,h:o}=L.M_.board;(0,C.HC)((0,W.BN)((0,C.$p)(),e,t,n,o))}function n(e){(0,M.TV)(!0);let{w:t,h:n}=L.M_.board;(0,C.HC)((0,W.e7)((0,C.$p)(),e,t,n))}function o(e){(0,M.TV)(!0);let{w:t,h:n}=L.M_.board;t!==n&&(0,_.qN)({w:n,h:t}),(0,C.HC)((0,W.e$)((0,C.$p)(),e,t,n))}function a(){gtag("event","img_save")}return(e,l)=>((0,x.uX)(),(0,x.CE)("section",{class:(0,x.C4)({show:0==(0,x.R1)(L.wk).tab})},[(0,x.Lk)("div",tl,[(0,x.Lk)("span",tr,[(0,x.Lk)("button",{type:"button",class:"btn btn-secondary",onClick:l[0]||(l[0]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,x.R1)(C.YC).empty&&(0,x.R1)(C.YC).empty(...t)}),disabled:(0,x.R1)(L.Sl)(),title:"Empty board"},[...l[17]||(l[17]=[(0,x.Lk)("i",{class:"fa-solid fa-trash-can"},null,-1),(0,x.Lk)("span",null," Empty board",-1)])],8,ts),(0,x.Lk)("button",{type:"button",class:"btn btn-secondary",onClick:l[1]||(l[1]=e=>(0,x.R1)(C.YC).reset()),disabled:(0,x.R1)(L.Sl)(),title:"Starting position"},[...l[18]||(l[18]=[(0,x.Lk)("i",{class:"fa-solid fa-flag-checkered"},null,-1),(0,x.Lk)("span",null," Starting position",-1)])],8,ti)]),(0,x.Lk)("span",tc,[(0,x.Lk)("button",{type:"button",class:"btn btn-secondary",title:"Shift leftwards",onClick:l[2]||(l[2]=e=>t(-1,0)),disabled:(0,x.R1)(L.Sl)()},[...l[19]||(l[19]=[(0,x.Lk)("i",{class:"fa-solid fa-arrow-left"},null,-1)])],8,tu),(0,x.Lk)("button",{type:"button",class:"btn btn-secondary",title:"Shift rightwards",onClick:l[3]||(l[3]=e=>t(1,0)),disabled:(0,x.R1)(L.Sl)()},[...l[20]||(l[20]=[(0,x.Lk)("i",{class:"fa-solid fa-arrow-right"},null,-1)])],8,td),(0,x.Lk)("button",{type:"button",class:"btn btn-secondary",title:"Shift upwards",onClick:l[4]||(l[4]=e=>t(0,-1)),disabled:(0,x.R1)(L.Sl)()},[...l[21]||(l[21]=[(0,x.Lk)("i",{class:"fa-solid fa-arrow-up"},null,-1)])],8,tp),(0,x.Lk)("button",{type:"button",class:"btn btn-secondary",title:"Shift downwards",onClick:l[5]||(l[5]=e=>t(0,1)),disabled:(0,x.R1)(L.Sl)()},[...l[22]||(l[22]=[(0,x.Lk)("i",{class:"fa-solid fa-arrow-down"},null,-1)])],8,tf)]),(0,x.Lk)("span",th,[(0,x.Lk)("button",{type:"button",class:"btn btn-secondary",title:"Rotate counterclockwise",onClick:l[6]||(l[6]=e=>o(-1)),disabled:(0,x.R1)(L.Sl)()},[...l[23]||(l[23]=[(0,x.Lk)("i",{class:"fa-solid fa-rotate-left"},null,-1)])],8,tm),(0,x.Lk)("button",{type:"button",class:"btn btn-secondary",title:"Rotate clockwise",onClick:l[7]||(l[7]=e=>o(1)),disabled:(0,x.R1)(L.Sl)()},[...l[24]||(l[24]=[(0,x.Lk)("i",{class:"fa-solid fa-rotate-right"},null,-1)])],8,ty),(0,x.Lk)("button",{type:"button",class:"btn btn-secondary",title:"Mirror horizontally",onClick:l[8]||(l[8]=e=>n("-")),disabled:(0,x.R1)(L.Sl)()},[...l[25]||(l[25]=[(0,x.Lk)("i",{class:"fa-solid fa-arrows-left-right"},null,-1)])],8,tb),(0,x.Lk)("button",{type:"button",class:"btn btn-secondary",title:"Mirror vertically",onClick:l[9]||(l[9]=e=>n("|")),disabled:(0,x.R1)(L.Sl)()},[...l[26]||(l[26]=[(0,x.Lk)("i",{class:"fa-solid fa-arrows-up-down"},null,-1)])],8,tg)]),(0,x.Lk)("span",tk,[(0,x.Lk)("button",{type:"button",class:"btn btn-secondary px-2",title:"All Black",onClick:l[10]||(l[10]=e=>(0,x.R1)(C.YC).color(-1)),disabled:(0,x.R1)(L.Sl)()},[...l[27]||(l[27]=[(0,x.Lk)("i",{class:"fa-solid fa-chess-king fa-fw text-black shadow-white"},null,-1)])],8,tw),(0,x.Lk)("button",{type:"button",class:"btn btn-secondary px-2",title:"All Neutral",onClick:l[11]||(l[11]=e=>(0,x.R1)(C.YC).color(0)),disabled:(0,x.R1)(L.Sl)()},[(0,x.R1)(L.M_).board.blackWhite?((0,x.uX)(),(0,x.CE)(x.FK,{key:1},[l[28]||(l[28]=(0,x.Lk)("i",{class:"fa-solid fa-chess-king fa-fw text-black shadow-white"},null,-1)),l[29]||(l[29]=(0,x.Lk)("i",{class:"fa-solid fa-chess-king fa-fw text-white shadow-black",style:{"margin-left":"-1.25em","clip-path":"polygon(51.5% 0, 100% 0, 100% 100%, 51.5% 100%)"}},null,-1))],64)):((0,x.uX)(),(0,x.CE)("i",tR))],8,tv),(0,x.Lk)("button",{type:"button",class:"btn btn-secondary px-2",title:"All White",onClick:l[12]||(l[12]=e=>(0,x.R1)(C.YC).color(1)),disabled:(0,x.R1)(L.Sl)()},[...l[30]||(l[30]=[(0,x.Lk)("i",{class:"fa-solid fa-chess-king fa-fw text-white shadow-black"},null,-1)])],8,tx)]),(0,x.Lk)("span",tL,[(0,x.Lk)("button",{type:"button",class:"btn btn-secondary",title:"Switch side",onClick:l[13]||(l[13]=e=>(0,x.R1)(C.YC).invert(!1)),disabled:(0,x.R1)(L.Sl)()},[...l[31]||(l[31]=[(0,x.Lk)("i",{class:"fa-solid fa-chess-king text-black shadow-white"},null,-1),(0,x.eW)(" ",-1),(0,x.Lk)("i",{class:"fa-solid fa-arrows-left-right"},null,-1),(0,x.eW)(" ",-1),(0,x.Lk)("i",{class:"fa-solid fa-chess-king text-white shadow-black"},null,-1)])],8,tC),(0,x.Lk)("button",{type:"button",class:"btn btn-secondary",title:"Switch case (including text)",onClick:l[14]||(l[14]=e=>(0,x.R1)(C.YC).invert(!0)),disabled:(0,x.R1)(L.Sl)()},[...l[32]||(l[32]=[(0,x.eW)(" A ",-1),(0,x.Lk)("i",{class:"fa-solid fa-arrows-left-right"},null,-1),(0,x.eW)(" a ",-1)])],8,t_),(0,x.R1)(L.M_).board.SN?(0,x.Q3)("",!0):((0,x.uX)(),(0,x.CE)("button",{key:0,type:"button",class:"btn btn-secondary",title:"Change all S to N when 'Use S for knight' mode is off",onClick:l[15]||(l[15]=e=>(0,x.R1)(C.YC).fixSN()),disabled:(0,x.R1)(L.Sl)()},[...l[33]||(l[33]=[(0,x.eW)(" S ",-1),(0,x.Lk)("i",{class:"fa-solid fa-arrow-right"},null,-1),(0,x.eW)(" N ",-1)])],8,tE))])]),(0,x.Lk)("div",tS,[(0,x.Lk)("span",tM,[(0,x.R1)(L.M_).feature.janko?((0,x.uX)(),(0,x.Wv)(tn,{key:0,factory:(0,x.R1)(te).copyJanko,class:"btn-primary"},{default:(0,x.k6)(()=>[...l[34]||(l[34]=[(0,x.eW)("Create Janko URL",-1)])]),_:1},8,["factory"])):(0,x.Q3)("",!0),(0,x.R1)(L.h5).envReady&&!(0,x.R1)(B._K).isTouch?((0,x.uX)(),(0,x.Wv)(tn,{key:1,factory:()=>(0,x.R1)(P)((0,x.R1)(S.qW)),class:"btn-primary"},{default:(0,x.k6)(()=>[...l[35]||(l[35]=[(0,x.eW)("Copy image ",-1)])]),_:1},8,["factory"])):(0,x.Q3)("",!0),(0,x.bF)(tn,{factory:(0,x.R1)(te).copyUrl,class:"btn-primary"},{default:(0,x.k6)(()=>[...l[36]||(l[36]=[(0,x.eW)("Create image URL",-1)])]),_:1},8,["factory"])]),(0,x.Lk)("span",tB,[(0,x.bF)(ta),(0,x.Lk)("a",{class:"btn btn-primary",download:"board.png",id:"Save",click:a},[...l[37]||(l[37]=[(0,x.Lk)("i",{class:"fa-solid fa-download"},null,-1),(0,x.eW)(" Save image ",-1)])])])]),(0,x.R1)(L.h5).envReady&&(0,x.R1)(B._K).isTop?((0,x.uX)(),(0,x.CE)("div",tA,[(0,x.Lk)("div",tP,[(0,x.Lk)("div",tN,[(0,x.bo)((0,x.Lk)("input",{class:"form-check-input",type:"checkbox",role:"switch",id:"sSplit","onUpdate:modelValue":l[16]||(l[16]=e=>(0,x.R1)(L.wk).split=e)},null,512),[[x.lH,(0,x.R1)(L.wk).split]]),l[38]||(l[38]=(0,x.Lk)("label",{class:"form-check-label",for:"sSplit"},"Split window",-1))])])])):(0,x.Q3)("",!0)],2))}}),tW={class:"form-check"},tV=["checked","disabled"],tT=(0,x.pM)({__name:"checkbox",props:{modelValue:{type:Boolean},disabled:{type:Boolean}},emits:["update:modelValue","change"],setup(e){let t="chk"+(0,x.nI)().uid;return(n,o)=>((0,x.uX)(),(0,x.CE)("div",tW,[(0,x.Lk)("input",{type:"checkbox",class:"form-check-input",id:t,checked:e.modelValue,onChange:o[0]||(o[0]=t=>{n.$emit("update:modelValue",!e.modelValue),n.$emit("change")}),disabled:e.disabled},null,40,tV),(0,x.Lk)("label",{class:"form-check-label",for:t},[(0,x.RG)(n.$slots,"default")])]))}}),tD={class:"input-group"},tI=["disabled"],tQ=["title","value"],tU=["disabled"],tX=(0,x.pM)({__name:"inputNumber",props:{title:{},min:{},max:{},modelValue:{}},emits:["update:modelValue"],setup(e,t){let{emit:n}=t;function o(t){n("update:modelValue",e.modelValue+t)}return(t,a)=>((0,x.uX)(),(0,x.CE)("div",tD,[(0,x.Lk)("button",{class:"btn btn-secondary px-2",disabled:e.modelValue<=e.min,type:"button",onClick:a[0]||(a[0]=e=>o(-1))},[...a[3]||(a[3]=[(0,x.Lk)("i",{class:"fa-solid fa-minus"},null,-1)])],8,tI),(0,x.Lk)("input",{type:"number",class:"form-control text-center px-0",min:"1",title:e.title,value:e.modelValue,onChange:a[1]||(a[1]=t=>{let o,a,l;return o=t.target,a=e.modelValue,void(isNaN(l=Math.round(Number(o.value)))||l<e.min||void 0!==e.max&&l>e.max?o.value=a.toString():n("update:modelValue",l))}),onfocus:"this.select()"},null,40,tQ),(0,x.Lk)("button",{class:"btn btn-secondary px-2",disabled:void 0!==e.max&&e.modelValue>=e.max,type:"button",onClick:a[2]||(a[2]=e=>o(1))},[...a[4]||(a[4]=[(0,x.Lk)("i",{class:"fa-solid fa-plus"},null,-1)])],8,tU)]))}}),tO={class:"row mb-2"},tj={class:"col flex-grow-1",style:{"flex-basis":"18rem"}},tK={class:"row gx-3"},tz={class:"col",style:{"flex-basis":"15rem"}},tY={class:"row gx-3 mb-2"},t$={class:"col"},tG={class:"col",style:{"flex-basis":"13rem"}},tq={class:"row gx-3 mb-2"},tH={class:"col"},tJ={class:"row gx-3"},tZ={class:"col",style:{"flex-basis":"15rem"}},t0={class:"row gx-3 mb-2"},t1={class:"col"},t2={class:"col",style:{"flex-basis":"16rem"}},t3={class:"row gx-3 mb-2"},t5={class:"col"},t8={class:"col flex-grow-1 mb-2",style:{"flex-basis":"22rem"}},t4={class:"row gx-3"},t6={class:"col",style:{"flex-basis":"22rem"}},t9={class:"row gx-3"},t7={class:"col mb-2",style:{"flex-basis":"14rem","flex-grow":"10000"}},ne={class:"row gx-3"},nt={class:"col"},nn={class:"col"},no={class:"col mb-2 text-end"},na={class:"col",style:{"flex-basis":"14rem"}},nl={class:"row gx-3 mb-2"},nr={class:"col"},ns=["value"],ni={class:"row gx-3 align-items-baseline"},nc={class:"col",style:{"flex-basis":"15rem"}},nu={class:"col",style:{"flex-basis":"15rem"}},nd={class:"row align-items-center"},np={class:"col"},nf={class:"d-none d-md-block"},nh=(0,x.pM)({__name:"options",setup(e){let t=(0,x.IJ)(!1);function n(){(0,_.qN)({},!0)}return(0,x.sV)(()=>setTimeout(()=>t.value=!0,50)),(e,o)=>((0,x.uX)(),(0,x.CE)("section",{class:(0,x.C4)({show:1==(0,x.R1)(L.wk).tab})},[(0,x.Lk)("div",tO,[(0,x.Lk)("div",tj,[(0,x.Lk)("div",tK,[(0,x.Lk)("div",tz,[(0,x.Lk)("div",tY,[o[19]||(o[19]=(0,x.Lk)("label",{class:"col-auto col-form-label"},"Chess set:",-1)),(0,x.Lk)("div",t$,[(0,x.bo)((0,x.Lk)("select",{class:"form-select","onUpdate:modelValue":o[0]||(o[0]=e=>(0,x.R1)(_.PE).set=e)},[...o[18]||(o[18]=[(0,x.Fv)('<option value="1echecs">1Echecs</option><option value="alpha">Alpha</option><option value="goodCompanion">Good Companion</option><option value="kilfiger">Kilfiger</option><option value="merida">Merida</option><option value="mpchess">MPChess</option><option value="skak">Skak</option>',7)])],512),[[x.u1,(0,x.R1)(_.PE).set]])])])]),(0,x.Lk)("div",tG,[(0,x.Lk)("div",tq,[o[21]||(o[21]=(0,x.Lk)("label",{class:"col-auto col-form-label"},"Square size:",-1)),(0,x.Lk)("div",tH,[(0,x.bo)((0,x.Lk)("select",{class:"form-select","onUpdate:modelValue":o[1]||(o[1]=e=>(0,x.R1)(_.PE).size=e)},[...o[20]||(o[20]=[(0,x.Lk)("option",{value:"26"},"26px",-1),(0,x.Lk)("option",{value:"32"},"32px",-1),(0,x.Lk)("option",{value:"38"},"38px",-1),(0,x.Lk)("option",{value:"44"},"44px",-1)])],512),[[x.u1,(0,x.R1)(_.PE).size,void 0,{number:!0}]])])])])]),(0,x.bF)(tT,{class:"mb-2",modelValue:(0,x.R1)(L.M_).board.exHigh,"onUpdate:modelValue":o[2]||(o[2]=e=>(0,x.R1)(L.M_).board.exHigh=e),onChange:(0,x.R1)(S.Fk)},{default:(0,x.k6)(()=>[...o[22]||(o[22]=[(0,x.eW)("Export to high-resolution image ",-1)])]),_:1},8,["modelValue","onChange"]),(0,x.Lk)("div",tJ,[(0,x.Lk)("div",tZ,[(0,x.Lk)("div",t0,[o[24]||(o[24]=(0,x.Lk)("label",{class:"col-auto col-form-label"},"Background:",-1)),(0,x.Lk)("div",t1,[(0,x.bo)((0,x.Lk)("select",{class:"form-select","onUpdate:modelValue":o[3]||(o[3]=e=>(0,x.R1)(L.M_).board.bg=e),onChange:o[4]||(o[4]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,x.R1)(S.pv)&&(0,x.R1)(S.pv)(...t)})},[...o[23]||(o[23]=[(0,x.Lk)("option",{value:void 0},"Default",-1),(0,x.Lk)("option",{value:"gray"},"Gray",-1),(0,x.Lk)("option",{value:"green"},"Green",-1),(0,x.Lk)("option",{value:"classic"},"Classic",-1)])],544),[[x.u1,(0,x.R1)(L.M_).board.bg]])])])]),(0,x.Lk)("div",t2,[(0,x.Lk)("div",t3,[o[26]||(o[26]=(0,x.Lk)("label",{class:"col-auto col-form-label"},"Board pattern:",-1)),(0,x.Lk)("div",t5,[(0,x.bo)((0,x.Lk)("select",{class:"form-select","onUpdate:modelValue":o[5]||(o[5]=e=>(0,x.R1)(L.M_).board.pattern=e),onChange:o[6]||(o[6]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,x.R1)(S.pv)&&(0,x.R1)(S.pv)(...t)})},[...o[25]||(o[25]=[(0,x.Lk)("option",{value:void 0},"Normal",-1),(0,x.Lk)("option",{value:"inverted"},"Inverted",-1),(0,x.Lk)("option",{value:"mono"},"Uncolored",-1)])],544),[[x.u1,(0,x.R1)(L.M_).board.pattern]])])])])])]),(0,x.Lk)("div",t8,[(0,x.Lk)("div",t4,[(0,x.Lk)("div",t6,[(0,x.Lk)("div",t9,[(0,x.Lk)("div",t7,[(0,x.Lk)("div",ne,[(0,x.Lk)("div",nt,[(0,x.bF)(tX,{modelValue:(0,x.R1)(_.PE).width,"onUpdate:modelValue":o[7]||(o[7]=e=>(0,x.R1)(_.PE).width=e),min:1,title:"Files"},null,8,["modelValue"])]),o[27]||(o[27]=(0,x.Lk)("label",{class:"col-auto col-form-label"},"x",-1)),(0,x.Lk)("div",nn,[(0,x.bF)(tX,{modelValue:(0,x.R1)(_.PE).height,"onUpdate:modelValue":o[8]||(o[8]=e=>(0,x.R1)(_.PE).height=e),min:1,title:"Ranks"},null,8,["modelValue"])])])]),(0,x.Lk)("div",no,[(0,x.Lk)("button",{type:"button",class:"btn btn-secondary",onClick:o[9]||(o[9]=e=>(0,x.R1)(_.PE).setDimension({w:8,h:8}))},"Reset")])])]),(0,x.Lk)("div",na,[(0,x.Lk)("div",nl,[o[28]||(o[28]=(0,x.Lk)("label",{class:"col-auto col-form-label"},"Border pattern:",-1)),(0,x.Lk)("div",nr,[(0,x.Lk)("input",{type:"text",placeholder:"Use comma-separated numbers",title:"Use comma-separated numbers",class:"form-control",value:(0,x.R1)(L.M_).board.border,onChange:o[10]||(o[10]=e=>(0,x.R1)(_.PE).setBorder(e.target))},null,40,ns)])])])]),(0,x.bF)(tT,{modelValue:(0,x.R1)(L.M_).board.SN,"onUpdate:modelValue":o[11]||(o[11]=e=>(0,x.R1)(L.M_).board.SN=e),onChange:(0,x.R1)(C.XJ)},{default:(0,x.k6)(()=>[...o[29]||(o[29]=[(0,x.eW)("Use S for knight",-1)])]),_:1},8,["modelValue","onChange"]),(0,x.Lk)("div",ni,[(0,x.Lk)("div",nc,[(0,x.bF)(tT,{modelValue:(0,x.R1)(L.M_).board.blackWhite,"onUpdate:modelValue":o[12]||(o[12]=e=>(0,x.R1)(L.M_).board.blackWhite=e),onChange:(0,x.R1)(S.AI)},{default:(0,x.k6)(()=>[...o[30]||(o[30]=[(0,x.eW)("Black/White neutral piece",-1)])]),_:1},8,["modelValue","onChange"])]),(0,x.bo)((0,x.Lk)("div",nu,[(0,x.Lk)("div",nd,[o[31]||(o[31]=(0,x.Lk)("label",{class:"col-auto col-form-label"},"Knight offset:",-1)),(0,x.Lk)("div",np,[(0,x.bo)((0,x.Lk)("input",{type:"range",class:"form-range",min:"0.25",max:"0.75",step:"0.025","onUpdate:modelValue":o[13]||(o[13]=e=>(0,x.R1)(L.M_).board.knightOffset=e),onInput:o[14]||(o[14]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,x.R1)(S.AI)&&(0,x.R1)(S.AI)(...t)})},null,544),[[x.Jo,(0,x.R1)(L.M_).board.knightOffset,void 0,{number:!0}]])])])],512),[[x.aG,t.value&&(0,x.R1)(L.M_).board.blackWhite]])]),(0,x.Lk)("div",nf,[(0,x.bF)(tT,{modelValue:(0,x.R1)(L.M_).board.collapse,"onUpdate:modelValue":o[15]||(o[15]=e=>(0,x.R1)(L.M_).board.collapse=e),onChange:(0,x.R1)(_.XR)},{default:(0,x.k6)(()=>[...o[32]||(o[32]=[(0,x.eW)("Always collapse boards",-1)])]),_:1},8,["modelValue","onChange"])]),(0,x.bF)(tT,{modelValue:(0,x.R1)(L.M_).board.coordinates,"onUpdate:modelValue":o[16]||(o[16]=e=>(0,x.R1)(L.M_).board.coordinates=e),onChange:n},{default:(0,x.k6)(()=>[...o[33]||(o[33]=[(0,x.eW)("Show coordinate labels",-1)])]),_:1},8,["modelValue"]),(0,x.bF)(tT,{modelValue:(0,x.R1)(L.M_).board.fullFEN,"onUpdate:modelValue":o[17]||(o[17]=e=>(0,x.R1)(L.M_).board.fullFEN=e),onChange:(0,x.R1)(C.fh)},{default:(0,x.k6)(()=>[...o[34]||(o[34]=[(0,x.eW)("Show full FEN",-1)])]),_:1},8,["modelValue","onChange"])])])],2))}}),nm={class:"me-3"},ny=["checked","disabled","onChange","id"],nb=["for","textContent"],ng=(0,x.pM)({__name:"radio",props:{label:{},text:{},value:{},modelValue:{},disabled:{type:Boolean}},emits:["update:modelValue"],setup(e,t){let{emit:n}=t,o="rdo"+(0,x.nI)().uid;return(t,a)=>((0,x.uX)(),(0,x.CE)(x.FK,null,[(0,x.Lk)("span",nm,(0,x.v_)(e.label),1),((0,x.uX)(!0),(0,x.CE)(x.FK,null,(0,x.pI)(e.text,(t,a)=>((0,x.uX)(),(0,x.CE)("div",{class:"form-check d-inline-block me-3",key:a},[(0,x.Lk)("input",{class:"form-check-input",type:"radio",checked:e.modelValue===e.value[a],disabled:e.disabled,onChange:t=>{n("update:modelValue",e.value[a])},name:o,id:o+"_"+a},null,40,ny),(0,x.Lk)("label",{class:"form-check-label",for:o+"_"+a,textContent:(0,x.v_)(t)},null,8,nb)]))),128))],64))}});var nk=n(940);let nw={key:0},nv={class:"mb-3"},nR={class:"btn-gap"},nx=["disabled"],nL=["disabled"],nC=["disabled"],n_=["disabled"],nE={key:0,class:"btn-gap"},nS={key:0},nM={key:0},nB={key:1},nA={key:1,class:"ms-2"},nP={key:2,class:"ms-2"},nN=["onClick"],nF={key:0},nW={key:1},nV={class:"btn-gap"},nT={class:"mt-2"},nD={class:"form-check d-inline-block me-3"},nI=["checked"],nQ={class:"form-check d-inline-block me-3"},nU=["checked"],nX={class:"form-check d-inline-block"},nO=["checked"],nj={key:0,class:"mt-2"},nK={class:"mt-2"},nz={key:1,class:"mt-2"},nY={class:"btn-gap"},n$=["disabled"],nG=["disabled"],nq=["disabled"],nH={class:"mt-2 gx-3 row"},nJ={class:"col flex-grow-1",style:{"flex-basis":"22rem"}},nZ={class:"d-flex align-items-center flex-wrap-reverse mb-2"},n0={class:"flex-grow-1 col-form-label",style:{"flex-basis":"max-content"}},n1={class:"flex-grow-1",style:{"flex-basis":"max-content"}},n2={class:"row gx-3"},n3={class:"col"},n5={class:"mb-2"},n8={class:"d-inline-block"},n4={class:"d-inline-block"},n6={class:"col flex-grow-1",style:{"flex-basis":"22rem"}},n9={class:"row gx-3 mb-2"},n7={class:"col"},oe=["disabled"],ot={class:"row gx-3"},on={class:"col mb-2",style:{"flex-basis":"10.5rem"}},oo={class:"row gx-3"},oa={class:"col"},ol=["disabled"],or={class:"col mb-2",style:{"flex-basis":"10.5rem"}},os={class:"row gx-3"},oi={class:"col"},oc=["disabled"],ou={class:"text-end"},od=(0,x.pM)({__name:"play",setup(e){let t=()=>L.wk.play.mode==V.ey.retro,n=()=>L.wk.play.moveNumber<0,o=()=>L.wk.play.moveNumber>=L.wk.play.history.length-1;return(e,a)=>((0,x.uX)(),(0,x.CE)("section",{class:(0,x.C4)({show:6==(0,x.R1)(L.wk).tab})},[(0,x.R1)(L.wk).play.playing?((0,x.uX)(),(0,x.CE)("div",nw,[(0,x.Lk)("div",nv,[(0,x.Lk)("span",nR,[(0,x.Lk)("button",{type:"button",class:"py-0 btn btn-secondary",onClick:a[0]||(a[0]=e=>(0,x.R1)(G).move(-1)),disabled:n()},[...a[27]||(a[27]=[(0,x.Lk)("i",{class:"fa-solid fa-angles-left fa-fw"},null,-1)])],8,nx),(0,x.Lk)("button",{type:"button",class:"py-0 btn btn-secondary",onClick:a[1]||(a[1]=e=>(0,x.R1)(G).moveBy(-1)),disabled:n()},[...a[28]||(a[28]=[(0,x.Lk)("i",{class:"fa-solid fa-angle-left fa-fw"},null,-1)])],8,nL),(0,x.Lk)("button",{type:"button",class:"py-0 btn btn-secondary",onClick:a[2]||(a[2]=e=>(0,x.R1)(G).moveBy(1)),disabled:o()},[...a[29]||(a[29]=[(0,x.Lk)("i",{class:"fa-solid fa-angle-right fa-fw"},null,-1)])],8,nC),(0,x.Lk)("button",{type:"button",class:"py-0 btn btn-secondary",onClick:a[3]||(a[3]=e=>(0,x.R1)(G).move((0,x.R1)(L.wk).play.history.length-1)),disabled:o()},[...a[30]||(a[30]=[(0,x.Lk)("i",{class:"fa-solid fa-angles-right fa-fw"},null,-1)])],8,n_)]),(0,x.Lk)("span",null,[(0,x.Lk)("span",{class:(0,x.C4)(["btn step px-1 py-0 ms-3",{active:-1==(0,x.R1)(L.wk).play.moveNumber}]),onClick:a[4]||(a[4]=e=>(0,x.R1)(G).goto())},"*",2)]),(0,x.R1)(L.h5).module.chess?((0,x.uX)(),(0,x.CE)("span",nE,[((0,x.uX)(!0),(0,x.CE)(x.FK,null,(0,x.pI)((0,x.R1)(L.wk).play.history,(e,t)=>((0,x.uX)(),(0,x.CE)("span",{key:t},[(0,x.R1)(L.wk).play.history[t-1]&&(0,x.R1)(L.wk).play.history[t-1].color==e.color?((0,x.uX)(),(0,x.CE)("span",nS,[e.color==(0,x.R1)(V.Q1).white?((0,x.uX)(),(0,x.CE)("span",nM," ... ")):((0,x.uX)(),(0,x.CE)("span",nB,(0,x.v_)((0,x.R1)(G).number(e))+"...",1))])):(0,x.Q3)("",!0),e.color==(0,x.R1)(V.Q1).black&&0==t?((0,x.uX)(),(0,x.CE)("span",nA,(0,x.v_)((0,x.R1)(G).number(e))+"...",1)):(0,x.Q3)("",!0),e.color==(0,x.R1)(V.Q1).white?((0,x.uX)(),(0,x.CE)("span",nP,(0,x.v_)((0,x.R1)(G).number(e))+".",1)):(0,x.Q3)("",!0),(0,x.Lk)("span",{class:(0,x.C4)(["btn step px-1 py-0",{active:t==(0,x.R1)(L.wk).play.moveNumber}]),onClick:e=>(0,x.R1)(G).move(t)},(0,x.v_)((0,x.R1)(G).format(e)),11,nN)]))),128)),(0,x.R1)(L.wk).play.mode!=(0,x.R1)(V.ey).retro?((0,x.uX)(),(0,x.CE)(x.FK,{key:0},[(0,x.R1)(L.wk).play.over==(0,x.R1)(nk.A).checkmate?((0,x.uX)(),(0,x.CE)("span",nF,"Checkmate.")):(0,x.Q3)("",!0),(0,x.R1)(L.wk).play.over==(0,x.R1)(nk.A).draw?((0,x.uX)(),(0,x.CE)("span",nW,"Draw.")):(0,x.Q3)("",!0)],64)):(0,x.Q3)("",!0)])):(0,x.Q3)("",!0)]),(0,x.Lk)("div",nV,[(0,x.Lk)("button",{class:"btn btn-secondary",onClick:a[5]||(a[5]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,x.R1)(G).exit&&(0,x.R1)(G).exit(...t)})}," Exit playing "),(0,x.bF)(tn,{factory:(0,x.R1)(G).copyGame,class:"btn-primary"},{default:(0,x.k6)(()=>[...a[31]||(a[31]=[(0,x.eW)(" Copy game ",-1)])]),_:1},8,["factory"]),(0,x.bF)(tn,{factory:(0,x.R1)(G).copyPGN,class:"btn-primary"},{default:(0,x.k6)(()=>[...a[32]||(a[32]=[(0,x.eW)(" Copy PGN ",-1)])]),_:1},8,["factory"]),(0,x.R1)(B._K).canPaste?((0,x.uX)(),(0,x.CE)("button",{key:0,class:"btn btn-secondary",onClick:a[6]||(a[6]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,x.R1)(G).pasteMoves&&(0,x.R1)(G).pasteMoves(...t)})},[...a[33]||(a[33]=[(0,x.Lk)("i",{class:"fa-solid fa-paste"},null,-1),(0,x.eW)(" Paste moves ",-1)])])):(0,x.Q3)("",!0)]),(0,x.Lk)("div",nT,[a[37]||(a[37]=(0,x.Lk)("span",{class:"me-3"},"Symbol:",-1)),(0,x.Lk)("div",nD,[(0,x.Lk)("input",{class:"form-check-input",type:"radio",checked:null==(0,x.R1)(L.M_).PLAY.symbol,onChange:a[7]||(a[7]=e=>(0,x.R1)(L.M_).PLAY.symbol=null),name:"SYM",id:"sEng"},null,40,nI),a[34]||(a[34]=(0,x.Lk)("label",{class:"form-check-label",for:"sEng"}," English ",-1))]),(0,x.Lk)("div",nQ,[(0,x.Lk)("input",{class:"form-check-input",type:"radio",checked:"german"==(0,x.R1)(L.M_).PLAY.symbol,onChange:a[8]||(a[8]=e=>(0,x.R1)(L.M_).PLAY.symbol="german"),name:"SYM",id:"sGer"},null,40,nU),a[35]||(a[35]=(0,x.Lk)("label",{class:"form-check-label",for:"sGer"}," German ",-1))]),(0,x.Lk)("div",nX,[(0,x.Lk)("input",{class:"form-check-input",type:"radio",checked:"unicode"==(0,x.R1)(L.M_).PLAY.symbol,onChange:a[9]||(a[9]=e=>(0,x.R1)(L.M_).PLAY.symbol="unicode"),name:"SYM",id:"sUni"},null,40,nO),a[36]||(a[36]=(0,x.Lk)("label",{class:"form-check-label",for:"sUni"}," Unicode ",-1))])]),t()?(0,x.Q3)("",!0):((0,x.uX)(),(0,x.CE)("div",nj,[(0,x.bF)(tT,{modelValue:(0,x.R1)(L.M_).PLAY.ep,"onUpdate:modelValue":a[10]||(a[10]=e=>(0,x.R1)(L.M_).PLAY.ep=e)},{default:(0,x.k6)(()=>[...a[38]||(a[38]=[(0,x.eW)("Add ep to en passant moves",-1)])]),_:1},8,["modelValue"])])),(0,x.Lk)("div",nK,[(0,x.bF)(tT,{modelValue:(0,x.R1)(L.M_).PLAY.zero,"onUpdate:modelValue":a[11]||(a[11]=e=>(0,x.R1)(L.M_).PLAY.zero=e)},{default:(0,x.k6)(()=>[...a[39]||(a[39]=[(0,x.eW)("Use number 0 for castling notation",-1)])]),_:1},8,["modelValue"])]),t()?((0,x.uX)(),(0,x.CE)("div",nz,[(0,x.bF)(tT,{modelValue:(0,x.R1)(L.M_).PLAY.negative,"onUpdate:modelValue":a[12]||(a[12]=e=>(0,x.R1)(L.M_).PLAY.negative=e)},{default:(0,x.k6)(()=>[...a[40]||(a[40]=[(0,x.eW)("Use negative numbers in retro mode",-1)])]),_:1},8,["modelValue"])])):(0,x.Q3)("",!0)])):((0,x.uX)(),(0,x.CE)(x.FK,{key:1},[(0,x.Lk)("div",nY,[(0,x.Lk)("button",{class:"btn btn-primary",onClick:a[13]||(a[13]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,x.R1)(G).start&&(0,x.R1)(G).start(...t)}),disabled:(0,x.R1)(L.wk).popeye.playing},"Start playing",8,n$),(0,x.Lk)("button",{type:"button",class:"btn btn-secondary",onClick:a[14]||(a[14]=e=>(0,x.R1)(C.YC).reset(!0)),disabled:(0,x.R1)(L.wk).popeye.playing},[...a[41]||(a[41]=[(0,x.Lk)("i",{class:"fa-solid fa-flag-checkered"},null,-1),(0,x.eW)("  Starting position ",-1)])],8,nG),(0,x.Lk)("button",{class:"btn btn-secondary",onClick:a[15]||(a[15]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,x.R1)(G).pasteGame&&(0,x.R1)(G).pasteGame(...t)}),disabled:(0,x.R1)(L.wk).popeye.playing},[...a[42]||(a[42]=[(0,x.Lk)("i",{class:"fa-solid fa-paste"},null,-1),(0,x.eW)(" Paste PGN ",-1)])],8,nq)]),(0,x.Lk)("div",nH,[(0,x.Lk)("div",nJ,[(0,x.Lk)("div",nZ,[(0,x.Lk)("div",n0,[(0,x.bF)(ng,{modelValue:(0,x.R1)(L.wk).play.turn,"onUpdate:modelValue":a[16]||(a[16]=e=>(0,x.R1)(L.wk).play.turn=e),label:"Turn:",text:["White","Black"],value:["w","b"],disabled:(0,x.R1)(L.wk).play.mode==(0,x.R1)(V.ey).pass},null,8,["modelValue","disabled"])]),(0,x.Lk)("div",n1,[(0,x.Lk)("div",n2,[a[44]||(a[44]=(0,x.Lk)("label",{class:"col-auto col-form-label"},"Mode:",-1)),(0,x.Lk)("div",n3,[(0,x.bo)((0,x.Lk)("select",{class:"form-select","onUpdate:modelValue":a[17]||(a[17]=e=>(0,x.R1)(L.wk).play.mode=e),onChange:a[18]||(a[18]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,x.R1)(S.pv)&&(0,x.R1)(S.pv)(...t)})},[...a[43]||(a[43]=[(0,x.Lk)("option",{value:"normal"},"Normal",-1),(0,x.Lk)("option",{value:"pass"},"Allow passing move",-1),(0,x.Lk)("option",{value:"retro"},"Retro",-1)])],544),[[x.u1,(0,x.R1)(L.wk).play.mode]])])])])]),(0,x.Lk)("div",n5,[a[49]||(a[49]=(0,x.eW)(" Castling: ",-1)),(0,x.Lk)("span",n8,[(0,x.bF)(tT,{class:"ms-2 d-inline-block",modelValue:(0,x.R1)(L.wk).play.castle.K,"onUpdate:modelValue":a[19]||(a[19]=e=>(0,x.R1)(L.wk).play.castle.K=e),disabled:t()},{default:(0,x.k6)(()=>[...a[45]||(a[45]=[(0,x.eW)("WK",-1)])]),_:1},8,["modelValue","disabled"]),(0,x.bF)(tT,{class:"ms-2 d-inline-block",modelValue:(0,x.R1)(L.wk).play.castle.Q,"onUpdate:modelValue":a[20]||(a[20]=e=>(0,x.R1)(L.wk).play.castle.Q=e),disabled:t()},{default:(0,x.k6)(()=>[...a[46]||(a[46]=[(0,x.eW)("WQ",-1)])]),_:1},8,["modelValue","disabled"])]),(0,x.Lk)("span",n4,[(0,x.bF)(tT,{class:"ms-2 d-inline-block",modelValue:(0,x.R1)(L.wk).play.castle.k,"onUpdate:modelValue":a[21]||(a[21]=e=>(0,x.R1)(L.wk).play.castle.k=e),disabled:t()},{default:(0,x.k6)(()=>[...a[47]||(a[47]=[(0,x.eW)("BK",-1)])]),_:1},8,["modelValue","disabled"]),(0,x.bF)(tT,{class:"ms-2 d-inline-block",modelValue:(0,x.R1)(L.wk).play.castle.q,"onUpdate:modelValue":a[22]||(a[22]=e=>(0,x.R1)(L.wk).play.castle.q=e),disabled:t()},{default:(0,x.k6)(()=>[...a[48]||(a[48]=[(0,x.eW)("BQ",-1)])]),_:1},8,["modelValue","disabled"])])])]),(0,x.Lk)("div",n6,[(0,x.Lk)("div",n9,[a[50]||(a[50]=(0,x.Lk)("label",{class:"col-auto col-form-label"},"En passant square: ",-1)),(0,x.Lk)("div",n7,[(0,x.bo)((0,x.Lk)("input",{type:"text",class:"form-control",maxlength:"2","onUpdate:modelValue":a[23]||(a[23]=e=>(0,x.R1)(L.wk).play.enPassant=e),disabled:t()},null,8,oe),[[x.Jo,(0,x.R1)(L.wk).play.enPassant]])])]),(0,x.Lk)("div",ot,[(0,x.Lk)("div",on,[(0,x.Lk)("div",oo,[a[51]||(a[51]=(0,x.Lk)("label",{class:"col-auto col-form-label"},"Half moves: ",-1)),(0,x.Lk)("div",oa,[(0,x.bo)((0,x.Lk)("input",{type:"number",class:"form-control",min:"0","onUpdate:modelValue":a[24]||(a[24]=e=>(0,x.R1)(L.wk).play.halfMove=e),disabled:t()},null,8,ol),[[x.Jo,(0,x.R1)(L.wk).play.halfMove,void 0,{number:!0}]])])])]),(0,x.Lk)("div",or,[(0,x.Lk)("div",os,[a[52]||(a[52]=(0,x.Lk)("label",{class:"col-auto col-form-label"},"Full moves: ",-1)),(0,x.Lk)("div",oi,[(0,x.bo)((0,x.Lk)("input",{type:"number",class:"form-control",min:"1","onUpdate:modelValue":a[25]||(a[25]=e=>(0,x.R1)(L.wk).play.fullMove=e),disabled:t()},null,8,oc),[[x.Jo,(0,x.R1)(L.wk).play.fullMove,void 0,{number:!0}]])])])])]),(0,x.Lk)("div",ou,[(0,x.Lk)("button",{class:"btn btn-secondary",onClick:a[26]||(a[26]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,x.R1)(C.IF)&&(0,x.R1)(C.IF)(...t)})},"Reset settings")])])])],64))],2))}}),op=(0,x.IJ)(""),of={async fetch(e){try{gtag("event","fen_pdb_get"),e.disabled=!0,e.value="Fetching...";let t=oh+encodeURIComponent("PROBID='".concat(op.value,"'")),n=await fetch("https://corsproxy.io/?"+t),o=await n.text();(0,C.w3)(o.match(/<b>FEN:<\/b> (.+)/)[1],!0)}catch{(0,A.x)("An error has occurred. Please try again later.")}finally{e.disabled=!1,e.value="Get FEN"}},search(){gtag("event","fen_pdb_search"),window.open(oh+encodeURIComponent(ob()))},copyQuery:()=>(gtag("event","fen_pdb_copy"),ob()),copyEdit:()=>(gtag("event","fen_pdb_copyEdit"),function(){let e={},{w:t,h:n}=L.M_.board;for(let o=0;o<n;o++)for(let n=0;n<t;n++){let a,l=C.pT[o*t+n].value,r=l.match(/^(-?)(?:\*(\d))?([kqbsnrpxc])$/i);if(r){if("x"==r[3])a="sY";else{let e=om[F.g.indexOf(r[3].toLowerCase().replace("s","n"))];a=(r[1]?"n":og(l))+e+oy[Number(r[2]||0)]}e[a]=(e[a]||"")+(0,W.Lw)(o,n)}}let o=[];for(let t in e)o.push(t+e[t]);return o.join(" ")}())},oh="https://pdb.dieschwalbe.de/search.jsp?expression=",om=["K","D","L","S","T","B","I"],oy=["","R","U","L"];function ob(){let e=[],{w:t,h:n}=L.M_.board;for(let o=0;o<n;o++)for(let n=0;n<t;n++){let a=C.pT[o*t+n].value;if(!a.match(/^[kqbsnrp]$/i))continue;let l=om[F.g.indexOf(a.toLowerCase().replace("s","n"))],r=og(a);e.push(r+l+(0,W.Lw)(o,n))}let o="POSITION='".concat(e.join(" "),"'");return L.M_.DB.exact&&(o+=" AND APIECES=".concat(e.length)),o}function og(e){return e==e.toLowerCase()?"s":"w"}let ok={copyFEN(){gtag("event","fen_yacpdb_copyFEN");let{w:e,h:t}=L.M_.board,n=C.pT.map(e=>(0,W.lZ)(e.value));return(0,W.KF)(n,e,t)},async fetch(e){try{gtag("event","fen_yacpdb_get"),e.disabled=!0,e.value="Fetching...";let n="https://yacpdb.org/gateway/ql?q="+encodeURIComponent("Id('".concat(op.value,"')")),o=await fetch("https://corsproxy.io/?"+n),a=await o.json();if(a.success){let{w:e,h:n}=L.M_.board,o=a.result.entries[0].algebraic,l=(0,W.mX)(e*n);function t(t){let o=t.charCodeAt(1)-97,a=Number(t[2]);l[(n-a)*e+o]=t[0]}for(let e of o.black)t(e.toLowerCase());for(let e of o.white)t(e);(0,C.w3)((0,W.KF)(l,e,n))}}catch{(0,A.x)("An error has occurred. Please try again later.")}finally{e.disabled=!1,e.value="Get FEN"}},search(){gtag("event","fen_yacpdb_search"),window.open("https://yacpdb.org/#q/"+encodeURIComponent(ow())+"/1")},copyQuery:()=>(gtag("event","fen_yacpdb_copy"),ow()),copyEdit:()=>(gtag("event","fen_yacpdb_copyEdit"),function(){let e={w:[],b:[],n:[]},{w:t,h:n}=L.M_.board;for(let o=0;o<n;o++)for(let n=0;n<t;n++){let a=C.pT[o*t+n].value,l=a.match(/^(-?)([kqbsnrp])$/i);if(!l)continue;let r=(0,W.rX)(l[2],!1,!0).toUpperCase();e[l[1]?"n":ov(a)].push(r+(0,W.Lw)(o,n))}let o=[];return e.w.length&&o.push("    white: [".concat(e.w.join(", "),"]")),e.b.length&&o.push("    black: [".concat(e.b.join(", "),"]")),e.n.length&&o.push("    neutral: [".concat(e.n.join(", "),"]")),o.join("\n")}())};function ow(){let e=[],{w:t,h:n}=L.M_.board;for(let o=0;o<n;o++)for(let n=0;n<t;n++){let a=(0,W.lZ)(C.pT[o*t+n].value).replace("(","").replace(")","");a&&(a.match(/\d/)||(a=a.startsWith("!")?"n"+a.toUpperCase():ov(a)+a.toUpperCase(),e.push(a+(0,W.Lw)(o,n))))}let o='MatrixExtended("'.concat(e.join(" "),'", false, false, "None")');return L.M_.DB.exact&&(o+=" AND PCount(*) = "+e.length),o}function ov(e){return e==e.toLowerCase()?"b":"w"}let oR={class:"row gx-3 mb-2 align-items-center"},ox={class:"col"},oL={class:"form-check d-inline-block me-3"},oC=["checked"],o_={class:"form-check d-inline-block"},oE=["checked"],oS={class:"mb-3 btn-gap"},oM={class:"row gx-3 mb-3"},oB={class:"col"},oA=["readonly"],oP={class:"col-auto"},oN=["disabled"],oF={class:"row align-items-center flex-wrap"},oW={class:"col-auto mb-2"},oV={class:"col text-end btn-gap",style:{"flex-basis":"24rem"}},oT=(0,x.pM)({__name:"database",setup(e){let t=(0,x.EW)(()=>"PDB"==L.M_.DB.use?of:ok);return(e,n)=>((0,x.uX)(),(0,x.CE)("section",{class:(0,x.C4)({show:2==(0,x.R1)(L.wk).tab})},[(0,x.Lk)("div",oR,[n[8]||(n[8]=(0,x.Lk)("label",{class:"col-auto col-form-label"},"Use database: ",-1)),(0,x.Lk)("div",ox,[(0,x.Lk)("div",oL,[(0,x.Lk)("input",{class:"form-check-input",type:"radio",checked:"PDB"==(0,x.R1)(L.M_).DB.use,onChange:n[0]||(n[0]=e=>(0,x.R1)(L.M_).DB.use="PDB"),name:"DB",id:"rPDB"},null,40,oC),n[6]||(n[6]=(0,x.Lk)("label",{class:"form-check-label",for:"rPDB"}," PDB ",-1))]),(0,x.Lk)("div",o_,[(0,x.Lk)("input",{class:"form-check-input",type:"radio",checked:"YACPDB"==(0,x.R1)(L.M_).DB.use,onChange:n[1]||(n[1]=e=>(0,x.R1)(L.M_).DB.use="YACPDB"),name:"DB",id:"rYACPDB"},null,40,oE),n[7]||(n[7]=(0,x.Lk)("label",{class:"form-check-label",for:"rYACPDB"}," YACPDB ",-1))])])]),(0,x.Lk)("div",oS,[(0,x.bF)(tn,{factory:t.value.copyEdit,class:"btn-primary"},{default:(0,x.k6)(()=>[...n[9]||(n[9]=[(0,x.eW)(" Copy board edit syntax ",-1)])]),_:1},8,["factory"]),"YACPDB"==(0,x.R1)(L.M_).DB.use?((0,x.uX)(),(0,x.Wv)(tn,{key:0,factory:(0,x.R1)(ok).copyFEN,class:"btn-secondary"},{default:(0,x.k6)(()=>[...n[10]||(n[10]=[(0,x.eW)(" Copy YACPDB FEN ",-1)])]),_:1},8,["factory"])):(0,x.Q3)("",!0)]),(0,x.Lk)("div",oM,[n[11]||(n[11]=(0,x.Lk)("label",{class:"col-auto col-form-label"},"Problem Id:",-1)),(0,x.Lk)("div",oB,[(0,x.bo)((0,x.Lk)("input",{type:"text",class:"form-control","onUpdate:modelValue":n[2]||(n[2]=e=>(0,x.i9)(op)?op.value=e:null),readonly:(0,x.R1)(L.Sl)()||void 0},null,8,oA),[[x.Jo,(0,x.R1)(op)]])]),(0,x.Lk)("div",oP,[(0,x.Lk)("input",{type:"button",class:"btn btn-primary",value:"Get FEN",onClick:n[3]||(n[3]=e=>t.value.fetch(e.target)),disabled:(0,x.R1)(L.Sl)()},null,8,oN)])]),(0,x.Lk)("div",oF,[(0,x.Lk)("div",oW,[(0,x.bF)(tT,{modelValue:(0,x.R1)(L.M_).DB.exact,"onUpdate:modelValue":n[4]||(n[4]=e=>(0,x.R1)(L.M_).DB.exact=e)},{default:(0,x.k6)(()=>[...n[12]||(n[12]=[(0,x.eW)("Search exactly these pieces",-1)])]),_:1},8,["modelValue"])]),(0,x.Lk)("div",oV,[(0,x.bF)(tn,{factory:t.value.copyQuery,class:"btn-secondary"},{default:(0,x.k6)(()=>[...n[13]||(n[13]=[(0,x.eW)(" Copy search query ",-1)])]),_:1},8,["factory"]),(0,x.Lk)("button",{class:"btn btn-primary nowrap",onClick:n[5]||(n[5]=function(){for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];return t.value.search&&t.value.search(...n)})},[...n[14]||(n[14]=[(0,x.Lk)("i",{class:"fa-solid fa-magnifying-glass"},null,-1),(0,x.eW)(" Search position ",-1)])])])])],2))}});var oD=n(8332),oI=n(5582);function oQ(){return n.e("381").then(n.bind(n,552))}function oU(e){try{let t=JSON.parse(e);if("number"!=typeof t.version||!Array.isArray(t.project))throw Error();return t.project}catch{return null}}function oX(e){let t=e.match(/[kqbnrp1-8]{1,8}(?:\/[kqbnrp1-8]{1,8}){7}(?: [wb] (?:-|[kq]{1,4}) (?:-|[a-h][1-8]) \d+ \d+)?/gi);if(!t||!t.length)return null;let n=[];for(let[e,o]of t.entries())n.push((0,oI.l)({fen:o},e));return n}let oO={async reset(){L.M_.project.length&&await (0,A.l)("Are you sure you want to clear all entries?")&&L.M_.project.length&&(L.M_.project=[])},async add(e){if(e){let e=await oQ(),t=L.wk.popeye.input,n=(0,J.qK)(t);t=e.normalizeInput(t,n),L.M_.project.push((0,oI.l)({fen:n.fen,popeye:t}))}else L.M_.project.push((0,oI.l)({fen:C.ro.value}))},remove(e){L.M_.project.splice(e,1)},async open(e){var t;let n=await (t=e,new Promise((e,n)=>{let o=new FileReader;o.onload=t=>e(t.target.result),o.onerror=e=>n(e),o.readAsText(t)}));for(let e of[oU,(await oQ()).parseOliveFormat,oX]){let t=e(n);if(t){L.M_.project=t;return}}(0,A.x)("Unable to parse the file. The format cannot be recognized.")},link:(0,x.IJ)("")};(0,x.nT)(()=>{let e=new Blob([JSON.stringify({version:1,project:L.M_.project})],{type:"application/fen.tool.project+json"}),t=URL.createObjectURL(e);oO.link.value&&URL.revokeObjectURL(oO.link.value),oO.link.value=t});var oj=n(5003);let oK={class:"btn-gap"},oz={class:"btn-group"},oY={class:"dropdown-menu"},o$=["href"],oG={key:0,class:"p-1"},oq=["fen","onClick"],oH=["onClick"],oJ=(0,x.pM)({__name:"project",setup(e){let t=(0,x.IJ)(!1);function n(e){var t;return(null==(t=e.popeye)?void 0:t.includes("Forsyth"))?(0,oj.eK)(e.fen):e.fen}return(e,o)=>((0,x.uX)(),(0,x.CE)("section",{class:(0,x.C4)({show:8==(0,x.R1)(L.wk).tab})},[(0,x.Lk)("input",{type:"file",class:"d-none",id:"project_file",onChange:o[0]||(o[0]=e=>{var t,n;let o;(o=null==(n=(t=e.target).files)?void 0:n[0])&&(t.value="",oO.open(o))}),accept:".fentool,.olv"},null,32),(0,x.Lk)("div",oK,[(0,x.Lk)("div",oz,[(0,x.Lk)("button",{type:"button",class:"btn btn-primary pe-2",onClick:o[1]||(o[1]=e=>(0,x.R1)(oO).add())},[...o[9]||(o[9]=[(0,x.Lk)("i",{class:"fa-solid fa-plus"},null,-1),(0,x.eW)(" Add ",-1)])]),o[10]||(o[10]=(0,x.Lk)("button",{type:"button",class:"ps-2 btn btn-primary dropdown-toggle dropdown-toggle-split","data-bs-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},[(0,x.Lk)("span",{class:"visually-hidden"},"Toggle Dropdown")],-1)),(0,x.Lk)("div",oY,[(0,x.Lk)("div",{class:"dropdown-item",onClick:o[2]||(o[2]=e=>(0,x.R1)(oO).add(!0))},"As a Popeye problem")])]),o[13]||(o[13]=(0,x.Lk)("label",{for:"project_file",class:"btn btn-secondary",title:"Open a project file"},[(0,x.Lk)("i",{class:"fa-regular fa-folder-open"}),(0,x.eW)(" Open ")],-1)),(0,x.Lk)("a",{href:(0,x.R1)(L.h5).envReady?(0,x.R1)(oO).link.value:void 0,download:"project.fentool",class:"btn btn-secondary",title:"Save project file"},[...o[11]||(o[11]=[(0,x.Lk)("i",{class:"fa-solid fa-download"},null,-1),(0,x.eW)(" Save ",-1)])],8,o$),(0,x.Lk)("button",{class:"btn btn-secondary",onClick:o[3]||(o[3]=e=>(0,x.R1)(oO).reset()),title:"Clear all positions in the project"},[...o[12]||(o[12]=[(0,x.Lk)("i",{class:"fa-regular fa-file"},null,-1),(0,x.eW)(" Clear ",-1)])])]),(0,x.R1)(L.h5).envReady?((0,x.uX)(),(0,x.CE)("div",{key:0,onMousedown:o[8]||(o[8]=(0,x.D$)(()=>{},["stop"])),class:"mt-3"},[(0,x.R1)(L.M_).project.length?(0,x.Q3)("",!0):((0,x.uX)(),(0,x.CE)("div",oG,[...o[14]||(o[14]=[(0,x.Lk)("div",{class:"d-flex flex-wrap"},[(0,x.Lk)("div",{style:{"flex-basis":"max-content"}}," No positions in the project yet.\xa0 "),(0,x.Lk)("div",{style:{"flex-basis":"max-content"}},' Click "Add" to add position. ')],-1)])])),(0,x.bF)((0,x.R1)(oD.XM),{axis:"xy",list:(0,x.R1)(L.M_).project,"onUpdate:list":o[5]||(o[5]=e=>(0,x.R1)(L.M_).project=e),distance:10*!(0,x.R1)(B._K).isTouch,class:(0,x.C4)(["thumbnail-container",{sorting:t.value}]),onSortStart:o[6]||(o[6]=e=>t.value=!0),onSortEnd:o[7]||(o[7]=e=>t.value=!1),"press-delay":200*!!(0,x.R1)(B._K).isTouch,"helper-class":"thumbnail-ghost"},{default:(0,x.k6)(()=>[((0,x.uX)(!0),(0,x.CE)(x.FK,null,(0,x.pI)((0,x.R1)(L.M_).project,(e,t)=>((0,x.uX)(),(0,x.Wv)((0,x.R1)(oD.iO),{index:t,key:e.id},{default:(0,x.k6)(()=>[(0,x.Lk)("div",{class:(0,x.C4)(["thumbnail-wrapper",{touch:(0,x.R1)(B._K).isTouch}]),onDragstart:o[4]||(o[4]=(0,x.D$)(()=>{},["prevent"]))},[(0,x.Lk)("img",{fen:n(e),onClick:t=>{!(0,L.Sl)()&&((0,C.w3)(n(e)),e.popeye&&(L.wk.tab=7,L.wk.compute="py",L.wk.popeye.input=e.popeye),B._K.isTouch&&document.body.scrollTo({behavior:"smooth",top:0}))},class:(0,x.C4)(["thumbnail",{disabled:(0,x.R1)(L.Sl)()}])},null,10,oq),(0,x.Lk)("i",{class:"fa-solid fa-circle-xmark text-danger",onClick:e=>(0,x.R1)(oO).remove(t)},null,8,oH)],34)]),_:2},1032,["index"]))),128))]),_:1},8,["list","distance","class","press-delay"])],32)):(0,x.Q3)("",!0)],2))}}),oZ={async copy(){if(8!=L.M_.board.w||8!=L.M_.board.h)throw(0,A.x)("只支援標準棋盤"),Error();return gtag("event","fen_bbs_copy"),(await n.e("438").then(n.bind(n,1041))).generate((0,C.AS)(),e9(),op.value,L.M_.BBS,L.M_.board,B._K.isTouch)}},o0={class:"row gx-3"},o1={class:"col flex-grow-1 mb-3",style:{"flex-basis":"max-content"}},o2={class:"col flex-grow-1 text-end"},o3=(0,x.pM)({__name:"bbs",setup:e=>(e,t)=>(0,x.R1)(L.h5).envReady&&(0,x.R1)(B._K).isTaiwan?((0,x.uX)(),(0,x.CE)("section",{key:0,class:(0,x.C4)({show:4==(0,x.R1)(L.wk).tab})},[(0,x.Lk)("div",o0,[(0,x.Lk)("div",o1,[(0,x.bF)(tT,{modelValue:(0,x.R1)(L.M_).BBS.Id,"onUpdate:modelValue":t[0]||(t[0]=e=>(0,x.R1)(L.M_).BBS.Id=e)},{default:(0,x.k6)(()=>[...t[5]||(t[5]=[(0,x.eW)("Include database Id",-1)])]),_:1},8,["modelValue"]),(0,x.bF)(tT,{modelValue:(0,x.R1)(L.M_).BBS.coordinates,"onUpdate:modelValue":t[1]||(t[1]=e=>(0,x.R1)(L.M_).BBS.coordinates=e)},{default:(0,x.k6)(()=>[...t[6]||(t[6]=[(0,x.eW)("Include Coordinates",-1)])]),_:1},8,["modelValue"]),(0,x.bF)(tT,{modelValue:(0,x.R1)(L.M_).BBS.notes,"onUpdate:modelValue":t[2]||(t[2]=e=>(0,x.R1)(L.M_).BBS.notes=e)},{default:(0,x.k6)(()=>[...t[7]||(t[7]=[(0,x.eW)("Include Notes",-1)])]),_:1},8,["modelValue"]),(0,x.bF)(tT,{modelValue:(0,x.R1)(L.M_).BBS.uncoloredNotes,"onUpdate:modelValue":t[3]||(t[3]=e=>(0,x.R1)(L.M_).BBS.uncoloredNotes=e)},{default:(0,x.k6)(()=>[...t[8]||(t[8]=[(0,x.eW)("Uncolored Note",-1)])]),_:1},8,["modelValue"]),(0,x.bF)(tT,{modelValue:(0,x.R1)(L.M_).BBS.redBlue,"onUpdate:modelValue":t[4]||(t[4]=e=>(0,x.R1)(L.M_).BBS.redBlue=e)},{default:(0,x.k6)(()=>[...t[9]||(t[9]=[(0,x.eW)("Use Red and Blue in BBS Code",-1)])]),_:1},8,["modelValue"])]),(0,x.Lk)("div",o2,[(0,x.bF)(tn,{factory:(0,x.R1)(oZ).copy,class:"btn-primary"},{default:(0,x.k6)(()=>[...t[10]||(t[10]=[(0,x.eW)("Copy BBS Code",-1)])]),_:1},8,["factory"])])])],2)):(0,x.Q3)("",!0)}),o5=["disabled"],o8={class:"mb-3 row gx-2"},o4={class:"col"},o6={class:"w-passive-100"},o9=["disabled"],o7={class:"col-auto text-end"},ae={class:"btn-gap"},at=["disabled"],an={key:1},ao=["title"],aa={key:0},al={class:"mb-3 row"},ar={class:"col"},as={class:"btn-gap"},ai={class:"col-auto text-end"},ac={key:1,class:"mb-3 row"},au={class:"col"},ad={class:"btn-gap"},ap=["disabled"],af=["disabled"],ah=["disabled"],am=["disabled"],ay={class:"col-auto text-end"},ab=["innerHTML"],ag=(0,x.pM)({__name:"popeye",setup:e=>(e,t)=>(0,x.bo)(((0,x.uX)(),(0,x.CE)("div",null,[(0,x.bo)((0,x.Lk)("div",null,[(0,x.bo)((0,x.Lk)("textarea",{class:"form-control mb-2",rows:"5","onUpdate:modelValue":t[0]||(t[0]=e=>(0,x.R1)(L.wk).popeye.input=e),disabled:(0,x.R1)(L.wk).popeye.running,placeholder:"For example:\n=============\nStipulation #2\nOption Variation"},null,8,o5),[[x.Jo,(0,x.R1)(L.wk).popeye.input]]),(0,x.Lk)("div",o8,[(0,x.Lk)("div",o4,[(0,x.Lk)("div",o6,[(0,x.Lk)("button",{type:"button",class:"btn btn-secondary",onClick:t[1]||(t[1]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,x.R1)(J.DB).editMap&&(0,x.R1)(J.DB).editMap(...t)}),disabled:(0,x.R1)(L.wk).popeye.running,style:{overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis","max-width":"100%"}},[...t[15]||(t[15]=[(0,x.Lk)("i",{class:"fa-solid fa-pen-to-square"},null,-1),(0,x.eW)(" Fairy piece mapping ",-1)])],8,o9)])]),(0,x.Lk)("div",o7,[(0,x.Lk)("div",ae,[!(0,x.R1)(L.wk).popeye.running&&(0,x.R1)(L.wk).popeye.output?((0,x.uX)(),(0,x.CE)("button",{key:0,type:"button",class:"btn btn-secondary",onClick:t[2]||(t[2]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,x.R1)(J.DB).play&&(0,x.R1)(J.DB).play(...t)}),disabled:(0,x.R1)(L.wk).popeye.error}," Play solution ",8,at)):(0,x.Q3)("",!0),(0,x.R1)(L.wk).popeye.running?((0,x.uX)(),(0,x.CE)("button",{key:2,type:"button",class:"btn btn-secondary",onClick:t[4]||(t[4]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,x.R1)(J.DB).cancel&&(0,x.R1)(J.DB).cancel(...t)})},[...t[18]||(t[18]=[(0,x.Lk)("i",{class:"fa-solid fa-stop"},null,-1),(0,x.eW)(" Cancel ",-1)])])):((0,x.uX)(),(0,x.CE)("span",an,[(0,x.R1)(L.wk).play.playing||!(0,x.R1)(L.wk).popeye.input.trim()?((0,x.uX)(),(0,x.CE)("button",{key:0,type:"button",class:"btn btn-primary disabled",title:(0,x.R1)(L.wk).play.playing?"Need to exit play mode first":"Input instructions first"},[...t[16]||(t[16]=[(0,x.Lk)("i",{class:"fa-solid fa-play"},null,-1),(0,x.eW)(" Run ",-1)])],8,ao)):((0,x.uX)(),(0,x.CE)("button",{key:1,type:"button",class:"btn btn-primary",onClick:t[3]||(t[3]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,x.R1)(J.DB).run&&(0,x.R1)(J.DB).run(...t)}),title:"Run Popeye on your device!"},[...t[17]||(t[17]=[(0,x.Lk)("i",{class:"fa-solid fa-play"},null,-1),(0,x.eW)(" Run ",-1)])]))]))])])])],512),[[x.aG,!(0,x.R1)(L.wk).popeye.playing&&!(0,x.R1)(L.wk).popeye.editMap]]),!(0,x.R1)(L.wk).popeye.playing&&(0,x.R1)(L.wk).popeye.editMap?((0,x.uX)(),(0,x.CE)("div",aa,[(0,x.bo)((0,x.Lk)("textarea",{class:"form-control mb-2",rows:"5","onUpdate:modelValue":t[5]||(t[5]=e=>(0,x.R1)(L.wk).popeye.mapping=e),placeholder:"Use the format like *2Q=G for each line."},null,512),[[x.Jo,(0,x.R1)(L.wk).popeye.mapping]]),(0,x.Lk)("div",al,[(0,x.Lk)("div",ar,[(0,x.Lk)("div",as,[(0,x.Lk)("button",{type:"button",class:"btn btn-primary",onClick:t[6]||(t[6]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,x.R1)(J.DB).saveMap&&(0,x.R1)(J.DB).saveMap(...t)})}," Save setting "),(0,x.Lk)("button",{type:"button",class:"btn btn-secondary",onClick:t[7]||(t[7]=e=>(0,x.R1)(L.wk).popeye.editMap=!1)}," Cancel ")])]),(0,x.Lk)("div",ai,[(0,x.Lk)("button",{type:"button",class:"btn btn-secondary",onClick:t[8]||(t[8]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,x.R1)(J.DB).resetMap&&(0,x.R1)(J.DB).resetMap(...t)})}," Reset ")])])])):(0,x.Q3)("",!0),(0,x.R1)(L.wk).popeye.playing?((0,x.uX)(),(0,x.CE)("div",ac,[(0,x.Lk)("div",au,[(0,x.Lk)("div",ad,[(0,x.Lk)("button",{type:"button",class:"btn btn-secondary",onClick:t[9]||(t[9]=e=>(0,x.R1)(J.DB).move(0)),disabled:(0,x.R1)(L.wk).popeye.index<=0},[...t[19]||(t[19]=[(0,x.Lk)("i",{class:"fa-solid fa-angles-left fa-fw"},null,-1)])],8,ap),(0,x.Lk)("button",{type:"button",class:"btn btn-secondary",onClick:t[10]||(t[10]=e=>(0,x.R1)(J.DB).moveBy(-1)),disabled:(0,x.R1)(L.wk).popeye.index<=0},[...t[20]||(t[20]=[(0,x.Lk)("i",{class:"fa-solid fa-angle-left fa-fw"},null,-1)])],8,af),(0,x.Lk)("button",{type:"button",class:"btn btn-secondary",onClick:t[11]||(t[11]=e=>(0,x.R1)(J.DB).moveBy(1)),disabled:(0,x.R1)(L.wk).popeye.index>=(0,x.R1)(L.wk).popeye.steps.length-1},[...t[21]||(t[21]=[(0,x.Lk)("i",{class:"fa-solid fa-angle-right fa-fw"},null,-1)])],8,ah),(0,x.Lk)("button",{type:"button",class:"btn btn-secondary",onClick:t[12]||(t[12]=e=>(0,x.R1)(J.DB).move((0,x.R1)(L.wk).popeye.steps.length-1)),disabled:(0,x.R1)(L.wk).popeye.index>=(0,x.R1)(L.wk).popeye.steps.length-1},[...t[22]||(t[22]=[(0,x.Lk)("i",{class:"fa-solid fa-angles-right fa-fw"},null,-1)])],8,am)])]),(0,x.Lk)("div",ay,[(0,x.Lk)("button",{type:"button",class:"btn btn-secondary",onClick:t[13]||(t[13]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,x.R1)(J.DB).exit&&(0,x.R1)(J.DB).exit(...t)})}," Exit playing ")])])):(0,x.Q3)("",!0),(0,x.bo)((0,x.Lk)("div",{id:"Output",class:"form-control",innerHTML:(0,x.R1)(L.wk).popeye.output,onClick:t[14]||(t[14]=e=>(0,x.R1)(J.DB).step(e))},null,8,ab),[[x.aG,(0,x.R1)(L.wk).popeye.output&&7==(0,x.R1)(L.wk).tab]]),t[23]||(t[23]=(0,x.Lk)("div",{class:"mt-2"},[(0,x.Lk)("a",{href:"https://github.com/thomas-maeder/popeye/blob/master/py-engl.txt",target:"_blank"}," Popeye documentation ")],-1))],512)),[[x.aG,"py"==(0,x.R1)(L.wk).compute]])}),ak={key:0},aw={key:1,type:"button",class:"btn btn-primary",disabled:""},av={key:1},aR={key:2},ax={key:0,class:"row align-items-baseline"},aL={class:"col",style:{"flex-basis":"12rem"}},aC={class:"row gx-3 mb-2"},a_={class:"col"},aE={class:"col",style:{"flex-basis":"11rem"}},aS={class:"row gx-3 mb-2"},aM={class:"col"},aB={class:"col mb-2",style:{"flex-basis":"10rem"}},aA={class:"btn-gap"},aP={key:1,disabled:"",class:"btn btn-primary"},aN={class:"mt-3"},aF={key:0},aW={key:0},aV={key:1},aT={key:2},aD={key:3},aI={class:"table"},aQ={class:"align-top"},aU={class:"nowrap"},aX={class:"mt-2"},aO=["onClick"],aj=["textContent"],aK=(0,x.pM)({__name:"stockfish",setup:e=>(e,t)=>(0,x.bo)(((0,x.uX)(),(0,x.CE)("div",null,[(0,x.R1)(L.h5).stockfish.status<(0,x.R1)(V.N8).needReload?((0,x.uX)(),(0,x.CE)("div",ak,[t[8]||(t[8]=(0,x.Lk)("div",{class:"mb-3"},"To use this feature, we need to download Stockfish modules first.",-1)),(0,x.R1)(L.h5).stockfish.status==(0,x.R1)(V.N8).notDownloaded?((0,x.uX)(),(0,x.CE)("button",{key:0,type:"button",class:"btn btn-primary",onClick:t[0]||(t[0]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,x.R1)(eN).download&&(0,x.R1)(eN).download(...t)})},[...t[6]||(t[6]=[(0,x.Lk)("i",{class:"fa-solid fa-download"},null,-1),(0,x.eW)(" Download now! (39.5MB) ",-1)])])):((0,x.uX)(),(0,x.CE)("button",aw,[...t[7]||(t[7]=[(0,x.Lk)("i",{class:"fa-solid fa-download"},null,-1),(0,x.eW)(" Downloading... ",-1),(0,x.Lk)("i",{class:"fa-solid fa-spinner fa-spin"},null,-1)])]))])):(0,x.R1)(L.h5).stockfish.status==(0,x.R1)(V.N8).needReload?((0,x.uX)(),(0,x.CE)("div",av,[...t[9]||(t[9]=[(0,x.Lk)("div",{class:"mb-3"},"Download complete. Please restart FEN Tool.",-1),(0,x.Lk)("button",{type:"button",class:"btn btn-primary",onclick:"location.reload()"},[(0,x.Lk)("i",{class:"fa-solid fa-rotate-right"}),(0,x.eW)(" Restart FEN Tool now ")],-1)])])):((0,x.uX)(),(0,x.CE)("div",aR,[(0,x.R1)(L.h5).stockfish.running<(0,x.R1)(V.y9).running?((0,x.uX)(),(0,x.CE)("div",ax,[(0,x.Lk)("div",aL,[(0,x.Lk)("div",aC,[t[10]||(t[10]=(0,x.Lk)("label",{class:"col-auto col-form-label"},"Depth:",-1)),(0,x.Lk)("div",a_,[(0,x.bF)(tX,{modelValue:(0,x.R1)(L.M_).Stockfish.depth,"onUpdate:modelValue":t[1]||(t[1]=e=>(0,x.R1)(L.M_).Stockfish.depth=e),min:1,title:"Search depth"},null,8,["modelValue"])])])]),(0,x.Lk)("div",aE,[(0,x.Lk)("div",aS,[t[11]||(t[11]=(0,x.Lk)("label",{class:"col-auto col-form-label"},"Lines:",-1)),(0,x.Lk)("div",aM,[(0,x.bF)(tX,{modelValue:(0,x.R1)(L.M_).Stockfish.lines,"onUpdate:modelValue":t[2]||(t[2]=e=>(0,x.R1)(L.M_).Stockfish.lines=e),min:1,title:"Number of lines to search"},null,8,["modelValue"])])])]),(0,x.Lk)("div",aB,[(0,x.bF)(tT,{modelValue:(0,x.R1)(L.M_).Stockfish.study,"onUpdate:modelValue":t[3]||(t[3]=e=>(0,x.R1)(L.M_).Stockfish.study=e),disabled:(0,x.R1)(L.M_).Stockfish.lines<=1},{default:(0,x.k6)(()=>[...t[12]||(t[12]=[(0,x.eW)("Study mode",-1)])]),_:1},8,["modelValue","disabled"])])])):(0,x.Q3)("",!0),(0,x.Lk)("div",aA,[(0,x.R1)(L.h5).stockfish.running?(0,x.R1)(L.h5).stockfish.running==(0,x.R1)(V.y9).starting?((0,x.uX)(),(0,x.CE)("button",aP,[...t[14]||(t[14]=[(0,x.Lk)("i",{class:"fa-solid fa-play"},null,-1),(0,x.eW)(" Initializing... ",-1)])])):((0,x.uX)(),(0,x.CE)("button",{key:2,type:"button",class:"btn btn-secondary",onClick:t[5]||(t[5]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,x.R1)(eN).stop&&(0,x.R1)(eN).stop(...t)})},[...t[15]||(t[15]=[(0,x.Lk)("i",{class:"fa-solid fa-stop"},null,-1),(0,x.eW)(" Stop ",-1)])])):((0,x.uX)(),(0,x.CE)("button",{key:0,type:"button",class:"btn btn-primary",onClick:t[4]||(t[4]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,x.R1)(eN).analyze&&(0,x.R1)(eN).analyze(...t)})},[...t[13]||(t[13]=[(0,x.Lk)("i",{class:"fa-solid fa-play"},null,-1),(0,x.eW)(" Analyze with Stockfish 16 ",-1)])]))]),(0,x.Lk)("div",aN,[(0,x.R1)(L.wk).stockfish.depth?((0,x.uX)(),(0,x.CE)("div",aF,[(0,x.Lk)("span",null,"Depth: "+(0,x.v_)((0,x.R1)(L.wk).stockfish.depth),1),(0,x.R1)(L.h5).stockfish.running==(0,x.R1)(V.y9).running?((0,x.uX)(),(0,x.CE)("span",aW,[(0,x.eW)(" /"+(0,x.v_)((0,x.R1)(L.M_).Stockfish.depth)+" ",1),t[16]||(t[16]=(0,x.Lk)("i",{class:"fa-solid fa-spinner fa-spin ms-2"},null,-1))])):(0,x.Q3)("",!0)])):(0,x.Q3)("",!0),(0,x.R1)(L.wk).stockfish.mate?((0,x.uX)(),(0,x.CE)("div",aV,(0,x.v_)(((0,x.R1)(L.wk).stockfish.mate||"")[0])+" has mate in "+(0,x.v_)(((0,x.R1)(L.wk).stockfish.mate||"")[1])+". ",1)):(0,x.R1)(L.wk).stockfish.score?((0,x.uX)(),(0,x.CE)("div",aT," Score: "+(0,x.v_)((0,x.R1)(L.wk).stockfish.score),1)):(0,x.Q3)("",!0),(0,x.R1)(L.wk).stockfish.header.length?((0,x.uX)(),(0,x.CE)("div",aD,[t[17]||(t[17]=(0,x.eW)(" Solution is unique against best defense up to:",-1)),t[18]||(t[18]=(0,x.Lk)("br",null,null,-1)),(0,x.eW)(" "+(0,x.v_)((0,x.R1)(eN).format((0,x.R1)(L.wk).stockfish.header)),1),t[19]||(t[19]=(0,x.Lk)("br",null,null,-1)),t[20]||(t[20]=(0,x.eW)(" And then: ",-1))])):(0,x.Q3)("",!0),(0,x.Lk)("table",aI,[(0,x.Lk)("tbody",null,[((0,x.uX)(!0),(0,x.CE)(x.FK,null,(0,x.pI)((0,x.R1)(L.wk).stockfish.lines.filter(e=>e&&e.moves.length),e=>((0,x.uX)(),(0,x.CE)("tr",{key:e.pgn},[(0,x.Lk)("td",aQ,[(0,x.Lk)("div",aU,(0,x.v_)(e.score),1),(0,x.Lk)("div",aX,[(0,x.Lk)("button",{type:"button",class:"btn btn-primary px-2 py-0 m-0",title:"Play this line",onClick:t=>(0,x.R1)(eN).play(e)},[...t[21]||(t[21]=[(0,x.Lk)("i",{class:"fa-solid fa-play"},null,-1)])],8,aO)])]),(0,x.Lk)("td",{class:"align-top w-100",textContent:(0,x.v_)((0,x.R1)(eN).format(e.moves))},null,8,aj)]))),128))])])])]))],512)),[[x.aG,"sf"==(0,x.R1)(L.wk).compute]])}),az={class:"mb-3"},aY=["innerHTML"],a$={key:1,class:"mt-3 table"},aG={class:"align-top py-1"},aq=["onClick"],aH={key:0,class:"fa-solid fa-spinner fa-spin ms-2"},aJ=(0,x.pM)({__name:"syzygy",setup:e=>(e,t)=>(0,x.bo)(((0,x.uX)(),(0,x.CE)("div",null,[(0,x.Lk)("div",az,[(0,x.R1)(L.h5).syzygy.running?((0,x.uX)(),(0,x.CE)("button",{key:1,class:"btn btn-secondary me-3",onClick:t[1]||(t[1]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,x.R1)(eO).stop&&(0,x.R1)(eO).stop(...t)})},[...t[3]||(t[3]=[(0,x.Lk)("i",{class:"fa-solid fa-stop"},null,-1),(0,x.eW)(" Stop ",-1)])])):((0,x.uX)(),(0,x.CE)("button",{key:0,type:"button",class:"btn btn-primary",onClick:t[0]||(t[0]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,x.R1)(eO).run&&(0,x.R1)(eO).run(...t)})},[...t[2]||(t[2]=[(0,x.Lk)("i",{class:"fa-solid fa-play"},null,-1),(0,x.eW)(" Analyze with Syzygy tablebase ",-1)])]))]),(0,x.R1)(L.wk).syzygy.header?((0,x.uX)(),(0,x.CE)("div",{key:0,innerHTML:(0,x.R1)(L.wk).syzygy.header},null,8,aY)):(0,x.Q3)("",!0),(0,x.R1)(L.wk).syzygy.lines?((0,x.uX)(),(0,x.CE)("table",a$,[((0,x.uX)(!0),(0,x.CE)(x.FK,null,(0,x.pI)((0,x.R1)(L.wk).syzygy.lines,e=>((0,x.uX)(),(0,x.CE)("tr",{key:e.pgn},[(0,x.Lk)("td",aG,[e.leaf?((0,x.uX)(),(0,x.CE)("button",{key:0,type:"button",class:"btn btn-primary px-2 py-0 m-0",title:"Play this line",onClick:t=>(0,x.R1)(eO).play(e)},[...t[4]||(t[4]=[(0,x.Lk)("i",{class:"fa-solid fa-play"},null,-1)])],8,aq)):(0,x.Q3)("",!0)]),(0,x.Lk)("td",{class:"align-top w-100 py-1",style:(0,x.Tr)("padding-left:".concat(e.indent+.5,"rem"))},[(0,x.eW)((0,x.v_)((0,x.R1)(eO).format(e))+" ",1),e.searching?((0,x.uX)(),(0,x.CE)("i",aH)):(0,x.Q3)("",!0)],4)]))),128))])):(0,x.Q3)("",!0)],512)),[[x.aG,"sy"==(0,x.R1)(L.wk).compute]])}),aZ={class:"mb-3"},a0=(0,x.pM)({__name:"compute",setup:e=>(e,t)=>(0,x.bo)(((0,x.uX)(),(0,x.CE)("section",{class:(0,x.C4)({show:7==(0,x.R1)(L.wk).tab})},[(0,x.Lk)("div",aZ,[(0,x.bF)(ng,{modelValue:(0,x.R1)(L.wk).compute,"onUpdate:modelValue":t[0]||(t[0]=e=>(0,x.R1)(L.wk).compute=e),label:"Tool:",text:["Popeye","Stockfish","Syzygy"],value:["py","sf","sy"]},null,8,["modelValue"])]),(0,x.bF)(ag),(0,x.bF)(aK),(0,x.bF)(aJ)],2)),[[x.aG,7==(0,x.R1)(L.wk).tab]])}),a1={class:"mb-2 btn-gap"},a2={class:"mb-2 btn-gap"},a3={class:"btn-gap"},a5=(0,x.pM)({__name:"api",setup(e){let t=!location.protocol.startsWith("http");return(e,n)=>((0,x.uX)(),(0,x.CE)("section",{class:(0,x.C4)({show:5==(0,x.R1)(L.wk).tab})},[(0,x.Lk)("div",a1,[(0,x.bF)(tn,{factory:(0,x.R1)(te).copyBase64,class:"btn-secondary",disabled:t},{default:(0,x.k6)(()=>[...n[0]||(n[0]=[(0,x.eW)(" Copy base64 link ",-1)])]),_:1},8,["factory"]),(0,x.bF)(tn,{factory:(0,x.R1)(te).copyBase64Img,class:"btn-secondary",disabled:t},{default:(0,x.k6)(()=>[...n[1]||(n[1]=[(0,x.eW)(" Copy base64 <img> code ",-1)])]),_:1},8,["factory"])]),n[6]||(n[6]=(0,x.Lk)("h6",null,"Embed mode",-1)),(0,x.Lk)("div",a2,[(0,x.bF)(tn,{factory:(0,x.R1)(te).copyEmbed,class:"btn-secondary"},{default:(0,x.k6)(()=>[...n[2]||(n[2]=[(0,x.eW)(" Copy embed HTML code ",-1)])]),_:1},8,["factory"]),(0,x.bF)(tn,{factory:(0,x.R1)(te).copyEmbedUrl,class:"btn-secondary"},{default:(0,x.k6)(()=>[...n[3]||(n[3]=[(0,x.eW)(" Copy just the URL ",-1)])]),_:1},8,["factory"])]),n[7]||(n[7]=(0,x.Lk)("h6",null,"SDK mode",-1)),(0,x.Lk)("div",a3,[(0,x.bF)(tn,{factory:(0,x.R1)(te).copySDK,class:"btn-secondary"},{default:(0,x.k6)(()=>[...n[4]||(n[4]=[(0,x.eW)(" Copy SDK script tag ",-1)])]),_:1},8,["factory"]),(0,x.bF)(tn,{factory:(0,x.R1)(te).copyImg,class:"btn-secondary"},{default:(0,x.k6)(()=>[...n[5]||(n[5]=[(0,x.eW)(" Copy SDK <img> code ",-1)])]),_:1},8,["factory"])])],2))}}),a8={class:"d-flex mb-4"},a4=(0,x.pM)({__name:"sections",setup:e=>(e,t)=>((0,x.uX)(),(0,x.CE)("div",a8,[(0,x.bF)(tF),(0,x.bF)(oJ),(0,x.bF)(nh),(0,x.bF)(a5),(0,x.bF)(oT),(0,x.bF)(od),(0,x.bF)(a0),(0,x.bF)(o3)]))}),a6={class:"w-passive-100"},a9={class:"row gx-3 mb-1"},a7={class:"col mb-2",style:{"flex-basis":"15rem","flex-grow":"1000"}},le={class:"col ps-0 mb-2 text-end",style:{"white-space":"nowrap","flex-basis":"max-content"}},lt=["textContent"],ln={key:0,class:"btn-group"},lo=["disabled"],la=(0,x.pM)({__name:"header",setup(e){function t(){gtag("event","fen_copy"),navigator.clipboard.writeText(C.ro.value)}async function n(){gtag("event","fen_paste"),(0,C.w3)(await N(),!0)}return(e,o)=>((0,x.uX)(),(0,x.CE)("header",a6,[(0,x.Lk)("div",a9,[(0,x.Lk)("div",a7,[(0,x.bo)((0,x.Lk)("input",{type:"text",class:"form-control",placeholder:"Enter FEN here","onUpdate:modelValue":o[0]||(o[0]=e=>(0,x.i9)(C.ro)?C.ro.value=e:null),onChange:o[1]||(o[1]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,x.R1)(C.YC).update&&(0,x.R1)(C.YC).update(...t)})},null,544),[[x.Jo,(0,x.R1)(C.ro)]])]),(0,x.Lk)("div",le,[(0,x.Lk)("label",{class:"col-form-label pe-2",textContent:(0,x.v_)((0,x.R1)(L.h5).pieceCount)},null,8,lt),(0,x.R1)(L.h5).envReady&&(0,x.R1)(B._K).canCopy?((0,x.uX)(),(0,x.CE)("div",ln,[(0,x.Lk)("button",{class:"btn btn-secondary",title:"Copy",onClick:t},[...o[2]||(o[2]=[(0,x.Lk)("i",{class:"fa-solid fa-clipboard"},null,-1)])]),(0,x.R1)(B._K).canPaste?((0,x.uX)(),(0,x.CE)("button",{key:0,class:"btn btn-secondary",disabled:(0,x.R1)(L.Sl)(),title:"Paste",onClick:n},[...o[3]||(o[3]=[(0,x.Lk)("i",{class:"fa-solid fa-paste"},null,-1)])],8,lo)):(0,x.Q3)("",!0)])):(0,x.Q3)("",!0)])])]))}}),ll={class:"text-center"},lr={class:"d-inline-block",style:{overflow:"hidden"}},ls={class:"d-inline-block position-relative"},li={id:"Squares"},lc={class:"play-mask"},lu={id:"DragZone",class:"flex-grow-0 pb-4"},ld=(0,x.pM)({__name:"zone",setup:e=>(e,t)=>((0,x.uX)(),(0,x.CE)("div",ll,[(0,x.Lk)("div",lr,[(0,x.Lk)("div",{id:"Zone",class:(0,x.C4)(["d-inline-flex justify-content-center text-center collapse flex-wrap-reverse",{collapse:(0,x.R1)(L.h5).collapse}])},[(0,x.Lk)("div",{id:"EditZone",class:"flex-grow-0 pb-4",style:(0,x.Tr)({textAlign:L.h5.collapse?L.h5.hor?"center":"start":"unset"})},[(0,x.Lk)("div",ls,[t[0]||(t[0]=(0,x.Lk)("canvas",{id:"SN"},null,-1)),(0,x.Lk)("div",li,[(0,x.bo)((0,x.Lk)("div",lc,null,512),[[x.aG,(0,x.R1)(L.Sl)()]])])])],4),(0,x.Lk)("div",lu,[(0,x.Lk)("div",{class:(0,x.C4)(["position-relative d-inline-block",{"mb-3":(0,x.R1)(L.h5).hor}]),style:{"line-height":"0"},role:"application"},[t[2]||(t[2]=(0,x.Lk)("canvas",{id:"CN"},null,-1)),(0,x.Lk)("div",{class:(0,x.C4)(["loader",{show:(0,x.R1)(L.h5).loading}])},[...t[1]||(t[1]=[(0,x.Lk)("div",{class:"h-100 d-flex align-items-center justify-content-center"},[(0,x.Lk)("i",{class:"display-1 fa-solid fa-spinner fa-spin"})],-1)])],2),t[3]||(t[3]=(0,x.Lk)("img",{id:"PV"},null,-1))],2),(0,x.bo)((0,x.Lk)("canvas",{id:"TP",class:(0,x.C4)({"ms-4":!(0,x.R1)(L.h5).hor}),role:"menu"},null,2),[[x.aG,!(0,x.R1)(L.PO)()]])])],2)])]))}),lp={class:"mb-4"},lf=(0,n(9168).default)({},[["render",function(e,t){return(0,x.uX)(),(0,x.CE)("footer",lp,[...t[0]||(t[0]=[(0,x.Fv)('<div class="row small"><div class="col flex-grow-1" style="flex-basis:max-content;"> For more information and API, see <a href="https://github.com/MuTsunTsai/fen-tool" target="_blank">README</a>. </div><div class="col-auto text-end">Copyright \xa9 2023-2025 Mu-Tsun Tsai</div></div><div class="text-center mt-3"><a href="https://www.buymeacoffee.com/mutsuntsai" target="_blank"><img width="235" height="50" src="https://img.buymeacoffee.com/button-api/?text=Buy me a coffee&amp;emoji=☕&amp;slug=mutsuntsai&amp;button_colour=6f431f&amp;font_colour=ffffff&amp;font_family=Lato&amp;outline_colour=ffffff&amp;coffee_colour=FFDD00"></a></div>',2)])])}]]),lh={style:{display:"contents"}},lm={class:"d-flex justify-content-center p-3"},ly={class:"flex-grow-0 text-start",style:{"max-width":"100%"}},lb={class:"w-passive-100"},lg={key:0,src:"."},lk=(0,x.pM)({__name:"app",setup:e=>(e,t)=>((0,x.uX)(),(0,x.CE)("div",lh,[(0,x.Lk)("main",lm,[(0,x.Lk)("div",ly,[(0,x.bF)(la),(0,x.bF)(ld),(0,x.Lk)("div",lb,[(0,x.bF)(e4),(0,x.bF)(a4)]),t[0]||(t[0]=(0,x.Lk)("hr",null,null,-1)),(0,x.bF)(lf)])]),(0,x.bF)(eJ),(0,x.bF)(eZ),(0,x.R1)(L.wk).split?((0,x.uX)(),(0,x.CE)("iframe",lg)):(0,x.Q3)("",!0)]))});(0,eh.T)({getDefault:()=>L.M_.board,getTitle:e=>e}),document.addEventListener("mousedown",e=>{var t;let n=null==(t=document.activeElement)?void 0:t.nodeName.toLowerCase();"input"!=n&&"textarea"!=n&&e.detail>1&&e.preventDefault()},!1),addEventListener("keydown",e=>{var t;if(!L.wk.play.playing&&!L.wk.popeye.playing)return;let n=null==(t=document.activeElement)?void 0:t.nodeName.toLowerCase();if("input"==n||"textarea"==n)return;let o=e.key;("a"==o||"ArrowLeft"==o)&&(e.preventDefault(),L.wk.play.playing?D(-1):J.DB.moveBy(-1)),("d"==o||"ArrowRight"==o)&&(e.preventDefault(),L.wk.play.playing?D(1):J.DB.moveBy(1))}),(0,x.m1)(lk).mount("#app"),L.h5.envReady=!0,(0,L.Bk)(),(0,_.D1)(),E.gf.onmousedown=ed,E.gf.ontouchstart=ed,E.gf.ondragstart=e=>e.preventDefault(),E.gf.onwheel=function(e){if((0,L.Sl)())return;let{w:t,h:n}=L.M_.board,{offset:o,s:a}=(0,L.IQ)(),l=Math.floor((e.offsetX-o.x)/a),r=Math.floor((e.offsetY-o.y)/a);if(ef(l,r,t,n)){let n=C.pT[r*t+l];if(""==n.value)return;e.preventDefault();let o=performance.now();if(o-er<50)return;er=o,eu(n,e.deltaY>0?1:3)}},E.wJ.onmousedown=ed,E.wJ.ontouchstart=ed,document.body.onmousedown=e=>{(0,L.Sl)()||e.target==E.wJ||e.target==E.gf||ei()},document.body.onmousemove=es,document.body.ontouchmove=es,document.body.onmouseleave=ec,document.body.onmouseup=ec,document.body.ontouchend=ec,(0,x.nT)(()=>{document.body.classList.toggle("split",L.wk.split),Promise.resolve().then(()=>(0,_.qN)({}))}),(0,x.nT)(C.cL),(0,B.Jh)()&&(0,A.x)('It seems that you have turned on "privacy.resistFingerprinting" in your browser. FEN Tool would not work properly with this setting.\nPlease add "mutsuntsai.github.io" to "privacy.resistFingerprinting.exemptedDomains" and reload the tool to fix this.')},8041:function(e,t,n){function o(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!(t instanceof Object))return e;for(let l of Object.keys(t)){if(n&&e instanceof Object&&!(l in e))continue;let r=t[l];r instanceof Object?e[l]instanceof Object&&e[l]!=r?e[l]=o(e[l],r,n):e[l]=a(r):e[l]=r}return e}function a(e){return o(Array.isArray(e)?[]:{},e)}n.d(t,{E:()=>o,o:()=>l});let l="function"==typeof structuredClone?structuredClone:a},5109:function(e,t,n){function o(){let e,t=async function(t){return await n,e(t)},n=new Promise(n=>{t.setup=function(t){e=t,n()}});return t}n.d(t,{l:()=>l,x:()=>a});let a=o(),l=o()},3923:function(e,t,n){n.d(t,{BB:()=>a,Nd:()=>i,gf:()=>c,hi:()=>s,w4:()=>l,wJ:()=>r});let o=document.createElement("canvas"),a=document.getElementById("CN")||o,l=document.getElementById("SN")||o,r=document.getElementById("TP")||o,s=document.getElementById("CanvasGhost")||o,i=document.getElementById("TemplateGhost")||o,c=document.getElementById("PV")},227:function(e,t,n){n.d(t,{Lf:()=>k,N8:()=>p,OP:()=>h,Q1:()=>y,Rj:()=>g,ey:()=>b,pL:()=>m,tU:()=>w,y9:()=>f});var o,a,l,r,s,i,c,u,d,p=((o={})[o.notDownloaded=0]="notDownloaded",o[o.downloading=1]="downloading",o[o.needReload=2]="needReload",o[o.ready=3]="ready",o),f=((a={})[a.stop=0]="stop",a[a.starting=1]="starting",a[a.running=2]="running",a),h=((l={})[l.counterclockwise=-1]="counterclockwise",l[l.clockwise=1]="clockwise",l[l.turn=2]="turn",l),m=((r={})[r.r90=1]="r90",r[r.r180=2]="r180",r[r.r270=3]="r270",r[r.full=4]="full",r),y=((s={}).black="b",s.white="w",s.neutral="n",s),b=((i={}).normal="normal",i.pass="pass",i.retro="retro",i),g=((c={})[c.bK=0]="bK",c[c.wK=1]="wK",c[c.nK=2]="nK",c[c.bQ=3]="bQ",c[c.wQ=4]="wQ",c[c.nQ=5]="nQ",c[c.bB=6]="bB",c[c.wB=7]="wB",c[c.nB=8]="nB",c[c.bN=9]="bN",c[c.wN=10]="wN",c[c.nN=11]="nN",c[c.bR=12]="bR",c[c.wR=13]="wR",c[c.nR=14]="nR",c[c.bP=15]="bP",c[c.wP=16]="wP",c[c.nP=17]="nP",c[c.bC=18]="bC",c[c.wC=19]="wC",c[c.nC=20]="nC",c[c.bX=21]="bX",c[c.wX=22]="wX",c[c.nX=23]="nX",c),k=((u={})[u.k=0]="k",u[u.q=1]="q",u[u.b=2]="b",u[u.n=3]="n",u[u.r=4]="r",u[u.p=5]="p",u[u.c=6]="c",u[u.x=7]="x",u),w=((d={})[d.edit=0]="edit",d[d.options=1]="options",d[d.database=2]="database",d[d.bbs=4]="bbs",d[d.api=5]="api",d[d.play=6]="play",d[d.compute=7]="compute",d[d.project=8]="project",d)},1167:function(e,t,n){n.d(t,{Be:()=>l,Jh:()=>s,_K:()=>i});let o=navigator.clipboard,a="canShare"in navigator,l=Math.min(2,Math.floor(devicePixelRatio)),r=matchMedia("(hover: none), (pointer: coarse)").matches;function s(){let e=document.createElement("canvas").getContext("2d");e.fillStyle="rgb(255, 0, 0)",e.fillRect(0,0,1,1);let t=e.getImageData(0,0,2,2).data,n=[255,0,0,255];for(let e=0;e<n.length;e++)if(t[e]!=n[e])return!0;return!1}let i={isTop:top==self,thread:"undefined"!=typeof SharedArrayBuffer,canShare:a,canSharePng:function(){if(!a)return!1;let e=atob("iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII"),t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);let n=new File([new Blob([t])],"1.png",{type:"image/png"});return navigator.canShare({files:[n]})}(),canCopy:o&&"writeText"in o,canPaste:o&&"readText"in o,canCopyImg:o&&"write"in o,isTouch:r,isTaiwan:navigator.languages.includes("zh-TW")}},5345:function(e,t,n){n.d(t,{B8:()=>M,BN:()=>_,KF:()=>b,L4:()=>f,Lw:()=>R,Nr:()=>x,Rr:()=>L,S1:()=>u,S8:()=>g,VX:()=>a,bV:()=>h,e$:()=>S,e7:()=>E,lZ:()=>k,ls:()=>y,mX:()=>C,qN:()=>o,rX:()=>w});let o="8/8/8/8/8/8/8/8",a="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",l="\\p{Extended_Pictographic}",r="\\p{Emoji_Modifier}",s="".concat("\\p{Regional_Indicator}","{2}|").concat(l,"\\uFE0F?").concat(r,"?(\\u200D").concat(l,"\\uFE0F?").concat(r,"?)*"),i="\\((!?)([kqbnrp])(\\d?)\\)",c="[-~]?(\\*\\d)?(".concat("[kqbnrpcxstadg]","|").concat("'(".concat(s,"|[^'])|''.."),")"),u=RegExp("^(?:".concat(s,")$"),"u"),d=RegExp("^(?:".concat(i,"|").concat(c,")$"),"iu"),p=RegExp("\\/|\\d+|".concat(i,"|").concat(c,"|."),"iug");function f(e){let t=e.match(p)||[];if(!t.some(e=>e.match(/^\d\d+$/)))return e;let n=[0],o=0;for(let e=0;e<t.length;e++){let a=t[e];if("/"==a)n[++o]=0;else if(a.match(/^\d+$/))if(1==a.length)n[o]+=Number(a);else{let l=a.split("").map(e=>Number(e)).reduce((e,t)=>e+t,0);n[o]+=l,t[e]=l.toString()}else n[o]++}return m(n)?t.join(""):e}function h(e){let t=e.match(p)||[],n=[0],o=0;for(let e of t)"/"==e?n[++o]=0:e.match(/^\d+$/)?n[o]+=Number(e):n[o]++;let a=n.length;if(1!=a&&m(n))return{w:n[0],h:a}}function m(e){let t=e[0];for(let n=1;n<e.length;n++)if(e[n]!=t)return!1;return!0}function y(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,o=e.match(p)||[],a=[],l=!1;for(let e of o){if("/"==e){if(!l){let e=a.length+t-a.length%t;for(;a.length<e;)a.push("")}}else if(e.match(/^\d+$/)){let t=Number(e);for(let e=0;e<t;e++)a.push("")}else a.push(e);if(l="/"!=e&&a.length%t==0,a.length==t*n)break}for(;a.length<t*n;)a.push("");return a}function b(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,o=0,a="";function l(){o&&(a+=o),o=0}for(let r=0;r<n;r++){for(let n=0;n<t;n++){let s=r*t+n;""==e[s]?o++:(l(),a+=e[s])}l(),r<n-1&&(a+="/")}return a}function g(e,t,n){if(!e.match(d))if(e.match(u))e="'"+e;else{let t=[...e].length;e=1==t&&"'"!=e?"'"+e:2==t?"''"+e:""}return(e=(e=e.replace(RegExp("^".concat(i,"$"),"i"),(e,t,n,o)=>{let a=n;return o&&(a="*"+o+a),t&&(a="-"+a),a})).replace(/^~/,"-").replace(/^-(?=.*')/,"")).startsWith("-")&&(e=e.toLowerCase()),e=w(e,t,n)}function k(e){let t=(e=w(e,!1,!0)).match(/^(-?)(?:\*(\d))?([kqbnrp])$/i);if(!t)return"";let n=w(t[3],!0);return t[1]||t[2]?"("+(t[1]?"!":"")+n+(t[2]||"")+")":n}function w(e,t,n){return e.match(/^-?(\*\d)?[sng]$/i)&&(t?(n&&(e=e.replace("s","g").replace("S","G")),e=e.replace("n","s").replace("N","S")):(n&&(e=e.replace("s","n").replace("S","N")),e=e.replace("g","s").replace("G","S"))),e}function R(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8;return void 0===t&&(t=e%8,e=(e-t)/8),String.fromCharCode(97+t)+(n-e)}function x(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8;return{x:e.charCodeAt(0)-97,y:t-Number(e[1])}}function L(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,{x:o,y:a}=x(e,n);return a*t+o}function C(e){return Array.from({length:e},e=>"")}function _(e,t,n){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:8,l=C(o*a);l.anime="";for(let r=0;r<a;r++)for(let s=0;s<o;s++){let i=s+t,c=r+n,u=0<=i&&i<o&&0<=c&&c<a;e[r*o+s]&&(l[c*o+i]=u?e[r*o+s]:"",l.anime+=R(r,s,a)+R(c,i,a))}return l}function E(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,a=C(n*o);a.anime="";for(let l=0;l<o;l++)for(let r=0;r<n;r++){let s=r,i=l;if("-"==t&&(s=n-1-s),("|"==t||"/"==t)&&(i=o-1-i),"/"==t||"\\"==t){let e=i-s;s+=e,i-=e}"/"==t&&(i=o-1-i),e[i*n+s]&&(a[l*n+r]=e[i*n+s],a.anime+=R(i,s,o)+R(l,r,o))}return a}function S(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,a=C(n*o);n==o&&(a.anime="");for(let u=0;u<n;u++)for(let d=0;d<o;d++){var l,r,s,i,c;let{x:p,y:f}=(l=u,r=d,s=n,i=o,1==(c=t)?{x:l,y:i-1-r}:2==c?{x:i-1-r,y:s-1-l}:{x:s-1-l,y:r});e[f*n+p]&&(a[u*o+d]=e[f*n+p],n==o&&(a.anime+=R(f,p,o)+R(u,d,o)))}return a}function M(e,t){return e.map(e=>{if(""==e||e.startsWith("-")||!t&&e.startsWith("'"))return e;let n=e.toLowerCase();return e==n?e.toUpperCase():n})}},3639:function(e,t,n){n.d(t,{Eo:()=>p,FU:()=>a,I5:()=>c,YY:()=>u,_7:()=>o,eY:()=>d,oj:()=>l});let o=44,a="1echecs",l={pattern:void 0,bg:void 0,exHigh:!0,border:"1",blackWhite:!1,knightOffset:.6,SN:!1,size:44,w:8,h:8,fullFEN:!1,coordinates:!1,set:a,collapse:!0},r=/^\d+(,\d+)*$/,s=[26,32,38,44],i=["1echecs","alpha","goodCompanion","kilfiger","merida","mpchess","skak"];function c(e){if("string"==typeof e&&(e=e.replace(/\D/g,",").replace(/,+/g,",").replace(/^,/,"").replace(/,$/,"")).match(r))return e}function u(e){let t=Object.assign({},l);if(e){let n=Number(e.size);s.includes(n)&&(t.size=n),e.set&&i.includes(e.set)&&(t.set=e.set),e.border=c(e.border),e.border&&(t.border=e.border),e.knightOffset&&0<e.knightOffset&&e.knightOffset<1&&(t.knightOffset=e.knightOffset),t.blackWhite=!!e.blackWhite,t.pattern=e.pattern,t.bg=e.bg,t.SN=e.SN||!1;let o=Math.floor(Number(e.w)),a=Math.floor(Number(e.h));o>0&&(t.w=o),a>0&&(t.h=a)}return t}let d=20;function p(e,t){let n,o,a=(o=(n=e.border.split(",").map(e=>{let t=Number(e);return isNaN(t)?0:Math.abs(Math.floor(t))})).reduce((e,t)=>e+t,0),{array:n,size:o}),l=e.coordinates?{x:d,y:d}:{x:0,y:0};!0===t&&(l.y=0),!1===t&&(l.x=0);let r=e.w*e.size+2*a.size+l.x,s=e.h*e.size+2*a.size+l.y,i={x:a.size+l.x,y:a.size};return{w:r,h:s,border:a,offset:i,margin:l}}},9916:function(e,t,n){n.d(t,{DA:()=>f,Lo:()=>b,OV:()=>x,P:()=>d,SQ:()=>u,Ts:()=>y,Yk:()=>m,ZV:()=>E,cv:()=>M,dG:()=>L,gZ:()=>g,pn:()=>w,px:()=>R,xQ:()=>_,yh:()=>S});var o=n(495),a=n(5345),l=n(4283);function r(){let e=(0,o._)(["[[^]]+]"],["\\[[^\\]]+\\]"]);return r=function(){return e},e}function s(){let e=(0,o._)(["(+)?[a-z]) (S[ S]+S)"],["(\\+)?[a-z]\\) (\\S[ \\S]+\\S)"]);return s=function(){return e},e}function i(){let e=(0,o._)(["(?<mod>hcc)?(?:(?<move>0-0(?:-0)?|",")(?:",")*(?:",")?(?:=(?<cc>[nwb]))?)(?:",")*"]);return i=function(){return e},e}function c(){let e=(0,o._)(["(?<count>d+.(?:..)?)?(?<main>","(?:/",")*)(?: [+#=])?"],["(?<count>\\d+\\.(?:\\.\\.)?)?(?<main>","(?:\\/",")*)(?: [+#=])?"]);return c=function(){return e},e}let u="[a-h][1-8]",d="(?:[0-9A-Z][0-9A-Z]|[A-Z])",p=String.raw(r()),f=String.raw(s()),h="(?:[nwb])?r?".concat(d,"?(?<from>").concat(u,")[-*](?<to>").concat(u,")(?<ep> ep\\.)?(?<then>([-*]").concat(u,"(=[nwb]?").concat(d,")?)*)"),m="=(?<pc>[nwb])?(?<p>".concat(d,")"),y=["condition","2option","3stipulation","2sstipulation","3forsyth","2pieces","2twin"].map(l.x).join("|"),b=RegExp(y,"ig"),g=String.raw(i(),h,p,m,p),k=g.replace(/\?<[^>]+>/g,""),w=String.raw(c(),k,k);function R(e,t,n,o){return"w"==o&&(n=n.toUpperCase()),"b"==o&&(n=n.toLowerCase()),"n"==o&&(n="-"+n.toLowerCase()),e[(0,a.Rr)(t)]=n,n}function x(e,t,n,o){o&&o.push(t+n);let l=(0,a.Rr)(t),r=(0,a.Rr)(n);return e[r]=e[l],e[l]="",e[r]}let L={"*2Q":"G","*2N":"N","*1N":"Z","*3N":"CA","*3B":"GI","*3Q":"LI","*1Q":"EQ","*2P":"BP","*1B":"AN","*1K":"PO","*2K":"ST","*3K":"DU","*2R":"WE","*3R":"PA",C:"I"},C={"*1B":"25,37,AL,AN,BM,C,CT,DB,GN,GY,NH","*1K":"PO","*1N":"36,AO,BK,BN,DR,GR,KP,LS,MA,MS,OH,RK,S1,S2,S3,S4,SQ,SS,SW,UU,Z,ZE,ZH,ZR","*1P":"BS,CP,MP","*1Q":"EQ,HA,KH,L,LE,NE","*1R":"DA,DK,EK,GT,MH,RM,RO,RR,SH,WA","*2B":"15,AR,BH,BT,BU,BW,ND,PR","*2K":"ST","*2N":"N","*2P":"BP","*2Q":"G","*2R":"DG,EM,RA,RF,RH,RW,WE","*3B":"BE,BL,FE,GI,LO,OK,RB,VA","*3K":"DU","*3N":"24,35,AH,CA,DS,GH,MO,OA,SA","*3P":"O,SP","*3Q":"16,AM,EH,KA,LI,M,OR,SE,SI","*3R":"BR,CH,CR,EA,FA,PA,RE,RL,TR",A:"AG,B1,B2,B3,BI,BO,CG,CY,DO,ET,F,FR,G2,G3,GE,GF,GL,KL,KO,LB,LH,LN,LR,MG,ML,MM,NA,NL,NO,PP,QE,QF,QN,QQ,RN,RP,RT,SK,SO,TH,WR",C:"I",N:"S"},_={custom:()=>({}),default:{}};for(let e in C)for(let t of C[e].split(","))_.default[t]=e;function E(e){if(!e)return e;let t=e.toUpperCase(),n=function(e){let t=_.custom();for(let n in t)if(t[n]==e)return n}(t)||_.default[t];return n?e==t?n:n.toLowerCase():e}function S(e){var t;let n=e.startsWith("-")?"=":"";n&&(e=e.substring(1));let o=e.toUpperCase();if(t=o,/^[KQBNRP]$/.test(t))e=e.replace("n","s").replace("N","S");else{let t=o==e,a=_.custom();if(!(o in a))return null;let l=a[o];2==(e=t?l:l.toLowerCase()).length&&(e="."+e),l.match(/^\d+$/)&&!n&&(n=t?"+":"-")}return n+e}function M(e,t,n){let o=(0,a.Rr)(t),l=(0,a.Rr)(n),r=e[l];e[l]=e[o],e[o]=r}},6515:function(e,t,n){n.d(t,{P:()=>m,o:()=>h});var o=n(495),a=n(227),l=n(5345),r=n(4283),s=n(9916);function i(){let e=(0,o._)(["s+(?<c>",")(?:s+(?:","))?(?<l>(?:s+",")+)"],["\\s+(?<c>",")(?:\\s+(?:","))?(?<l>(?:\\s+",")+)"]);return i=function(){return e},e}function c(){let e=(0,o._)(["","(?:",")+(?=s+(?:",")|$)"],["","(?:",")+(?=\\s+(?:",")|$)"]);return c=function(){return e},e}let u=["1Black","1Neutral","1White"].map(r.x).join("|"),d=["1Chameleon","2FrischAuf","2Functionary","2HalfNeutral","2HurdleColourChanging","1Jigger","1Kamikaze","1Magic","2Paralysing","2Protean","1Royal","1Uncapturable","1Volage"].map(r.x).join("|"),p="(?<p>".concat(s.P,")(?<sq>(?:").concat(s.SQ,")+)"),f=String.raw(i(),u,d,p),h=String.raw(c(),(0,r.x)("2pieces"),f,s.Ts);function m(e){let t=(e=e.split("a=>b")[0]).match(RegExp(h,"ig"));if(!t)return null;let n=(0,l.mX)(64);for(let e of t)for(let t of e.match(RegExp(f,"ig"))){let e=t.match(RegExp(f,"i")).groups,o=e.c[0].toLowerCase();for(let t of e.l.match(RegExp(p,"ig"))){let e=t.match(RegExp(p,"i")).groups,r=e.p.toUpperCase();for(let t of e.sq.match(RegExp(s.SQ,"g")))n[(0,l.Rr)(t)]=function(e,t){if(2==t.length&&(t="."+t),e==a.Q1.neutral)return"="+t;let n=e==a.Q1.white;return t.match(/[A-Z]/)?n?t:t.toLowerCase():(n?"+":"-")+t}(o,r)}}return(0,l.KF)(n)}},5003:function(e,t,n){n.d(t,{eK:()=>H,t8:()=>X});var o=n(495),a=n(8041),l=n(5345),r=n(4283),s=n(9916),i=n(227);function c(){let e=(0,o._)(["^+(?<c>[nwb])(?<is>",")(?<at>",")(=(?<p>","))?$"],["^\\+(?<c>[nwb])(?<is>",")(?<at>",")(=(?<p>","))?$"]);return c=function(){return e},e}function u(){let e=(0,o._)(["^-([nwb]",")?(?<at>",")$"]);return u=function(){return e},e}let d=new RegExp(String.raw(c(),s.P,s.SQ,s.P)),p=new RegExp(String.raw(u(),s.P,s.SQ)),f=new RegExp("^(?<c>[nwb])".concat(s.P,"(?<from>").concat(s.SQ,")-&gt;(?<to>").concat(s.SQ,")(=(?<p>").concat(s.P,"))?$")),h=new RegExp("^".concat(s.P,"(?<from>").concat(s.SQ,")&lt;-&gt;").concat(s.P,"(?<to>").concat(s.SQ,")$")),m=new RegExp("^(?<at>".concat(s.SQ,")=(?<c>[nwb])?(?:r?(?<p>").concat(s.P,"))?$")),y=new RegExp("^I".concat(s.SQ,"(,").concat(s.SQ,")*$")),b=new RegExp(s.gZ),g=new RegExp(s.pn);function k(e){return e.pg?l.VX:e.fen}let w=new RegExp("^[nwb](?:hcc)?".concat(s.P,"(").concat(s.SQ,")--&gt;(").concat(s.SQ,")$")),R=new RegExp("^[nwb](?:hcc)?".concat(s.P,"(").concat(s.SQ,")&lt;--&gt;[nwb](?:hcc)?").concat(s.P,"(").concat(s.SQ,")$")),x=new RegExp("^([+-]?)([nwb])(?:hcc)?(".concat(s.P,")(").concat(s.SQ,")$")),L=new RegExp("^(".concat(s.P,")==&gt;(").concat(s.P,")$")),C=new RegExp("^mirror(".concat(s.SQ,")&lt;--&gt;(").concat(s.SQ,")$")),_=new RegExp("^shift(".concat(s.SQ,")==&gt;(").concat(s.SQ,")$")),E=/^rotate(90|180|270)$/;function S(e,t){let n=e.match(w);return!!n&&((0,s.OV)(t,n[1],n[2]),!0)}function M(e,t){let n=e.match(R);return!!n&&((0,s.cv)(t,n[1],n[2]),!0)}function B(e,t){let n=e.match(x);return!!n&&("+"==n[1]||""==n[1]?(0,s.px)(t,n[4],(0,s.ZV)(n[3]),n[2]):(0,s.px)(t,n[4],""),!0)}function A(e,t){let n,o=e.match(C);if(!o)return!1;let a=(0,l.Nr)(o[1]),r=(0,l.Nr)(o[2]);return n=a.x==r.x?"|":a.y==r.y?"-":(a.x-r.x)*(a.y-r.y)>0?"\\":"/",V(t,(0,l.e7)(t,n)),!0}function P(e,t){let n=e.match(_);if(!n)return!1;let o=(0,l.Nr)(n[1]),a=(0,l.Nr)(n[2]);return V(t,(0,l.BN)(t,a.x-o.x,a.y-o.y)),!0}function N(e,t){let n=e.match(L);if(!n)return!1;let o=(0,s.ZV)(n[1]),a=o.toLowerCase(),l=(0,s.ZV)(n[2]),r=l.toLowerCase();for(let e=0;e<t.length;e++)t[e]==o&&(t[e]=l),t[e]==a&&(t[e]=r),t[e]=="-"+a&&(t[e]="-"+r);return!0}function F(e,t){var n;let o=e.match(E);return!!o&&(V(t,(0,l.e$)(t,"90"==(n=o[1])?i.OP.counterclockwise:"180"==n?2:1)),!0)}function W(e,t){return"PolishType"==e&&(V(t,(0,l.B8)(t)),!0)}function V(e,t){e.length=0,e.push(...t)}function T(){let e=(0,o._)(["\n\n+|(?:",")|(?:",")"],["\\n\\n+|(?:",")|(?:",")"]);return T=function(){return e},e}function D(){let e=(0,o._)(["","s+(S*(?:d|[^ds]s+d+(?:.[05])?))"],["","\\s+(\\S*(?:\\d|[^\\d\\s]\\s+\\d+(?:\\.[05])?))"]);return D=function(){return e},e}function I(){let e=(0,o._)(["\bimitw*s+(?:",")+"],["\\bimit\\w*\\s+(?:",")+"]);return I=function(){return e},e}let Q=new RegExp(s.DA),U=RegExp(String.raw(T(),s.DA,s.pn),"g");function X(e,t,n){return function(e,t,n,o){var c,u,w,R,x;let L,C,_,E,V,T,D,I;if(!t)return n;console.log(n);let X=(c=e,u=t,w=n=n.replace(/<br>/g,"\n").replace(/<span class="text-secondary">.+?<\/span>/g,""),_=(C=(L=c.replace(/\n/g," ").replace(s.Lo,"\n$&").split("\n")).filter(e=>e.match((0,r.C)("2option","^"))).join(" "),{imitators:(null==(x=L.filter(e=>e.match((0,r.x)("condition"))).join(" ").match(K))?void 0:x.join(" ").match(RegExp(s.SQ,"g")))||[],duplex:z.test(C),halfDuplex:Y.test(C)}),E=c.split((0,r.C)("2twin","\\b","\\b")).map(e=>{var t;return null==(t=e.match(O))?void 0:t[1].replace(/\s/g,"")}).filter(e=>e),T={stack:[],stipIndex:0,solutionPrinted:!1,currentProblem:V={pg:/dia/i.test(E[0]),fen:function(e,t){if(!t)return e;let n=(0,l.ls)(e);for(let e of t)n[(0,l.Rr)(e)]="-"+(0,s.ZV)("i");return(0,l.KF)(n)}(H(u),_.imitators),imitators:_.imitators,ordering:j(E[0],_.halfDuplex)},board:(0,l.ls)(k(V)),ordering:V.ordering,imitators:null==(R=V.imitators)?void 0:R.concat()},{duplexSeparator:_.duplex?(D=/^\n\n+ +1\./,I=w.replace(/\n\nsolution finished./,"\n  1.").match(/\n\n+[^\n]+/g).filter((e,t,n)=>t>0&&e.match(D)&&n[t-1].match(D)).map(e=>e.match(/^\n+/)[0].length),"\n".repeat(Math.max(...I))):"",initProblem:V,stipulations:E,options:_,state:T}),G=!1;return(n=n.replace(U,e=>{if(G)return e;try{if(function(e,t){let{state:n,duplexSeparator:o}=e;return!!t.match(/^\n+$/)&&(n.stack.length=0,n.board=(0,l.ls)(k(n.currentProblem)),t==o&&n.solutionPrinted&&(n.ordering=$(n.ordering)),!0)}(X,e)||function(e,t){let{state:n,stipulations:o,options:r,initProblem:s}=e,i=t.match(Q);if(!i)return!1;n.solutionPrinted=!1,n.currentProblem=(0,a.o)(i[1]?n.currentProblem:s);let c=o[++n.stipIndex];c&&(n.currentProblem.ordering=j(c,r.halfDuplex),n.currentProblem.pg=/dia/i.test(c)),n.ordering=n.currentProblem.ordering,n.stack.length=0;let{fen:u,board:d}=function(e,t){let n=(0,l.ls)(e);for(let e of t.replace(/(mirror|shift|rotate) /g,"$1").replace(/ ==&gt; /g,"==&gt;").split(" "))!function(e,t){for(let n of[S,M,B,A,P,N,F,W])if(n(t,e))return}(n,e);return{fen:(0,l.KF)(n),board:n}}(n.currentProblem.fen,i[2]);return n.currentProblem.fen=u,n.board=n.currentProblem.pg?(0,l.ls)(l.VX):d,!0}(X,e))return e;return X.state.solutionPrinted=!0,function(e,t,n){var o,a,r,c;let u,{stack:w,ordering:R}=t,x=e.match(g).groups,L=x.count,C=k(t.currentProblem);if(L){let e,n=w.findIndex(e=>e.move==L||parseInt(e.move)>parseInt(L));n>=0&&(o=t,a=n,r=C,e=a>0?o.stack[a-1].fen:r,o.board=(0,l.ls)(e),o.imitators&&(o.imitators=(a>0?o.stack[a-1].imitators:o.currentProblem.imitators).concat()),o.stack.length=a,u=e)}let _=R[!L||L.endsWith("...")?1:0],{imitators:E,board:S}=t,M=null==E?void 0:E.concat();if(E){for(let e of E)(0,s.px)(S,e,"");E.length=0}let B=[];for(let e of x.main.split("/")){!function(e,t,n,o,a){let l,r;if(n.move.startsWith("0-0")){let o=t==i.Q1.white?"1":"8",c="0-0"==n.move?["g","h","f"]:["c","a","d"];(0,s.OV)(e,"e"+o,c[0]+o,a),r=(0,s.OV)(e,c[1]+o,l=c[2]+o,a)}else r=(0,s.OV)(e,n.from,l=n.to,a),n.ep&&(0,s.px)(e,n.to.replace("3","4").replace("6","5"),""),n.then&&function(e,t,n){let o=t.to;for(let a of t.then.match(RegExp("".concat(s.Yk,"|").concat(s.SQ),"g"))){let t=a.match(new RegExp(s.Yk));if(t){let a=(0,s.px)(e,o,(0,s.ZV)(t.groups.p),t.groups.pc);n&&(n[n.length-1]+="="+a)}else(0,s.OV)(e,o,a,n),o=a}}(e,n,a);"I"==n.p?(o.push(l),(0,s.px)(e,l,(0,s.ZV)("I"),i.Q1.neutral)):n.p&&(0,s.px)(e,l,r=(0,s.ZV)(n.p),n.pc?n.pc:t),n.cc&&(0,s.px)(e,l,r,n.cc)}(S,_,e.match(b).groups,E,B);let t=null==(c=e.match(/\[[^[\]]+(?=\])/g))?void 0:c.map(e=>e.substring(1));t&&t.forEach(e=>(function(e,t,n){var o,a,r,c,u,b,g;let k=null==(o=t.match(d))?void 0:o.groups;if(k)return(0,s.px)(e,k.at,(0,s.ZV)(k.p||k.is),k.c);if(k=null==(a=t.match(p))?void 0:a.groups)return(0,s.px)(e,k.at,"");if(k=null==(r=t.match(f))?void 0:r.groups){(0,s.OV)(e,k.from,k.to),k.p&&(0,s.px)(e,k.to,(0,s.ZV)(k.p),k.c);return}if(k=null==(c=t.match(h))?void 0:c.groups)return(0,s.cv)(e,k.from,k.to);if(k=null==(u=t.match(m))?void 0:u.groups){return(0,s.px)(e,k.at,(0,s.ZV)(k.p)||(b=e,g=k.at,b[(0,l.Rr)(g)].match(RegExp("^(\\*\\d)?"+s.P+"$","i"))[0].toUpperCase()),k.c||function(e,t){let n=e[(0,l.Rr)(t)];return s.P.startsWith("-")?i.Q1.neutral:n==n.toLowerCase()?i.Q1.black:i.Q1.white}(e,k.at))}if(t.match(y))for(let o of(n.push(...t.match(RegExp(s.SQ,"g"))),n))(0,s.px)(e,o,(0,s.ZV)("I"),i.Q1.neutral)})(S,e,E))}let A=(0,l.KF)(S);return L&&w.push({move:L,color:_,fen:A,imitators:null==E?void 0:E.concat()}),M&&function(e,t){for(let n=0;n<t.length;n++){let[o,a]=t[n].match(/[a-z]\d/g).map(e=>(0,l.Nr)(e)),r=a.x-o.x,s=a.y-o.y;for(let o of e){let e=(0,l.Nr)(o);t[n]+=o+(0,l.Lw)(e.y+s,e.x+r)}}}(M,B),(1==w.length&&L?n("*",C)+" ":"")+n(e,A,B,u)}(e,X.state,o)}catch(t){return console.log(t,e),G=!0,e}})).replace(/ {2} ?<span init/g,"<span").replace(/\n/g,"<br>")}(e,t,n,G)}let O=RegExp(String.raw(D(),(0,r.x)("3stipulation")),"i");function j(e){var t;let n,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return"wb";let a=e.match(/^(\d+-&gt;)?(?:exact-)?(?:(?:ser|pser|phser|semi|reci)-)?(hs|hr|h|s|r)?/i);return n=!a||a[1]?"wb":(null==(t=a[2])?void 0:t.toLowerCase())=="h"?"bw":"wb",o?$(n):n}let K=RegExp(String.raw(I(),s.SQ),"ig"),z=(0,r.C)("3duplex"),Y=(0,r.C)("3halfDuplex");function $(e){return"wb"==e?"bw":"wb"}function G(e,t,n,o){let a="*"==e?"init ":"";t=t.replace(/-/g,"&#45;").replace(/"/g,"&#34;");let l="";return n&&n.length&&(l+=' data-anime="'.concat(n.join(","),'"')),o&&(l+=' data-before="'.concat(o,'"')),"<span ".concat(a,'class="step btn px-1 py-0" data-fen="').concat(t,'"').concat(l,">").concat(e,"</span>")}let q=/[-+=]?(\.[0-9A-Z][0-9A-Z]|[A-Z])|\d+|\//ig;function H(e){return e.match(q).map(e=>{if("/"==e||e.match(/^\d+$/))return e;let t=e.match(/^[-+=]/)?e[0]:null;return t&&(e=e.substring(1)),e.startsWith(".")&&(e=e.substring(1)),e=(0,s.ZV)(e),"+"==t&&(e=e.toUpperCase()),"-"==t&&(e=e.toLowerCase()),"="==t&&(e="-"+e.toLowerCase()),e}).join("")}},4283:function(e,t,n){n.d(t,{C:()=>l,x:()=>r});var o=n(495);function a(){let e=(0,o._)(["(?:","","|\b)"],["(?:","","|\\b)"]);return a=function(){return e},e}function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return RegExp(t+r(e)+n,"i")}function r(e){let t=4;return(e.match(/^\d/)&&(t=Number(e[0]),e=e.substring(1)),e.length<=t)?"\\b"+e+"\\b":"\\b"+e.substring(0,t)+function e(t){return""==t?"":String.raw(a(),t[0],e(t.substring(1)))}(e.substring(t))}},940:function(e,t,n){n.d(t,{A:()=>a});var o,a=((o={})[o.notYet=0]="notYet",o[o.checkmate=1]="checkmate",o[o.draw=2]="draw",o)},5944:function(e,t,n){n.d(t,{M_:()=>f,IQ:()=>C,h5:()=>m,$P:()=>d,XS:()=>y,Sl:()=>_,PO:()=>E,Bk:()=>R,Qx:()=>w,wk:()=>g});var o=n(476),a=n(3639),l=n(3923),r=n(1167),s=n(8041),i=n(9916),c=n(227),u=n(7231);let d=new URL(location.href).searchParams,p={BBS:{Id:!0,coordinates:!0,notes:!0,uncoloredNotes:!1,redBlue:!1},DB:{use:"PDB",exact:!1},PLAY:u.st,Stockfish:{study:!1,downloaded:!1,depth:50,lines:3},feature:{janko:!1},popeye:{pieceMap:i.dG},board:a.oj,project:[]},f=(0,o.Kh)(p);i.xQ.custom=()=>f.popeye.pieceMap;let h=matchMedia("(prefers-color-scheme: dark)");h.onchange=()=>m.isDark=h.matches;let m=(0,o.Kh)({module:{chess:!1},envReady:!1,loading:!0,isDark:h.matches,pieceCount:"(0+0)",hor:!1,collapse:!1,dragging:!1,selection:null,stockfish:{status:c.N8.notDownloaded,running:c.y9.stop},syzygy:{running:!1}}),y={depth:0,score:null,mate:null,lines:[],header:[]},b={split:!1,tab:0,compute:"py",play:u.RF,popeye:{initFEN:"",index:0,steps:[],playing:!1,error:!1,running:!1,editMap:!1,mapping:"",input:"",output:"",intInput:"",intOutput:""},stockfish:y,syzygy:{header:null,lines:null}},g=(0,o.Kh)(b),k=[];function w(e){k.push(e)}function R(){let e=JSON.parse(localStorage.getItem("settings")||"{}");(0,s.E)(p,e,!0),e.project&&(p.project=e.project),e.popeye&&(p.popeye.pieceMap=e.popeye.pieceMap),d.has("janko")&&(p.feature.janko=!0);let t=r._K.isTop?JSON.parse(sessionStorage.getItem("state")||"null"):null;for(let e of(t&&(0,s.E)(g,t),m.stockfish.status=f.Stockfish.downloaded?c.N8.ready:c.N8.notDownloaded,k))e();(0,o.nT)(x),(0,o.nT)(L)}function x(){localStorage.setItem("settings",JSON.stringify(f))}function L(){r._K.isTop&&sessionStorage.setItem("state",JSON.stringify(g))}function C(e,t,n){let{size:o,w:r}=f.board,{border:s,margin:i}=(0,a.Eo)(f.board,t),c=s.size,u=t?8:3,d=e?u:r,p=(e||l.BB).clientWidth/(o*d+2*c+i.x),h={x:(c+i.x)*p,y:c*p,r:c*p,b:(c+i.y)*p};return{s:o*p,offset:h,width:((n||r)*o+2*s.size+i.x)*p}}function _(){return g.play.playing||g.popeye.playing}function E(){return m.hor&&g.popeye.playing}},7231:function(e,t,n){n.d(t,{GQ:()=>r,RF:()=>l,YJ:()=>s,st:()=>a,v5:()=>p});var o=n(227);let a={symbol:null,ep:!0,negative:!1,zero:!1},l={initFEN:"",playing:!1,pendingPromotion:!1,moveNumber:-1,game:"",history:[],turn:"w",castle:{K:!0,Q:!0,k:!0,q:!0},retro:{uncapture:void 0,unpromote:!1,ep:!1},enPassant:"",halfMove:0,fullMove:1,mode:o.ey.normal,over:void 0},r=1,s=8,i=[4,7,10,13],c=[3,6,9,12],u=c.concat(15,16,18),d=i.concat(15,16,19),p={w:i,b:c,wr:u,br:d}},8752:function(e,t,n){n.d(t,{B0:()=>c,Lm:()=>s,VG:()=>i,gi:()=>u,k4:()=>r});var o=n(476);let a=document.getElementById("Output"),l=!1;function r(){l=l||!!a&&a.scrollTop+a.clientHeight+30>a.scrollHeight}function s(){l&&(l=!1,(0,o.dY)(()=>a.scrollTop=a.scrollHeight-a.clientHeight))}function i(e){let t=e.offsetTop-10;a.scrollTop>t&&(a.scrollTop=t);let n=e.offsetTop+e.clientHeight-a.clientHeight+10;a.scrollTop<n&&(a.scrollTop=n);let o=e.offsetLeft-10;a.scrollLeft>o&&(a.scrollLeft=o);let l=e.offsetLeft+e.clientWidth-a.clientWidth+10;a.scrollLeft<l&&(a.scrollLeft=l)}function c(){a.scrollTop=a.scrollLeft=0}function u(){return[...a.querySelectorAll("span")]}},7173:function(e,t,n){n.d(t,{DB:()=>P,Q3:()=>E,qK:()=>M,yS:()=>w});var o=n(495),a=n(476),l=n(4848),r=n(5944),s=n(5003),i=n(1364),c=n(9318),u=n(5345),d=n(4283),p=n(9916),f=n(2906),h=n(6515),m=n(5109),y=n(8752);function b(){let e=(0,o._)(["(?:",")s.+$"],["(?:",")\\s.+$"]);return b=function(){return e},e}function g(){let e=(0,o._)(["","s+S+"],["","\\s+\\S+"]);return g=function(){return e},e}function k(){let e=(0,o._)(["","s+(S+)"],["","\\s+(\\S+)"]);return k=function(){return e},e}let w={};(0,r.Qx)(()=>{r.wk.popeye.running=!1,r.wk.popeye.editMap=!1,r.wk.popeye.playing&&(0,c.Hh)().then(()=>(0,a.dY)(()=>B(!0)))});let R=RegExp(String.raw(b(),["remark","2author","2origin","3title"].map(d.x).join("|")),"igm"),x=RegExp(String.raw(g(),(0,d.x)("5protocol")),"i"),L=(0,d.C)("3beginProblem"),C=(0,d.C)("3endProblem"),_=/\bnext\s[\s\S]+$/i,E=(0,d.x)("3forsyth"),S=(0,d.x)("2pieces");function M(e){if(RegExp("".concat(E,"|").concat(S),"i").test(e)){var t;let n=(0,h.P)(e)||(null==(t=e.match(RegExp(String.raw(k(),E),"i")))?void 0:t[1]);if(n)return{fen:n,imitators:[],fromInput:!0}}let{w:n,h:o}=r.M_.board;if(8!=n||8!=o)throw Error();let a=[],s=(0,l.$p)().map((e,t)=>{if(""==e)return e;let n=r.M_.board.SN?e.replace("s","n").replace("S","N").replace("g","s").replace("G","S"):e;if(!(n=(0,p.yh)(n)))throw(0,m.x)("Unspecified fairy piece: "+e);return n.match(/^=?i$/i)?(a.push((0,u.Lw)(t)),""):n});return{fen:(0,u.KF)(s),imitators:a,fromInput:!1}}async function B(e){let t=r.wk.popeye;t.steps=(0,y.gi)(),0!=t.steps.length&&(A(0,!0),t.playing=!0,e&&await (0,c.Hh)(),(0,c.L9)([]),(0,a.dY)(i.XR))}async function A(e,t){let n=r.wk.popeye,o=n.steps[e],s=n.steps[n.index];if(s&&s.dataset.anime&&(e==n.index-1&&!s.dataset.before||o.dataset.fen==s.dataset.before))await (0,f.i0)(o.dataset.fen,s.dataset.fen,s.dataset.anime,!0);else{var i;let t=o.dataset.before||(null==(i=n.steps[e-1])?void 0:i.dataset.fen);o.dataset.anime&&t?await (0,f.i0)(t,o.dataset.fen,o.dataset.anime):((0,f.TV)(),(0,l.w3)(o.dataset.fen))}t||s.classList.remove("active"),n.index=e,o.classList.add("active"),(0,a.dY)(()=>(0,y.VG)(o))}let P={run(){gtag("event","fen_popeye_run"),w.initMemory();try{let e=r.wk.popeye;e.intInput=function(e){e=e.replace(R,"").replace(x,"").replace(L,"").replace(_,"").replace(C,"");let t=r.wk.popeye,{fen:n,imitators:o,fromInput:a}=M(e);return(t.initFEN=n,a)?((0,l.w3)((0,s.eK)(n)),e):(o.length&&(e+="\ncond imitator "+o.join("")),"fors ".concat(n,"\n").concat(e))}(e.input),w.start()}catch{}},cancel:()=>w.cancel(),play(){let e=r.wk.popeye;(0,y.B0)(),gtag("event","fen_popeye_play"),e.output=(0,s.t8)(e.intInput,e.initFEN,e.intOutput),(0,a.dY)(B)},step(e){let t=r.wk.popeye;if(!t.playing)return;let n=t.steps.indexOf(e.target);n>=0&&n!=t.index&&(e.preventDefault(),A(n))},exit(){let e=r.wk.popeye;(0,l.w3)(e.steps[0].dataset.fen),e.output=e.intOutput,e.playing=!1,(0,c.L9)([]),(0,a.dY)(i.XR)},moveBy(e){let t=r.wk.popeye,n=t.index;(n+=e)<0&&(n=0),n>t.steps.length-1&&(n=t.steps.length-1),P.move(n)},move(e){e!=r.wk.popeye.index&&A(e)},editMap(){gtag("event","fen_popeye_edit_map"),r.wk.popeye.mapping=N(r.M_.popeye.pieceMap),r.wk.popeye.editMap=!0},resetMap(){r.wk.popeye.mapping=N(p.dG)},saveMap(){let e=r.wk.popeye.mapping.toUpperCase().split("\n"),t={};for(let n of e){let[e,o]=n.replace(/\s/g,"").split("=");e.match(F)&&o&&o.match(W)&&(t[e]=o)}r.M_.popeye.pieceMap=t,r.wk.popeye.editMap=!1}};function N(e){let t=[];for(let n in e)t.push("".concat(n,"=").concat(e[n]));return t.join("\n")}let F=/^(\*[1-3][KQBNRP]|(\*[1-3])?[CXSTAD]|''..|'.)$/,W=new RegExp("^".concat(p.P,"$"))},5582:function(e,t,n){n.d(t,{l:()=>o});function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return{id:Date.now()+t,...e}}},2906:function(e,t,n){let o;n.d(t,{IU:()=>d,TV:()=>f,i0:()=>p});var a=n(7925),l=n(9508),r=n(4016),s=n(1167),i=n(5345),c=n(3639),u=n(7714);let d={};function p(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return f(),(o=new h(e,t,n,a)).promise}function f(e){o&&o.stop(e?d.callback:void 0)}class h{stop(e){cancelAnimationFrame(this.request),o=void 0,e&&e(this.after),this.resolve()}step(e){let{ctx:t,options:n,callback:o}=d,a=this.stages.length-1;this.startTime||(this.startTime=e);let i=(e-this.startTime)/150,p=Math.floor(i);if(p>a)return this.stop(o);let f=this.reverse?a-p:p;p>this.cursor?(this.cursor=p,(0,r.x)(t,this.stages[f].board,n,s.Be),this.background=t.getImageData(0,0,t.canvas.width,t.canvas.height)):t.putImageData(this.background,0,0);let h=(0,c.Eo)(n);t.save(),t.translate(h.offset.x,h.offset.y);let m=(0,l.p)(n,s.Be),y=i-Math.floor(i);for(let e of(this.reverse&&(y=1-y),this.stages[f].moves)){let o=e.from.x*(1-y)+e.to.x*y,a=e.from.y*(1-y)+e.to.y*y;(0,u.j)(t,a,o,e.p,{info:h,assets:m,options:n,dpr:s.Be})}t.restore(),this.request=requestAnimationFrame(this.anime)}constructor(e,t,n,o){(0,a._)(this,"promise",void 0),(0,a._)(this,"after",void 0),(0,a._)(this,"reverse",void 0),(0,a._)(this,"resolve",void 0),(0,a._)(this,"cursor",void 0),(0,a._)(this,"stages",void 0),(0,a._)(this,"anime",void 0),(0,a._)(this,"request",void 0),(0,a._)(this,"background",void 0),(0,a._)(this,"startTime",void 0),this.after=o?e:t,this.reverse=o,this.promise=new Promise(e=>this.resolve=e),this.cursor=-1,this.stages=[];const l=n.split(","),r=(0,i.ls)(e),{h:s,w:c}=d.options;for(const e of l){const t=[],n=e.match(/[`a-z]\d(=(\*\d)?[A-Z])?/g);for(let e=0;e<n.length;e+=2){var u;const o=n[e],a=n[e+1],l=(0,i.Rr)(o,c,s),d={p:r[l],promo:null==(u=a.match(/[=](.+)$/))?void 0:u[1],from:(0,i.Nr)(o,s),to:(0,i.Nr)(a,s)};r[l]="",t.push(d)}for(const e of(this.stages.push({board:r.concat(),moves:t}),t))r[e.to.y*c+e.to.x]=e.promo||e.p}this.anime=this.step.bind(this),this.request=requestAnimationFrame(this.anime)}}},9508:function(e,t,n){n.d(t,{p:()=>r,x:()=>s});let o=document.createElement("canvas"),a=o.getContext("2d"),l=new Map;function r(e,t){let n=e.set+e.size*t;return l.get(n)}async function s(e,t,n){let o=t.set+t.size*n;if(l.has(o))return l.get(o);let a=await i(e,t,n),r=await c(a);return l.set(o,r),r}async function i(e,t,n){let{set:l,size:r}=t;e+="/x"+n;let[s,i]=await Promise.all([c("".concat(e,"/").concat(l).concat(r,".png")),c("".concat(e,"/symbol").concat(r,".png"))]);return o.width=r*n*3,o.height=r*n*12,a.drawImage(s,0,0),a.drawImage(i,0,r*n*6),o.toDataURL()}function c(e){return new Promise((t,n)=>{let o=new Image;o.onload=()=>t(o),o.onerror=e=>n(e),o.src=e})}},8836:function(e,t,n){n.d(t,{m:()=>u,p:()=>d});var o=n(4549);let a={26:"YdVh1QDVYdVh",32:"AAAKAAAAo/+jAAr/AP8KAKP/owAAAAoAAA==",38:"AAw+DAAM3P/cDD7/AP8+DNz/3AwADD4MAA==",44:"AC9yLwAv+f/5L3L/AP9yL/n/+S8AL3IvAA==",52:"A3i2eAN4////eLb/AP+2eP///3gDeLZ4Aw==",64:"AAAEHgQAAAA/5v/mPwAE5v///+YEHv//AP//HgTm////5gQAP+b/5j8AAAAEHgQAAA==",76:"AARZhFkEAAS7////uwRZ//////9ZhP//AP//hFn//////1kEu////7sEAARZhFkEAA==",88:"AEfE68RHAEf8/////EfE///////E6///AP//68T//////8RH/P////xHAEfE68RHAA=="},l={},[r,s]=(0,o.h)(),[i,c]=(0,o.h)();function u(e,t,n){let{dpr:o,options:u}=n;(function(e,t,n){i.width=r.width=e.width,i.height=r.height=e.height,s.fillStyle="white",s.fillRect(0,0,e.width,e.height),s.globalCompositeOperation="destination-in",s.drawImage(e,0,0);let o=function(e){if(!(e in l)){let t=atob(a[e]),n=[];for(let e=0;e<t.length;e++)n.push(t.charCodeAt(e));l[e]=n}return l[e]}(t*n),u=Math.sqrt(o.length),d=(u-1)/2;for(let e=0;e<u;e++)for(let t=0;t<u;t++){let n=o[t*u+e];0!=n&&(s.globalAlpha=n/255,c.drawImage(r,e-d,t-d))}})(t,u.size,o),e.drawImage(i,0,0),e.drawImage(i,0,0),e.drawImage(i,0,0)}function d(e,t,n){if(e.strokeStyle="black",e.lineWidth=t/60,e.fillStyle="#fff",e.fillRect(0,0,t,t),n)return;e.beginPath();let o=t/7.5;for(let n=0;n<t;n+=o)e.moveTo(t-n,0),e.lineTo(0,t-n),n>0&&(e.moveTo(n,t),e.lineTo(t,n));e.stroke()}},4016:function(e,t,n){n.d(t,{x:()=>u});var o=n(9508),a=n(3639),l=n(4549),r=n(8836),s=n(7714);let[i,c]=(0,l.h)();function u(e,t,n,l,u,p){let f=(0,a.Eo)(n,p),h={info:f,assets:(0,o.p)(n,l),options:n,dpr:l},m="classic"==n.bg;d(e,h),u||function(e,t){let{w:n,h:o}=t;for(let a=0;a<o;a++)for(let o=0;o<n;o++)!function(e,t,n,o){var a,l;let s=function(e,t,n){if("mono"==e)return 1;let o=(t+n)%2;return"inverted"!=e&&(o=1-o),o}(o.pattern,t,n),i=o.size;e.save(),e.translate(n*i,t*i),"classic"==o.bg?(0,r.p)(e,i,s):(a=s,e.fillStyle="classic"==(l=o.bg)?"none":"gray"==l?a?"#fff":"#bbb":"green"==l?a?"#EEEED2":"#769656":a?"#FFCE9E":"#D18B47",e.fillRect(0,0,i,i)),e.restore()}(e,a,o,t)}(e,n),e.restore(),d(c,h),function(e,t){let{w:n,h:o}=t.options;for(let a=0;a<o;a++)for(let o=0;o<n;o++)(0,s.j)(c,a,o,e[a*n+o],t)}(t,h),c.restore(),m&&!u&&(0,r.m)(e,i,h),e.drawImage(i,0,0),e.scale(l,l);let{w:y,h:b,offset:g,border:k,margin:w}=f;void 0===p&&n.coordinates&&(e.save(),e.translate(g.x,g.y),function(e,t,n){let{size:o,w:l,h:r}=t;e.font="15px sans-serif",e.strokeStyle="black",e.lineWidth=2,e.fillStyle="white",e.lineJoin="round";for(let t=0;t<r;t++){let l=(t+1).toString(),s=e.measureText(l),i=o*(r-t)-o/2+5,c=(a.eY-s.width)/2-a.eY-n;e.strokeText(l,c,i),e.fillText(l,c,i)}for(let t=0;t<l&&t<26;t++){let l=String.fromCharCode(97+t),s=e.measureText(l),i=o*r+a.eY+n-5,c=o*t+(o-s.width)/2;e.strokeText(l,c,i),e.fillText(l,c,i)}}(e,n,k.size),e.restore()),u||function(e,t,n,o,a){e.save(),e.translate(a.x,0),n-=a.x,o-=a.y;let l=0;for(let a=0;a<t.array.length;a++){let r=t.array[a];if(e.strokeStyle=a%2?"white":"black",0==r)continue;e.lineWidth=r;let s=t.size-l-r/2;e.strokeRect(s,s,n-2*s,o-2*s),l+=r}e.restore()}(e,k,y,b,w)}function d(e,t){let{dpr:n}=t,{w:o,h:a,offset:l}=t.info;e.canvas.width=o*n,e.canvas.height=a*n,e.save(),e.scale(n,n),e.translate(l.x,l.y)}},7714:function(e,t,n){n.d(t,{g:()=>a,j:()=>l});var o=n(5345);let a=["k","q","b","n","r","p","c","x","s","t","a","d"];function l(e,t,n,l,r){var s,i,c,u,d,p;let f,h,m,y,b,g,{assets:k,options:w,dpr:R}=r,x=(s=l,i=w,void 0===s&&(s=""),(f=!!s&&s.startsWith("-"))&&(s=s.substring(1)),void 0!==(m=(h=s.match(/^\*(\d)/))&&h[1]?Number(h[1]):void 0)&&(s=s.substring(2)),m=Number(m)%4,i.SN&&(s=(0,o.rX)(s,!1,!0)),y=s.toLowerCase(),b=a.indexOf(y),g=s.startsWith("'"),b<0&&!g?null:{neutral:f,rotate:m,isText:g,value:s,lower:y,typeIndex:b});if(!x)return;let{neutral:L,rotate:C,isText:_,value:E,lower:S,typeIndex:M}=x;e.save();let B=w.blackWhite,A=function(e,t){let{neutral:n,value:o,lower:a}=e;return n?2*!t:+(o!=a)}(x,B),P=(c=L,u=S,d=B,p=w,c&&d?"n"==u?p.knightOffset:.5:1),[N,F]=[C+1&2?1:0,2&C?1:0],{size:W}=w;e.translate((n+N)*W,(t+F)*W),0!==C&&e.rotate(Math.PI/2*C),_?function(e,t,n){var a;e.save();let l=o.S1.test(t),r=n-4;e.font="".concat(r,"px sans-serif");let s=n-2,i=e.measureText(t);if(l&&i.width>s){let n=s/i.width;e.font="".concat(r*n,"px sans-serif"),i=e.measureText(t)}let c=(a=l?e.measureText("M"):i).actualBoundingBoxAscent-a.actualBoundingBoxDescent,u=(n-Math.min(i.width,s))/2,d=Math.max((n-c)/2,0);e.fillStyle="black",e.fillText(t,u,n-d,s),e.restore()}(e,E.substring(E.startsWith("''")?2:1),W):(e.drawImage(k,A*W*R,M*W*R,W*P*R,W*R,0,0,W*P,W),L&&B&&e.drawImage(k,(1+P)*W*R,M*W*R,W*(1-P)*R,W*R,W*P,0,W*(1-P),W)),e.restore()}},9318:function(e,t,n){n.d(t,{$2:()=>M,AI:()=>N,Fk:()=>F,Hh:()=>b,L9:()=>_,kj:()=>B,nX:()=>h,pv:()=>P,qW:()=>A,u5:()=>x});var o=n(3923),a=n(5944),l=n(4848),r=n(4016),s=n(9508),i=n(3639),c=n(1167),u=n(2906),d=n(5345),p=n(7889),f=n(7714);let h="k,K,-k,q,Q,-q,b,B,-b,n,N,-n,r,R,-r,p,P,-p,c,C,-c,x,X,-x".split(","),m="k,q,b,n,r,p,c,x,K,Q,B,N,R,P,C,X,-k,-q,-b,-n,-r,-p,-c,-x".split(",");function y(){return a.M_.board.exHigh?2:1}async function b(){a.h5.loading=!0;let e=[(0,s.x)("./assets",a.M_.board,c.Be)],t=y();c.Be!=t&&e.push((0,s.x)("./assets",a.M_.board,t)),await Promise.all(e),a.h5.loading=!1}let g=o.BB.getContext("2d",{willReadFrequently:!0}),k=o.hi.getContext("2d"),w=o.wJ.getContext("2d"),R=o.Nd.getContext("2d"),x=document.createElement("canvas"),L=x.getContext("2d"),C={except:void 0,data:void 0};function _(e){let t;e?C.except=e:e=C.except;let n=Object.assign({},a.M_.board,a.h5.hor?{w:8,h:3}:{w:3,h:8}),o=(t=a.h5.hor?m:h,a.wk.play.playing&&"retro"==a.wk.play.mode&&(t=t.concat(),a.h5.hor?(t[6]="p",t[14]="P"):(t[18]="p",t[19]="P")),t);(0,r.x)(w,o,n,c.Be,!1,a.h5.hor);let{size:l}=a.M_.board;if((0,a.Sl)()){var s,u,d;let t,n,o="retro"==a.wk.play.mode;w.save();let{offset:r}=(0,i.Eo)(a.M_.board,a.h5.hor);w.translate(r.x,r.y),o&&(s=l,w.save(),w.font="".concat(s/2,"px sans-serif"),w.strokeStyle="black",w.lineWidth=s/12,w.fillStyle="white",w.lineJoin="round",E(1,7),E(2,7),w.restore()),function(e,t){w.save(),w.globalAlpha=a.h5.isDark?.5:.4,w.fillStyle="black";for(let n=0;n<3;n++)for(let o=0;o<8;o++){if(null==e?void 0:e.includes(3*o+n))continue;let[l,r]=a.h5.hor?[o,n]:[n,o];w.fillRect(l*t,r*t,t,t)}w.restore()}(e,l),o&&(u=e,d=l,w.save(),t=a.wk.play.retro,n=+(3!=u[0]),w.lineWidth=d/12,w.strokeStyle="#0d6efd",t.uncapture&&S(n,f.g.indexOf(t.uncapture)),t.unpromote&&S(1-n,5),w.restore()),w.restore()}else if((0,r.x)(R,o,n,c.Be,!0,a.h5.hor),a.h5.selection){w.save();let{offset:e}=(0,i.Eo)(a.M_.board,a.h5.hor);w.lineWidth=l/12,w.strokeStyle="#0d6efd",w.translate(e.x,e.y);let t=h.indexOf(a.h5.selection),n=t%3;S(n,(t-n)/3),w.restore()}}function E(e,t){let{size:n}=a.M_.board,o=n/15;a.h5.hor&&([e,t]=[t,e]);let l=w.measureText("ep"),r=l.width,s=l.actualBoundingBoxDescent;w.strokeText("ep",e*n-r-o,t*n-s-o),w.fillText("ep",e*n-r-o,t*n-s-o)}function S(e,t){let{size:n}=a.M_.board,o=n/8;a.h5.hor&&([e,t]=[t,e]),w.beginPath(),function(){for(var a=arguments.length,l=Array(a),r=0;r<a;r++)l[r]=arguments[r];for(let a of l){w.moveTo(e*n+o*(a[0][0]+.5),t*n+o*(a[0][1]+.5));for(let l=1;l<a.length;l++)w.lineTo(e*n+o*(a[l][0]+.5),t*n+o*(a[l][1]+.5))}}([[0,2],[0,0],[2,0]],[[5,0],[7,0],[7,2]],[[7,5],[7,7],[5,7]],[[0,5],[0,7],[2,7]]),w.stroke()}async function M(e){e?C.data=e:e=C.data||(0,l.$p)();let t=a.M_.board;if((0,r.x)(g,e,t,c.Be),(0,r.x)(L,e,t,y()),function(e){let t=0,n=0,o=0,l=0;for(let a of e)""!=a&&(a.startsWith("'")?l++:a.startsWith("-")?o++:a==a.toUpperCase()?t++:n++);a.h5.pieceCount="(".concat(t,"+").concat(n).concat(o>0?"+"+o:"").concat(l>0?"+"+l:"",")")}(e),a.h5.dragging||((0,r.x)(k,e,t,c.Be,!0),(0,l.c8)()),location.protocol.startsWith("http")){let e=document.getElementById("Save");e.href&&URL.revokeObjectURL(e.href),o.gf.src=e.href=URL.createObjectURL(await A())}}function B(e){let{w:t,h:n}=a.M_.board;(0,r.x)(e,(0,d.mX)(t*n),a.M_.board,c.Be)}function A(){return new Promise(e=>x.toBlob(e))}function P(){B(o.w4.getContext("2d")),N()}function N(){M(),_(),a.M_.project.length&&(0,p._)()}async function F(){await b(),M()}u.IU.ctx=g},4549:function(e,t,n){n.d(t,{h:()=>o});function o(){let e=document.createElement("canvas");return[e,e.getContext("2d")]}}},r={};function s(e){var t=r[e];if(void 0!==t)return t.exports;var n=r[e]={exports:{}};return l[e].call(n.exports,n,n.exports,s),n.exports}s.m=l,s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.f={},s.e=e=>Promise.all(Object.keys(s.f).reduce((t,n)=>(s.f[n](e,t),t),[])),s.u=e=>"230"===e?"static/js/async/chess.12bc1c9d.js":"381"===e?"static/js/async/olive.1f975c72.js":"438"===e?"static/js/async/ptt.ecaf332e.js":"267"===e?"static/js/async/py.394becf6.js":""+e+".javascript",s.miniCssF=e=>""+e+".css",s.g=(()=>{if("object"==typeof globalThis)return globalThis;try{return this||Function("return this")()}catch(e){if("object"==typeof window)return window}})(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},s.l=function(t,n,o,a){if(e[t])return void e[t].push(n);if(void 0!==o)for(var l,r,i=document.getElementsByTagName("script"),c=0;c<i.length;c++){var u=i[c];if(u.getAttribute("src")==t||u.getAttribute("data-webpack")=="fen-tool:"+o){l=u;break}}l||(r=!0,(l=document.createElement("script")).charset="utf-8",l.timeout=120,s.nc&&l.setAttribute("nonce",s.nc),l.setAttribute("data-webpack","fen-tool:"+o),l.src=t),e[t]=[n];var d=function(n,o){l.onerror=l.onload=null,clearTimeout(p);var a=e[t];if(delete e[t],l.parentNode&&l.parentNode.removeChild(l),a&&a.forEach(function(e){return e(o)}),n)return n(o)},p=setTimeout(d.bind(null,void 0,{type:"timeout",target:l}),12e4);l.onerror=d.bind(null,l.onerror),l.onload=d.bind(null,l.onload),r&&document.head.appendChild(l)},s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t=[],s.O=(e,n,o,a)=>{if(n){a=a||0;for(var l=t.length;l>0&&t[l-1][2]>a;l--)t[l]=t[l-1];t[l]=[n,o,a];return}for(var r=1/0,l=0;l<t.length;l++){for(var[n,o,a]=t[l],i=!0,c=0;c<n.length;c++)(!1&a||r>=a)&&Object.keys(s.O).every(e=>s.O[e](n[c]))?n.splice(c--,1):(i=!1,a<r&&(r=a));if(i){t.splice(l--,1);var u=o();void 0!==u&&(e=u)}}return e},s.p="/fen-tool/",function(){var e="[@rsbuild/plugin-assets-retry] ";function t(e,t){for(var n=t.domain,o=0;o<n.length;o++){var a=n[o];if(-1!==e.indexOf(a))return a}return window.origin}var n=/[?#].*$/;function o(e,t,o,a,l,r){var s;return e.replace(t,o).replace(n,"")+(s=a+1,!0===r.addQuery?""!==l?"".concat(l,"&retry=").concat(s):"?retry=".concat(s):"function"==typeof r.addQuery?r.addQuery({times:s,originalQuery:l}):"")}var a=[{max:2,type:["link","script","img"],domain:[],crossOrigin:!1,delay:0,addQuery:!0,test:e=>!e.includes("gtag")}],l={},r={},i={},c={},u=s.e,d=s.u,p=s.miniCssF||s.k||function(){return null},f=s.l;function h(n){var f=Array.prototype.slice.call(arguments);f[10]||(f[10]={count:0,cssFailedCount:0});var m=f[10],y=u.apply(null,f);try{var b=d(n),g=p(n);"undefined"!=typeof window&&(b&&(window.__RB_ASYNC_CHUNKS__[b]=!0),g&&(window.__RB_ASYNC_CHUNKS__[g]=!0))}catch(t){console.error(e,"get original script or CSS filename error",t)}return m&&"number"==typeof m.count&&"number"==typeof m.cssFailedCount?(m.count+=1,y.catch(function(u){var y,b,g,k,w,R,x=m.count-1,L=m.cssFailedCount,C=!!(null==u||null==(y=u.message)?void 0:y.includes("CSS chunk"));C&&(m.cssFailedCount+=1);var _=C?L:x-L;try{var E=function(e,n,u){var f,h,m,y=u?null==(f=r[e])?void 0:f[n]:null==(h=l[e])?void 0:h[n],b=n+1;if(0===n||void 0===y){if(!(m=function(e,n){var l,r=n?p(e):d(e);if(!r)throw Error("only support cssExtract");var i=s.p,c="/"===i[0]&&"/"!==i[1]?window.origin+i+r:i+r,u=(l=c.split("?")[1])?"?".concat(l.split("#")[0]):"",f=function(e,n,o){for(var a=0;a<o.length;a++){var l,r=o[a],s=r.test,i=!0;if((null!=(l=RegExp)&&"undefined"!=typeof Symbol&&l[Symbol.hasInstance]?!!l[Symbol.hasInstance](s):s instanceof l)?i=s.test(e):"string"==typeof s?i=new RegExp(s).test(e):"function"==typeof s&&(i=s(e)),r.domain&&r.domain.length>0){var c=t(e,r);r.domain.includes(c)||(i=!1)}if(r.type&&r.type.length>0&&!r.type.includes(n)&&(i=!1),i)return r}return null}(c,n?"link":"script",a);if(!f)return null;var h=t(c,f);return{nextDomain:h,nextRetryUrl:o(c,h,h,0,u,f),originalScriptFilename:r,originalSrcUrl:c,originalQuery:u,rule:f}}(e,u)))return null;u?r[e]=[]:l[e]=[]}else{var g,k,w,R,x=y.originalScriptFilename,L=y.originalSrcUrl,C=y.originalQuery,_=y.rule,E=(g=y.nextDomain,k=_.domain,w=t(g,_),-1===(R=k.indexOf(w))?w:k[(R+1)%k.length]);m={nextDomain:E,nextRetryUrl:o(y.nextRetryUrl,y.nextDomain,E,n,C,_),originalScriptFilename:x,originalSrcUrl:L,originalQuery:C,rule:_}}return u?(r[e][b]=m,c[e]=m):(l[e][b]=m,i[e]=m),m}(n,_,C);if(!E)throw u;b=E.originalScriptFilename,g=E.nextRetryUrl,k=E.nextDomain,w=E.rule}catch(t){throw t!==u&&console.error(e,"failed to get nextRetryUrl",t),u}var S=function(e){return{times:e,domain:k,url:g,tagName:C?"link":"script",isAsyncChunk:!0}},M=S(_);if(_>=w.max)throw u.message=(null==(R=u.message)?void 0:R.includes("retries:"))?u.message:"Loading chunk ".concat(n,' from "').concat(b,'" failed after ').concat(w.max,' retries: "').concat(u.message,'"'),"function"==typeof w.onFail&&w.onFail(M),u;"function"==typeof w.onRetry&&w.onRetry(M);var B="function"==typeof w.delay?w.delay(M):w.delay;return(B>0?new Promise(function(e){return setTimeout(e,B)}):Promise.resolve()).then(function(){return h.apply(h,f)}).then(function(e){var t=(null==m?void 0:m.count)===x+2;if("function"==typeof w.onSuccess&&t){var n=S(_+1);w.onSuccess(n)}return e})})):y}"undefined"==typeof window||window.__RB_ASYNC_CHUNKS__||(window.__RB_ASYNC_CHUNKS__={});try{s.e=h,s.l=function(){var e=Array.prototype.slice.call(arguments),t=i[e[3]];return t&&(e[0]=t.nextRetryUrl),f.apply(null,e)},s.rbLoadStyleSheet=function(e,t){var n=c[t];return n&&n.nextRetryUrl||s.p+e}}catch(t){console.error(e,"Register async chunk retry runtime failed",t)}}(),s.b=document.baseURI||self.location.href,n={410:0},s.f.j=function(e,t){var o=s.o(n,e)?n[e]:void 0;if(0!==o)if(o)t.push(o[2]);else{var a=new Promise((t,a)=>o=n[e]=[t,a]);t.push(o[2]=a);var l=s.p+s.u(e),r=Error();s.l(l,function(t){if(s.o(n,e)&&(0!==(o=n[e])&&(n[e]=void 0),o)){var a=t&&("load"===t.type?"missing":t.type),l=t&&t.target&&t.target.src;r.message="Loading chunk "+e+" failed.\n("+a+": "+l+")",r.name="ChunkLoadError",r.type=a,r.request=l,o[1](r)}},"chunk-"+e,e)}},s.O.j=e=>0===n[e],o=(e,t)=>{var o,a,[l,r,i]=t,c=0;if(l.some(e=>0!==n[e])){for(o in r)s.o(r,o)&&(s.m[o]=r[o]);if(i)var u=i(s)}for(e&&e(t);c<l.length;c++)a=l[c],s.o(n,a)&&n[a]&&n[a][0](),n[a]=0;return s.O(u)},(a=self.webpackChunkfen_tool=self.webpackChunkfen_tool||[]).forEach(o.bind(null,0)),a.push=o.bind(null,a.push.bind(a));var i=s.O(void 0,["306","888"],function(){return s(4210)});i=s.O(i)})();