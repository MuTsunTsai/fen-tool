(()=>{var t={pattern:void 0,bg:void 0,exHigh:!0,border:"1",blackWhite:!1,knightOffset:.6,SN:!1,size:44,w:8,h:8,fullFEN:!1,coordinates:!1,set:"1echecs",collapse:!0},e=/^\d+(,\d+)*$/,n=[26,32,38,44],r=["1echecs","alpha","goodCompanion","kilfiger","merida","mpchess","skak"];var o=20;function s(t,e){const n=function(t){const e=t.split(",").map((t=>{const e=Number(t);return isNaN(e)?0:Math.abs(Math.floor(e))})),n=e.reduce(((t,e)=>t+e),0);return{array:e,size:n}}(t.border),r=t.coordinates?{x:o,y:o}:{x:0,y:0};!0===e&&(r.y=0),!1===e&&(r.x=0);return{w:t.w*t.size+2*n.size+r.x,h:t.h*t.size+2*n.size+r.y,border:n,offset:{x:n.size+r.x,y:n.size},margin:r}}var a="[ðŸ‡¦-ðŸ‡¿]{2}|\\p{ExtPict}\\uFE0F?\\p{EMod}?(\\u200D\\p{ExtPict}\\uFE0F?\\p{EMod}?)*",i="\\((!?)([kqbnrp])(\\d?)\\)",c="'(".concat(a,"|[^'])|''.."),l="[-~]?(\\*\\d)?(".concat("[kqbnrpcxstadg]","|").concat(c,")"),f=RegExp("^(?:".concat(a,")$"),"u"),h=("^(?:".concat(i,"|").concat(l,")$"),RegExp("\\/|\\d+|".concat(i,"|").concat(l,"|."),"iug"));var g=document.createElement("canvas"),d=g.getContext("2d"),u=new Map;function A(t){return new Promise(((e,n)=>{const r=new Image;r.onload=()=>e(r),r.onerror=n,r.src=t}))}var m=["k","q","b","n","r","p","c","x","s","t","a","d"],w=document.createElement("canvas"),b=w.getContext("2d"),p=document.createElement("canvas"),x=p.getContext("2d"),v={26:"YdVh1QDVYdVh",32:"AAAKAAAAo/+jAAr/AP8KAKP/owAAAAoAAA==",38:"AAw+DAAM3P/cDD7/AP8+DNz/3AwADD4MAA==",44:"AC9yLwAv+f/5L3L/AP9yL/n/+S8AL3IvAA==",52:"A3i2eAN4////eLb/AP+2eP///3gDeLZ4Aw==",64:"AAAEHgQAAAA/5v/mPwAE5v///+YEHv//AP//HgTm////5gQAP+b/5j8AAAAEHgQAAA==",76:"AARZhFkEAAS7////uwRZ//////9ZhP//AP//hFn//////1kEu////7sEAARZhFkEAA==",88:"AEfE68RHAEf8/////EfE///////E6///AP//68T//////8RH/P////xHAEfE68RHAA=="};function E(t,e,n,r,a,i){const{w:c,h:l,border:f,offset:h,margin:g}=s(n,i),d=function(t,e){const n=t.set+t.size*e;return u.get(n)}(n,r);t.canvas.width=c*r,t.canvas.height=l*r,t.save(),t.scale(r,r);const A="classic"==n.bg,m=a||A;t.translate(h.x,h.y);for(let o=0;o<n.h;o++)for(let s=0;s<n.w;s++)m||y(t,o,s,n),k(t,d,o,s,e[o*n.w+s],n,r);if(t.restore(),A&&!a){!function(t,e,n){const r=t.canvas;p.width=w.width=r.width,p.height=w.height=r.height,b.drawImage(r,0,0),t.save(),t.fillStyle="white",t.fillRect(0,0,r.width,r.height),t.globalCompositeOperation="destination-in",t.drawImage(w,0,0),t.restore(),t.save();const o=function(t){if("string"==typeof v[t]){const e=atob(v[t]),n=[];for(let t=0;t<e.length;t++)n.push(e.charCodeAt(t));v[t]=n}return v[t]}(e*n),s=Math.sqrt(o.length),a=(s-1)/2;for(let e=0;e<s;e++)for(let n=0;n<s;n++){const i=o[n*s+e];0!=i&&(t.globalAlpha=i/255,x.drawImage(r,e-a,n-a))}t.restore()}(t,n.size,r),t.save(),t.scale(r,r),t.translate(h.x,h.y);for(let e=0;e<n.h;e++)for(let r=0;r<n.w;r++)y(t,e,r,n);t.restore(),t.drawImage(p,0,0),t.drawImage(p,0,0),t.drawImage(p,0,0),t.drawImage(w,0,0)}t.scale(r,r),void 0===i&&n.coordinates&&(t.save(),t.translate(h.x,h.y),function(t,e,n){const{size:r,w:s,h:a}=e;t.font="15px sans-serif",t.strokeStyle="black",t.lineWidth=2,t.fillStyle="white",t.lineJoin="round";for(let e=0;e<a;e++){const s=(e+1).toString(),i=t.measureText(s),c=r*(a-e)-(r-10)/2,l=(o-i.width)/2-o-n;t.strokeText(s,l,c),t.fillText(s,l,c)}for(let e=0;e<s&&e<26;e++){const s=String.fromCharCode(97+e),i=t.measureText(s),c=r*a+o+n-5,l=r*e+(r-i.width)/2;t.strokeText(s,l,c),t.fillText(s,l,c)}}(t,n,f.size),t.restore()),a||function(t,e,n,r,o){t.save(),t.translate(o.x,0),n-=o.x,r-=o.y;let s=0;for(let o=0;o<e.array.length;o++){const a=e.array[o];if(t.strokeStyle=o%2?"white":"black",0==a)continue;t.lineWidth=a;const i=e.size-s-a/2;t.strokeRect(i,i,n-2*i,r-2*i),s+=a}t.restore()}(t,f,c,l,g)}function k(t,e,n,r,o,s,a){void 0===o&&(o="");const{size:i}=s,c=o&&o.startsWith("-");c&&(o=o.substring(1));const l=o.match(/^\*(\d)/);let h=l&&l[1]||void 0;void 0!==h&&(o=o.substring(2)),h=Number(h)%4,s.SN&&(o=function(t,e,n){return t.match(/^-?(\*\d)?[sng]$/i)?(e?(n&&(t=t.replace("s","g").replace("S","G")),t=t.replace("n","s").replace("N","S")):(n&&(t=t.replace("s","n").replace("S","N")),t=t.replace("g","s").replace("G","S")),t):t}(o,!1,!0));const g=o.toLowerCase(),d=m.indexOf(g),u=o.startsWith("'");if(d<0&&!u)return;t.save();const A=s.blackWhite,w=c?A?0:2:o==g?0:1,b=c&&A?"n"==g?s.knightOffset:.5:1,[p,x]=[h+1&2?1:0,2&h?1:0];if(t.translate((r+p)*i,(n+x)*i),0!==h&&t.rotate(Math.PI/2*h),u){!function(t,e,n){t.save();const r=f.test(e),o=n-4;t.font="".concat(o,"px sans-serif");const s=n-2;let a=t.measureText(e);if(r&&a.width>s){const n=s/a.width;t.font="".concat(o*n,"px sans-serif"),a=t.measureText(e)}const i=function(t){return t.actualBoundingBoxAscent-t.actualBoundingBoxDescent}(r?t.measureText("M"):a),c=(n-Math.min(a.width,s))/2,l=Math.max((n-i)/2,0);t.fillStyle="black",t.fillText(e,c,n-l,s),t.restore()}(t,o.substring(o.startsWith("''")?2:1),i)}else t.drawImage(e,w*i*a,d*i*a,i*b*a,i*a,0,0,i*b,i),c&&A&&t.drawImage(e,(1+b)*i*a,d*i*a,i*(1-b)*a,i*a,i*b,0,i*(1-b),i);t.restore()}function y(t,e,n,r){const o=function(t,e,n){if("mono"==t)return 1;let r=(e+n)%2;return"inverted"!=t&&(r=1-r),r}(r.pattern,e,n),s=r.size;if(t.save(),t.translate(n*s,e*s),"classic"==r.bg){if(t.strokeStyle="black",t.lineWidth=s/60,t.fillStyle="#fff",t.fillRect(0,0,s,s),!o){t.beginPath();const e=s/7.5;for(let n=0;n<s;n+=e)t.moveTo(s-n,0),t.lineTo(0,s-n),n>0&&(t.moveTo(n,s),t.lineTo(s,n));t.stroke()}}else t.fillStyle=function(t,e){return"classic"==e?"none":"gray"==e?t?"#fff":"#bbb":"green"==e?t?"#EEEED2":"#769656":t?"#FFCE9E":"#D18B47"}(o,r.bg),t.fillRect(0,0,s,s);t.restore()}var z=document.getElementById("CN"),P=z.getContext("2d"),S=Math.min(2,Math.floor(devicePixelRatio));var N=new URL(location.href).searchParams,M=N.get("fen")||"8/8/8/8/8/8/8/8",T=function(o){const s=Object.assign({},t);if(o){const t=Number(o.size);n.includes(t)&&(s.size=t),r.includes(o.set)&&(s.set=o.set),o.border="string"!=typeof(a=o.border)?null:(a=a.replace(/\D/g,",").replace(/,+/g,",").replace(/^,/,"").replace(/,$/,"")).match(e)?a:null,o.border&&(s.border=o.border),0<o.knightOffset&&o.knightOffset<1&&(s.knightOffset=o.offset),s.blackWhite=Boolean(o.blackWhite),s.pattern=o.pattern,s.bg=o.bg,s.SN=o.SN;const i=Math.floor(Number(o.w)),c=Math.floor(Number(o.h));i>0&&(s.w=i),c>0&&(s.h=c)}var a;return s}({size:N.get("size"),set:N.get("set"),knightOffset:N.get("knightOffset"),pattern:N.get("pattern"),bg:N.get("bg"),border:N.get("border"),blackWhite:N.has("blackWhite"),w:N.get("w"),h:N.get("h")}),{w:I,h:R}=function(t){const e=t.match(h)||[],n=[0];let r=0;for(const t of e)"/"==t?n[++r]=0:t.match(/^\d+$/)?n[r]+=Number(t):n[r]++;const o=n.length;if(1==o)return;const s=n[0];for(const t of n)if(t!=s)return;return{w:s,h:o}}(M)||T,D=function(t,e=8,n=8){const r=t.match(h)||[],o=[];let s=!1;for(const t of r){if("/"==t){if(!s){const t=o.length+e-o.length%e;for(;o.length<t;)o.push("")}}else if(t.match(/^\d+$/)){const e=Number(t);for(let t=0;t<e;t++)o.push("")}else o.push(t);if(s="/"!=t&&o.length%e==0,o.length==e*n)break}for(;o.length<e*n;)o.push("");return o}(M,I,R);T.w=I,T.h=R,async function(t,e,n){const r=e.set+e.size*n;if(u.has(r))return u.get(r);const o=await async function(t,e,n){const{set:r,size:o}=e;t+="/x"+n;const[s,a]=await Promise.all([A("".concat(t,"/").concat(r).concat(o,".png")),A("".concat(t,"/symbol").concat(o,".png"))]);return g.width=o*n*3,g.height=o*n*12,d.drawImage(s,0,0),d.drawImage(a,0,o*n*6),g.toDataURL()}(t,e,n),s=await A(o);return u.set(r,s),s}("../assets",T,S).then((()=>function(t,e){const{w:n,h:r}=s(e);return z.width=n*S,z.height=r*S,z.style.width=n+"px",z.style.height=r+"px",E(P,t,e,S),z}(D,T)))})();