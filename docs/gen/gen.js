(()=>{var t={pattern:void 0,bg:void 0,border:"1",blackWhite:!1,knightOffset:.6,SN:!1,size:44,w:8,h:8,set:"1echecs"},e=/^\d+(,\d+)*$/,s=[26,32,38,44],r=["1echecs","alpha","goodCompanion","merida","skak"];var n=/\/|\d+|\(!?[kqbnrp]\d?\)|[-~]?(\*\d)?([kqbsnrpcx]|'[^']|''..)|./giu;var a="０１２３４５６７８９".split(""),i=function(){const t=new Map,e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ,./<>?;':\"[]\\{}|!@#$%^&*()_+-=`~".split(""),s="ａｂｃｄｅｆｇｈｉｊｋｌｍｎｏｐｑｒｓｔｕｖｗｘｙｚＡＢＣＤＥＦＧＨＩＪＫＬＭＮＯＰＱＲＳＴＵＶＷＸＹＺ，．／＜＞？；’：”〔〕＼｛｝｜！＠＃＄％︿＆＊（）ˍ＋－＝‘～".split("");for(let r=0;r<e.length;r++)t.set(e[r],s[r]);for(let e=0;e<10;e++)t.set(e.toString(),a[e]);return t}();var o=["k","q","b","n","r","p","c","x"];function c(t,e,s,r,n,a,c){const l=c.size,f=n.startsWith("-");f&&(n=n.substring(1));const h=n.match(/^\*(\d)/);let g=h&&h[1]||void 0;void 0!==g&&(n=n.substring(2)),g=Number(g)%4,"s"==n&&(n="n"),"S"==n&&(n="N");const u=n.toLowerCase(),b=o.indexOf(u),d=n.startsWith("'"),m="gray"==c.bg;if((b<0||m)&&2!=a&&function(t,e,s,r,n){const a=n.size;t.save(),"gray"==n.bg?t.fillStyle=r?"#fff":"#bbb":t.fillStyle=r?"#FFCE9E":"#D18B47";t.fillRect(s*a,e*a,a,a),t.restore()}(t,s,r,a,c),b<0&&!d)return;t.save(),m&&(a=2);const p=c.blackWhite,k=f?p?0:2:n==u?0:1,z=f&&p?"n"==u?c.knightOffset:.5:1,[v,w]=[g+1&2?1:0,2&g?1:0];if(t.translate((r+v)*l,(s+w)*l),0!==g&&t.rotate(Math.PI/2*g),d){const e=n.substring(1);!function(t,e,s){t.fillStyle="black";const r=t.measureText(e),n=r.actualBoundingBoxAscent-r.actualBoundingBoxDescent,a=Math.max((s-r.width)/2,0),i=Math.max((s-n)/2,0);t.fillText(e,a,s-i,s)}(t,n.startsWith("''")?n.substring(2):(x=e,((y=!1)&&"c"==x.toLowerCase()?"‧":y&&"x"==x.toLowerCase()?"╳":i.get(x))||e),l)}else t.drawImage(e,(k+3*a)*l,b*l,l*z,l,0,0,l*z,l),f&&p&&t.drawImage(e,(1+z+3*a)*l,b*l,l*(1-z),l,l*z,0,l*(1-z),l);var x,y;t.restore()}function l(t,e,s){if("mono"==t)return 1;let r=(e+s)%2;return"inverted"!=t&&(r=1-r),r}var f=document.getElementById("CN"),h=f.getContext("2d");function g(t,e,s){const r=function(t){const e=t.split(",").map((t=>{const e=Number(t);return isNaN(e)?0:Math.abs(Math.floor(e))})),s=e.reduce(((t,e)=>t+e),0);return{array:e,size:s}}(s.border),n=8*s.size+2*r.size,a=8*s.size+2*r.size;f.width=n,f.height=a,function(t,e,s,r){t.save();let n=0;for(let a=0;a<e.array.length;a++){const i=e.array[a];if(t.strokeStyle=a%2?"white":"black",0==i)continue;t.lineWidth=i;const o=e.size-n-i/2;t.strokeRect(o,o,s-2*o,r-2*o),n+=i}t.restore()}(h,r,n,a),h.save(),h.translate(r.size,r.size),h.font=s.size-4+"px arial";for(let r=0;r<8;r++)for(let n=0;n<8;n++){const a=l(s.pattern,r,n);c(h,t,r,n,e[8*r+n],a,s)}return h.restore(),f}var u=new URL(location.href),b=u.searchParams.get("fen")||"8/8/8/8/8/8/8/8",d=function(t,e=8,s=8){const r=t.match(n)||[],a=[];let i=!1;for(const t of r){if("/"==t){if(!i){const t=a.length+e-a.length%e;for(;a.length<t;)a.push("")}}else if(t.match(/^\d+$/)){const e=Number(t);for(let t=0;t<e;t++)a.push("")}else a.push(t);if(i="/"!=t&&a.length%e==0,a.length==e*s)break}for(;a.length<e*s;)a.push("");return a}(b),m=function(n){const a=Object.assign({},t);if(n){const t=Number(n.size);s.includes(t)&&(a.size=t),r.includes(n.set)&&(a.set=n.set),n.border&&n.border.match(e)&&(a.border=n.border),0<n.knightOffset&&n.knightOffset<1&&(a.knightOffset=n.offset),a.blackWhite=Boolean(n.blackWhite),a.pattern=n.pattern,a.bg=n.bg,a.SN=n.SN}return a}({size:u.searchParams.get("size"),set:u.searchParams.get("set"),knightOffset:u.searchParams.get("knightOffset"),pattern:u.searchParams.get("pattern"),bg:u.searchParams.get("bg"),border:u.searchParams.get("border"),blackWhite:u.searchParams.has("blackWhite")}),p=new Image;p.onload=()=>{g(p,d,m).title=b+"\n\nGenerated by https://mutsuntsai.github.io/fen-tool"},p.src=`../assets/${m.set}${m.size}.png`})();