(()=>{var e={pattern:void 0,bg:void 0,border:"1",blackWhite:!1,knightOffset:.6,SN:!1,size:44,w:8,h:8,set:"1echecs"},t=/^\d+(,\d+)*$/,n=[26,32,38,44],r=["1echecs","alpha","goodCompanion","merida","skak"];function s(e){const t=e.split(",").map((e=>{const t=Number(e);return isNaN(t)?0:Math.abs(Math.floor(t))})),n=t.reduce(((e,t)=>e+t),0);return{array:t,size:n}}var a="[🇦-🇿]{2}|\\p{ExtPict}\\uFE0F?\\p{EMod}?(\\u200D\\p{ExtPict}\\uFE0F?\\p{EMod}?)*",o="\\((!?)([kqbnrp])(\\d?)\\)",i=`[-~]?(\\*\\d)?([kqbnrpcxstadg]|${`'(${a}|[^'])|''..`})`,c=new RegExp(`^(?:${a})$`,"u"),l=new RegExp(`\\/|\\d+|${o}|${i}|.`,"iug");var h="０１２３４５６７８９".split(""),f=function(){const e=new Map,t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ,./<>?;':\"[]\\{}|!@#$%^&*()_+-=`~".split(""),n="ａｂｃｄｅｆｇｈｉｊｋｌｍｎｏｐｑｒｓｔｕｖｗｘｙｚＡＢＣＤＥＦＧＨＩＪＫＬＭＮＯＰＱＲＳＴＵＶＷＸＹＺ，．／＜＞？；’：”〔〕＼｛｝｜！＠＃＄％︿＆＊（）ˍ＋－＝‘～".split("");for(let r=0;r<t.length;r++)e.set(t[r],n[r]);for(let t=0;t<10;t++)e.set(t.toString(),h[t]);return e}();var g=["k","q","b","n","r","p","c","x","s","t","a","d"],d=document.createElement("canvas"),u=d.getContext("2d"),m=document.createElement("canvas"),w=m.getContext("2d"),b={26:[0,0,0,0,0,0,97,213,97,0,0,213,255,213,0,0,97,213,97,0,0,0,0,0,0],32:[0,0,10,0,0,0,163,255,163,0,10,255,255,255,10,0,163,255,163,0,0,0,10,0,0],38:[0,12,62,12,0,12,220,255,220,12,62,255,255,255,62,12,220,255,220,12,0,12,62,12,0],44:[0,47,114,47,0,47,249,255,249,47,114,255,255,255,114,47,249,255,249,47,0,47,114,47,0]};function p(e,t,n,r,a){const o=s(r.border),i=r.w*r.size+2*o.size,c=r.h*r.size+2*o.size;e.canvas.width=i,e.canvas.height=c;const l="classic"==r.bg,h=a||l;h&&e.clearRect(0,0,i,c),e.save(),e.translate(o.size,o.size);for(let s=0;s<r.h;s++)for(let a=0;a<r.w;a++)h||k(e,s,a,r),v(e,t,s,a,n[s*r.w+a],r);if(e.restore(),l&&!a){!function(e,t){const n=e.canvas;m.width=d.width=n.width,m.height=d.height=n.height,u.drawImage(n,0,0),e.save(),e.fillStyle="white",e.fillRect(0,0,n.width,n.height),e.globalCompositeOperation="destination-in",e.drawImage(d,0,0),e.restore(),e.save();for(let r=0;r<5;r++)for(let s=0;s<5;s++){const a=b[t][5*s+r];0!=a&&(e.globalAlpha=a/255,w.drawImage(n,r-2,s-2))}e.restore()}(e,r.size),e.save(),e.translate(o.size,o.size);for(let t=0;t<r.h;t++)for(let n=0;n<r.w;n++)k(e,t,n,r);e.restore(),e.drawImage(m,0,0),e.drawImage(m,0,0),e.drawImage(m,0,0),e.drawImage(d,0,0)}a||function(e,t,n,r){e.save();let s=0;for(let a=0;a<t.array.length;a++){const o=t.array[a];if(e.strokeStyle=a%2?"white":"black",0==o)continue;e.lineWidth=o;const i=t.size-s-o/2;e.strokeRect(i,i,n-2*i,r-2*i),s+=o}e.restore()}(e,o,i,c)}function v(e,t,n,r,s,a){const o=a.size,i=s.startsWith("-");i&&(s=s.substring(1));const l=s.match(/^\*(\d)/);let h=l&&l[1]||void 0;void 0!==h&&(s=s.substring(2)),h=Number(h)%4,a.SN&&(s=function(e,t,n){return e.match(/^-?(\*\d)?[sng]$/i)?(t?(n&&(e=e.replace("s","g").replace("S","G")),e=e.replace("n","s").replace("N","S")):(n&&(e=e.replace("s","n").replace("S","N")),e=e.replace("g","s").replace("G","S")),e):e}(s,!1,!0));const d=s.toLowerCase(),u=g.indexOf(d),m=s.startsWith("'");if(u<0&&!m)return;e.save();const w=a.blackWhite,b=i?w?0:2:s==d?0:1,p=i&&w?"n"==d?a.knightOffset:.5:1,[v,k]=[h+1&2?1:0,2&h?1:0];if(e.translate((r+v)*o,(n+k)*o),0!==h&&e.rotate(Math.PI/2*h),m){const t=s.substring(1);!function(e,t,n){e.save();const r=c.test(t),s=n-4;e.font=`${s}px arial`;const a=n-2;let o=e.measureText(t);if(r&&o.width>a){const n=a/o.width;e.font=s*n+"px arial",o=e.measureText(t)}const i=function(e){return e.actualBoundingBoxAscent-e.actualBoundingBoxDescent}(r?e.measureText("M"):o),l=(n-Math.min(o.width,a))/2,h=Math.max((n-i)/2,0);e.fillStyle="black",e.fillText(t,l,n-h,a),e.restore()}(e,s.startsWith("''")?s.substring(2):(z=t,((x=!1)&&"c"==z.toLowerCase()?"‧":x&&"x"==z.toLowerCase()?"╳":x&&"s"==z.toLowerCase()?"■":x&&"t"==z.toLowerCase()?"▲":x&&"a"==z.toLowerCase()?"★":x&&"d"==z.toLowerCase()?"◎":f.get(z))||t),o)}else e.drawImage(t,b*o,u*o,o*p,o,0,0,o*p,o),i&&w&&e.drawImage(t,(1+p)*o,u*o,o*(1-p),o,o*p,0,o*(1-p),o);var z,x;e.restore()}function k(e,t,n,r){const s=function(e,t,n){if("mono"==e)return 1;let r=(t+n)%2;return"inverted"!=e&&(r=1-r),r}(r.pattern,t,n),a=r.size;if(e.save(),e.translate(n*a,t*a),"classic"==r.bg){if(e.strokeStyle="black",e.lineWidth=a/60,e.fillStyle="#fff",e.fillRect(0,0,a,a),!s){e.beginPath();const t=a/7.5;for(let n=0;n<a;n+=t)e.moveTo(a-n,0),e.lineTo(0,a-n),n>0&&(e.moveTo(n,a),e.lineTo(a,n));e.stroke()}}else e.fillStyle=function(e,t){return"classic"==t?"none":"gray"==t?e?"#fff":"#bbb":"green"==t?e?"#EEEED2":"#769656":e?"#FFCE9E":"#D18B47"}(s,r.bg),e.fillRect(0,0,a,a);e.restore()}var z=document.getElementById("CN"),x=z.getContext("2d");var E=document.createElement("canvas"),N=E.getContext("2d");var $=new URL(location.href).searchParams,C=$.get("fen")||"8/8/8/8/8/8/8/8",I=function(s){const a=Object.assign({},e);if(s){const e=Number(s.size),o=Math.floor(Number(s.w)),i=Math.floor(Number(s.h));n.includes(e)&&(a.size=e),r.includes(s.set)&&(a.set=s.set),s.border&&s.border.match(t)&&(a.border=s.border),0<s.knightOffset&&s.knightOffset<1&&(a.knightOffset=s.offset),a.blackWhite=Boolean(s.blackWhite),a.pattern=s.pattern,a.bg=s.bg,a.SN=s.SN,o>0&&(a.w=o),i>0&&(a.h=i)}return a}({size:$.get("size"),set:$.get("set"),knightOffset:$.get("knightOffset"),pattern:$.get("pattern"),bg:$.get("bg"),border:$.get("border"),blackWhite:$.has("blackWhite"),w:$.get("w"),h:$.get("h")}),{w:S,h:y}=function(e){const t=e.match(l)||[],n=[0];let r=0;for(const e of t)"/"==e?n[++r]=0:e.match(/^\d+$/)?n[r]+=Number(e):n[r]++;const s=n.length;if(1==s)return;const a=n[0];for(const e of n)if(e!=a)return;return{w:a,h:s}}(C)||I,M=function(e,t=8,n=8){const r=e.match(l)||[],s=[];let a=!1;for(const e of r){if("/"==e){if(!a){const e=s.length+t-s.length%t;for(;s.length<e;)s.push("")}}else if(e.match(/^\d+$/)){const t=Number(e);for(let e=0;e<t;e++)s.push("")}else s.push(e);if(a="/"!=e&&s.length%t==0,s.length==t*n)break}for(;s.length<t*n;)s.push("");return s}(C,S,y);I.w=S,I.h=y,async function(e,t){const{set:n,size:r}=t,s=new Image,a=new Image;return await Promise.all([new Promise((t=>{s.onload=t,s.src=`${e}/${n}${r}.png`})),new Promise((t=>{a.onload=t,a.src=`${e}/symbol${r}.png`}))]),E.width=3*r,E.height=12*r,N.drawImage(s,0,0),N.drawImage(a,0,6*r),E}("../assets",I).then((e=>function(e,t,n){const r=s(n.border),a=n.w*n.size+2*r.size,o=n.h*n.size+2*r.size;return z.width=a,z.height=o,p(x,e,t,n),z}(e,M,I)))})();