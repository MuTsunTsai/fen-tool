(()=>{var e={pattern:void 0,bg:void 0,exHigh:!0,border:"1",blackWhite:!1,knightOffset:.6,SN:!1,size:44,w:8,h:8,set:"1echecs",collapse:!1},t=/^\d+(,\d+)*$/,n=[26,32,38,44],s=["1echecs","alpha","goodCompanion","merida","skak"];function r(e){const t=e.split(",").map((e=>{const t=Number(e);return isNaN(t)?0:Math.abs(Math.floor(t))})),n=t.reduce(((e,t)=>e+t),0);return{array:t,size:n}}var a="[ðŸ‡¦-ðŸ‡¿]{2}|\\p{ExtPict}\\uFE0F?\\p{EMod}?(\\u200D\\p{ExtPict}\\uFE0F?\\p{EMod}?)*",o="\\((!?)([kqbnrp])(\\d?)\\)",i=`[-~]?(\\*\\d)?([kqbnrpcxstadg]|${`'(${a}|[^'])|''..`})`,c=RegExp(`^(?:${a})$`,"u"),l=RegExp(`\\/|\\d+|${o}|${i}|.`,"iug");var h=document.createElement("canvas"),f=h.getContext("2d"),g=new Map;function u(e){return new Promise(((t,n)=>{const s=new Image;s.onload=()=>t(s),s.onerror=n,s.src=e}))}var d=["k","q","b","n","r","p","c","x","s","t","a","d"],A=document.createElement("canvas"),m=A.getContext("2d"),b=document.createElement("canvas"),w=b.getContext("2d"),p={26:"YdVh1QDVYdVh",32:"AAAKAAAAo/+jAAr/AP8KAKP/owAAAAoAAA==",38:"AAw+DAAM3P/cDD7/AP8+DNz/3AwADD4MAA==",44:"AC9yLwAv+f/5L3L/AP9yL/n/+S8AL3IvAA==",52:"A3i2eAN4////eLb/AP+2eP///3gDeLZ4Aw==",64:"AAAEHgQAAAA/5v/mPwAE5v///+YEHv//AP//HgTm////5gQAP+b/5j8AAAAEHgQAAA==",76:"AARZhFkEAAS7////uwRZ//////9ZhP//AP//hFn//////1kEu////7sEAARZhFkEAA==",88:"AEfE68RHAEf8/////EfE///////E6///AP//68T//////8RH/P////xHAEfE68RHAA=="};function E(e,t,n,s,a){const o=r(n.border),i=function(e,t){const n=e.set+e.size*t;return g.get(n)}(n,s),c=n.w*n.size+2*o.size,l=n.h*n.size+2*o.size;e.canvas.width=c*s,e.canvas.height=l*s,e.save(),e.scale(s,s);const h="classic"==n.bg,f=a||h;e.translate(o.size,o.size);for(let r=0;r<n.h;r++)for(let a=0;a<n.w;a++)f||k(e,r,a,n),v(e,i,r,a,t[r*n.w+a],n,s);if(e.restore(),h&&!a){!function(e,t,n){const s=e.canvas;b.width=A.width=s.width,b.height=A.height=s.height,m.drawImage(s,0,0),e.save(),e.fillStyle="white",e.fillRect(0,0,s.width,s.height),e.globalCompositeOperation="destination-in",e.drawImage(A,0,0),e.restore(),e.save();const r=function(e){if("string"==typeof p[e]){const t=atob(p[e]),n=[];for(let e=0;e<t.length;e++)n.push(t.charCodeAt(e));p[e]=n}return p[e]}(t*n),a=Math.sqrt(r.length),o=(a-1)/2;for(let t=0;t<a;t++)for(let n=0;n<a;n++){const i=r[n*a+t];0!=i&&(e.globalAlpha=i/255,w.drawImage(s,t-o,n-o))}e.restore()}(e,n.size,s),e.save(),e.scale(s,s),e.translate(o.size,o.size);for(let t=0;t<n.h;t++)for(let s=0;s<n.w;s++)k(e,t,s,n);e.restore(),e.drawImage(b,0,0),e.drawImage(b,0,0),e.drawImage(b,0,0),e.drawImage(A,0,0)}e.scale(s,s),a||function(e,t,n,s){e.save();let r=0;for(let a=0;a<t.array.length;a++){const o=t.array[a];if(e.strokeStyle=a%2?"white":"black",0==o)continue;e.lineWidth=o;const i=t.size-r-o/2;e.strokeRect(i,i,n-2*i,s-2*i),r+=o}e.restore()}(e,o,c,l)}function v(e,t,n,s,r,a,o){const{size:i}=a,l=r.startsWith("-");l&&(r=r.substring(1));const h=r.match(/^\*(\d)/);let f=h&&h[1]||void 0;void 0!==f&&(r=r.substring(2)),f=Number(f)%4,a.SN&&(r=function(e,t,n){return e.match(/^-?(\*\d)?[sng]$/i)?(t?(n&&(e=e.replace("s","g").replace("S","G")),e=e.replace("n","s").replace("N","S")):(n&&(e=e.replace("s","n").replace("S","N")),e=e.replace("g","s").replace("G","S")),e):e}(r,!1,!0));const g=r.toLowerCase(),u=d.indexOf(g),A=r.startsWith("'");if(u<0&&!A)return;e.save();const m=a.blackWhite,b=l?m?0:2:r==g?0:1,w=l&&m?"n"==g?a.knightOffset:.5:1,[p,E]=[f+1&2?1:0,2&f?1:0];if(e.translate((s+p)*i,(n+E)*i),0!==f&&e.rotate(Math.PI/2*f),A){!function(e,t,n){e.save();const s=c.test(t),r=n-4;e.font=`${r}px sans-serif`;const a=n-2;let o=e.measureText(t);if(s&&o.width>a){const n=a/o.width;e.font=r*n+"px sans-serif",o=e.measureText(t)}const i=function(e){return e.actualBoundingBoxAscent-e.actualBoundingBoxDescent}(s?e.measureText("M"):o),l=(n-Math.min(o.width,a))/2,h=Math.max((n-i)/2,0);e.fillStyle="black",e.fillText(t,l,n-h,a),e.restore()}(e,r.substring(r.startsWith("''")?2:1),i)}else e.drawImage(t,b*i*o,u*i*o,i*w*o,i*o,0,0,i*w,i),l&&m&&e.drawImage(t,(1+w)*i*o,u*i*o,i*(1-w)*o,i*o,i*w,0,i*(1-w),i);e.restore()}function k(e,t,n,s){const r=function(e,t,n){if("mono"==e)return 1;let s=(t+n)%2;return"inverted"!=e&&(s=1-s),s}(s.pattern,t,n),a=s.size;if(e.save(),e.translate(n*a,t*a),"classic"==s.bg){if(e.strokeStyle="black",e.lineWidth=a/60,e.fillStyle="#fff",e.fillRect(0,0,a,a),!r){e.beginPath();const t=a/7.5;for(let n=0;n<a;n+=t)e.moveTo(a-n,0),e.lineTo(0,a-n),n>0&&(e.moveTo(n,a),e.lineTo(a,n));e.stroke()}}else e.fillStyle=function(e,t){return"classic"==t?"none":"gray"==t?e?"#fff":"#bbb":"green"==t?e?"#EEEED2":"#769656":e?"#FFCE9E":"#D18B47"}(r,s.bg),e.fillRect(0,0,a,a);e.restore()}var x=document.getElementById("CN"),z=x.getContext("2d"),P=Math.min(2,Math.floor(devicePixelRatio));var y=new URL(location.href).searchParams,N=y.get("fen")||"8/8/8/8/8/8/8/8",M=function(r){const a=Object.assign({},e);if(r){const e=Number(r.size),o=Math.floor(Number(r.w)),i=Math.floor(Number(r.h));n.includes(e)&&(a.size=e),s.includes(r.set)&&(a.set=r.set),r.border&&r.border.match(t)&&(a.border=r.border),0<r.knightOffset&&r.knightOffset<1&&(a.knightOffset=r.offset),a.blackWhite=Boolean(r.blackWhite),a.pattern=r.pattern,a.bg=r.bg,a.SN=r.SN,o>0&&(a.w=o),i>0&&(a.h=i)}return a}({size:y.get("size"),set:y.get("set"),knightOffset:y.get("knightOffset"),pattern:y.get("pattern"),bg:y.get("bg"),border:y.get("border"),blackWhite:y.has("blackWhite"),w:y.get("w"),h:y.get("h")}),{w:S,h:$}=function(e){const t=e.match(l)||[],n=[0];let s=0;for(const e of t)"/"==e?n[++s]=0:e.match(/^\d+$/)?n[s]+=Number(e):n[s]++;const r=n.length;if(1==r)return;const a=n[0];for(const e of n)if(e!=a)return;return{w:a,h:r}}(N)||M,I=function(e,t=8,n=8){const s=e.match(l)||[],r=[];let a=!1;for(const e of s){if("/"==e){if(!a){const e=r.length+t-r.length%t;for(;r.length<e;)r.push("")}}else if(e.match(/^\d+$/)){const t=Number(e);for(let e=0;e<t;e++)r.push("")}else r.push(e);if(a="/"!=e&&r.length%t==0,r.length==t*n)break}for(;r.length<t*n;)r.push("");return r}(N,S,$);M.w=S,M.h=$,async function(e,t,n){const s=t.set+t.size*n;if(g.has(s))return g.get(s);const r=await async function(e,t,n){const{set:s,size:r}=t;1!=n&&(e+="/x"+n);const[a,o]=await Promise.all([u(`${e}/${s}${r}.png`),u(`${e}/symbol${r}.png`)]);return h.width=r*n*3,h.height=r*n*12,f.drawImage(a,0,0),f.drawImage(o,0,r*n*6),h.toDataURL()}(e,t,n),a=await u(r);return g.set(s,a),a}("../assets",M,P).then((()=>function(e,t){const n=r(t.border),s=t.w*t.size+2*n.size,a=t.h*t.size+2*n.size;return x.width=s*P,x.height=a*P,x.style.width=s+"px",x.style.height=a+"px",E(z,e,t,P),x}(I,M)))})();