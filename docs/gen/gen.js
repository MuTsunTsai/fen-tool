(()=>{var e={pattern:void 0,bg:void 0,exHigh:!0,border:"1",blackWhite:!1,knightOffset:.6,SN:!1,size:44,w:8,h:8,coordinates:!1,set:"1echecs",collapse:!1},t=/^\d+(,\d+)*$/,n=[26,32,38,44],r=["1echecs","alpha","goodCompanion","merida","skak"];var s=20;function o(e,t){const n=function(e){const t=e.split(",").map((e=>{const t=Number(e);return isNaN(t)?0:Math.abs(Math.floor(t))})),n=t.reduce(((e,t)=>e+t),0);return{array:t,size:n}}(e.border),r=e.coordinates?{x:s,y:s}:{x:0,y:0};!0===t&&(r.y=0),!1===t&&(r.x=0);return{w:e.w*e.size+2*n.size+r.x,h:e.h*e.size+2*n.size+r.y,border:n,offset:{x:n.size+r.x,y:n.size},margin:r}}var a="[ðŸ‡¦-ðŸ‡¿]{2}|\\p{ExtPict}\\uFE0F?\\p{EMod}?(\\u200D\\p{ExtPict}\\uFE0F?\\p{EMod}?)*",i="\\((!?)([kqbnrp])(\\d?)\\)",c=`[-~]?(\\*\\d)?([kqbnrpcxstadg]|${`'(${a}|[^'])|''..`})`,l=RegExp(`^(?:${a})$`,"u"),f=RegExp(`\\/|\\d+|${i}|${c}|.`,"iug");var h=document.createElement("canvas"),g=h.getContext("2d"),d=new Map;function u(e){return new Promise(((t,n)=>{const r=new Image;r.onload=()=>t(r),r.onerror=n,r.src=e}))}var A=["k","q","b","n","r","p","c","x","s","t","a","d"],m=document.createElement("canvas"),w=m.getContext("2d"),b=document.createElement("canvas"),p=b.getContext("2d"),x={26:"YdVh1QDVYdVh",32:"AAAKAAAAo/+jAAr/AP8KAKP/owAAAAoAAA==",38:"AAw+DAAM3P/cDD7/AP8+DNz/3AwADD4MAA==",44:"AC9yLwAv+f/5L3L/AP9yL/n/+S8AL3IvAA==",52:"A3i2eAN4////eLb/AP+2eP///3gDeLZ4Aw==",64:"AAAEHgQAAAA/5v/mPwAE5v///+YEHv//AP//HgTm////5gQAP+b/5j8AAAAEHgQAAA==",76:"AARZhFkEAAS7////uwRZ//////9ZhP//AP//hFn//////1kEu////7sEAARZhFkEAA==",88:"AEfE68RHAEf8/////EfE///////E6///AP//68T//////8RH/P////xHAEfE68RHAA=="};function v(e,t,n,r,a,i){const{w:c,h:l,border:f,offset:h,margin:g}=o(n,i),u=function(e,t){const n=e.set+e.size*t;return d.get(n)}(n,r);e.canvas.width=c*r,e.canvas.height=l*r,e.save(),e.scale(r,r);const A="classic"==n.bg,v=a||A;e.translate(h.x,h.y);for(let s=0;s<n.h;s++)for(let o=0;o<n.w;o++)v||k(e,s,o,n),E(e,u,s,o,t[s*n.w+o],n,r);if(e.restore(),A&&!a){!function(e,t,n){const r=e.canvas;b.width=m.width=r.width,b.height=m.height=r.height,w.drawImage(r,0,0),e.save(),e.fillStyle="white",e.fillRect(0,0,r.width,r.height),e.globalCompositeOperation="destination-in",e.drawImage(m,0,0),e.restore(),e.save();const s=function(e){if("string"==typeof x[e]){const t=atob(x[e]),n=[];for(let e=0;e<t.length;e++)n.push(t.charCodeAt(e));x[e]=n}return x[e]}(t*n),o=Math.sqrt(s.length),a=(o-1)/2;for(let t=0;t<o;t++)for(let n=0;n<o;n++){const i=s[n*o+t];0!=i&&(e.globalAlpha=i/255,p.drawImage(r,t-a,n-a))}e.restore()}(e,n.size,r),e.save(),e.scale(r,r),e.translate(h.x,h.y);for(let t=0;t<n.h;t++)for(let r=0;r<n.w;r++)k(e,t,r,n);e.restore(),e.drawImage(b,0,0),e.drawImage(b,0,0),e.drawImage(b,0,0),e.drawImage(m,0,0)}e.scale(r,r),void 0===i&&n.coordinates&&(e.save(),e.translate(h.x,h.y),function(e,t,n){const{size:r,w:o,h:a}=t;e.font="15px sans-serif",e.strokeStyle="black",e.lineWidth=2,e.fillStyle="white",e.lineJoin="round";for(let t=0;t<a;t++){const o=(t+1).toString(),i=e.measureText(o),c=r*(a-t)-(r-10)/2,l=(s-i.width)/2-s-n;e.strokeText(o,l,c),e.fillText(o,l,c)}for(let t=0;t<o&&t<26;t++){const o=String.fromCharCode(97+t),i=e.measureText(o),c=r*a+s+n-5,l=r*t+(r-i.width)/2;e.strokeText(o,l,c),e.fillText(o,l,c)}}(e,n,f.size),e.restore()),a||function(e,t,n,r,s){e.save(),e.translate(s.x,0),n-=s.x,r-=s.y;let o=0;for(let s=0;s<t.array.length;s++){const a=t.array[s];if(e.strokeStyle=s%2?"white":"black",0==a)continue;e.lineWidth=a;const i=t.size-o-a/2;e.strokeRect(i,i,n-2*i,r-2*i),o+=a}e.restore()}(e,f,c,l,g)}function E(e,t,n,r,s,o,a){const{size:i}=o,c=s&&s.startsWith("-");c&&(s=s.substring(1));const f=s.match(/^\*(\d)/);let h=f&&f[1]||void 0;void 0!==h&&(s=s.substring(2)),h=Number(h)%4,o.SN&&(s=function(e,t,n){return e.match(/^-?(\*\d)?[sng]$/i)?(t?(n&&(e=e.replace("s","g").replace("S","G")),e=e.replace("n","s").replace("N","S")):(n&&(e=e.replace("s","n").replace("S","N")),e=e.replace("g","s").replace("G","S")),e):e}(s,!1,!0));const g=s.toLowerCase(),d=A.indexOf(g),u=s.startsWith("'");if(d<0&&!u)return;e.save();const m=o.blackWhite,w=c?m?0:2:s==g?0:1,b=c&&m?"n"==g?o.knightOffset:.5:1,[p,x]=[h+1&2?1:0,2&h?1:0];if(e.translate((r+p)*i,(n+x)*i),0!==h&&e.rotate(Math.PI/2*h),u){!function(e,t,n){e.save();const r=l.test(t),s=n-4;e.font=`${s}px sans-serif`;const o=n-2;let a=e.measureText(t);if(r&&a.width>o){const n=o/a.width;e.font=s*n+"px sans-serif",a=e.measureText(t)}const i=function(e){return e.actualBoundingBoxAscent-e.actualBoundingBoxDescent}(r?e.measureText("M"):a),c=(n-Math.min(a.width,o))/2,f=Math.max((n-i)/2,0);e.fillStyle="black",e.fillText(t,c,n-f,o),e.restore()}(e,s.substring(s.startsWith("''")?2:1),i)}else e.drawImage(t,w*i*a,d*i*a,i*b*a,i*a,0,0,i*b,i),c&&m&&e.drawImage(t,(1+b)*i*a,d*i*a,i*(1-b)*a,i*a,i*b,0,i*(1-b),i);e.restore()}function k(e,t,n,r){const s=function(e,t,n){if("mono"==e)return 1;let r=(t+n)%2;return"inverted"!=e&&(r=1-r),r}(r.pattern,t,n),o=r.size;if(e.save(),e.translate(n*o,t*o),"classic"==r.bg){if(e.strokeStyle="black",e.lineWidth=o/60,e.fillStyle="#fff",e.fillRect(0,0,o,o),!s){e.beginPath();const t=o/7.5;for(let n=0;n<o;n+=t)e.moveTo(o-n,0),e.lineTo(0,o-n),n>0&&(e.moveTo(n,o),e.lineTo(o,n));e.stroke()}}else e.fillStyle=function(e,t){return"classic"==t?"none":"gray"==t?e?"#fff":"#bbb":"green"==t?e?"#EEEED2":"#769656":e?"#FFCE9E":"#D18B47"}(s,r.bg),e.fillRect(0,0,o,o);e.restore()}var y=document.getElementById("CN"),z=y.getContext("2d"),P=Math.min(2,Math.floor(devicePixelRatio));var S=new URL(location.href).searchParams,N=S.get("fen")||"8/8/8/8/8/8/8/8",$=function(s){const o=Object.assign({},e);if(s){const e=Number(s.size);n.includes(e)&&(o.size=e),r.includes(s.set)&&(o.set=s.set),s.border="string"!=typeof(a=s.border)?null:(a=a.replace(/\D/g,",").replace(/,+/g,",").replace(/^,/,"").replace(/,$/,"")).match(t)?a:null,s.border&&(o.border=s.border),0<s.knightOffset&&s.knightOffset<1&&(o.knightOffset=s.offset),o.blackWhite=Boolean(s.blackWhite),o.pattern=s.pattern,o.bg=s.bg,o.SN=s.SN;const i=Math.floor(Number(s.w)),c=Math.floor(Number(s.h));i>0&&(o.w=i),c>0&&(o.h=c)}var a;return o}({size:S.get("size"),set:S.get("set"),knightOffset:S.get("knightOffset"),pattern:S.get("pattern"),bg:S.get("bg"),border:S.get("border"),blackWhite:S.has("blackWhite"),w:S.get("w"),h:S.get("h")}),{w:M,h:T}=function(e){const t=e.match(f)||[],n=[0];let r=0;for(const e of t)"/"==e?n[++r]=0:e.match(/^\d+$/)?n[r]+=Number(e):n[r]++;const s=n.length;if(1==s)return;const o=n[0];for(const e of n)if(e!=o)return;return{w:o,h:s}}(N)||$,I=function(e,t=8,n=8){const r=e.match(f)||[],s=[];let o=!1;for(const e of r){if("/"==e){if(!o){const e=s.length+t-s.length%t;for(;s.length<e;)s.push("")}}else if(e.match(/^\d+$/)){const t=Number(e);for(let e=0;e<t;e++)s.push("")}else s.push(e);if(o="/"!=e&&s.length%t==0,s.length==t*n)break}for(;s.length<t*n;)s.push("");return s}(N,M,T);$.w=M,$.h=T,async function(e,t,n){const r=t.set+t.size*n;if(d.has(r))return d.get(r);const s=await async function(e,t,n){const{set:r,size:s}=t;1!=n&&(e+="/x"+n);const[o,a]=await Promise.all([u(`${e}/${r}${s}.png`),u(`${e}/symbol${s}.png`)]);return h.width=s*n*3,h.height=s*n*12,g.drawImage(o,0,0),g.drawImage(a,0,s*n*6),h.toDataURL()}(e,t,n),o=await u(s);return d.set(r,o),o}("../assets",$,P).then((()=>function(e,t){const{w:n,h:r}=o(t);return y.width=n*P,y.height=r*P,y.style.width=n+"px",y.style.height=r+"px",v(z,e,t,P),y}(I,$)))})();