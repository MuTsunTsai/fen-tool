(()=>{var t={pattern:void 0,bg:void 0,border:"1",blackWhite:!1,knightOffset:.6,SN:!1,size:44,w:8,h:8,set:"1echecs"},e=/^\d+(,\d+)*$/,n=[26,32,38,44],r=["1echecs","alpha","goodCompanion","merida","skak"];var s=/\/|\d+|\(!?[kqbnrp]\d?\)|[-~]?(\*\d)?([kqbsnrpcx]|'[^']|''..)|./giu;var o="０１２３４５６７８９".split(""),i=function(){const t=new Map,e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ,./<>?;':\"[]\\{}|!@#$%^&*()_+-=`~".split(""),n="ａｂｃｄｅｆｇｈｉｊｋｌｍｎｏｐｑｒｓｔｕｖｗｘｙｚＡＢＣＤＥＦＧＨＩＪＫＬＭＮＯＰＱＲＳＴＵＶＷＸＹＺ，．／＜＞？；’：”〔〕＼｛｝｜！＠＃＄％︿＆＊（）ˍ＋－＝‘～".split("");for(let r=0;r<e.length;r++)t.set(e[r],n[r]);for(let e=0;e<10;e++)t.set(e.toString(),o[e]);return t}();var a=["k","q","b","n","r","p","c","x"];function c(t,e,n,r,s,o,c){const f=c.size,l=s.startsWith("-");l&&(s=s.substring(1));const h=s.match(/^\*(\d)/);let g=h&&h[1]||void 0;void 0!==g&&(s=s.substring(2)),g=Number(g)%4,"s"==s&&(s="n"),"S"==s&&(s="N");const u=s.toLowerCase(),b=a.indexOf(u),d=s.startsWith("'"),m="gray"==c.bg;if((b<0||m)&&2!=o&&function(t,e,n,r,s){const o=s.size;t.save(),"gray"==s.bg?t.fillStyle=r?"#fff":"#bbb":t.fillStyle=r?"#FFCE9E":"#D18B47";t.fillRect(n*o,e*o,o,o),t.restore()}(t,n,r,o,c),b<0&&!d)return;t.save(),m&&(o=2);const p=c.blackWhite,k=l?p?0:2:s==u?0:1,w=l&&p?"n"==u?c.knightOffset:.5:1,[v,z]=[g+1&2?1:0,2&g?1:0];if(t.translate((r+v)*f,(n+z)*f),0!==g&&t.rotate(Math.PI/2*g),d){const e=s.substring(1);!function(t,e,n){t.fillStyle="black";const r=t.measureText(e),s=r.actualBoundingBoxAscent-r.actualBoundingBoxDescent,o=Math.max((n-r.width)/2,0),i=Math.max((n-s)/2,0);t.fillText(e,o,n-i,n)}(t,s.startsWith("''")?s.substring(2):(N=e,((x=!1)&&"c"==N.toLowerCase()?"‧":x&&"x"==N.toLowerCase()?"╳":i.get(N))||e),f)}else t.drawImage(e,(k+3*o)*f,b*f,f*w,f,0,0,f*w,f),l&&p&&t.drawImage(e,(1+w+3*o)*f,b*f,f*(1-w),f,f*w,0,f*(1-w),f);var N,x;t.restore()}function f(t,e,n){if("mono"==t)return 1;let r=(e+n)%2;return"inverted"!=t&&(r=1-r),r}var l=document.getElementById("CN"),h=l.getContext("2d");function g(t,e,n){const r=function(t){const e=t.split(",").map((t=>{const e=Number(t);return isNaN(e)?0:Math.abs(Math.floor(e))})),n=e.reduce(((t,e)=>t+e),0);return{array:e,size:n}}(n.border),s=n.w*n.size+2*r.size,o=n.h*n.size+2*r.size;l.width=s,l.height=o,function(t,e,n,r){t.save();let s=0;for(let o=0;o<e.array.length;o++){const i=e.array[o];if(t.strokeStyle=o%2?"white":"black",0==i)continue;t.lineWidth=i;const a=e.size-s-i/2;t.strokeRect(a,a,n-2*a,r-2*a),s+=i}t.restore()}(h,r,s,o),h.save(),h.translate(r.size,r.size),h.font=n.size-4+"px arial";for(let r=0;r<n.h;r++)for(let s=0;s<n.w;s++){const o=f(n.pattern,r,s);c(h,t,r,s,e[r*n.w+s],o,n)}return h.restore(),l}var u=new URL(location.href).searchParams,b=u.get("fen")||"8/8/8/8/8/8/8/8",d=function(s){const o=Object.assign({},t);if(s){const t=Number(s.size),i=Math.floor(Number(s.w)),a=Math.floor(Number(s.h));n.includes(t)&&(o.size=t),r.includes(s.set)&&(o.set=s.set),s.border&&s.border.match(e)&&(o.border=s.border),0<s.knightOffset&&s.knightOffset<1&&(o.knightOffset=s.offset),o.blackWhite=Boolean(s.blackWhite),o.pattern=s.pattern,o.bg=s.bg,o.SN=s.SN,i>0&&(o.w=i),a>0&&(o.h=a)}return o}({size:u.get("size"),set:u.get("set"),knightOffset:u.get("knightOffset"),pattern:u.get("pattern"),bg:u.get("bg"),border:u.get("border"),blackWhite:u.has("blackWhite"),w:u.get("w"),h:u.get("h")}),{w:m,h:p}=function(t){const e=t.match(s)||[],n=[0];let r=0;for(const t of e)"/"==t?n[++r]=0:t.match(/^\d+$/)?n[r]+=Number(t):n[r]++;const o=n.length;if(1==o)return;const i=n[0];for(const t of n)if(t!=i)return;return{w:i,h:o}}(b)||d,k=function(t,e=8,n=8){const r=t.match(s)||[],o=[];let i=!1;for(const t of r){if("/"==t){if(!i){const t=o.length+e-o.length%e;for(;o.length<t;)o.push("")}}else if(t.match(/^\d+$/)){const e=Number(t);for(let t=0;t<e;t++)o.push("")}else o.push(t);if(i="/"!=t&&o.length%e==0,o.length==e*n)break}for(;o.length<e*n;)o.push("");return o}(b,m,p);d.w=m,d.h=p;var w=new Image;w.onload=()=>{g(w,k,d).title=b+"\n\nGenerated by https://mutsuntsai.github.io/fen-tool"},w.src=`../assets/${d.set}${d.size}.png`})();