"use strict";(()=>{var t=3,e=97,n={pattern:void 0,bg:void 0,exHigh:!0,border:"1",blackWhite:!1,knightOffset:.6,SN:!1,size:44,w:8,h:8,fullFEN:!1,coordinates:!1,set:"1echecs",collapse:!0},r=/^\d+(,\d+)*$/,o=[26,32,38,44],s=["1echecs","alpha","goodCompanion","kilfiger","merida","mpchess","skak"];var a=20;function c(t,e){const n=function(t){const e=t.split(",").map((t=>{const e=Number(t);return isNaN(e)?0:Math.abs(Math.floor(e))})),n=e.reduce(((t,e)=>t+e),0);return{array:e,size:n}}(t.border),r=t.coordinates?{x:a,y:a}:{x:0,y:0};!0===e&&(r.y=0),!1===e&&(r.x=0);return{w:t.w*t.size+2*n.size+r.x,h:t.h*t.size+2*n.size+r.y,border:n,offset:{x:n.size+r.x,y:n.size},margin:r}}var i="\\p{Extended_Pictographic}",l="\\p{Emoji_Modifier}",f="".concat("\\p{Regional_Indicator}","{2}|").concat(i,"\\uFE0F?").concat(l,"?(\\u200D").concat(i,"\\uFE0F?").concat(l,"?)*"),h="\\((!?)([kqbnrp])(\\d?)\\)",u="'(".concat(f,"|[^'])|''.."),g="[-~]?(\\*\\d)?(".concat("[kqbnrpcxstadg]","|").concat(u,")"),d=RegExp("^(?:".concat(f,")$"),"u"),A=("^(?:".concat(h,"|").concat(g,")$"),RegExp("\\/|\\d+|".concat(h,"|").concat(g,"|."),"iug"));var m=12,w=6,b=document.createElement("canvas"),p=b.getContext("2d"),x=new Map;function v(t){return new Promise(((e,n)=>{const r=new Image;r.onload=()=>e(r),r.onerror=n,r.src=t}))}var k=.5,E=26,y=4,z=5,N=7.5,P=60,S=255,I=["k","q","b","n","r","p","c","x","s","t","a","d"],T=document.createElement("canvas"),R=T.getContext("2d"),M=document.createElement("canvas"),D=M.getContext("2d"),C={26:"YdVh1QDVYdVh",32:"AAAKAAAAo/+jAAr/AP8KAKP/owAAAAoAAA==",38:"AAw+DAAM3P/cDD7/AP8+DNz/3AwADD4MAA==",44:"AC9yLwAv+f/5L3L/AP9yL/n/+S8AL3IvAA==",52:"A3i2eAN4////eLb/AP+2eP///3gDeLZ4Aw==",64:"AAAEHgQAAAA/5v/mPwAE5v///+YEHv//AP//HgTm////5gQAP+b/5j8AAAAEHgQAAA==",76:"AARZhFkEAAS7////uwRZ//////9ZhP//AP//hFn//////1kEu////7sEAARZhFkEAA==",88:"AEfE68RHAEf8/////EfE///////E6///AP//68T//////8RH/P////xHAEfE68RHAA=="},O={};function W(t,n,r,o,s,i){const{w:l,h:f,border:h,offset:u,margin:g}=c(r,i),d=function(t,e){const n=t.set+t.size*e;return x.get(n)}(r,o);t.canvas.width=l*o,t.canvas.height=f*o,t.save(),t.scale(o,o);const A="classic"==r.bg,m=s||A;t.translate(u.x,u.y);for(let e=0;e<r.h;e++)for(let s=0;s<r.w;s++)m||L(t,e,s,r),F(t,e,s,n[e*r.w+s],{assets:d,options:r,dpr:o});if(t.restore(),A&&!s){!function(t,e,n){const r=t.canvas;M.width=T.width=r.width,M.height=T.height=r.height,R.drawImage(r,0,0),t.save(),t.fillStyle="white",t.fillRect(0,0,r.width,r.height),t.globalCompositeOperation="destination-in",t.drawImage(T,0,0),t.restore(),t.save();const o=function(t){if(!(t in O)){const e=atob(C[t]),n=[];for(let t=0;t<e.length;t++)n.push(e.charCodeAt(t));O[t]=n}return O[t]}(e*n),s=Math.sqrt(o.length),a=(s-1)/2;for(let e=0;e<s;e++)for(let n=0;n<s;n++){const c=o[n*s+e];0!=c&&(t.globalAlpha=c/S,D.drawImage(r,e-a,n-a))}t.restore()}(t,r.size,o),t.save(),t.scale(o,o),t.translate(u.x,u.y);for(let e=0;e<r.h;e++)for(let n=0;n<r.w;n++)L(t,e,n,r);t.restore(),t.drawImage(M,0,0),t.drawImage(M,0,0),t.drawImage(M,0,0),t.drawImage(T,0,0)}t.scale(o,o),void 0===i&&r.coordinates&&(t.save(),t.translate(u.x,u.y),function(t,n,r){const{size:o,w:s,h:c}=n;t.font="15px sans-serif",t.strokeStyle="black",t.lineWidth=2,t.fillStyle="white",t.lineJoin="round";for(let e=0;e<c;e++){const n=(e+1).toString(),s=t.measureText(n),i=o*(c-e)-o/2+z,l=(a-s.width)/2-a-r;t.strokeText(n,l,i),t.fillText(n,l,i)}for(let n=0;n<s&&n<E;n++){const s=String.fromCharCode(e+n),i=t.measureText(s),l=o*c+a+r-z,f=o*n+(o-i.width)/2;t.strokeText(s,f,l),t.fillText(s,f,l)}}(t,r,h.size),t.restore()),s||function(t,e,n,r,o){t.save(),t.translate(o.x,0),n-=o.x,r-=o.y;let s=0;for(let o=0;o<e.array.length;o++){const a=e.array[o];if(t.strokeStyle=o%2?"white":"black",0==a)continue;t.lineWidth=a;const c=e.size-s-a/2;t.strokeRect(c,c,n-2*c,r-2*c),s+=a}t.restore()}(t,h,l,f,g)}function F(t,e,n,r,{assets:o,options:s,dpr:a}){const c=function(t,e){void 0===t&&(t="");const n=Boolean(t)&&t.startsWith("-");n&&(t=t.substring(1));const r=t.match(/^\*(\d)/);let o=r&&r[1]?Number(r[1]):void 0;void 0!==o&&(t=t.substring(2));o=Number(o)%4,e.SN&&(t=function(t,e,n){return t.match(/^-?(\*\d)?[sng]$/i)?(e?(n&&(t=t.replace("s","g").replace("S","G")),t=t.replace("n","s").replace("N","S")):(n&&(t=t.replace("s","n").replace("S","N")),t=t.replace("g","s").replace("G","S")),t):t}(t,!1,!0));const s=t.toLowerCase(),a=I.indexOf(s),c=t.startsWith("'");return a<0&&!c?null:{neutral:n,rotate:o,isText:c,value:t,lower:s,typeIndex:a}}(r,s);if(!c)return;const{neutral:i,rotate:l,isText:f,value:h,lower:u,typeIndex:g}=c;t.save();const A=s.blackWhite,m=function(t,e){const{neutral:n,value:r,lower:o}=t;return n?e?0:2:r==o?0:1}(c,A),w=function(t,e,n,r){return t&&n?"n"==e?r.knightOffset:k:1}(i,u,A,s),[b,p]=[l+1&2?1:0,2&l?1:0],{size:x}=s;if(t.translate((n+b)*x,(e+p)*x),0!==l&&t.rotate(Math.PI/2*l),f){!function(t,e,n){t.save();const r=d.test(e),o=n-y;t.font="".concat(o,"px sans-serif");const s=n-2;let a=t.measureText(e);if(r&&a.width>s){const n=s/a.width;t.font="".concat(o*n,"px sans-serif"),a=t.measureText(e)}const c=function(t){return t.actualBoundingBoxAscent-t.actualBoundingBoxDescent}(r?t.measureText("M"):a),i=(n-Math.min(a.width,s))/2,l=Math.max((n-c)/2,0);t.fillStyle="black",t.fillText(e,i,n-l,s),t.restore()}(t,h.substring(h.startsWith("''")?2:1),x)}else t.drawImage(o,m*x*a,g*x*a,x*w*a,x*a,0,0,x*w,x),i&&A&&t.drawImage(o,(1+w)*x*a,g*x*a,x*(1-w)*a,x*a,x*w,0,x*(1-w),x);t.restore()}function L(t,e,n,r){const o=function(t,e,n){if("mono"==t)return 1;let r=(e+n)%2;return"inverted"!=t&&(r=1-r),r}(r.pattern,e,n),s=r.size;t.save(),t.translate(n*s,e*s),"classic"==r.bg?(t.strokeStyle="black",t.lineWidth=s/P,t.fillStyle="#fff",t.fillRect(0,0,s,s),o||function(t,e){t.beginPath();const n=e/N;for(let r=0;r<e;r+=n)t.moveTo(e-r,0),t.lineTo(0,e-r),r>0&&(t.moveTo(r,e),t.lineTo(e,r));t.stroke()}(t,s)):(t.fillStyle=function(t,e){return"classic"==e?"none":"gray"==e?t?"#fff":"#bbb":"green"==e?t?"#EEEED2":"#769656":t?"#FFCE9E":"#D18B47"}(o,r.bg),t.fillRect(0,0,s,s)),t.restore()}var H=document.getElementById("CN"),B=H.getContext("2d"),$=Math.min(2,Math.floor(devicePixelRatio));var Z=new URL(location.href).searchParams,j=Z.get("fen")||"8/8/8/8/8/8/8/8",q=function(t){const e=Object.assign({},n);if(t){const n=Number(t.size);o.includes(n)&&(e.size=n),t.set&&s.includes(t.set)&&(e.set=t.set),t.border=function(t){if("string"==typeof t&&(t=t.replace(/\D/g,",").replace(/,+/g,",").replace(/^,/,"").replace(/,$/,"")).match(r))return t}(t.border),t.border&&(e.border=t.border),t.knightOffset&&0<t.knightOffset&&t.knightOffset<1&&(e.knightOffset=t.knightOffset),e.blackWhite=Boolean(t.blackWhite),e.pattern=t.pattern,e.bg=t.bg,e.SN=t.SN||!1;const a=Math.floor(Number(t.w)),c=Math.floor(Number(t.h));a>0&&(e.w=a),c>0&&(e.h=c)}return e}({size:K("size"),set:Q("set"),knightOffset:K("knightOffset"),pattern:Q("pattern"),bg:Q("bg"),border:Q("border"),blackWhite:Z.has("blackWhite"),w:K("w"),h:K("h")});function Q(t){return Z.get(t)||void 0}function K(t){const e=Z.get(t);return e?Number(e):void 0}var{w:V,h:Y}=function(t){const e=t.match(A)||[],n=[0];let r=0;for(const t of e)"/"==t?n[++r]=0:t.match(/^\d+$/)?n[r]+=Number(t):n[r]++;const o=n.length;if(1!=o&&function(t){const e=t[0];for(let n=1;n<t.length;n++)if(t[n]!=e)return!1;return!0}(n))return{w:n[0],h:o}}(j)||q,_=function(t,e=8,n=8){const r=t.match(A)||[],o=[];let s=!1;for(const t of r){if("/"==t){if(!s){const t=o.length+e-o.length%e;for(;o.length<t;)o.push("")}}else if(t.match(/^\d+$/)){const e=Number(t);for(let t=0;t<e;t++)o.push("")}else o.push(t);if(s="/"!=t&&o.length%e==0,o.length==e*n)break}for(;o.length<e*n;)o.push("");return o}(j,V,Y);q.w=V,q.h=Y,async function(e,n,r){const o=n.set+n.size*r;if(x.has(o))return x.get(o);const s=await async function(e,n,r){const{set:o,size:s}=n;e+="/x"+r;const[a,c]=await Promise.all([v("".concat(e,"/").concat(o).concat(s,".png")),v("".concat(e,"/symbol").concat(s,".png"))]);return b.width=s*r*t,b.height=s*r*m,p.drawImage(a,0,0),p.drawImage(c,0,s*r*w),b.toDataURL()}(e,n,r),a=await v(s);return x.set(o,a),a}("../assets",q,$).then((()=>function(t,e){const{w:n,h:r}=c(e);return H.width=n*$,H.height=r*$,H.style.width=n+"px",H.style.height=r+"px",W(B,t,e,$),H}(_,q)))})();