(()=>{var t={pattern:void 0,bg:void 0,border:"1",blackWhite:!1,knightOffset:.6,SN:!1,size:44,w:8,h:8,set:"1echecs"},e=/^\d+(,\d+)*$/,n=[26,32,38,44],s=["1echecs","alpha","goodCompanion","merida","skak"];function r(t){const e=t.split(",").map((t=>{const e=Number(t);return isNaN(e)?0:Math.abs(Math.floor(e))})),n=e.reduce(((t,e)=>t+e),0);return{array:e,size:n}}var o=/\/|\d+|\(!?[kqbnrp]\d?\)|[-~]?(\*\d)?([kqbsnrpcx]|'[^']|''..)|./giu;var i="０１２３４５６７８９".split(""),a=function(){const t=new Map,e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ,./<>?;':\"[]\\{}|!@#$%^&*()_+-=`~".split(""),n="ａｂｃｄｅｆｇｈｉｊｋｌｍｎｏｐｑｒｓｔｕｖｗｘｙｚＡＢＣＤＥＦＧＨＩＪＫＬＭＮＯＰＱＲＳＴＵＶＷＸＹＺ，．／＜＞？；’：”〔〕＼｛｝｜！＠＃＄％︿＆＊（）ˍ＋－＝‘～".split("");for(let s=0;s<e.length;s++)t.set(e[s],n[s]);for(let e=0;e<10;e++)t.set(e.toString(),i[e]);return t}();var l=["k","q","b","n","r","p","c","x"],c=document.createElement("canvas"),h=c.getContext("2d"),f=document.createElement("canvas"),g=f.getContext("2d"),d={26:[0,0,0,0,0,0,97,213,97,0,0,213,255,213,0,0,97,213,97,0,0,0,0,0,0],32:[0,0,10,0,0,0,163,255,163,0,10,255,255,255,10,0,163,255,163,0,0,0,10,0,0],38:[0,12,62,12,0,12,220,255,220,12,62,255,255,255,62,12,220,255,220,12,0,12,62,12,0],44:[0,47,114,47,0,47,249,255,249,47,114,255,255,255,114,47,249,255,249,47,0,47,114,47,0]};function u(t,e,n,s,o){const i=r(s.border),a=s.w*s.size+2*i.size,l=s.h*s.size+2*i.size;t.canvas.width=a,t.canvas.height=l;const u="classic"==s.bg,p=o||u;p&&t.clearRect(0,0,a,l),t.save(),t.translate(i.size,i.size);for(let r=0;r<s.h;r++)for(let o=0;o<s.w;o++){const i=p?2:m(s.pattern,r,o);b(t,e,r,o,n[r*s.w+o],i,s)}if(t.restore(),u&&!o){!function(t,e){const n=t.canvas;f.width=c.width=n.width,f.height=c.height=n.height,h.drawImage(n,0,0),t.save(),t.fillStyle="white",t.fillRect(0,0,n.width,n.height),t.globalCompositeOperation="destination-in",t.drawImage(c,0,0),t.restore(),t.save();for(let s=0;s<5;s++)for(let r=0;r<5;r++){const o=d[e][5*r+s];0!=o&&(t.globalAlpha=o/255,g.drawImage(n,s-2,r-2))}t.restore()}(t,s.size),t.save(),t.translate(i.size,i.size);for(let e=0;e<s.h;e++)for(let n=0;n<s.w;n++){w(t,e,n,m(s.pattern,e,n),s)}t.restore(),t.drawImage(f,0,0),t.drawImage(f,0,0),t.drawImage(f,0,0),t.drawImage(c,0,0)}o||function(t,e,n,s){t.save();let r=0;for(let o=0;o<e.array.length;o++){const i=e.array[o];if(t.strokeStyle=o%2?"white":"black",0==i)continue;t.lineWidth=i;const a=e.size-r-i/2;t.strokeRect(a,a,n-2*a,s-2*a),r+=i}t.restore()}(t,i,a,l)}function b(t,e,n,s,r,o,i){const c=i.size,h=r.startsWith("-");h&&(r=r.substring(1));const f=r.match(/^\*(\d)/);let g=f&&f[1]||void 0;void 0!==g&&(r=r.substring(2)),g=Number(g)%4,"s"==r&&(r="n"),"S"==r&&(r="N");const d=r.toLowerCase(),u=l.indexOf(d),b=r.startsWith("'"),m=void 0!==i.bg;if((u<0||m)&&2!=o&&w(t,n,s,o,i),u<0&&!b)return;t.save(),m&&(o=2);const p=i.blackWhite,v=h?p?0:2:r==d?0:1,k=h&&p?"n"==d?i.knightOffset:.5:1,[z,x]=[g+1&2?1:0,2&g?1:0];if(t.translate((s+z)*c,(n+x)*c),0!==g&&t.rotate(Math.PI/2*g),b){const e=r.substring(1);!function(t,e,n){t.save();const s=/\p{Extended_Pictographic}/u.test(e),r=n-4;t.font=`${r}px arial`;const o=n-2;let i=t.measureText(e);if(s&&i.width>o){const n=o/i.width;t.font=r*n+"px arial",i=t.measureText(e)}const a=i.actualBoundingBoxAscent-i.actualBoundingBoxDescent,l=(n-Math.min(i.width,o))/2,c=Math.max((n-a)/2,0);t.fillStyle="black",t.fillText(e,l,n-c,o),t.restore()}(t,r.startsWith("''")?r.substring(2):(y=e,((N=!1)&&"c"==y.toLowerCase()?"‧":N&&"x"==y.toLowerCase()?"╳":a.get(y))||e),c)}else t.drawImage(e,(v+3*o)*c,u*c,c*k,c,0,0,c*k,c),h&&p&&t.drawImage(e,(1+k+3*o)*c,u*c,c*(1-k),c,c*k,0,c*(1-k),c);var y,N;t.restore()}function m(t,e,n){if("mono"==t)return 1;let s=(e+n)%2;return"inverted"!=t&&(s=1-s),s}function w(t,e,n,s,r){const o=r.size;if(t.save(),t.translate(n*o,e*o),"classic"==r.bg){if(t.strokeStyle="black",t.lineWidth=o/60,t.fillStyle="#fff",t.fillRect(0,0,o,o),!s){t.beginPath();const e=o/8;for(let n=0;n<o;n+=e)t.moveTo(o-n,0),t.lineTo(0,o-n),n>0&&(t.moveTo(n,o),t.lineTo(o,n));t.stroke()}}else"gray"==r.bg?t.fillStyle=s?"#fff":"#bbb":"green"==r.bg?t.fillStyle=s?"#EEEED2":"#769656":t.fillStyle=s?"#FFCE9E":"#D18B47",t.fillRect(0,0,o,o);t.restore()}var p=document.getElementById("CN"),v=p.getContext("2d");var k=new URL(location.href).searchParams,z=k.get("fen")||"8/8/8/8/8/8/8/8",x=function(r){const o=Object.assign({},t);if(r){const t=Number(r.size),i=Math.floor(Number(r.w)),a=Math.floor(Number(r.h));n.includes(t)&&(o.size=t),s.includes(r.set)&&(o.set=r.set),r.border&&r.border.match(e)&&(o.border=r.border),0<r.knightOffset&&r.knightOffset<1&&(o.knightOffset=r.offset),o.blackWhite=Boolean(r.blackWhite),o.pattern=r.pattern,o.bg=r.bg,o.SN=r.SN,i>0&&(o.w=i),a>0&&(o.h=a)}return o}({size:k.get("size"),set:k.get("set"),knightOffset:k.get("knightOffset"),pattern:k.get("pattern"),bg:k.get("bg"),border:k.get("border"),blackWhite:k.has("blackWhite"),w:k.get("w"),h:k.get("h")}),{w:y,h:N}=function(t){const e=t.match(o)||[],n=[0];let s=0;for(const t of e)"/"==t?n[++s]=0:t.match(/^\d+$/)?n[s]+=Number(t):n[s]++;const r=n.length;if(1==r)return;const i=n[0];for(const t of n)if(t!=i)return;return{w:i,h:r}}(z)||x,S=function(t,e=8,n=8){const s=t.match(o)||[],r=[];let i=!1;for(const t of s){if("/"==t){if(!i){const t=r.length+e-r.length%e;for(;r.length<t;)r.push("")}}else if(t.match(/^\d+$/)){const e=Number(t);for(let t=0;t<e;t++)r.push("")}else r.push(t);if(i="/"!=t&&r.length%e==0,r.length==e*n)break}for(;r.length<e*n;)r.push("");return r}(z,y,N);x.w=y,x.h=N;var I=new Image;I.onload=()=>{(function(t,e,n){const s=r(n.border),o=n.w*n.size+2*s.size,i=n.h*n.size+2*s.size;return p.width=o,p.height=i,u(v,t,e,n),p}(I,S,x)).title=z+"\n\nGenerated by https://mutsuntsai.github.io/fen-tool"},I.src=`../assets/${x.set}${x.size}.png`})();