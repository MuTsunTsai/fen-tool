(()=>{"use strict";let e,t="\\p{Extended_Pictographic}",n="\\p{Emoji_Modifier}",r="".concat("\\p{Regional_Indicator}","{2}|").concat(t,"\\uFE0F?").concat(n,"?(\\u200D").concat(t,"\\uFE0F?").concat(n,"?)*"),a="\\((!?)([kqbnrp])(\\d?)\\)",o="[-~]?(\\*\\d)?(".concat("[kqbnrpcxstadg]","|").concat("'(".concat(r,"|[^'])|''.."),")");RegExp("^(?:".concat(r,")$"),"u"),RegExp("^(?:".concat(a,"|").concat(o,")$"),"iu");let i=RegExp("\\/|\\d+|".concat(a,"|").concat(o,"|."),"iug"),c={pattern:void 0,bg:void 0,exHigh:!0,border:"1",blackWhite:!1,knightOffset:.6,SN:!1,size:44,w:8,h:8,fullFEN:!1,coordinates:!1,set:"1echecs",collapse:!0},s=/^\d+(,\d+)*$/,l=[26,32,38,44],d=["1echecs","alpha","goodCompanion","kilfiger","merida","mpchess","skak"],u=document.currentScript,f="img[fen]",g=document.createElement("iframe");function h(t){var n;let r,a,o,u,f,h,b,m=new MessageChannel;m.port1.onmessage=n=>{t.src=n.data,t.title=e.getTitle(p,t.dataset)};let p=t.getAttribute("fen"),w=function(e){let t=Object.assign({},c);if(e){let n=Number(e.size);l.includes(n)&&(t.size=n),e.set&&d.includes(e.set)&&(t.set=e.set),e.border=function(e){if("string"==typeof e&&(e=e.replace(/\D/g,",").replace(/,+/g,",").replace(/^,/,"").replace(/,$/,"")).match(s))return e}(e.border),e.border&&(t.border=e.border),e.knightOffset&&0<e.knightOffset&&e.knightOffset<1&&(t.knightOffset=e.knightOffset),t.blackWhite=!!e.blackWhite,t.pattern=e.pattern,t.bg=e.bg,t.SN=e.SN||!1;let r=Math.floor(Number(e.w)),a=Math.floor(Number(e.h));r>0&&(t.w=r),a>0&&(t.h=a)}return t}(Object.assign({},e.getDefault(),t.dataset)),k=function(e){let t=e.match(i)||[],n=[0],r=0;for(let e of t)"/"==e?n[++r]=0:e.match(/^\d+$/)?n[r]+=Number(e):n[r]++;let a=n.length;if(1!=a&&function(e){let t=e[0];for(let n=1;n<e.length;n++)if(e[n]!=t)return!1;return!0}(n))return{w:n[0],h:a}}(p);k&&Object.assign(w,k);let{w:E,h:N}=(o=(a=(r=(n=w).border.split(",").map(e=>{let t=Number(e);return isNaN(t)?0:Math.abs(Math.floor(t))})).reduce((e,t)=>e+t,0),{array:r,size:a}),u=n.coordinates?{x:20,y:20}:{x:0,y:0},f=n.w*n.size+2*o.size+u.x,h=n.h*n.size+2*o.size+u.y,b={x:o.size+u.x,y:o.size},{w:f,h,border:o,offset:b,margin:u});t.width=E,t.height=N,g.contentWindow.postMessage({fen:p,options:w},"*",[m.port2])}function b(e){e instanceof Element&&(e.matches(f)?h(e):e.querySelectorAll(f).forEach(e=>h(e)))}async function m(t){let n=new URL(u.src).origin,r=new URL(n+"/fen-tool/api/");e=t,document.head.appendChild(g),await new Promise(e=>{let t=n=>{n.source==g.contentWindow&&(removeEventListener("message",t),e())};addEventListener("message",t),g.src=r.toString()});let a=document.documentElement;new MutationObserver(e=>{for(let t of e)if("attributes"==t.type){let e=t.attributeName.toLowerCase(),n=e.startsWith("data");t.target==u&&n&&b(document.body),"IMG"==t.target.nodeName&&("fen"==e||n)&&h(t.target)}else for(let e of t.addedNodes)b(e)}).observe(a,{childList:!0,attributes:!0,subtree:!0}),b(a)}g.style.display="none";let p=document.currentScript;m({getDefault:()=>p.dataset,getTitle:e=>e+"\n\nGenerated by https://mutsuntsai.github.io/fen-tool"})})();