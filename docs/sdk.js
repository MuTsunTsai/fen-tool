(()=>{var t=/\/|\d+|\(!?[kqbnrp]\d?\)|[-~]?(\*\d)?([kqbnrpcxstadg]|'(\p{ExtPict}\p{EMod}?(\u200D\p{ExtPict}\p{EMod}?)*|[^'])|''..)|./giu;var e={pattern:void 0,bg:void 0,border:"1",blackWhite:!1,knightOffset:.6,SN:!1,size:44,w:8,h:8,set:"1echecs"},n=/^\d+(,\d+)*$/,o=[26,32,38,44],s=["1echecs","alpha","goodCompanion","merida","skak"];var r=document.currentScript,a=new URL("api/",r.src),i=r.dataset,c="img[fen]",d=document.createElement("iframe");function u(r){const a=new MessageChannel;a.port1.onmessage=t=>{r.src=t.data,r.title=c+"\n\nGenerated by https://mutsuntsai.github.io/fen-tool"};const c=r.getAttribute("fen"),u=function(t){const r=Object.assign({},e);if(t){const e=Number(t.size),a=Math.floor(Number(t.w)),i=Math.floor(Number(t.h));o.includes(e)&&(r.size=e),s.includes(t.set)&&(r.set=t.set),t.border&&t.border.match(n)&&(r.border=t.border),0<t.knightOffset&&t.knightOffset<1&&(r.knightOffset=t.offset),r.blackWhite=Boolean(t.blackWhite),r.pattern=t.pattern,r.bg=t.bg,r.SN=t.SN,a>0&&(r.w=a),i>0&&(r.h=i)}return r}(Object.assign({},i,r.dataset)),f=function(t){const e=t.split(",").map((t=>{const e=Number(t);return isNaN(e)?0:Math.abs(Math.floor(e))})),n=e.reduce(((t,e)=>t+e),0);return{array:e,size:n}}(u.border).size,{w:h,h:b}=function(e){const n=e.match(t)||[],o=[0];let s=0;for(const t of n)"/"==t?o[++s]=0:t.match(/^\d+$/)?o[s]+=Number(t):o[s]++;const r=o.length;if(1==r)return;const a=o[0];for(const t of o)if(t!=a)return;return{w:a,h:r}}(c)||u;r.width=u.size*h+2*f,r.height=u.size*b+2*f,d.contentWindow.postMessage({fen:c,options:u},"*",[a.port2])}function f(t){t.matches(c)?u(t):t.querySelectorAll(c).forEach((t=>u(t)))}d.style.display="none",async function(){document.head.appendChild(d),await new Promise((t=>{const e=n=>{n.source==d.contentWindow&&(removeEventListener("message",e),t())};addEventListener("message",e),d.src=a.toString()}));const t=document.documentElement;new MutationObserver((t=>{for(const e of t)if("attributes"==e.type){const t=e.attributeName.toLowerCase(),n=t.startsWith("data");e.target==r&&n&&f(document),"IMG"!=e.target.nodeName||"fen"!=t&&!n||u(e.target)}else for(const t of e.addedNodes)f(t)})).observe(t,{childList:!0,attributes:!0,subtree:!0}),f(t)}()})();