(()=>{var e="[ðŸ‡¦-ðŸ‡¿]{2}|\\p{ExtPict}\\uFE0F?\\p{EMod}?(\\u200D\\p{ExtPict}\\uFE0F?\\p{EMod}?)*",t="\\((!?)([kqbnrp])(\\d?)\\)",n=`[-~]?(\\*\\d)?([kqbnrpcxstadg]|${`'(${e}|[^'])|''..`})`,o=RegExp(`\\/|\\d+|${t}|${n}|.`,"iug");var s={pattern:void 0,bg:void 0,exHigh:!0,border:"1",blackWhite:!1,knightOffset:.6,SN:!1,size:44,w:8,h:8,set:"1echecs",collapse:!1},r=/^\d+(,\d+)*$/,a=[26,32,38,44],i=["1echecs","alpha","goodCompanion","merida","skak"];var c=document.currentScript,d=new URL("api/",c.src),u=c.dataset,f="img[fen]",h=document.createElement("iframe");function b(e){const t=new MessageChannel;t.port1.onmessage=t=>{e.src=t.data,e.title=n+"\n\nGenerated by https://mutsuntsai.github.io/fen-tool"};const n=e.getAttribute("fen"),c=function(e){const t=Object.assign({},s);if(e){const n=Number(e.size),o=Math.floor(Number(e.w)),s=Math.floor(Number(e.h));a.includes(n)&&(t.size=n),i.includes(e.set)&&(t.set=e.set),e.border&&e.border.match(r)&&(t.border=e.border),0<e.knightOffset&&e.knightOffset<1&&(t.knightOffset=e.offset),t.blackWhite=Boolean(e.blackWhite),t.pattern=e.pattern,t.bg=e.bg,t.SN=e.SN,o>0&&(t.w=o),s>0&&(t.h=s)}return t}(Object.assign({},u,e.dataset)),d=function(e){const t=e.split(",").map((e=>{const t=Number(e);return isNaN(t)?0:Math.abs(Math.floor(t))})),n=t.reduce(((e,t)=>e+t),0);return{array:t,size:n}}(c.border).size,{w:f,h:b}=function(e){const t=e.match(o)||[],n=[0];let s=0;for(const e of t)"/"==e?n[++s]=0:e.match(/^\d+$/)?n[s]+=Number(e):n[s]++;const r=n.length;if(1==r)return;const a=n[0];for(const e of n)if(e!=a)return;return{w:a,h:r}}(n)||c;e.width=c.size*f+2*d,e.height=c.size*b+2*d,h.contentWindow.postMessage({fen:n,options:c},"*",[t.port2])}function m(e){e.matches(f)?b(e):e.querySelectorAll(f).forEach((e=>b(e)))}h.style.display="none",async function(){document.head.appendChild(h),await new Promise((e=>{const t=n=>{n.source==h.contentWindow&&(removeEventListener("message",t),e())};addEventListener("message",t),h.src=d.toString()}));const e=document.documentElement;new MutationObserver((e=>{for(const t of e)if("attributes"==t.type){const e=t.attributeName.toLowerCase(),n=e.startsWith("data");t.target==c&&n&&m(document),"IMG"!=t.target.nodeName||"fen"!=e&&!n||b(t.target)}else for(const e of t.addedNodes)m(e)})).observe(e,{childList:!0,attributes:!0,subtree:!0}),m(e)}()})();