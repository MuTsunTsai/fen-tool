const script=document.currentScript,apiURL=new URL("api/",script.src),globalOptions=script.dataset,frame=document.createElement("iframe");function setup(e){const t=new MessageChannel;t.port1.onmessage=t=>{e.src=t.data,e.title=n+"\n\nGenerated by https://mutsuntsai.github.io/fen-tool"};const n=e.getAttribute("fen"),s=Object.assign({},globalOptions,e.dataset);frame.contentWindow.postMessage({fen:n,options:s},"*",[t.port2])}function check(e){e.querySelectorAll("img[fen]").forEach((e=>setup(e)))}async function init(){document.body.appendChild(frame),await new Promise((e=>{const t=n=>{n.source==frame.contentWindow&&(removeEventListener("message",t),e())};addEventListener("message",t),frame.src=apiURL.toString()})),new MutationObserver((e=>{for(const t of e)if("attributes"==t.type){const e=t.attributeName.toLowerCase(),n=e.startsWith("data");t.target==script&&n&&check(document),"IMG"!=t.target.nodeName||"fen"!=e&&!n||setup(t.target)}else for(const e of t.addedNodes)check(e)})).observe(document.documentElement,{childList:!0,attributes:!0,subtree:!0}),check(document)}frame.style.display="none",addEventListener("DOMContentLoaded",init);