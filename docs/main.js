(()=>{Object.create;var t=Object.freeze,n=Object.defineProperty,o=(Object.getOwnPropertyDescriptor,Object.getOwnPropertyNames,Object.getPrototypeOf,Object.prototype.hasOwnProperty,(e,o)=>t(n(e,"raw",{value:t(o||e.slice())}))),r=Object.defineProperty,s=(e,t,n)=>(((e,t,n)=>{t in e?r(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n);function a(e){if(y(e)){const t={};for(let n=0;n<e.length;n++){const o=e[n],r=b(o)?l(o):a(o);if(r)for(const e in r)t[e]=r[e]}return t}return b(e)||k(e)?e:void 0}var i=/;(?![^(]*\))/g,c=/:(.+)/;function l(e){const t={};return e.split(i).forEach((e=>{if(e){const n=e.split(c);n.length>1&&(t[n[0].trim()]=n[1].trim())}})),t}function u(e){let t="";if(b(e))t=e;else if(y(e))for(let n=0;n<e.length;n++){const o=u(e[n]);o&&(t+=o+" ")}else if(k(e))for(const n in e)e[n]&&(t+=n+" ");return t.trim()}function f(e,t){if(e===t)return!0;let n=w(e),o=w(t);if(n||o)return!(!n||!o)&&e.getTime()===t.getTime();if(n=y(e),o=y(t),n||o)return!(!n||!o)&&function(e,t){if(e.length!==t.length)return!1;let n=!0;for(let o=0;n&&o<e.length;o++)n=f(e[o],t[o]);return n}(e,t);if(n=k(e),o=k(t),n||o){if(!n||!o)return!1;if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e){const o=e.hasOwnProperty(n),r=t.hasOwnProperty(n);if(o&&!r||!o&&r||!f(e[n],t[n]))return!1}}return String(e)===String(t)}function p(e,t){return e.findIndex((e=>f(e,t)))}var h,d=Object.assign,g=Object.prototype.hasOwnProperty,m=(e,t)=>g.call(e,t),y=Array.isArray,v=e=>"[object Map]"===A(e),w=e=>e instanceof Date,b=e=>"string"==typeof e,x=e=>"symbol"==typeof e,k=e=>null!==e&&"object"==typeof e,E=Object.prototype.toString,A=e=>E.call(e),S=e=>A(e).slice(8,-1),N=e=>b(e)&&"NaN"!==e&&"-"!==e[0]&&""+parseInt(e,10)===e,P=e=>{const t=Object.create(null);return n=>t[n]||(t[n]=e(n))},R=/-(\w)/g,C=P((e=>e.replace(R,((e,t)=>t?t.toUpperCase():"")))),O=/\B([A-Z])/g,_=P((e=>e.replace(O,"-$1").toLowerCase())),B=e=>{const t=parseFloat(e);return isNaN(t)?e:t};function I(e,t){(t=t||h)&&t.active&&t.effects.push(e)}var T,L=e=>{const t=new Set(e);return t.w=0,t.n=0,t},M=e=>(e.w&D)>0,z=e=>(e.n&D)>0,$=new WeakMap,j=0,D=1,W=30,F=[],U=Symbol(""),H=Symbol("");function K(e){const{deps:t}=e;if(t.length){for(let n=0;n<t.length;n++)t[n].delete(e);t.length=0}}function q(e,t){e.effect&&(e=e.effect.fn);const n=new class{constructor(e,t=null,n){this.fn=e,this.scheduler=t,this.active=!0,this.deps=[],I(this,n)}run(){if(!this.active)return this.fn();if(!F.includes(this))try{return F.push(T=this),Y.push(Q),Q=!0,D=1<<++j,j<=W?(({deps:e})=>{if(e.length)for(let t=0;t<e.length;t++)e[t].w|=D})(this):K(this),this.fn()}finally{j<=W&&(e=>{const{deps:t}=e;if(t.length){let n=0;for(let o=0;o<t.length;o++){const r=t[o];M(r)&&!z(r)?r.delete(e):t[n++]=r,r.w&=~D,r.n&=~D}t.length=n}})(this),D=1<<--j,Z(),F.pop();const e=F.length;T=e>0?F[e-1]:void 0}}stop(){this.active&&(K(this),this.onStop&&this.onStop(),this.active=!1)}}(e);t&&(d(n,t),t.scope&&I(n,t.scope)),(!t||!t.lazy)&&n.run();const o=n.run.bind(n);return o.effect=n,o}function G(e){e.effect.stop()}var Q=!0,Y=[];function Z(){const e=Y.pop();Q=void 0===e||e}function V(e,t,n){if(!Q||void 0===T)return;let o=$.get(e);o||$.set(e,o=new Map);let r=o.get(n);r||o.set(n,r=L()),function(e,t){let n=!1;j<=W?z(e)||(e.n|=D,n=!M(e)):n=!e.has(T),n&&(e.add(T),T.deps.push(e))}(r)}function J(e,t,n,o,r,s){const a=$.get(e);if(!a)return;let i=[];if("clear"===t)i=[...a.values()];else if("length"===n&&y(e))a.forEach(((e,t)=>{("length"===t||t>=o)&&i.push(e)}));else switch(void 0!==n&&i.push(a.get(n)),t){case"add":y(e)?N(n)&&i.push(a.get("length")):(i.push(a.get(U)),v(e)&&i.push(a.get(H)));break;case"delete":y(e)||(i.push(a.get(U)),v(e)&&i.push(a.get(H)));break;case"set":v(e)&&i.push(a.get(U))}if(1===i.length)i[0]&&X(i[0]);else{const e=[];for(const t of i)t&&e.push(...t);X(L(e))}}function X(e,t){for(const t of y(e)?e:[...e])(t!==T||t.allowRecurse)&&(t.scheduler?t.scheduler():t.run())}var ee=function(e,t){const n=Object.create(null),o=e.split(",");for(let e=0;e<o.length;e++)n[o[e]]=!0;return t?e=>!!n[e.toLowerCase()]:e=>!!n[e]}("__proto__,__v_isRef,__isVue"),te=new Set(Object.getOwnPropertyNames(Symbol).map((e=>Symbol[e])).filter(x)),ne=se(),oe=se(!0),re=function(){const e={};return["includes","indexOf","lastIndexOf"].forEach((t=>{e[t]=function(...e){const n=de(this);for(let e=0,t=this.length;e<t;e++)V(n,0,e+"");const o=n[t](...e);return-1===o||!1===o?n[t](...e.map(de)):o}})),["push","pop","shift","unshift","splice"].forEach((t=>{e[t]=function(...e){Y.push(Q),Q=!1;const n=de(this)[t].apply(this,e);return Z(),n}})),e}();function se(e=!1,t=!1){return function(n,o,r){if("__v_isReactive"===o)return!e;if("__v_isReadonly"===o)return e;if("__v_raw"===o&&r===(e?t?fe:ue:t?le:ce).get(n))return n;const s=y(n);if(!e&&s&&m(re,o))return Reflect.get(re,o,r);const a=Reflect.get(n,o,r);return(x(o)?te.has(o):ee(o))||(e||V(n,0,o),t)?a:ge(a)?s&&N(o)?a:a.value:k(a)?e?function(e){return he(e,!0,ie,null,ue)}(a):pe(a):a}}var ae={get:ne,set:function(e=!1){return function(t,n,o,r){let s=t[n];if(!e&&!function(e){return!(!e||!e.__v_isReadonly)}(o)&&(o=de(o),s=de(s),!y(t)&&ge(s)&&!ge(o)))return s.value=o,!0;const a=y(t)&&N(n)?Number(n)<t.length:m(t,n),i=Reflect.set(t,n,o,r);return t===de(r)&&(a?((e,t)=>!Object.is(e,t))(o,s)&&J(t,"set",n,o):J(t,"add",n,o)),i}}(),deleteProperty:function(e,t){const n=m(e,t);e[t];const o=Reflect.deleteProperty(e,t);return o&&n&&J(e,"delete",t,void 0),o},has:function(e,t){const n=Reflect.has(e,t);return(!x(t)||!te.has(t))&&V(e,0,t),n},ownKeys:function(e){return V(e,0,y(e)?"length":U),Reflect.ownKeys(e)}},ie={get:oe,set:(e,t)=>!0,deleteProperty:(e,t)=>!0},ce=new WeakMap,le=new WeakMap,ue=new WeakMap,fe=new WeakMap;function pe(e){return e&&e.__v_isReadonly?e:he(e,!1,ae,null,ce)}function he(e,t,n,o,r){if(!k(e)||e.__v_raw&&(!t||!e.__v_isReactive))return e;const s=r.get(e);if(s)return s;const a=function(e){return e.__v_skip||!Object.isExtensible(e)?0:function(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}(S(e))}(e);if(0===a)return e;const i=new Proxy(e,2===a?o:n);return r.set(e,i),i}function de(e){const t=e&&e.__v_raw;return t?de(t):e}function ge(e){return Boolean(e&&!0===e.__v_isRef)}Promise.resolve();var me=!1,ye=[],ve=Promise.resolve(),we=e=>ve.then(e),be=e=>{ye.includes(e)||ye.push(e),me||(me=!0,we(xe))},xe=()=>{for(const e of ye)e();ye.length=0,me=!1},ke=/^(spellcheck|draggable|form|list|type)$/,Ee=({el:e,get:t,effect:n,arg:o,modifiers:r})=>{let s;"class"===o&&(e._class=e.className),n((()=>{let n=t();if(o)(null==r?void 0:r.camel)&&(o=C(o)),Ae(e,o,n,s);else{for(const t in n)Ae(e,t,n[t],s&&s[t]);for(const t in s)(!n||!(t in n))&&Ae(e,t,null)}s=n}))},Ae=(e,t,n,o)=>{if("class"===t)e.setAttribute("class",u(e._class?[e._class,n]:n)||"");else if("style"===t){n=a(n);const{style:t}=e;if(n)if(b(n))n!==o&&(t.cssText=n);else{for(const e in n)Ne(t,e,n[e]);if(o&&!b(o))for(const e in o)null==n[e]&&Ne(t,e,"")}else e.removeAttribute("style")}else e instanceof SVGElement||!(t in e)||ke.test(t)?"true-value"===t?e._trueValue=n:"false-value"===t?e._falseValue=n:null!=n?e.setAttribute(t,n):e.removeAttribute(t):(e[t]=n,"value"===t&&(e._value=n))},Se=/\s*!important$/,Ne=(e,t,n)=>{y(n)?n.forEach((n=>Ne(e,t,n))):t.startsWith("--")?e.setProperty(t,n):Se.test(n)?e.setProperty(_(t),n.replace(Se,""),"important"):e[t]=n},Pe=(e,t)=>{const n=e.getAttribute(t);return null!=n&&e.removeAttribute(t),n},Re=(e,t,n,o)=>{e.addEventListener(t,n,o)},Ce=/^[A-Za-z_$][\w$]*(?:\.[A-Za-z_$][\w$]*|\['[^']*?']|\["[^"]*?"]|\[\d+]|\[[A-Za-z_$][\w$]*])*$/,Oe=["ctrl","shift","alt","meta"],_e={stop:e=>e.stopPropagation(),prevent:e=>e.preventDefault(),self:e=>e.target!==e.currentTarget,ctrl:e=>!e.ctrlKey,shift:e=>!e.shiftKey,alt:e=>!e.altKey,meta:e=>!e.metaKey,left:e=>"button"in e&&0!==e.button,middle:e=>"button"in e&&1!==e.button,right:e=>"button"in e&&2!==e.button,exact:(e,t)=>Oe.some((n=>e["".concat(n,"Key")]&&!t[n]))},Be=({el:e,get:t,exp:n,arg:o,modifiers:r})=>{if(!o)return;let s=Ce.test(n)?t("(e => ".concat(n,"(e))")):t("($event => { ".concat(n," })"));if("vue:mounted"!==o){if("vue:unmounted"===o)return()=>s();if(r){"click"===o&&(r.right&&(o="contextmenu"),r.middle&&(o="mouseup"));const e=s;s=t=>{if(!("key"in t)||_(t.key)in r){for(const e in r){const n=_e[e];if(n&&n(t,r))return}return e(t)}}}Re(e,o,s,r)}else we(s)},Ie=({el:e,get:t,effect:n})=>{n((()=>{e.textContent=Te(t())}))},Te=e=>null==e?"":k(e)?JSON.stringify(e,null,2):String(e),Le=e=>"_value"in e?e._value:e.value,Me=(e,t)=>{const n=t?"_trueValue":"_falseValue";return n in e?e[n]:t},ze=e=>{e.target.composing=!0},$e=e=>{const t=e.target;t.composing&&(t.composing=!1,je(t,"input"))},je=(e,t)=>{const n=document.createEvent("HTMLEvents");n.initEvent(t,!0,!0),e.dispatchEvent(n)},De=Object.create(null),We=(e,t,n)=>Fe(e,"return(".concat(t,")"),n),Fe=(e,t,n)=>{const o=De[t]||(De[t]=Ue(t));try{return o(e,n)}catch(e){console.error(e)}},Ue=e=>{try{return new Function("$data","$el","with($data){".concat(e,"}"))}catch(t){return console.error("".concat(t.message," in expression: ").concat(e)),()=>{}}},He={bind:Ee,on:Be,show:({el:e,get:t,effect:n})=>{const o=e.style.display;n((()=>{e.style.display=t()?o:"none"}))},text:Ie,html:({el:e,get:t,effect:n})=>{n((()=>{e.innerHTML=t()}))},model:({el:e,exp:t,get:n,effect:o,modifiers:r})=>{const s=e.type,a=n("(val) => { ".concat(t," = val }")),{trim:i,number:c="number"===s}=r||{};if("SELECT"===e.tagName){const t=e;Re(e,"change",(()=>{const e=Array.prototype.filter.call(t.options,(e=>e.selected)).map((e=>c?B(Le(e)):Le(e)));a(t.multiple?e:e[0])})),o((()=>{const e=n(),o=t.multiple;for(let n=0,r=t.options.length;n<r;n++){const r=t.options[n],s=Le(r);if(o)y(e)?r.selected=p(e,s)>-1:r.selected=e.has(s);else if(f(Le(r),e))return void(t.selectedIndex!==n&&(t.selectedIndex=n))}!o&&-1!==t.selectedIndex&&(t.selectedIndex=-1)}))}else if("checkbox"===s){let t;Re(e,"change",(()=>{const t=n(),o=e.checked;if(y(t)){const n=Le(e),r=p(t,n),s=-1!==r;if(o&&!s)a(t.concat(n));else if(!o&&s){const e=[...t];e.splice(r,1),a(e)}}else a(Me(e,o))})),o((()=>{const o=n();y(o)?e.checked=p(o,Le(e))>-1:o!==t&&(e.checked=f(o,Me(e,!0))),t=o}))}else if("radio"===s){let t;Re(e,"change",(()=>{a(Le(e))})),o((()=>{const o=n();o!==t&&(e.checked=f(o,Le(e)))}))}else{const t=e=>i?e.trim():c?B(e):e;Re(e,"compositionstart",ze),Re(e,"compositionend",$e),Re(e,(null==r?void 0:r.lazy)?"change":"input",(()=>{e.composing||a(t(e.value))})),i&&Re(e,"change",(()=>{e.value=e.value.trim()})),o((()=>{if(e.composing)return;const o=e.value,r=n();document.activeElement===e&&t(o)===r||o!==r&&(e.value=r)}))}},effect:({el:e,ctx:t,exp:n,effect:o})=>{we((()=>o((()=>Fe(t.scope,n,e)))))}},Ke=/([\s\S]*?)\s+(?:in|of)\s+([\s\S]*)/,qe=/,([^,\}\]]*)(?:,([^,\}\]]*))?$/,Ge=/^\(|\)$/g,Qe=/^[{[]\s*((?:[\w_$]+\s*,?\s*)+)[\]}]$/,Ye=(e,t,n)=>{const o=t.match(Ke);if(!o)return;const r=e.nextSibling,s=e.parentElement,a=new Text("");s.insertBefore(a,e),s.removeChild(e);const i=o[2].trim();let c,l,u,f,p=o[1].trim().replace(Ge,"").trim(),h=!1,d="key",g=e.getAttribute(d)||e.getAttribute(d=":key")||e.getAttribute(d="v-bind:key");g&&(e.removeAttribute(d),"key"===d&&(g=JSON.stringify(g))),(f=p.match(qe))&&(p=p.replace(qe,"").trim(),l=f[1].trim(),f[2]&&(u=f[2].trim())),(f=p.match(Qe))&&(c=f[1].split(",").map((e=>e.trim())),h="["===p[0]);let m,v,w,b=!1;const x=(e,t,o,r)=>{const s={};c?c.forEach(((e,n)=>s[e]=t[h?n:e])):s[p]=t,r?(l&&(s[l]=r),u&&(s[u]=o)):l&&(s[l]=o);const a=at(n,s),i=g?We(a.scope,g):o;return e.set(i,o),a.key=i,a},E=(t,n)=>{const o=new ct(e,t);return o.key=t.key,o.insert(s,n),o};return n.effect((()=>{const e=We(n.scope,i),t=w;if([v,w]=(e=>{const t=new Map,n=[];if(y(e))for(let o=0;o<e.length;o++)n.push(x(t,e[o],o));else if("number"==typeof e)for(let o=0;o<e;o++)n.push(x(t,o+1,o));else if(k(e)){let o=0;for(const r in e)n.push(x(t,e[r],o++,r))}return[n,t]})(e),b){for(let e=0;e<m.length;e++)w.has(m[e].key)||m[e].remove();const e=[];let n,o,r=v.length;for(;r--;){const i=v[r],c=t.get(i.key);let l;null==c?l=E(i,n?n.el:a):(l=m[c],Object.assign(l.ctx.scope,i.scope),c!==r&&(m[c+1]!==n||o===n)&&(o=l,l.insert(s,n?n.el:a))),e.unshift(n=l)}m=e}else m=v.map((e=>E(e,a))),b=!0})),r},Ze=({el:e,ctx:{scope:{$refs:t}},get:n,effect:o})=>{let r;return o((()=>{const o=n();t[o]=e,r&&o!==r&&delete t[r],r=o})),()=>{r&&delete t[r]}},Ve=/^(?:v-|:|@)/,Je=/\.([\w-]+)/g,Xe=!1,et=(e,t)=>{const n=e.nodeType;if(1===n){const n=e;if(n.hasAttribute("v-pre"))return;let o;if(Pe(n,"v-cloak"),o=Pe(n,"v-if"))return((e,t,n)=>{const o=e.parentElement,r=new Comment("v-if");o.insertBefore(r,e);const s=[{exp:t,el:e}];let a,i;for(;(a=e.nextElementSibling)&&(i=null,""===Pe(a,"v-else")||(i=Pe(a,"v-else-if")));)o.removeChild(a),s.push({exp:i,el:a});const c=e.nextSibling;o.removeChild(e);let l,u=-1;const f=()=>{l&&(o.insertBefore(r,l.el),l.remove(),l=void 0)};return n.effect((()=>{for(let e=0;e<s.length;e++){const{exp:t,el:a}=s[e];if(!t||We(n.scope,t))return void(e!==u&&(f(),l=new ct(a,n),l.insert(o,r),o.removeChild(r),u=e))}u=-1,f()})),c})(n,o,t);if(o=Pe(n,"v-for"))return Ye(n,o,t);if((o=Pe(n,"v-scope"))||""===o){const e=o?We(t.scope,o):{};t=at(t,e),e.$template&&rt(n,e.$template)}const r=null!=Pe(n,"v-once");r&&(Xe=!0),(o=Pe(n,"ref"))&&ot(n,Ze,'"'.concat(o,'"'),t),tt(n,t);const s=[];for(const{name:e,value:o}of[...n.attributes])Ve.test(e)&&"v-cloak"!==e&&("v-model"===e?s.unshift([e,o]):"@"===e[0]||/^v-on\b/.test(e)?s.push([e,o]):nt(n,e,o,t));for(const[e,o]of s)nt(n,e,o,t);r&&(Xe=!1)}else if(3===n){const n=e.data;if(n.includes(t.delimiters[0])){let o,r=[],s=0;for(;o=t.delimitersRE.exec(n);){const e=n.slice(s,o.index);e&&r.push(JSON.stringify(e)),r.push("$s(".concat(o[1],")")),s=o.index+o[0].length}s<n.length&&r.push(JSON.stringify(n.slice(s))),ot(e,Ie,r.join("+"),t)}}else 11===n&&tt(e,t)},tt=(e,t)=>{let n=e.firstChild;for(;n;)n=et(n,t)||n.nextSibling},nt=(e,t,n,o)=>{let r,s,a;if(":"===(t=t.replace(Je,((e,t)=>((a||(a={}))[t]=!0,""))))[0])r=Ee,s=t.slice(1);else if("@"===t[0])r=Be,s=t.slice(1);else{const e=t.indexOf(":"),n=e>0?t.slice(2,e):t.slice(2);r=He[n]||o.dirs[n],s=e>0?t.slice(e+1):void 0}r&&(r===Ee&&"ref"===s&&(r=Ze),ot(e,r,n,o,s,a),e.removeAttribute(t))},ot=(e,t,n,o,r,s)=>{const a=t({el:e,get:(t=n)=>We(o.scope,t,e),effect:o.effect,ctx:o,exp:n,arg:r,modifiers:s});a&&o.cleanups.push(a)},rt=(e,t)=>{if("#"!==t[0])e.innerHTML=t;else{const n=document.querySelector(t);e.appendChild(n.content.cloneNode(!0))}},st=e=>{const t={delimiters:["{{","}}"],delimitersRE:/\{\{([^]+?)\}\}/g,...e,scope:e?e.scope:pe({}),dirs:e?e.dirs:{},effects:[],blocks:[],cleanups:[],effect:e=>{if(Xe)return be(e),e;const n=q(e,{scheduler:()=>be(n)});return t.effects.push(n),n}};return t},at=(e,t={})=>{const n=e.scope,o=Object.create(n);Object.defineProperties(o,Object.getOwnPropertyDescriptors(t)),o.$refs=Object.create(n.$refs);const r=pe(new Proxy(o,{set:(e,t,o,s)=>s!==r||e.hasOwnProperty(t)?Reflect.set(e,t,o,s):Reflect.set(n,t,o)}));return it(r),{...e,scope:r}},it=e=>{for(const t of Object.keys(e))"function"==typeof e[t]&&(e[t]=e[t].bind(e))},ct=class{constructor(e,t,n=!1){s(this,"template"),s(this,"ctx"),s(this,"key"),s(this,"parentCtx"),s(this,"isFragment"),s(this,"start"),s(this,"end"),this.isFragment=e instanceof HTMLTemplateElement,n?this.template=e:this.isFragment?this.template=e.content.cloneNode(!0):this.template=e.cloneNode(!0),n?this.ctx=t:(this.parentCtx=t,t.blocks.push(this),this.ctx=st(t)),et(this.template,this.ctx)}get el(){return this.start||this.template}insert(e,t=null){if(this.isFragment)if(this.start){let n,o=this.start;for(;o&&(n=o.nextSibling,e.insertBefore(o,t),o!==this.end);)o=n}else this.start=new Text(""),this.end=new Text(""),e.insertBefore(this.end,t),e.insertBefore(this.start,this.end),e.insertBefore(this.template,this.end);else e.insertBefore(this.template,t)}remove(){if(this.parentCtx&&((e,t)=>{const n=e.indexOf(t);n>-1&&e.splice(n,1)})(this.parentCtx.blocks,this),this.start){const e=this.start.parentNode;let t,n=this.start;for(;n&&(t=n.nextSibling,e.removeChild(n),n!==this.end);)n=t}else this.template.parentNode.removeChild(this.template);this.teardown()}teardown(){this.ctx.blocks.forEach((e=>{e.teardown()})),this.ctx.effects.forEach(G),this.ctx.cleanups.forEach((e=>e()))}},lt=e=>e.replace(/[-.*+?^${}()|[\]\/\\]/g,"\\$&"),ut=e=>{const t=st();if(e&&(t.scope=pe(e),it(t.scope),e.$delimiters)){const[n,o]=t.delimiters=e.$delimiters;t.delimitersRE=new RegExp(lt(n)+"([^]+?)"+lt(o),"g")}let n;return t.scope.$s=Te,t.scope.$nextTick=we,t.scope.$refs=Object.create(null),{directive(e,n){return n?(t.dirs[e]=n,this):t.dirs[e]},mount(e){if("string"==typeof e&&!(e=document.querySelector(e)))return;let o;return o=(e=e||document.documentElement).hasAttribute("v-scope")?[e]:[...e.querySelectorAll("[v-scope]")].filter((e=>!e.matches("[v-scope] [v-scope]"))),o.length||(o=[e]),n=o.map((e=>new ct(e,t,!0))),this},unmount(){n.forEach((e=>e.teardown()))}}},ft=document.currentScript;ft&&ft.hasAttribute("init")&&ut().mount();var pt=/^\d+(,\d+)*$/;var ht=20;function dt(e,t){const n=function(e){const t=e.split(",").map((e=>{const t=Number(e);return isNaN(t)?0:Math.abs(Math.floor(t))})),n=t.reduce(((e,t)=>e+t),0);return{array:t,size:n}}(e.border),o=e.coordinates?{x:ht,y:ht}:{x:0,y:0};!0===t&&(o.y=0),!1===t&&(o.x=0);return{w:e.w*e.size+2*n.size+o.x,h:e.h*e.size+2*n.size+o.y,border:n,offset:{x:n.size+o.x,y:n.size},margin:o}}var gt=document.getElementById("CN"),mt=document.getElementById("SN"),yt=document.getElementById("TP"),vt=document.getElementById("CanvasGhost"),wt=document.getElementById("TemplateGhost"),bt=document.getElementById("FEN"),xt=document.getElementById("DB"),kt=document.getElementById("PV"),Et=navigator.clipboard,At="canShare"in navigator,St=Math.min(2,Math.floor(devicePixelRatio));var Nt=matchMedia("(hover: none), (pointer: coarse)").matches,Pt={isTop:top==self,thread:"undefined"!=typeof SharedArrayBuffer,canShare:At,canSharePng:function(){if(!At)return!1;const e=atob("iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII"),t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);const n=new Blob([t]),o=new File([n],"1.png",{type:"image/png"});return navigator.canShare({files:[o]})}(),canCopy:Et&&"writeText"in Et,canPaste:Et&&"readText"in Et,canCopyImg:Et&&"write"in Et,isTouch:Nt,isTaiwan:navigator.languages.includes("zh-TW")};function Rt(e,t,n=!1){if(!(t instanceof Object))return e;const o=Object.keys(t);for(const r of o){if(n&&!(r in e))continue;const o=t[r];o instanceof Object?e[r]instanceof Object&&e[r]!=o?e[r]=Rt(e[r],o,n):e[r]=Ct(o):e[r]=o}return e}function Ct(e){return Rt(Array.isArray(e)?[]:{},e)}var Ot,_t="function"==typeof structuredClone?structuredClone:Ct,Bt="8/8/8/8/8/8/8/8",It="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",Tt="[🇦-🇿]{2}|\\p{ExtPict}\\uFE0F?\\p{EMod}?(\\u200D\\p{ExtPict}\\uFE0F?\\p{EMod}?)*",Lt="\\((!?)([kqbnrp])(\\d?)\\)",Mt="'(".concat(Tt,"|[^'])|''.."),zt="[-~]?(\\*\\d)?(".concat("[kqbnrpcxstadg]","|").concat(Mt,")"),$t=RegExp("^(?:".concat(Tt,")$"),"u"),jt=RegExp("^(?:".concat(Lt,"|").concat(zt,")$"),"iu"),Dt=RegExp("\\/|\\d+|".concat(Lt,"|").concat(zt,"|."),"iug");function Wt(e){const t=e.match(Dt)||[],n=[0];let o=0;for(const e of t)"/"==e?n[++o]=0:e.match(/^\d+$/)?n[o]+=Number(e):n[o]++;const r=n.length;if(1==r)return;const s=n[0];for(const e of n)if(e!=s)return;return{w:s,h:r}}function Ft(e,t=8,n=8){const o=e.match(Dt)||[],r=[];let s=!1;for(const e of o){if("/"==e){if(!s){const e=r.length+t-r.length%t;for(;r.length<e;)r.push("")}}else if(e.match(/^\d+$/)){const t=Number(e);for(let e=0;e<t;e++)r.push("")}else r.push(e);if(s="/"!=e&&r.length%t==0,r.length==t*n)break}for(;r.length<t*n;)r.push("");return r}function Ut(e,t=8,n=8){let o=0,r="";function s(){o&&(r+=o),o=0}for(let a=0;a<n;a++){for(let n=0;n<t;n++){const i=a*t+n;""==e[i]?o++:(s(),r+=e[i])}s(),a<n-1&&(r+="/")}return r}function Ht(e,t,n){if(!e.match(jt))if(e.match($t))e="'"+e;else{const t=[...e].length;e=1==t&&"'"!=e?"'"+e:2==t?"''"+e:""}return(e=(e=e.replace(RegExp("^".concat(Lt,"$"),"i"),((e,t,n,o)=>{let r=n;return o&&(r="*"+o+r),t&&(r="-"+r),r}))).replace(/^~/,"-").replace(/^-(?=.*')/,"")).startsWith("-")&&(e=e.toLowerCase()),e=qt(e,t,n)}function Kt(e){const t=(e=qt(e,!1,!0)).match(/^(-?)(?:\*(\d))?([kqbnrp])$/i);return t?t[1]||t[2]?"("+(t[1]?"!":"")+t[3]+(t[2]||"")+")":t[3]:""}function qt(e,t,n){return e.match(/^-?(\*\d)?[sng]$/i)?(t?(n&&(e=e.replace("s","g").replace("S","G")),e=e.replace("n","s").replace("N","S")):(n&&(e=e.replace("s","n").replace("S","N")),e=e.replace("g","s").replace("G","S")),e):e}function Gt(e,t,n=8){return void 0===t&&(e=(e-(t=e%8))/8),String.fromCharCode(97+t)+(n-e)}function Qt(e,t=8){return{x:e.charCodeAt(0)-97,y:t-Number(e[1])}}function Yt(e,t=8,n=8){const{x:o,y:r}=Qt(e,n);return r*t+o}function Zt(e){return Array.from({length:e},(e=>""))}function Vt(e,t,n,o=8,r=8){const s=Zt(o*r);s.anime="";for(let a=0;a<r;a++)for(let i=0;i<o;i++){const c=i+t,l=a+n,u=0<=c&&c<o&&0<=l&&l<r;e[a*o+i]&&(s[l*o+c]=u?e[a*o+i]:"",s.anime+=Gt(a,i,r)+Gt(l,c,r))}return s}function Jt(e,t,n=8,o=8){const r=Zt(n*o);r.anime="";for(let s=0;s<o;s++)for(let a=0;a<n;a++){let i=a,c=s;if("-"==t&&(i=n-1-i),"|"!=t&&"/"!=t||(c=o-1-c),"/"==t||"\\"==t){const e=c-i;i+=e,c-=e}"/"==t&&(c=o-1-c),e[c*n+i]&&(r[s*n+a]=e[c*n+i],r.anime+=Gt(c,i,o)+Gt(s,a,o))}return r}function Xt(e,t,n=8,o=8){const r=Zt(n*o);n==o&&(r.anime="");for(let s=0;s<n;s++)for(let a=0;a<o;a++){const i=1==t?s:2==t?o-1-a:n-1-s,c=1==t?o-1-a:2==t?n-1-s:a;e[c*n+i]&&(r[s*o+a]=e[c*n+i],n==o&&(r.anime+=Gt(c,i,o)+Gt(s,a,o)))}return r}function en(e,t){return e.map((e=>{if(""==e||e.startsWith("-"))return e;if(!t&&e.startsWith("'"))return e;const n=e.toLowerCase();return e=e==n?e.toUpperCase():n}))}function tn(e,t="",n=""){return new RegExp(t+nn(e)+n,"i")}function nn(e){let t=4;return e.match(/^\d/)&&(t=Number(e[0]),e=e.substring(1)),e.length<=t?"\\b"+e+"\\b":"\\b"+e.substring(0,t)+on(e.substring(t))}function on(e){return""==e?"":String.raw(Ot||(Ot=o(["(?:","","|\b)"],["(?:","","|\\b)"])),e[0],on(e.substring(1)))}var rn,sn,an,cn,ln="[a-h][1-8]",un="(?:[0-9A-Z][0-9A-Z]|[A-Z])",fn=String.raw(rn||(rn=o(["[[^]]+]"],["\\[[^\\]]+\\]"]))),pn=String.raw(sn||(sn=o(["(+)?[a-z]) (S[ S]+S)"],["(\\+)?[a-z]\\) (\\S[ \\S]+\\S)"]))),hn="(?:[nwb])?r?".concat(un,"?(?<from>").concat(ln,")[-*](?<to>").concat(ln,")(?:[-*](?<then>").concat(ln,"))?"),dn="=(?<pc>[nwb])?(?<p>".concat(un,")"),gn=["condition","2option","3stipulation","2sstipulation","3forsyth","2pieces","2twin"].map(nn).join("|"),mn=new RegExp(gn,"ig"),yn=String.raw(an||(an=o(["(?:(?<move>0-0(?:-0)?|",")(?:",")*(?:",")?(?:=(?<cc>[nwb]))?(?<ep> ep.)?)(?:",")*"],["(?:(?<move>0-0(?:-0)?|",")(?:",")*(?:",")?(?:=(?<cc>[nwb]))?(?<ep> ep\\.)?)(?:",")*"])),hn,fn,dn,fn),vn=yn.replace(/\?<[^>]+>/g,""),wn=String.raw(cn||(cn=o(["(?<count>d+.(?:..)?)?(?<main>","(?:/",")*)(?: [+#=])?"],["(?<count>\\d+\\.(?:\\.\\.)?)?(?<main>","(?:\\/",")*)(?: [+#=])?"])),vn,vn);function bn(e,t,n,o){n=Sn(n),"w"==o&&(n=n.toUpperCase()),"b"==o&&(n=n.toLowerCase()),"n"==o&&(n="-"+n.toLowerCase()),e[Yt(t)]=n}function xn(e,t,n,o){return o&&o.push(t+n),t=Yt(t),e[n=Yt(n)]=e[t],e[t]="",e[n]}var kn={"*2Q":"G","*2N":"N","*1N":"Z","*3N":"CA","*3B":"GI","*3Q":"LI","*1Q":"EQ","*2P":"BP","*1B":"AN","*1K":"PO","*2K":"ST","*3K":"DU","*2R":"WE","*3R":"PA",C:"I"},En={"*1B":"25,37,AL,AN,BM,C,CT,DB,GN,GY,NH","*1K":"PO","*1N":"36,AO,BK,BN,DR,GR,KP,LS,MA,MS,OH,RK,S1,S2,S3,S4,SQ,SS,SW,UU,Z,ZE,ZH,ZR","*1P":"BS,CP,MP","*1Q":"EQ,HA,KH,L,LE,NE","*1R":"DA,DK,EK,GT,MH,RM,RO,RR,SH,WA","*2B":"15,AR,BH,BT,BU,BW,ND,PR","*2K":"ST","*2N":"N","*2P":"BP","*2Q":"G","*2R":"DG,EM,RA,RF,RH,RW,WE","*3B":"BE,BL,FE,GI,LO,OK,RB,VA","*3K":"DU","*3N":"24,35,AH,CA,DS,GH,MO,OA,SA","*3P":"O,SP","*3Q":"16,AM,EH,KA,LI,M,OR,SE,SI","*3R":"BR,CH,CR,EA,FA,PA,RE,RL,TR",A:"AG,B1,B2,B3,BI,BO,CG,CY,DO,ET,F,FR,G2,G3,GE,GF,GL,KL,KO,LB,LH,LN,LR,MG,ML,MM,NA,NL,NO,PP,QE,QF,QN,QQ,RN,RP,RT,SK,SO,TH,WR",C:"I",N:"S"},An={custom:()=>({}),default:{}};for(const e in En)for(const t of En[e].split(","))An.default[t]=e;function Sn(e){const t=e.toUpperCase(),n=function(e,t){for(const n in e)if(e[n]==t)return n}(An.custom(),t)||An.default[t];return n?e==t?n:n.toLowerCase():e}var Nn=new URL(location.href).searchParams,Pn=JSON.parse(localStorage.getItem("settings"))||{},Rn={BBS:{Id:!0,coordinates:!0,notes:!0,uncoloredNotes:!1,redBlue:!1},DB:{use:"PDB",exact:!1},PLAY:{symbol:null,ep:!0,negative:!1,zero:!1},Stockfish:{study:!1,downloaded:!1,depth:50,lines:3},feature:{janko:!1},popeye:{pieceMap:kn},board:{pattern:void 0,bg:void 0,exHigh:!0,border:"1",blackWhite:!1,knightOffset:.6,SN:!1,size:44,w:8,h:8,fullFEN:!1,coordinates:!1,set:"1echecs",collapse:!0},message:{touchTip:!0,textShortcut:!0}};Rt(Rn,Pn,!0),Pn.popeye&&(Rn.popeye.pieceMap=Pn.popeye.pieceMap),Nn.has("janko")&&(Rn.feature.janko=!0);var Cn=pe(Rn);An.custom=()=>Cn.popeye.pieceMap;var On=matchMedia("(prefers-color-scheme: dark)");On.onchange=()=>_n.isDark=On.matches;var _n=pe({loading:!0,isDark:On.matches,pieceCount:"(0+0)",hor:!1,collapse:!1,dragging:!1,selection:null,stockfish:{status:Cn.Stockfish.downloaded?3:0,running:0},syzygy:{running:!1}}),Bn=Pt.isTop?sessionStorage.getItem("state"):null,In={depth:0,score:null,mate:null,lines:[],header:[]},Tn={split:!1,tab:0,compute:"py",play:{initFEN:null,playing:!1,pendingPromotion:!1,moveNumber:-1,game:"",history:[],turn:"w",castle:{K:!0,Q:!0,k:!0,q:!0},retro:{uncapture:null,unpromote:!1},enPassant:"",halfMove:0,fullMove:1,mode:"normal"},popeye:{initFEN:null,index:null,steps:null,playing:!1,error:!1,running:!1,editMap:!1,mapping:"",input:"",output:"",intInput:null,intOutput:null},stockfish:In,syzygy:{header:null,lines:null}},Ln=pe(Bn?JSON.parse(Bn):Tn);for(const e in Tn)e in Ln||(Ln[e]=Tn[e]);function Mn(e,t,n){const{size:o,w:r}=Cn.board,{border:s,margin:a}=dt(Cn.board,t),i=s.size,c=e?t?8:3:r,l=(e||gt).clientWidth/(o*c+2*i+a.x);return{s:o*l,offset:{x:(i+a.x)*l,y:i*l,r:i*l,b:(i+a.y)*l},width:((n||r)*o+2*s.size+a.x)*l}}function zn(){return Ln.play.playing||Ln.popeye.playing}var $n=0;function jn(e,t,n,o){return{$template:"#checkbox",id:"chk"+$n++,label:t,checked:e,disabled:()=>null==o?void 0:o(),change:e=>{n&&n(e.target.checked)}}}function Dn(e,t,n,o){const r=e.split(".");let s=e.startsWith("state.")?Ln:Cn;for(s==Ln&&r.shift(),e=r.pop();r.length;)s=s[r.shift()];return jn((()=>s[e]),t,(t=>{s[e]=t,n&&n()}),o)}var Wn=0;var Fn=document.createElement("canvas"),Un=Fn.getContext("2d"),Hn=new Map;function Kn(e,t){const n=e.set+e.size*t;return Hn.get(n)}async function qn(e,t,n){const o=t.set+t.size*n;if(Hn.has(o))return Hn.get(o);const r=await async function(e,t,n){const{set:o,size:r}=t;e+="/x"+n;const[s,a]=await Promise.all([Gn("".concat(e,"/").concat(o).concat(r,".png")),Gn("".concat(e,"/symbol").concat(r,".png"))]);return Fn.width=r*n*3,Fn.height=r*n*12,Un.drawImage(s,0,0),Un.drawImage(a,0,r*n*6),Fn.toDataURL()}(e,t,n),s=await Gn(r);return Hn.set(o,s),s}function Gn(e){return new Promise(((t,n)=>{const o=new Image;o.onload=()=>t(o),o.onerror=n,o.src=e}))}var Qn=["k","q","b","n","r","p","c","x","s","t","a","d"],Yn=document.createElement("canvas"),Zn=Yn.getContext("2d"),Vn=document.createElement("canvas"),Jn=Vn.getContext("2d"),Xn={26:"YdVh1QDVYdVh",32:"AAAKAAAAo/+jAAr/AP8KAKP/owAAAAoAAA==",38:"AAw+DAAM3P/cDD7/AP8+DNz/3AwADD4MAA==",44:"AC9yLwAv+f/5L3L/AP9yL/n/+S8AL3IvAA==",52:"A3i2eAN4////eLb/AP+2eP///3gDeLZ4Aw==",64:"AAAEHgQAAAA/5v/mPwAE5v///+YEHv//AP//HgTm////5gQAP+b/5j8AAAAEHgQAAA==",76:"AARZhFkEAAS7////uwRZ//////9ZhP//AP//hFn//////1kEu////7sEAARZhFkEAA==",88:"AEfE68RHAEf8/////EfE///////E6///AP//68T//////8RH/P////xHAEfE68RHAA=="};function eo(e,t,n,o,r,s){const{w:a,h:i,border:c,offset:l,margin:u}=dt(n,s),f=Kn(n,o);e.canvas.width=a*o,e.canvas.height=i*o,e.save(),e.scale(o,o);const p="classic"==n.bg,h=r||p;e.translate(l.x,l.y);for(let r=0;r<n.h;r++)for(let s=0;s<n.w;s++)h||no(e,r,s,n),to(e,f,r,s,t[r*n.w+s],n,o);if(e.restore(),p&&!r){!function(e,t,n){const o=e.canvas;Vn.width=Yn.width=o.width,Vn.height=Yn.height=o.height,Zn.drawImage(o,0,0),e.save(),e.fillStyle="white",e.fillRect(0,0,o.width,o.height),e.globalCompositeOperation="destination-in",e.drawImage(Yn,0,0),e.restore(),e.save();const r=function(e){if("string"==typeof Xn[e]){const t=atob(Xn[e]),n=[];for(let e=0;e<t.length;e++)n.push(t.charCodeAt(e));Xn[e]=n}return Xn[e]}(t*n),s=Math.sqrt(r.length),a=(s-1)/2;for(let t=0;t<s;t++)for(let n=0;n<s;n++){const i=r[n*s+t];0!=i&&(e.globalAlpha=i/255,Jn.drawImage(o,t-a,n-a))}e.restore()}(e,n.size,o),e.save(),e.scale(o,o),e.translate(l.x,l.y);for(let t=0;t<n.h;t++)for(let o=0;o<n.w;o++)no(e,t,o,n);e.restore(),e.drawImage(Vn,0,0),e.drawImage(Vn,0,0),e.drawImage(Vn,0,0),e.drawImage(Yn,0,0)}e.scale(o,o),void 0===s&&n.coordinates&&(e.save(),e.translate(l.x,l.y),function(e,t,n){const{size:o,w:r,h:s}=t;e.font="15px sans-serif",e.strokeStyle="black",e.lineWidth=2,e.fillStyle="white",e.lineJoin="round";for(let t=0;t<s;t++){const r=(t+1).toString(),a=e.measureText(r),i=o*(s-t)-(o-10)/2,c=(ht-a.width)/2-ht-n;e.strokeText(r,c,i),e.fillText(r,c,i)}for(let t=0;t<r&&t<26;t++){const r=String.fromCharCode(97+t),a=e.measureText(r),i=o*s+ht+n-5,c=o*t+(o-a.width)/2;e.strokeText(r,c,i),e.fillText(r,c,i)}}(e,n,c.size),e.restore()),r||function(e,t,n,o,r){e.save(),e.translate(r.x,0),n-=r.x,o-=r.y;let s=0;for(let r=0;r<t.array.length;r++){const a=t.array[r];if(e.strokeStyle=r%2?"white":"black",0==a)continue;e.lineWidth=a;const i=t.size-s-a/2;e.strokeRect(i,i,n-2*i,o-2*i),s+=a}e.restore()}(e,c,a,i,u)}function to(e,t,n,o,r,s,a){void 0===r&&(r="");const{size:i}=s,c=r&&r.startsWith("-");c&&(r=r.substring(1));const l=r.match(/^\*(\d)/);let u=l&&l[1]||void 0;void 0!==u&&(r=r.substring(2)),u=Number(u)%4,s.SN&&(r=qt(r,!1,!0));const f=r.toLowerCase(),p=Qn.indexOf(f),h=r.startsWith("'");if(p<0&&!h)return;e.save();const d=s.blackWhite,g=c?d?0:2:r==f?0:1,m=c&&d?"n"==f?s.knightOffset:.5:1,[y,v]=[u+1&2?1:0,2&u?1:0];if(e.translate((o+y)*i,(n+v)*i),0!==u&&e.rotate(Math.PI/2*u),h){!function(e,t,n){e.save();const o=$t.test(t),r=n-4;e.font="".concat(r,"px sans-serif");const s=n-2;let a=e.measureText(t);if(o&&a.width>s){const n=s/a.width;e.font="".concat(r*n,"px sans-serif"),a=e.measureText(t)}const i=function(e){return e.actualBoundingBoxAscent-e.actualBoundingBoxDescent}(o?e.measureText("M"):a),c=(n-Math.min(a.width,s))/2,l=Math.max((n-i)/2,0);e.fillStyle="black",e.fillText(t,c,n-l,s),e.restore()}(e,r.substring(r.startsWith("''")?2:1),i)}else e.drawImage(t,g*i*a,p*i*a,i*m*a,i*a,0,0,i*m,i),c&&d&&e.drawImage(t,(1+m)*i*a,p*i*a,i*(1-m)*a,i*a,i*m,0,i*(1-m),i);e.restore()}function no(e,t,n,o){const r=function(e,t,n){if("mono"==e)return 1;let o=(t+n)%2;return"inverted"!=e&&(o=1-o),o}(o.pattern,t,n),s=o.size;if(e.save(),e.translate(n*s,t*s),"classic"==o.bg){if(e.strokeStyle="black",e.lineWidth=s/60,e.fillStyle="#fff",e.fillRect(0,0,s,s),!r){e.beginPath();const t=s/7.5;for(let n=0;n<s;n+=t)e.moveTo(s-n,0),e.lineTo(0,s-n),n>0&&(e.moveTo(n,s),e.lineTo(s,n));e.stroke()}}else e.fillStyle=function(e,t){return"classic"==t?"none":"gray"==t?e?"#fff":"#bbb":"green"==t?e?"#EEEED2":"#769656":e?"#FFCE9E":"#D18B47"}(r,o.bg),e.fillRect(0,0,s,s);e.restore()}var oo,ro={};function so(e,t,n,o){return ao(),(oo=new io(e,t,n,o)).promise}function ao(e){oo&&oo.stop(e?ro.callback:void 0)}var io=class{constructor(e,t,n,o){var r;this.after=o?e:t,this.reverse=o,this.promise=new Promise((e=>this.resolve=e)),this.cursor=-1,this.stages=[];const s=n.split(","),a=Ft(e),{h:i,w:c}=ro.options;for(const e of s){const t=[],n=e.match(/[`a-z]\d(=(\*\d)?[A-Z])?/g);for(let e=0;e<n.length;e+=2){let o=n[e],s=n[e+1];const l=Yt(o,c,i),u={p:a[l],promo:null==(r=s.match(/=(.+)$/))?void 0:r[1],from:Qt(o,i),to:Qt(s,i)};a[l]="",t.push(u)}this.stages.push({board:a.concat(),moves:t});for(const e of t)a[e.to.y*c+e.to.x]=e.promo||e.p}this.background=void 0,this.anime=this.step.bind(this),this.request=requestAnimationFrame(this.anime)}stop(e){cancelAnimationFrame(this.request),oo=void 0,e&&e(this.after),this.resolve()}step(e){const{ctx:t,options:n,callback:o}=ro;this.startTime||(this.startTime=e);const r=(e-this.startTime)/150,s=Math.floor(r);if(s>=this.stages.length)return this.stop(o);const a=this.reverse?this.stages.length-1-s:s;s>this.cursor?(this.cursor=s,eo(t,this.stages[a].board,n,St),this.background=t.getImageData(0,0,t.canvas.width,t.canvas.height)):t.putImageData(this.background,0,0);const i=dt(n);t.save(),t.translate(i.offset.x,i.offset.y);const c=Kn(n,St);let l=r-Math.floor(r);this.reverse&&(l=1-l);for(const e of this.stages[a].moves){const o=e.from.x*(1-l)+e.to.x*l;to(t,c,e.from.y*(1-l)+e.to.y*l,o,e.p,n,St)}t.restore(),this.request=requestAnimationFrame(this.anime)}},co="k,K,-k,q,Q,-q,b,B,-b,n,N,-n,r,R,-r,p,P,-p,c,C,-c,x,X,-x".split(","),lo="k,q,b,n,r,p,c,x,K,Q,B,N,R,P,C,X,-k,-q,-b,-n,-r,-p,-c,-x".split(",");function uo(){return Cn.board.exHigh?2:1}async function fo(){_n.loading=!0;const e=[qn("assets",Cn.board,St)],t=uo();St!=t&&e.push(qn("assets",Cn.board,t)),await Promise.all(e),_n.loading=!1}var po=gt.getContext("2d"),ho=vt.getContext("2d"),go=yt.getContext("2d"),mo=wt.getContext("2d"),yo=document.createElement("canvas"),vo=yo.getContext("2d"),wo={except:void 0,data:void 0};function bo(e){e?wo.except=e:e=wo.except;const t=Object.assign({},Cn.board,_n.hor?{w:8,h:3}:{w:3,h:8}),n=function(){let e=_n.hor?lo:co;Ln.play.playing&&"retro"==Ln.play.mode&&(e=e.concat(),_n.hor?(e[6]="p",e[14]="P"):(e[18]="p",e[19]="P"));return e}();eo(go,n,t,St,!1,_n.hor);const{size:o}=Cn.board;if(zn()){const t="retro"==Ln.play.mode;go.save();const{offset:n}=dt(Cn.board,_n.hor);go.translate(n.x,n.y),t&&(go.save(),go.font="".concat(o/2,"px sans-serif"),go.strokeStyle="black",go.lineWidth=o/12,go.fillStyle="white",go.lineJoin="round",xo(1,7),xo(2,7),go.restore()),go.save(),go.globalAlpha=_n.isDark?.5:.4,go.fillStyle="black";for(let t=0;t<3;t++)for(let n=0;n<8;n++){if(null==e?void 0:e.includes(3*n+t))continue;const[r,s]=_n.hor?[n,t]:[t,n];go.fillRect(r*o,s*o,o,o)}if(go.restore(),t){go.save();const t=Ln.play.retro,n=3==e[0]?0:1;go.lineWidth=o/12,go.strokeStyle="#0d6efd",t.uncapture&&ko(n,Qn.indexOf(t.uncapture)),t.unpromote&&ko(1-n,5),go.restore()}go.restore()}else if(eo(mo,n,t,St,!0,_n.hor),_n.selection){go.save();const{offset:e}=dt(Cn.board,_n.hor);go.lineWidth=o/12,go.strokeStyle="#0d6efd",go.translate(e.x,e.y);const t=co.indexOf(_n.selection),n=t%3;ko(n,(t-n)/3),go.restore()}}function xo(e,t){const{size:n}=Cn.board,o=n/15;_n.hor&&([e,t]=[t,e]);const r=go.measureText("ep"),s=r.width,a=r.actualBoundingBoxDescent;go.strokeText("ep",e*n-s-o,t*n-a-o),go.fillText("ep",e*n-s-o,t*n-a-o)}function ko(e,t){const{size:n}=Cn.board,o=n/8;_n.hor&&([e,t]=[t,e]);const r=.5,s=(...s)=>{go.moveTo(e*n+o*(s[0][0]+r),t*n+o*(s[0][1]+r));for(let a=1;a<s.length;a++)go.lineTo(e*n+o*(s[a][0]+r),t*n+o*(s[a][1]+r))};go.beginPath(),s([0,2],[0,0],[2,0]),s([5,0],[7,0],[7,2]),s([7,5],[7,7],[5,7]),s([0,5],[0,7],[2,7]),go.stroke()}async function Eo(e){e?wo.data=e:e=wo.data||Jo();const t=Cn.board;if(eo(po,e,t,St),eo(vo,e,t,uo()),function(e){let t=0,n=0,o=0,r=0;for(const s of e)""!=s&&(s.startsWith("'")?r++:s.startsWith("-")?o++:s==s.toUpperCase()?t++:n++);_n.pieceCount="(".concat(t,"+").concat(n).concat(o>0?"+"+o:"").concat(r>0?"+"+r:"",")")}(e),_n.dragging||(eo(ho,e,t,St,!0),Vo()),location.protocol.startsWith("http")){const e=document.getElementById("Save");e.href&&URL.revokeObjectURL(e.href),kt.src=e.href=URL.createObjectURL(await So())}}function Ao(e){const{w:t,h:n}=Cn.board;eo(e,Zt(t*n),Cn.board,St)}function So(){return new Promise((e=>yo.toBlob(e)))}ro.ctx=po,addEventListener("storage",(e=>{if(e.storageArea==localStorage&&"settings"==e.key){const e=JSON.parse(localStorage.getItem("settings"));Rt(Cn,e,!0),Oo({},!0)}}));var No=document.getElementById("Zone"),Po=document.getElementById("DragZone"),Ro=document.getElementById("EditZone");function Co(){return document.body.clientWidth/(Ln.split?2:1)}async function Oo(e,t){const n=Cn.board,o={};for(const t in n)o[t]=void 0!==e[t]&&e[t]!==n[t],o[t]?n[t]=e[t]:e[t]=n[t];const{border:r,margin:s,w:a,h:i}=dt(e),c=Io(),l=Co()<(e.w+3)*e.size+s.x+4*r.size+4.2*c;o.mode=l!==_n.hor,_n.hor=l;const u=o.w||o.h;(u||t)&&function(){const{w:e,h:t}=Cn.board,n=e*t;Do.style.gridTemplateColumns="repeat(".concat(e,", 1fr)"),Do.style.gridTemplateRows="repeat(".concat(t,", 1fr)");for(let e=0;e<n||e<jo.length;e++){if(!jo[e]){const t=document.createElement("input");jo[e]=t,t.type="text",t.oninput=qo,t.onchange=Ko,t.onfocus=Uo,t.onblur=Ho,t.classList.add("square"),Do.appendChild(t)}jo[e].style.display=e<n?"block":"none"}}();const f=t||o.set||o.size,p=f||o.border,h=p||u,d=p||o.mode;if(d){let t=(3*e.size+2*r.size)*St,n=(8*e.size+2*r.size)*St;_n.hor?([t,n]=[n+s.x*St,t],gt.parentNode.classList.add("mb-3"),yt.classList.remove("ms-4")):(n+=s.y*St,gt.parentNode.classList.remove("mb-3"),yt.classList.add("ms-4")),yt.width===t&&yt.height===n||(wt.width=yt.width=t,wt.height=yt.height=n)}if(h){const e=a*St,t=i*St;gt.width===e&&gt.height===t||(mt.width=vt.width=gt.width=e,mt.height=vt.height=gt.height=t),Ao(mt.getContext("2d"))}Bo(),f&&await fo(),h&&Eo(),d&&bo(),we(Bo)}function _o(e){const{w:t,h:n}=Cn.board,o=Jo();Oo(e),function(e,t,n){const{w:o,h:r}=Cn.board;for(let s=0;s<r;s++)for(let r=0;r<o;r++){const a=jo[s*o+r];a.value=s<n&&r<t?e[s*t+r]:""}er()}(o,t,n)}function Bo(){No.style.maxWidth="calc(".concat(Co(),"px + 1rem)"),gt.style.width=gt.width/St+"px",yt.style.width=yt.width/St+"px";const{w:e}=Cn.board,t=Mn(void 0,void 0,8);if(_n.hor)if(e>8)yt.style.width=t.width+"px";else if(e<8){const{width:t}=Mn(yt,!0,e);gt.style.width=t+"px"}Do.style.borderWidth="".concat(t.offset.y,"px ").concat(t.offset.r,"px ").concat(t.offset.b,"px ").concat(t.offset.x,"px");const n=Io();Cn.board.collapse?(No.style.width="120%",No.style.width=Po.clientWidth+4*n+"px"):No.style.width="unset",vt.style.width=gt.clientWidth+"px",vt.style.height=gt.clientHeight+"px",wt.style.width=yt.clientWidth+"px",wt.style.height=yt.clientHeight+"px",function(e){Do.style.width=CN.clientWidth+"px",Do.style.height=CN.clientHeight+"px";for(const t of jo)t.style.fontSize=e-10+"px",t.style.lineHeight=e-10+"px"}(t.s),No.clientWidth<Po.clientWidth+gt.clientWidth+6*n?(Ro.style.marginTop=-Po.clientHeight+"px",Ro.style.width=Po.clientWidth+"px",Ro.style.textAlign=_n.hor?"center":"start",No.classList.add("collapse"),_n.collapse=!0):(Ro.style.marginTop="0",Ro.style.width="unset",Ro.style.textAlign="unset",No.classList.remove("collapse"),_n.collapse=!1)}function Io(){return parseFloat(getComputedStyle(document.documentElement).fontSize)}if(Pt.isTop)window.resizeIframe=function(){const e=document.getElementsByTagName("iframe")[0];e&&(e.style.minHeight=e.contentDocument.body.scrollHeight+"px")};else{if("undefined"!=typeof ResizeObserver){new ResizeObserver((e=>parent.resizeIframe())).observe(document.body)}else{new MutationObserver((e=>parent.resizeIframe())).observe(document.body,{childList:!0})}parent.resizeIframe()}var To={setOption:Oo,setDimension:_o,setBorder(e){const t=function(e){return"string"!=typeof e?null:(e=e.replace(/\D/g,",").replace(/,+/g,",").replace(/^,/,"").replace(/,$/,"")).match(pt)?e:null}(e.value);t?(e.value=t,Oo({border:t})):e.value=Cn.board.border},get height(){return Cn.board.h},set height(e){_o({h:e})},get width(){return Cn.board.w},set width(e){_o({w:e})}};async function Lo(){if(Pt.canPaste)return await navigator.clipboard.readText();throw alert('Pasting text is not enabled in your browser.\nIf you\'re using Firefox on desktops or Firefox Nightly on Android, this can be enabled by the following.\n1. Visit "about:config" in your address bar.\n2. Search for "dom.events.asyncClipboard.readText".\n3. Toggle its value to true.\n4. Reload this tool.'),!0}window.Layout=To;var Mo,zo,$o,jo=new Array(64),Do=document.getElementById("Squares"),Wo={};function Fo(e){var t;null==(t=Wo.draw)||t.call(Wo,e)}function Uo(){if(this.style.zIndex="10",_n.collapse){const e=Jo();e[jo.indexOf(this)]="",Fo(e)}this.select()}function Ho(){this.style.zIndex="unset",Go(this)?er():_n.collapse&&Fo(Jo())}function Ko(){Go(this),_n.collapse&&this.blur(),er()}function qo(){if(!_n.collapse){const e=Jo();e[jo.indexOf(this)]=Ht(this.value,Cn.board.SN),Fo(e)}}function Go(e,t){let n=Ht(e.value,Cn.board.SN,t);const o=n!==e.value;return e.value=n,o}function Qo(e,t){const n=e.value!==t;e.value=t,Go(e),n&&er()}function Yo(e,t){const n=Zo(e);bt.value=n[0]+(Cn.board.fullFEN?or():""),rr(t)}function Zo(e){const t=e.split(" ");if(t[1]&&t[1].match(/^[wb]$/)&&(Ln.play.turn=t[1]),t[2]&&t[2].match(/^(-|[kq]+)$/i))for(const e in Ln.play.castle)Ln.play.castle[e]=t[2].includes(e);return t[3]&&t[3].match(/^[a-h][36]$/)&&(Ln.play.enPassant=t[3]),t[4]&&t[4].match(/^\d+$/)&&(Ln.play.halfMove=Number(t[4])),t[5]&&t[5].match(/^\d+$/)&&(Ln.play.fullMove=Number(t[5])),t}function Vo(){const e=new URL(location.href).searchParams.get("fen")||Bt,t=bt.value.split(" ")[0],n=t==Bt?"":"?fen="+encodeURIComponent(t);t!==e&&history.pushState(null,"",n||".")}function Jo(){return jo.map((e=>e.value))}function Xo(){return Jo().map((e=>qt(e,!1,!0)))}function er(){Fo(tr())}function tr(){const{w:e,h:t,fullFEN:n}=Cn.board,o=Jo();return bt.value=Ut(o,e,t)+(n?or():""),o}function nr(){const e=function(){const{w:e,h:t}=Cn.board;if(8!=e||8!=t)return null;const n=Xo();for(const e of n)if(""!=e&&!e.match(/^[kqbsnrp]$/i))return null;return Ut(n,8,8)}();return e?e+or(!0):null}function or(e){const t=Ln.play;t.enPassant.match(/^[a-h][36]$/)||(t.enPassant=""),e&&t.pass&&t.enPassant&&"3"==t.enPassant[1]!=("b"==t.turn)&&(t.turn="b"==t.turn?"w":"b");const n="retro"==t.mode;e&&((n||!Number.isSafeInteger(t.halfMove)||t.halfMove<0)&&(t.halfMove=0),(n||!Number.isSafeInteger(t.fullMove)||t.fullMove<1)&&(t.fullMove=1));const o=n?"-":function(e){const t=Jo();let n="";const o=Ln.play.castle;e?("K"==t[60]&&(o.K&&"R"==t[63]&&(n+="K"),o.Q&&"R"==t[56]&&(n+="Q")),"k"==t[4]&&(o.k&&"r"==t[7]&&(n+="k"),o.q&&"r"==t[0]&&(n+="q"))):(o.K&&(n+="K"),o.Q&&(n+="Q"),o.k&&(n+="k"),o.q&&(n+="q"));return""==n?"-":n}(e),r=n?"-":t.enPassant||"-";return" ".concat(t.turn," ").concat(o," ").concat(r," ").concat(t.halfMove," ").concat(t.fullMove)}function rr(e){sr(bt.value);const t=Wt(bt.value),{w:n,h:o}=t||Cn.board,r=Ft(bt.value,n,o);Oo({w:n,h:o});let s=!1;for(let e=0;e<n*o;e++)jo[e].value=r[e],s=Go(jo[e])||s;s||e||!t?er():Fo(Jo())}function sr(e){const t=Ln.play,n=e.split(" ");if(1!=n.length){if("w"!=n[1]&&"b"!=n[1]||(t.turn=n[1]),n[2]){const e=["K","Q","k","q"];for(const o of e)t.castle[o]=n[2].includes(o)}t.enPassant=n[3]&&"-"!=n[3]?n[3]:"","retro"!=t.mode&&(t.halfMove=Number(n[4]||0),t.fullMove=Number(n[5]||1))}}function ar(e){for(const t of jo)t.readOnly=e}function ir(e){if(e.anime){const t=Ut(e,Cn.board.w,Cn.board.h);so(bt.value,t,e.anime)}else e.forEach(((e,t)=>jo[t].value=e)),er()}function cr(){Object.assign(Ln.play,{turn:"w",enPassant:"",halfMove:0,fullMove:1});const e=["K","Q","k","q"];for(const t of e)Ln.play.castle[t]=!0}if(ro.options=Cn.board,ro.callback=Yo,addEventListener("popstate",(async function(){if(Ln.play.playing)return;const e=new URL(location.href).searchParams.get("fen");e&&Yo(e,!0)})),window.FEN={update:()=>{Zo(bt.value),rr(!0)},empty(){for(const e of jo)e.value="";er()},reset(){Oo({w:8,h:8}),Cn.board.fullFEN&&cr(),Yo(It)},copy(){gtag("event","fen_copy"),navigator.clipboard.writeText(bt.value)},async paste(){gtag("event","fen_paste"),Yo(await Lo(),!0)},rotate(e){ao(!0);const{w:t,h:n}=Cn.board;t!==n&&Oo({w:n,h:t}),ir(Xt(Jo(),e,t,n))},color(e){for(const t of jo){let n=t.value;n.startsWith("'")||""==n||(n.startsWith("-")&&(n=n.substr(1)),n=n.toLowerCase(),0==e&&(n="-"+n),1==e&&(n=n.toUpperCase()),t.value=n)}er()},fixSN(){gtag("event","fen_fix_sn");for(const e of jo){let t=e.value;t.startsWith("'")||""==t||(e.value=t.replace("s","n").replace("S","N"))}er()},invert(e){ir(en(Jo(),e))},shift(e,t){ao(!0);const{w:n,h:o}=Cn.board;ir(Vt(Jo(),e,t,n,o))},mirror(e){ao(!0);const{w:t,h:n}=Cn.board;ir(Jt(Jo(),e,t,n))}},Ln.play.playing){const e=Ln.play;e.playing=!1,Promise.all([fo(),kr()]).then((()=>{e.playing=!0,Or.goto(e.history[e.moveNumber])}))}var lr="normal",ur="pass",fr="retro",pr=[4,7,10,13],hr=[3,6,9,12],dr=hr.concat(15,16,18),gr=pr.concat(15,16,19);function mr(e){const t=Ln.play;let n=t.moveNumber;n+=e,n<-1&&(n=-1),n>t.history.length-1&&(n=t.history.length-1),n!=t.moveNumber&&yr(n)}function yr(e){const t=Ln.play,n=t.moveNumber,o=e>=0||0==n;if(Or.goto(t.history[e],o),o){const o=e==n-1,r=t.history[o?n:e];let s=r.from+r.to;"k"!=r.flags&&"q"!=r.flags||(s+=","+wr(r)),so(r.before,r.after,s,o!=(Ln.play.mode==fr))}}function vr(e,t,n){if(e=Gt(e),t=Gt(t),Ln.play.mode==fr){const n=zo.retract({from:e,to:t,...Ln.play.retro});return n&&(Ar(),Sr()),n}{const o=zo.move({from:e,to:t,promotion:n});return!!o&&("k"!=o.flags&&"q"!=o.flags||function(e){const t=Ft(e.before),n="w"==e.color;return t[Yt(e.from)]="",t[Yt(e.to)]=n?"K":"k",{before:Ut(t),after:e.after,move:wr(e)}}(o))}}function wr(e){const t="w"==e.color,n="k"==e.flags,o=t?1:8;return(n?"h":"a")+o+(n?"f":"d")+o}function br(){Yo(zo.fen())}function xr(e){return zo.get(Gt(e)).color}async function kr(){return Mo||((Mo=await import("./modules/chess.js")).Chess.options=Cn.PLAY,zo=new Mo.Chess(Ln.play)),Mo}function Er(){Object.assign(Ln.play,{playing:!0,pendingPromotion:!1}),ar(!0),Ln.play.mode==fr?(Ar(),Sr()):bo([])}function Ar(){Ln.play.retro={uncapture:null,unpromote:!1,ep:!1}}function Sr(){bo("b"==zo.turn()?dr:gr)}function Nr(e,t){if(2==e)return;const n=Ln.play.retro;var o;0==e==("b"==zo.turn())?(0<t&&t<7&&(o=Qn[t],n.uncapture=n.uncapture==o?null:o),5!=t&&6!=t||(n.unpromote=!1)):5==t&&(n.unpromote=!n.unpromote,"p"!=n.uncapture&&"c"!=n.uncapture||(n.uncapture=null)),Sr()}async function Pr(e){await kr(),zo.loadGame(e)&&(br(),Er())}var Rr,Cr,Or={async start(){gtag("event","fen_play_"+Ln.play.mode);try{const e=nr();if(!e)throw"Only orthodox chess is supported.";await kr(),zo.init(e),Ln.play.over=zo.overState(),Er()}catch(e){alert(e instanceof Error?e.message:e)}},exit(){Ln.play.playing=!1,Ln.play.game="",sr(zo.fen()),ar(!1),bo([])},goto(e,t){Ln.play.pendingPromotion&&(Ln.play.pendingPromotion=!1,bo([]));const n=zo.goto(e);t||(ao(),Yo(n)),Ln.play.mode==fr&&(Ar(),Sr())},move(e){e!=Ln.play.moveNumber&&yr(e)},moveBy(e){mr(e)},reset(){cr()},copyGame:()=>zo.copyGame(),copyPGN:()=>zo.copyPGN(),number:e=>Mo.number(e,Ln.play.mode),format:e=>Mo.format(e,Ln.play.mode),async pasteMoves(){const e=await Lo();zo.addMoves(Mo.parseMoves(e)),br()},async pasteGame(){const e=await Lo();await Pr(e)}},_r=new RegExp(String.raw(Rr||(Rr=o(["^+(?<c>[nwb])(?<is>",")(?<at>",")(=(?<p>","))?$"],["^\\+(?<c>[nwb])(?<is>",")(?<at>",")(=(?<p>","))?$"])),un,ln,un)),Br=new RegExp(String.raw(Cr||(Cr=o(["^-([nwb]",")?(?<at>",")$"])),un,ln)),Ir=new RegExp("^(?<c>[nwb])".concat(un,"(?<from>").concat(ln,")-&gt;(?<to>").concat(ln,")(=(?<p>").concat(un,"))?$")),Tr=new RegExp("^".concat(un,"(?<from>").concat(ln,")&lt;-&gt;").concat(un,"(?<to>").concat(ln,")$")),Lr=new RegExp("^(?<at>".concat(ln,")=(?<c>[nwb])?(?:r?(?<p>").concat(un,"))?$")),Mr=new RegExp("^I".concat(ln,"(,").concat(ln,")*$"));function zr(e,t,n){var o,r,s,a,i;let c=null==(o=t.match(_r))?void 0:o.groups;if(c)return bn(e,c.at,c.p||c.is,c.c);if(c=null==(r=t.match(Br))?void 0:r.groups,c)return bn(e,c.at,"");if(c=null==(s=t.match(Ir))?void 0:s.groups,c)return xn(e,c.from,c.to),void(c.p&&bn(e,c.to,c.p,c.c));if(c=null==(a=t.match(Tr))?void 0:a.groups,c)return function(e,t,n){t=Yt(t),n=Yt(n);const o=e[n];e[n]=e[t],e[t]=o}(e,c.from,c.to);if(c=null==(i=t.match(Lr))?void 0:i.groups,c)return bn(e,c.at,c.p||function(e,t){const n=e[Yt(t)];return n.match(new RegExp(un,"i"))[0].toUpperCase()}(e,c.at),c.c||function(e,t){const n=e[Yt(t)];return un.startsWith("-")?"n":n==n.toLowerCase()?"b":"w"}(e,c.at));if(c=t.match(Mr),c){n.push(...t.match(new RegExp(ln,"g")));for(const t of n)bn(e,t,"I","n")}else;}var $r=new RegExp(yn),jr=new RegExp(wn);function Dr(e,t,n,o,r){let s,a;if(n.move.startsWith("0-0")){const o="w"==t?"1":"8",i="0-0"==n.move?["g","h","f"]:["c","a","d"];xn(e,"e"+o,i[0]+o,r),a=xn(e,i[1]+o,s=i[2]+o,r)}else a=xn(e,n.from,s=n.to,r),n.ep&&bn(e,n.to.replace("3","4").replace("6","5"),""),n.then&&xn(e,n.to,s=n.then,r);"I"==n.p?(o.push(s),bn(e,s,"I","n")):n.p&&bn(e,s,a=n.p,n.pc?n.pc:t),n.cc&&bn(e,s,a,n.cc)}var Wr=new RegExp("^[nwb]".concat(un,"(").concat(ln,")--&gt;(").concat(ln,")$")),Fr=new RegExp("^[nwb]".concat(un,"(").concat(ln,")&lt;--&gt;[nwb]").concat(un,"(").concat(ln,")$")),Ur=new RegExp("^([+-]?)([nwb])(".concat(un,")(").concat(ln,")$")),Hr=new RegExp("^(".concat(un,")==&gt;(").concat(un,")$")),Kr=new RegExp("^mirror(".concat(ln,")&lt;--&gt;(").concat(ln,")$")),qr=new RegExp("^shift(".concat(ln,")==&gt;(").concat(ln,")$")),Gr=/^rotate(90|180|270)$/;function Qr(e,t){let n=t.match(Wr);if(n)return xn(e,n[1],n[2]);if(n=t.match(Fr),n)return exchange(e,n[1],n[2]);if(n=t.match(Ur),n)"+"==n[1]||""==n[1]?bn(e,n[4],n[3],n[2]):bn(e,n[4],"");else{if(n=t.match(Kr),n){let t;const o=Qt(n[1]),r=Qt(n[2]);return t=o.x==r.x?"|":o.y==r.y?"-":(o.x-r.x)*(o.y-r.y)>0?"\\":"/",void Yr(e,Jt(e,t))}if(n=t.match(qr),!n){if(n=t.match(Hr),n){const t=Sn(n[1]),o=t.toLowerCase(),r=Sn(n[2]),s=r.toLowerCase();for(let n=0;n<e.length;n++)e[n]==t&&(e[n]=r),e[n]==o&&(e[n]=s),e[n]=="-"+o&&(e[n]="-"+s)}return n=t.match(Gr),n?Yr(e,Xt(e,"90"==n[1]?-1:"180"==n[1]?2:1)):"PolishType"==t?Yr(e,en(e)):void 0}{const t=Qt(n[1]),o=Qt(n[2]);Yr(e,Vt(e,o.x-t.x,o.y-t.y))}}}function Yr(e,t){e.length=0,e.push(...t)}var Zr,Vr,Jr=new RegExp(pn),Xr=new RegExp(String.raw(Zr||(Zr=o(["\n\n+|(?:",")|(?:",")"],["\\n\\n+|(?:",")|(?:",")"])),pn,wn),"g");function es(e,t,n){return function(e,t,n,o){var r;if(!t)return n;console.log(n);const s=function(e){var t;const n=e.replace(/\n/g," ").replace(mn,"\n$&").split("\n"),o=n.filter((e=>e.match(tn("2option","^")))).join(" "),r=n.filter((e=>e.match(nn("condition")))).join(" ");return{imitators:null==(t=r.match(ss))?void 0:t.join(" ").match(new RegExp(ln,"g")),duplex:as.test(o),halfDuplex:is.test(o)}}(e);let a=0;const i=function(e){return e.split(tn("2twin","\\b","\\b")).map((e=>{var t;return null==(t=e.match(ns))?void 0:t[1].replace(/\s/g,"")}))}(e),c={pg:/dia/i.test(i[0]),fen:rs(fs(t),s.imitators),imitators:s.imitators,ordering:os(i[0],s.halfDuplex)};let l=c;const u={stack:[],board:Ft(l.pg?It:l.fen),ordering:l.ordering,imitators:null==(r=l.imitators)?void 0:r.concat()};let f=!1;n=n.replace(/<br>/g,"\n");const p=s.duplex?function(e){const t=/^\n\n+ +1\./,n=e.replace(/\n\nsolution finished./,"\n  1.").match(/\n\n+[^\n]+/g).filter(((e,n,o)=>n>0&&e.match(t)&&o[n-1].match(t))).map((e=>e.match(/^\n+/)[0].length));return"\n".repeat(Math.max(...n))}(n):"";let h=!1;return n=n.replace(Xr,(e=>{if(f)return e;try{if(e.match(/^\n+$/)){u.stack.length=0;const t=l.pg?It:l.fen;return u.board=Ft(t),e==p&&h&&(u.ordering=cs(u.ordering)),e}const t=e.match(Jr);if(t){h=!1,l=_t(t[1]?l:c);const n=i[++a];n&&(l.ordering=os(n,s.halfDuplex),l.pg=/dia/i.test(n)),u.ordering=l.ordering,u.stack.length=0;const{fen:o,board:r}=function(e,t){const n=Ft(e),o=t.replace(/(mirror|shift|rotate) /g,"$1").replace(/ ==&gt; /g,"==&gt;").split(" ");for(const e of o)Qr(n,e);return{fen:Ut(n),board:n}}(l.fen,t[2]);return l.fen=o,u.board=l.pg?Ft(It):r,e}return h=!0,function(e,t,n,o){var r;const{stack:s,ordering:a}=n,i=e.match(jr),c=i.groups.count,l=t.pg?It:t.fen;let u=null;if(c){const e=s.findIndex((e=>e.move==c||parseInt(e.move)>parseInt(c)));e>=0&&(u=e>0?s[e-1].fen:l,n.board=Ft(u),n.imitators&&(n.imitators=(e>0?s[e-1].imitators:t.imitators).concat()),s.length=e)}const f=a[!c||c.endsWith("...")?1:0],{imitators:p,board:h}=n,d=null==p?void 0:p.concat();if(p){for(const e of p)bn(h,e,"");p.length=0}const g=[],m=i.groups.main.split("/");for(let e of m){const t=e.match($r);Dr(h,f,t.groups,p,g);const n=null==(r=e.match(/\[[^\[\]]+(?=\])/g))?void 0:r.map((e=>e.substring(1)));n&&n.forEach((e=>zr(h,e,p)))}const y=Ut(h);if(c&&s.push({move:c,color:f,fen:y,imitators:null==p?void 0:p.concat()}),d)for(let e=0;e<g.length;e++){const[t,n]=g[e].match(/[a-z]\d/g).map((e=>Qt(e))),o=n.x-t.x,r=n.y-t.y;for(const t of d){const n=Qt(t);g[e]+=t+Gt(n.y+r,n.x+o)}}return(1==s.length&&c?o("*",l)+" ":"")+o(e,y,g,u)}(e,l,u,o)}catch(t){return console.log(t,e),f=!0,e}})),n.replace(/   ?<span init/g,"<span").replace(/\n/g,"<br>")}(e,t,n,ls)}var ts,ns=new RegExp(String.raw(Vr||(Vr=o(["","s+(S*(?:d|[^ds]s+d+(?:.[05])?))"],["","\\s+(\\S*(?:\\d|[^\\d\\s]\\s+\\d+(?:\\.[05])?))"])),nn("3stipulation")),"i");function os(e,t){if(!e)return"wb";const n=e.match(/^(\d+-&gt;)?(?:exact-)?(?:(?:ser|pser|phser|semi|reci)-)?(hs|hr|h|s|r)?/i);let o;return o=!n||n[1]?"wb":"h"==n[2]?"bw":"wb",t?cs(o):o}function rs(e,t){if(!t)return e;const n=Ft(e);for(const e of t)n[Yt(e)]="-"+Sn("i");return Ut(n)}var ss=new RegExp(String.raw(ts||(ts=o(["\bimitw*s+(?:",")+"],["\\bimit\\w*\\s+(?:",")+"])),ln),"ig"),as=tn("3duplex"),is=tn("3halfDuplex");function cs(e){return"wb"==e?"bw":"wb"}function ls(e,t,n,o){const r="*"==e?"init ":"";t=t.replace(/-/g,"&#45;").replace(/"/g,"&#34;");let s="";return n&&n.length&&(s+=' data-anime="'.concat(n.join(","),'"')),o&&(s+=' data-before="'.concat(o,'"')),"<span ".concat(r,'class="step btn px-1 py-0" data-fen="').concat(t,'"').concat(s,">").concat(e,"</span>")}var us=/[-+=]?(\.[0-9A-Z][0-9A-Z]|[A-Z])|\d+|\//gi;function fs(e){return e.match(us).map((e=>{if("/"==e||e.match(/^\d+$/))return e;const t=e.match(/^[-+=]/)?e[0]:null;return t&&(e=e.substring(1)),e.startsWith(".")&&(e=e.substring(1)),e=Sn(e),"+"==t&&(e=e.toUpperCase()),"-"==t&&(e=e.toLowerCase()),"="==t&&(e="-"+e.toLowerCase()),e})).join("")}var ps,hs,ds,gs,ms=["1Black","1Neutral","1White"].map(nn).join("|"),ys=["1Chameleon","2FrischAuf","2Functionary","2HalfNeutral","2HurdleColourChanging","1Jigger","1Kamikaze","1Magic","2Paralysing","2Protean","1Royal","1Uncapturable","1Volage"].map(nn).join("|"),vs="(?<p>".concat(un,")(?<sq>(?:").concat(ln,")+)"),ws=String.raw(ps||(ps=o(["s+(?<c>",")(?:s+(?:","))?(?<l>(?:s+",")+)"],["\\s+(?<c>",")(?:\\s+(?:","))?(?<l>(?:\\s+",")+)"])),ms,ys,vs),bs=String.raw(hs||(hs=o(["","(?:",")+(?=s+(?:",")|$)"],["","(?:",")+(?=\\s+(?:",")|$)"])),nn("2pieces"),ws,gn);function xs(e,t){if(2==t.length&&(t="."+t),"n"==e)return"="+t;const n="w"==e;return t.match(/[A-Z]/)?n?t:t.toLowerCase():(n?"+":"-")+t}Ln.popeye.running=!1,Ln.popeye.editMap=!1,Ln.popeye.playing&&fo().then((()=>we((()=>qs(!0)))));var ks,Es,As,Ss="modules/py.js",Ns=!1,Ps=document.getElementById("Output");function Rs(){Ln.popeye.output=Ln.popeye.intOutput+'<br><i class="fa-solid fa-spinner fa-spin"></i>',Cs()}function Cs(){Ns&&(Ns=!1,we((()=>Ps.scrollTop=Ps.scrollHeight-Ps.clientHeight)))}function Os(e){ds.terminate(),ds=void 0;const t=500-(performance.now()-ks);Cs(),clearInterval(Es),e?Bs():(Ln.popeye.output=Ln.popeye.intOutput,setTimeout((()=>Ln.popeye.running=!1),Math.max(0,t)),_s())}function _s(){ds||((ds=new Worker(Ss)).onerror=t=>{let n;t.preventDefault(),clearInterval(Es),Ln.popeye.running=!1,t.filename?(ds.terminate(),n="An error occur in the Popeye module. Please submit an issue about this.\n"+e.message):n="Unable to load the Popeye module; please check your network connection.",Ln.popeye.output=Is(n),ds=void 0},ds.onmessage=e=>{const t=e.data;++As>3e3?(Ln.popeye.intOutput+="<br>".concat(Is("Too much output. Please modify the input to prevent excessive output."),"<br>"),Os()):-1===t?(gtag("event","fen_popeye_fallback"),Ss="modules/py.asm.js",Os(!0),Ln.popeye.intOutput="Fallback to JS mode.<br>"):-2===t?Os((gs/=2)>=4):null===t?Os():(Ns=Ns||Boolean(Ps)&&Ps.scrollTop+Ps.clientHeight+30>Ps.scrollHeight,"string"==typeof t.text&&(Ln.popeye.intOutput+=Ts(t.text)+"<br>"),"string"==typeof t.err&&(Ln.popeye.error=!0,Ln.popeye.intOutput+=Is(Ts(t.err))))})}function Bs(){_s(),spinner=".";const e=Ln.popeye;As=0,e.intOutput="",e.error=!1,e.running=!0,Es=setInterval(Rs,500),ks=performance.now(),ds.postMessage({mem:gs,input:"Opti NoBoard\n"+e.intInput})}function Is(e){return'<span class="text-danger">'.concat(e,"</span>")}function Ts(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}var Ls,Ms,zs,$s=new RegExp(String.raw(Ls||(Ls=o(["(?:",")s.+$"],["(?:",")\\s.+$"])),["remark","2author","2origin","3title"].map(nn).join("|")),"igm"),js=new RegExp(String.raw(Ms||(Ms=o(["","s+S+"],["","\\s+\\S+"])),nn("5protocol")),"i"),Ds=tn("3beginProblem"),Ws=tn("3endProblem"),Fs=/\bnext\s[\s\S]+$/i,Us=nn("3forsyth"),Hs=nn("2pieces");function Ks(e){var t;e=e.replace($s,"").replace(js,"").replace(Ds,"").replace(Fs,"").replace(Ws,"");const n=Ln.popeye;if(new RegExp("".concat(Us,"|").concat(Hs),"i").test(e))return n.initFEN=function(e){const t=e.match(new RegExp(bs,"ig"));if(!t)return null;const n=Zt(64);for(const e of t){const t=e.match(new RegExp(ws,"ig"));for(const e of t){const t=e.match(new RegExp(ws,"i")).groups,o=t.c[0].toLowerCase(),r=t.l.match(new RegExp(vs,"ig"));for(const e of r){const t=e.match(new RegExp(vs,"i")).groups,r=t.p.toUpperCase(),s=t.sq.match(new RegExp(ln,"g"));for(const e of s)n[Yt(e)]=xs(o,r)}}}return Ut(n)}(e)||(null==(t=e.match(new RegExp(String.raw(zs||(zs=o(["","s+(S+)"],["","\\s+(\\S+)"])),Us),"i")))?void 0:t[1]),n.initFEN&&Yo(fs(n.initFEN)),e;{const{fen:t,imitators:o}=function(){const{w:e,h:t}=Cn.board;if(8!=e||8!=t)return null;const n=[],o=Jo().map(((e,t)=>{if(""==e)return e;let o=Cn.board.SN?e.replace("s","n").replace("S","N").replace("g","s").replace("G","S"):e;if(o=function(e){let t=e.startsWith("-")?"=":"";t&&(e=e.substring(1));const n=e.toUpperCase();if(n.match(/^[KQBNRP]$/))e=e.replace("n","s").replace("N","S");else{const o=n==e,r=An.custom();if(!(n in r))return null;const s=r[n];2==(e=o?s:s.toLowerCase()).length&&(e="."+e),s.match(/^\d+$/)&&!t&&(t=o?"+":"-")}return t+e}(o),!o)throw alert("Unspecified fairy piece: "+e);return o.match(/^=?i$/i)?(n.push(Gt(t)),""):o}));return{fen:Ut(o,8,8),imitators:n}}();return n.initFEN=t,o.length&&(e+="\ncond imitator "+o.join("")),"fors ".concat(n.initFEN,"\n").concat(e)}}async function qs(e){const t=Ln.popeye;t.steps=[...Ps.querySelectorAll("span")],0!=t.steps.length&&(Gs(0,!0),t.playing=!0,e&&await fo(),bo([]),we(Bo))}async function Gs(e,t){var n;const o=Ln.popeye,r=o.steps[e],s=o.steps[o.index];if(s&&s.dataset.anime&&(e==o.index-1&&!s.dataset.before||r.dataset.fen==s.dataset.before))await so(r.dataset.fen,s.dataset.fen,s.dataset.anime,!0);else{const t=r.dataset.before||(null==(n=o.steps[e-1])?void 0:n.dataset.fen);r.dataset.anime&&t?await so(t,r.dataset.fen,r.dataset.anime):(ao(),Yo(r.dataset.fen))}t||s.classList.remove("active"),o.index=e,r.classList.add("active"),we((()=>function(e){const t=10,n=e.offsetTop-t;Ps.scrollTop>n&&(Ps.scrollTop=n);const o=e.offsetTop+e.clientHeight-Ps.clientHeight+t;Ps.scrollTop<o&&(Ps.scrollTop=o);const r=e.offsetLeft-t;Ps.scrollLeft>r&&(Ps.scrollLeft=r);const s=e.offsetLeft+e.clientWidth-Ps.clientWidth+t;Ps.scrollLeft<s&&(Ps.scrollLeft=s)}(r)))}var Qs={run(){gtag("event","fen_popeye_run"),gs=512;try{const e=Ln.popeye;e.intInput=Ks(e.input),Bs()}catch{}},cancel(){ds&&Os()},play(){const e=Ln.popeye;Ps.scrollTop=Ps.scrollLeft=0,gtag("event","fen_popeye_play"),e.output=es(e.intInput,e.initFEN,e.intOutput),we(qs)},step(e){const t=Ln.popeye.steps.indexOf(e.target);t>=0&&t!=Ln.popeye.index&&(e.preventDefault(),Gs(t))},exit(){const e=Ln.popeye;Yo(e.steps[0].dataset.fen),e.output=e.intOutput,e.playing=!1,bo([]),we(Bo)},moveBy(e){const t=Ln.popeye;let n=t.index;n+=e,n<0&&(n=0),n>t.steps.length-1&&(n=t.steps.length-1),Qs.move(n)},move(e){e!=Ln.popeye.index&&Gs(e)},editMap(){gtag("event","fen_popeye_edit_map"),Ln.popeye.mapping=Ys(Cn.popeye.pieceMap),Ln.popeye.editMap=!0},resetMap(){Ln.popeye.mapping=Ys(kn)},saveMap(){const e=Ln.popeye.mapping.toUpperCase().split("\n"),t={};for(const n of e){let[e,o]=n.replace(/\s/g,"").split("=");e.match(aa)&&o&&o.match(ia)&&(t[e]=o)}Cn.popeye.pieceMap=t,Ln.popeye.editMap=!1}};function Ys(e){const t=[];for(const n in e)t.push("".concat(n,"=").concat(e[n]));return t.join("\n")}var Zs,Vs,Js,Xs,ea,ta,na,oa,ra,sa,aa=/^(\*[1-3][KQBNRP]|(\*[1-3])?[CXSTAD]|''..|'.)$/,ia=new RegExp("^".concat(un,"$")),ca=0;function la(e){ba(e),"pending"==_n.dragging&&function(e){const t=e.offsetX-Zs,n=e.offsetY-Vs;return Math.sqrt(t*t+n*n)}(e)>5&&(ta=NaN,oa?(sa=Pt.isTouch?[]:null,function(e,t){fa(),na.style.display="block",t&&(ea.value="",er());_n.dragging=!0,va(e)}(e,Boolean(ea))):_n.dragging=!1),!0===_n.dragging&&(sa&&sa.push({x:e.clientX,y:e.clientY}),va(e))}function ua(e,t){const{s:n,offset:o}=Mn(),r=t.getBoundingClientRect(),s=Math.floor((e.clientY-r.top-o.y)/n);return{x:Math.floor((e.clientX-r.left-o.x)/n),y:s}}function fa(){_n.selection=null,bo([])}function pa(e){if("pending"==_n.dragging&&!Ln.play.playing&&e.target==kt){const t=performance.now();t-ca<300&&ea.focus(),ca=t,e.preventDefault(),_n.dragging=!1}na&&(na.style.display="none"),ba(e);if(performance.now()-ta<250){if(e.target==yt&&!zn()){let{x:t,y:n}=ua(e,yt);if(_n.hor&&([t,n]=[n,t]),wa(t,n,3,8)){const e=co[3*n+t];_n.selection==e?_n.selection=null:_n.selection=e,bo([])}else fa();return void(_n.dragging=!1)}if(e.target==kt&&Ln.popeye.playing){const{x:t}=ua(e,kt);return t<3&&Qs.moveBy(-1),void(t>4&&Qs.moveBy(1))}}if(Ln.popeye.playing||!_n.dragging)return;if(_n.dragging=!1,!oa)return;const{w:t,h:n}=Cn.board,{x:o,y:r}=ua(e,gt),s=r*t+o,a=wa(o,r,t,n);if(Ln.play.playing){let e;if(a){if(function(e,t){const n=Ln.play.mode;return n!=fr&&(n==ur&&xr(e)!=zo.turn()&&zo.switchSide(),!!zo.checkPromotion(Gt(e),Gt(t))&&($o=t,Ln.play.pendingPromotion=!0,bo("b"==zo.turn()?hr:pr),!0))}(ra,s))return Qo(jo[s],oa);ra!=s&&(e=vr(ra,s))}"object"==typeof e?so(e.before,e.after,e.move):br()}else if(a){if(Qo(jo[s],oa),sa&&sa.length>10){const e=function(e){let t=0,n=0;for(const o of e)t+=o.x,n+=o.y;return t/=e.length,n/=e.length,{x:t,y:n}}(sa),t=function(e,t){let n=0;for(let o=0,r=t.length-1;o<t.length;r=o++){const s=t[o],a=t[r];a.y<=e.y?s.y>e.y&&ha(a,s,e)>0&&n++:s.y<=e.y&&ha(a,s,e)<0&&n--}return n}(e,sa);ma(ea,t>0?1:3)}}else Vo()}function ha(e,t,n){return(t.x-e.x)*(n.y-e.y)-(n.x-e.x)*(t.y-e.y)}var da=performance.now();function ga(e){if(zn())return;const{w:t,h:n}=Cn.board,{offset:o,s:r}=Mn(),s=Math.floor((e.offsetX-o.x)/r),a=Math.floor((e.offsetY-o.y)/r);if(wa(s,a,t,n)){const n=jo[a*t+s];if(""==n.value)return;e.preventDefault();const o=performance.now();if(o-da<50)return;da=o,ma(n,e.deltaY>0?1:3)}}function ma(e,t){e.value=e.value.replace(/(^-?)(?:\*(\d))?([^-].*$)/,((e,n,o,r)=>{const s=(Number(o||0)+t)%4;return n+(s?"*"+s:"")+r})),er()}function ya(e){if(ta=performance.now(),Ln.popeye.playing)return;if(_n.loading||0!=e.button&&!e.targetTouches||e.targetTouches&&e.targetTouches.length>1)return;ba(e),document.activeElement&&document.activeElement.blur();const t=this!=yt,{offset:n,s:o}=t?Mn():Mn(yt,_n.hor),{w:r,h:s}=Cn.board;Zs=e.offsetX,Vs=e.offsetY;const[a,i]=[n.x,n.y];Js=Math.floor((Zs-a)/o);const c=(Xs=Math.floor((Vs-i)/o))*(t?r:3)+Js;na=t?vt:wt;const l=_n.selection;if(t&&l)if(e.preventDefault(),wa(Js,Xs,r,s)){const e=jo[c];e.value==l?e.value="":e.value=l,er()}else fa();else{if(Ln.play.playing){if(!t&&Ln.play.pendingPromotion){_n.hor&&([Js,Xs]=[Xs,Js]);Xs>0&&Xs<5&&Js==("p"==oa?0:1)&&(u=ra,f=Qn[Xs],vr(u,$o,f)?($o>>>3==0&&(f=f.toUpperCase()),Qo(jo[$o],f)):br(),Ln.play.pendingPromotion=!1,bo([]))}if(t||"retro"!=Ln.play.mode||(e.preventDefault(),_n.hor&&([Js,Xs]=[Xs,Js]),Nr(Js,Xs)),!t||!function(e){const t=Ln.play.mode;if(Ln.play.pendingPromotion)return!1;if(t!=fr&&zo.isGameOver())return!1;const n=xr(e)==zo.turn();return t==ur||n==(t==lr)}(c))return}var u,f;t?(ra=c,ea=jo[c],_n.dragging="pending",oa=void 0):ea=void 0,t&&""==ea.value||(e.preventDefault(),na.style.clip="rect(".concat(Xs*o+i+1,"px,").concat((Js+1)*o+a-1,"px,").concat((Xs+1)*o+i-1,"px,").concat(Js*o+a+1,"px)"),t?oa=ea.value:(oa=_n.hor?co[3*Js+Xs]:co[c],_n.dragging="pending"))}}function va(e){const{offset:t,s:n}=Mn(),{w:o,h:r,coordinates:s}=Cn.board,a=gt.getBoundingClientRect(),i=na==wt&&s&&!_n.hor?a.left+ht:a.left,c=Math.floor((e.clientY-a.top-t.y)/n),l=Math.floor((e.clientX-a.left-t.x)/n);l===Js&&c===Xs||(sa=null);const{scrollLeft:u,scrollTop:f}=document.documentElement;wa(l,c,o,r)?(na.style.left=i+(l-Js)*n+u+"px",na.style.top=a.top+(c-Xs)*n+f+"px"):(na.style.left=e.clientX+u+1-Zs+"px",na.style.top=e.clientY+f-Vs+"px")}function wa(e,t,n,o){return t>-1&&t<o&&e>-1&&e<n}function ba(e){if(e.targetTouches){const t=e.target.getBoundingClientRect(),n=e.targetTouches[0]||e.changedTouches[0];e.clientX=n.clientX,e.clientY=n.clientY,e.offsetX=e.clientX-t.x,e.offsetY=e.clientY-t.y}}var xa={copyFEN(){gtag("event","fen_yacpdb_copyFEN");const{w:e,h:t}=Cn.board;return Ut(jo.map((e=>Kt(e.value))),e,t)},async fetch(e){try{gtag("event","fen_yacpdb_get"),e.disabled=!0,e.value="Fetching...";const t="https://yacpdb.org/gateway/ql?q="+encodeURIComponent("Id('".concat(xt.value,"')")),n=await fetch("https://corsproxy.io/?"+encodeURIComponent(t)),o=await n.json();if(o.success){let e=function(e){const o=e.charCodeAt(1)-97,r=Number(e[2]);s[(n-r)*t+o]=e[0]};const{w:t,h:n}=Cn.board,r=o.result.entries[0].algebraic,s=Zt(t*n);for(const t of r.black)e(t.toLowerCase());for(const t of r.white)e(t);Yo(Ut(s),t)}}catch{alert("An error has occurred. Please try again later.")}finally{e.disabled=!1,e.value="Get FEN"}},search(){gtag("event","fen_yacpdb_search"),window.open("https://yacpdb.org/#q/"+encodeURIComponent(ka())+"/1")},copyQuery:()=>(gtag("event","fen_yacpdb_copy"),ka()),copyEdit:()=>(gtag("event","fen_yacpdb_copyEdit"),function(){const e={w:[],b:[],n:[]},{w:t,h:n}=Cn.board;for(let o=0;o<n;o++)for(let n=0;n<t;n++){const r=jo[o*t+n].value,s=r.match(/^(-?)([kqbsnrp])$/i);if(!s)continue;const a=qt(s[2],!1,!0).toUpperCase();e[s[1]?"n":r==r.toLowerCase()?"b":"w"].push(a+Gt(o,n))}let o=[];e.w.length&&o.push("    white: [".concat(e.w.join(", "),"]"));e.b.length&&o.push("    black: [".concat(e.b.join(", "),"]"));e.n.length&&o.push("    neutral: [".concat(e.n.join(", "),"]"));return o.join("\n")}())};function ka(){let e=[];const{w:t,h:n}=Cn.board;for(let o=0;o<n;o++)for(let n=0;n<t;n++){let r=Kt(jo[o*t+n].value).replace("(","").replace(")","");r&&(r.match(/\d/)||(r=r.startsWith("!")?"n"+r.toUpperCase():(r==r.toLowerCase()?"b":"w")+r.toUpperCase(),e.push(r+Gt(o,n))))}let o='MatrixExtended("'.concat(e.join(" "),'", false, false, "None")');return Cn.DB.exact&&(o+=" AND PCount(*) = "+e.length),o}var Ea={async fetch(e){try{gtag("event","fen_pdb_get"),e.disabled=!0,e.value="Fetching...";const t=Aa+encodeURIComponent("PROBID='".concat(xt.value,"'")),n=await fetch("https://corsproxy.io/?"+encodeURIComponent(t));Yo((await n.text()).match(/<b>FEN:<\/b> (.+)/)[1],!0)}catch{alert("An error has occurred. Please try again later.")}finally{e.disabled=!1,e.value="Get FEN"}},search(){gtag("event","fen_pdb_search"),window.open(Aa+encodeURIComponent(Pa()))},copyQuery:()=>(gtag("event","fen_pdb_copy"),Pa()),copyEdit:()=>(gtag("event","fen_pdb_copyEdit"),function(){const e={},{w:t,h:n}=Cn.board;for(let o=0;o<n;o++)for(let n=0;n<t;n++){const r=jo[o*t+n].value,s=r.match(/^(-?)(?:\*(\d))?([kqbsnrpxc])$/i);if(!s)continue;let a;if("x"==s[3])a="sY";else{const e=Sa[Qn.indexOf(s[3].toLowerCase().replace("s","n"))];a=(s[1]?"n":r==r.toLowerCase()?"s":"w")+e+Na[Number(s[2]||0)]}e[a]=(e[a]||"")+Gt(o,n)}const o=[];for(const t in e)o.push(t+e[t]);return o.join(" ")}())},Aa="https://pdb.dieschwalbe.de/search.jsp?expression=",Sa=["K","D","L","S","T","B","I"],Na=["","R","U","L"];function Pa(){let e=[];const{w:t,h:n}=Cn.board;for(let o=0;o<n;o++)for(let n=0;n<t;n++){const r=jo[o*t+n].value;if(!r.match(/^[kqbsnrp]$/i))continue;const s=Sa[Qn.indexOf(r.toLowerCase().replace("s","n"))],a=r==r.toLowerCase()?"s":"w";e.push(a+s+Gt(o,n))}let o="POSITION='".concat(e.join(" "),"'");return Cn.DB.exact&&(o+=" AND APIECES=".concat(e.length)),o}function Ra(e){return new URL(e,location.href).toString()}function Ca(){const{SN:e,w:t,h:n}=Cn.board;return e?Ut(Xo(),t,n):bt.value}function Oa(){const e=Cn.board,t=Ca();let n=Ra("gen/?fen="+t);return 44!=e.size&&(n+="&size="+e.size),"1echecs"!=e.set&&(n+="&set="+e.set),e.pattern&&(n+="&pattern="+e.pattern),e.bg&&(n+="&bg="+e.bg),"1"!=e.border&&(n+="&border="+e.border),e.blackWhite&&(n+="&blackWhite&knightOffset="+e.knightOffset),Wt(t)||(n+="&w=".concat(e.w,"&h=").concat(e.h)),n}var _a,Ba,Ia,Ta,La={copyJanko:()=>(gtag("event","fen_copy_janko"),"https://www.janko.at/Retros/d.php?ff="+Ca()),copyBase64:()=>(gtag("event","fen_link_copy64"),yo.toDataURL()),copyBase64Img:()=>(gtag("event","fen_link_copy64img"),'<img fen="'.concat(yo.toDataURL(),'">')),async copyUrl(){gtag("event","fen_gen_link");const e=new FormData,t=await new Promise((e=>yo.toBlob(e)));e.append("key","7802c5da1788f2315222d44bfba20519"),e.append("image",t,"fen");try{const t=await fetch("https://api.imgbb.com/1/upload",{method:"post",body:e}),n=await t.json();if(!n.success)throw n.error.message;return n.data.url+"?="+Ca()}catch(e){throw alert("string"==typeof e?e:"Internet connection failed. Please try again later."),e}},copyEmbed(){gtag("event","fen_copy_embed");const e=Cn.board;let t=Oa();const{w:n,h:o}=dt(e);return'<iframe src="'.concat(t,'" style="border:none;width:').concat(n,"px;height:").concat(o,'px"></iframe>')},copyEmbedUrl:()=>(gtag("event","fen_copy_embedUrl"),Oa()),copyImg:()=>(gtag("event","fen_copy_sdkImg"),'<img fen="'.concat(Ca(),'">')),copySDK(){gtag("event","fen_copy_sdk");const e=Cn.board;let t="";return 44!=e.size&&(t+=' data-size="'.concat(e.size,'"')),"1echecs"!=e.set&&(t+=' data-set="'.concat(e.set,'"')),e.bg&&(t+=' data-bg="'.concat(e.bg,'"')),"1"!=e.border&&(t+=' data-border="'.concat(e.border,'"')),e.blackWhite&&(t+=' data-black-white="true" data-knight-offset="'.concat(e.knightOffset,'"')),'<script src="'.concat(Ra("sdk.js"),'"').concat(t,"><\/script>")}},Ma={async copy(){if(8!=Cn.board.w||8!=Cn.board.h)throw alert("只支援標準棋盤"),!0;gtag("event","fen_bbs_copy");return(await import("./modules/ptt.js")).generate(Xo(),Ca(),xt.value,Cn.BBS,Cn.board,Pt.isTouch)}},za=["image/png","image/jpeg","image/bmp","image/webp"];function $a(e){za.includes(e.type)?alert("Image processing under development."):alert("Unsupported format.")}if(async function(){const e=Nn.get("image");if(e){const t=new URL(location.href);t.searchParams.delete("image"),history.replaceState(null,"",t.toString());const n=await fetch("shareImage?image="+e);$a(await n.blob())}}(),Ln.stockfish.lines.length){const e=Ln.stockfish.lines,t=Ln.stockfish.header;Ln.stockfish.lines=[],Ln.stockfish.header=[],kr().then((n=>{Ba=n,Ln.stockfish.lines=e,Ln.stockfish.header=t}))}function ja(e){_a.postMessage(e)}window.cmd=ja;var Da="(".concat(ln,")(").concat(ln,")([qrbn]?)"),Wa="modules/stockfish/",Fa=Pt.thread?"":"-single",Ua=1,Ha=["".concat(Wa,"stockfish-nnue-16.js#stockfish-nnue-16.wasm,worker"),"".concat(Wa,"stockfish-nnue-16.wasm"),"".concat(Wa,"stockfish-nnue-16-single.js#stockfish-nnue-16-single.wasm,worker"),"".concat(Wa,"stockfish-nnue-16-single.wasm"),"".concat(Wa,"nn-5af11540bbfe.nnue")];function Ka(e){return _a?Promise.resolve():new Promise(((t,n)=>{_n.stockfish.running=1,(_a=new Worker("".concat(Wa,"stockfish-nnue-16").concat(Fa,".js#stockfish-nnue-16").concat(Fa,".wasm"))).onmessage=e=>{const n=e.data;console.info(n),"readyok"==n&&(_n.stockfish.running=2,t()),n.startsWith("info ")&&function(e){var t;if(2!=_n.stockfish.running)return;const n=e.match(/multipv (\d+)/);if(!n)return;const o=Number(n[1])-1,r=e.match(/mate (-?)(\d+)/),s=e.match(/score cp (-?\d+)/);let a,i=Number(s&&s[1]||0)/100;if(r){const e="w"==Ta.split(" ")[1]==Boolean(r[1])?"Black":"White";a=Number(r[2])+Ln.stockfish.header.length/2,0==o&&(Ln.stockfish.mate=[e,a])}if(0==o){const t=e.match(/depth (\d+)/);t&&(Ln.stockfish.depth=t[1]),s&&(Ln.stockfish.score=i)}const c=e.match(new RegExp("pv (".concat(Da,"(?: ").concat(Da,")*)")));if(c){if((null==(t=Ln.stockfish.lines[o])?void 0:t.raw)==c[1])return;const e=c[1].split(" ").map((e=>e.match(new RegExp(Da))));Ln.stockfish.moves=[];const n=Ln.stockfish.header;Ia.init(n.length?n[n.length-1].after:Ta);for(const t of e){if(Ia.move({from:t[1],to:t[2],promotion:t[3]}).san.endsWith("=")){i=0;break}}const s={rawScore:r?r[1]?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY:i,score:r?r[1]+"#"+r[2]:i.toFixed(2),raw:c[1],moves:Ia.state.history.concat(),pgn:Ia.copyPGN(n)};Ln.stockfish.lines[o]=s}Cn.Stockfish.study&&qa()}(n.substring(5)),n.match(new RegExp("^bestmove ".concat(Da)))&&function(){const e=Cn.Stockfish.depth;if(!Cn.Stockfish.study||e<4||!qa())Ya.stop();else{const t=Ln.stockfish.header;t.push(...Ln.stockfish.lines[0].moves.slice(0,2));ja("position fen "+t[t.length-1].after),ja("go depth "+e)}}()},_a.onerror=e=>{e.message.includes("RangeError")?n(-1):e.message.includes("memory")?n("Not enough memory."):n("Unknown error has occurred.")},ja("uci"),ja("setoption name Use NNUE value true"),Pt.thread&&ja("setoption name Threads value "+Math.max(2,navigator.hardwareConcurrency-4)),ja("setoption name Hash value "+e),ja("isready")}))}function qa(){const e=Ln.stockfish.lines.filter((e=>e&&e.moves.length));if(e.length<=1)return!1;e.forEach((e=>e.moves[0]&&(e.moves[0].annotation=void 0)));const t=e.filter((e=>e.rawScore>Ua));if(t.length>1)return!1;if(1==t.length)return t[0].moves[0].annotation="!",!0;const n=e.filter((e=>e.rawScore>-Ua));return 1==n.length&&(n[0].moves[0].annotation="!",!0)}var Ga,Qa,Ya={async download(){gtag("event","fen_stockfish_download"),_n.stockfish.status=1,"serviceWorker"in navigator&&await navigator.serviceWorker.ready;for(const e of Ha){if(200!=(await fetch(e)).status)return alert("Download failed. Please check your network connection."),void(_n.stockfish.status=0)}Cn.Stockfish.downloaded=!0,_n.stockfish.status=2},async analyze(){try{gtag("event","fen_stockfish_run");let e=128,t=Ka(e);if(!(Ta=nr()))throw"Only orthodox chess is supported.";for(Ba||(Ba=await kr()),(Ia=new Ba.Chess).init(Ta);;)try{await t;break}catch(n){if(-1!==n)throw n;if(Ya.stop(),e/=2,e<4)throw"Not enough memory.";t=Ka(e)}Ln.stockfish=_t(In),ja("setoption name MultiPV value "+Cn.Stockfish.lines),ja("ucinewgame"),ja("position fen "+Ta),ja("go depth "+Cn.Stockfish.depth)}catch(e){Ya.stop(),alert(e instanceof Error?e.message:e),_n.stockfish.running=0}},play(e){gtag("event","fen_stockfish_play"),Ln.play.mode="normal",Ln.tab=6,Pr(e.pgn)},stop(){_a&&_a.terminate(),_a=void 0,_n.stockfish.running=0},format:e=>Ba.formatGame(e)};if(Ln.syzygy.lines){const e=Ln.syzygy.lines;e.forEach((e=>e.searching=!1)),Ln.syzygy.lines=[],kr().then((t=>{Ga=t,Ln.syzygy.lines=e}))}var Za=new Set;function Va(e){return new Promise((t=>{Za.add(t),setTimeout((()=>{Za.delete(t),t()}),1e3*e)}))}async function Ja(e,t){try{if(!t.running)return null;const n=t.ready;if(t.ready=n.then((()=>Va(1))),await n,!t.running)return null;const o=await fetch("https://tablebase.lichess.ovh/standard?fen="+e);return 429==o.status?(await Va(61),await Ja(e,t)):await o.json()}catch{throw"Unable to connect to the server. Please check your network connection."}}async function Xa(e){const t=new((Ga=await kr()).Chess);t.init(e.fen);const n=await Ja(t.fen(),e),o="w"==t.turn()?"White":"Black",r=n.category;if(Ln.syzygy.header="The position is a ".concat(r," for ").concat(o,"."),"unknown"==r||r.includes("loss")||!e.running)return;Ln.syzygy.lines=[],e.outcome=r,e.op=function(e){return"draw"==e?e:oi[ni.indexOf(e)]}(r);const s=n.moves.filter((t=>t.category==e.op));for(const n of s){t.init(e.fen);const[o,r,s]=n.uci.match(/..|./g);t.move({from:o,to:r,promotion:s});const a=t.fen();e.positions.add(ei(a));const i={fen:a,dtm:n.dtm,indent:0,history:t.state.history.concat(),leaf:!0,moves:t.state.history.concat(),pgn:t.copyPGN(),transpose:!1,searching:!t.isGameOver()};Ln.syzygy.lines.push(i)}if(!e.running)return;let a=Ln.syzygy.lines.filter((e=>e.searching));if(a.length>1)return;for(a[0].moves[0].annotation="!";a.length;){const t=a.map((t=>ti(t,e)));if(await Promise.all(t),a=Ln.syzygy.lines.filter((e=>e.searching)),!e.running)return}}function ei(e){return e.replace(/ \d+ \d+$/,"")}async function ti(e,t){const n=new Ga.Chess;n.init(e.fen);const o="number"==typeof e.dtm,r=n.moves({verbose:!0}).map((e=>Ja(e.after,t).then((n=>{if(!t.running)return null;const r=n.moves.filter((e=>e.category==t.op));return{score:(o?n.dtm:0)-r.length,json:n,dtm:n.dtm,defense:e,moves:r}})))),s=(await Promise.all(r)).filter((e=>e)).sort(((e,t)=>t.score-e.score)).filter(((e,t,n)=>e.score==n[0].score));if(e.searching=!1,!t.running)return;const a=s.filter((e=>"draw"!=t.op&&e.moves.length>0||1==e.moves.length));if(0==a.length)return;const i=1==a.length,c=a.map((o=>{n.init(e.fen);const r=n.move(o.defense);i&&(r.annotation="!");const[s,a,c]=o.moves[0].uci.match(/..|./g),l=n.move({from:s,to:a,promotion:c});1==o.moves.length&&(l.annotation="!");const u=n.fen(),f=ei(u),p=t.positions.has(f);p||t.positions.add(f);const h=n.state.history.concat();return{dtm:"number"==typeof o.dtm?1-o.dtm:null,fen:u,transpose:p,leaf:!0,indent:e.indent+(i?0:1),history:e.history.concat(h),moves:i?e.moves.concat(h):h,pgn:n.copyPGN(e.history),searching:!n.isGameOver()&&!p}})),l=Ln.syzygy.lines.concat(),u=l.indexOf(e);i?l.splice(u,1,...c):(e.leaf=!1,l.splice(u+1,0,...c)),Ln.syzygy.lines=l}var ni=["win","maybe-win","cursed-win"],oi=["loss","maybe-loss","blessed-loss"];var ri={async run(){var e;const t={positions:new Set,running:!0,ready:Promise.resolve()};Qa=t;try{if(gtag("event","fen_syzygy_run"),_n.syzygy.running=!0,Ln.syzygy.header=null,Ln.syzygy.lines=null,t.fen=nr(),!t.fen)throw"Only orthodox chess is supported.";if((null==(e=t.fen.split(" ")[0].match(/[a-z]/gi))?void 0:e.length)>7)throw"Only supports position with up to 7 pieces.";await Xa(t)}catch(e){alert(e instanceof Error?e.message:e)}finally{t.running&&ri.stop()}},play(e){gtag("event","fen_syzygy_play"),Ln.play.mode="normal",Ln.tab=6,Pr(e.pgn)},stop(){var e;Qa&&(Qa.running=!1);for(const e of Za)e();Za.clear(),null==(e=Ln.syzygy.lines)||e.forEach((e=>e.searching=!1)),_n.syzygy.running=!1},format:e=>Ga.formatGame(e.moves)+(e.searching?" ...":e.transpose?" (transpose)":"")};function si(){Eo(),bo()}!async function(){window.addEventListener("resize",(()=>Oo({})));const e=Nn.get("fen");await Oo({},!0),Wo.draw=Eo,e?(Yo(e,!0),Vo()):er(),setTimeout(Bo,1e3)}(),kt.onmousedown=ya,kt.ontouchstart=ya,kt.ondragstart=e=>e.preventDefault(),kt.onwheel=ga,yt.onmousedown=ya,yt.ontouchstart=ya,document.body.onmousedown=e=>{zn()||e.target==yt||e.target==kt||fa()},document.body.onmousemove=la,document.body.ontouchmove=la,document.body.onmouseleave=pa,document.body.onmouseup=pa,document.body.ontouchend=pa,document.addEventListener("mousedown",(function(e){var t;const n=null==(t=document.activeElement)?void 0:t.nodeName.toLowerCase();"input"!=n&&"textarea"!=n&&e.detail>1&&e.preventDefault()}),!1),addEventListener("keydown",(e=>{var t;if(!Ln.play.playing&&!Ln.popeye.playing)return;const n=null==(t=document.activeElement)?void 0:t.nodeName.toLowerCase();if("input"==n||"textarea"==n)return;const o=e.key;"a"!=o&&"ArrowLeft"!=o||(e.preventDefault(),Ln.play.playing?mr(-1):Qs.moveBy(-1)),"d"!=o&&"ArrowRight"!=o||(e.preventDefault(),Ln.play.playing?mr(1):Qs.moveBy(1))})),window.share=async function(e){if(gtag("event","fen_img_share"),Pt.canSharePng){const e=await So(),t=[new File([e],"board.png",{type:"image/png"})];navigator.share({files:t})}else{e.disabled=!0;const t=e.querySelector("i"),n=t.className;t.className="fa-spin fa-solid fa-spinner";try{const e=await La.copyUrl();navigator.share({url:e,text:Ca()})}finally{e.disabled=!1,t.className=n}}},ut({env:Pt,copyImage:async function(){if(Pt.canCopyImg){const e=await So();return navigator.clipboard.write([new ClipboardItem({"image/png":e})])}throw alert('Image copying is not enabled in your browser.\nIf you\'re using Firefox, this can be enabled by the following.\n1. Visit "about:config" in your address bar.\n2. Search for "dom.events.asyncClipboard.clipboardItem".\n3. Toggle its value to true.\n4. Reload this tool.'),!0},CheckboxBase:jn,Checkbox:Dn,CheckboxR:function(e,t){return Dn(e,t,null,(()=>"retro"==Ln.play.mode))},CopyButton:function(e,t,n,o){return{$template:"#copyBtn",cls:n,label:e,dis:void 0!==o&&o,state:0,async copy(){this.state=1;try{let e=t;for(;"function"==typeof e;)e=await e();"string"==typeof e&&function(e){if(env.canCopy)navigator.clipboard.writeText(e);else{const t=document.createElement("input");document.body.appendChild(t),t.value=e,t.select(),document.execCommand("copy"),document.body.removeChild(t)}}(e),this.state=2,setTimeout((()=>this.state=0),1e3)}catch(e){this.state=0}}}},Radio:function(e,t,n,o,r,s){return{$template:"#radio",id:"rdo"+Wn++,text:o,value:r,label:e,checked:e=>t[n]==r[e],set:e=>t[n]=r[e],disabled:()=>null==s?void 0:s()}},NumInput:function(e,t,n,o,r){const s=()=>t[n];return{$template:"#number",title:e,get:s,set:e=>{const a=e.target,i=s(),c=Math.round(Number(a.value));isNaN(c)||c<o||c>r?a.value=i:t[n]=c},setBy:e=>t[n]+=e,isMin:()=>s()<=o,isMax:()=>s()>=r}},Layout:To,redraw:si,updateBG:function(){Ao(mt.getContext("2d")),si()},updateSN:function(){let e=!1;for(const t of jo)e=Go(t,!0)||e;e&&er()},openFile:function(e){const t=e.files[0];e.value="",$a(t)},Popeye:Qs,updateEdwards:tr,toFEN:er,toggleCoordinates(){Oo({},!0)},get DB(){return"PDB"==Cn.DB.use?Ea:xa},get noEditing(){return zn()},get hideTemplate(){return _n.hor&&Ln.popeye.playing},YACPDB:xa,BBS:Ma,API:La,PLAY:Or,Stockfish:Ya,Syzygy:ri,store:Cn,state:Ln,status:_n,drawExport:async function(){await fo(),Eo()},resize(){Ln.split,Promise.resolve().then((()=>Oo({})))},saveSettings:function(){localStorage.setItem("settings",JSON.stringify(Cn))},saveSession:function(){Pt.isTop&&sessionStorage.setItem("state",JSON.stringify(Ln))}}).mount()})();