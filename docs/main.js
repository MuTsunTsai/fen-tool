(()=>{Object.create;var t=Object.freeze,n=Object.defineProperty,o=(Object.getOwnPropertyDescriptor,Object.getOwnPropertyNames,Object.getPrototypeOf,Object.prototype.hasOwnProperty,(e,o)=>t(n(e,"raw",{value:t(o||e.slice())}))),r=Object.defineProperty,s=(e,t,n)=>(((e,t,n)=>{t in e?r(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n);function a(e){if(y(e)){const t={};for(let n=0;n<e.length;n++){const o=e[n],r=w(o)?l(o):a(o);if(r)for(const e in r)t[e]=r[e]}return t}return w(e)||A(e)?e:void 0}var c=/;(?![^(]*\))/g,i=/:(.+)/;function l(e){const t={};return e.split(c).forEach((e=>{if(e){const n=e.split(i);n.length>1&&(t[n[0].trim()]=n[1].trim())}})),t}function u(e){let t="";if(w(e))t=e;else if(y(e))for(let n=0;n<e.length;n++){const o=u(e[n]);o&&(t+=o+" ")}else if(A(e))for(const n in e)e[n]&&(t+=n+" ");return t.trim()}function p(e,t){if(e===t)return!0;let n=v(e),o=v(t);if(n||o)return!(!n||!o)&&e.getTime()===t.getTime();if(n=y(e),o=y(t),n||o)return!(!n||!o)&&function(e,t){if(e.length!==t.length)return!1;let n=!0;for(let o=0;n&&o<e.length;o++)n=p(e[o],t[o]);return n}(e,t);if(n=A(e),o=A(t),n||o){if(!n||!o)return!1;if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e){const o=e.hasOwnProperty(n),r=t.hasOwnProperty(n);if(o&&!r||!o&&r||!p(e[n],t[n]))return!1}}return String(e)===String(t)}function f(e,t){return e.findIndex((e=>p(e,t)))}var h,d=Object.assign,g=Object.prototype.hasOwnProperty,m=(e,t)=>g.call(e,t),y=Array.isArray,b=e=>"[object Map]"===S(e),v=e=>e instanceof Date,w=e=>"string"==typeof e,x=e=>"symbol"==typeof e,A=e=>null!==e&&"object"==typeof e,E=Object.prototype.toString,S=e=>E.call(e),k=e=>S(e).slice(8,-1),R=e=>w(e)&&"NaN"!==e&&"-"!==e[0]&&""+parseInt(e,10)===e,C=e=>{const t=Object.create(null);return n=>t[n]||(t[n]=e(n))},N=/-(\w)/g,P=C((e=>e.replace(N,((e,t)=>t?t.toUpperCase():"")))),O=/\B([A-Z])/g,B=C((e=>e.replace(O,"-$1").toLowerCase())),_=e=>{const t=parseFloat(e);return isNaN(t)?e:t};function I(e,t){(t=t||h)&&t.active&&t.effects.push(e)}var L,T=e=>{const t=new Set(e);return t.w=0,t.n=0,t},M=e=>(e.w&z)>0,$=e=>(e.n&z)>0,j=new WeakMap,D=0,z=1,W=30,F=[],U=Symbol(""),H=Symbol("");function K(e){const{deps:t}=e;if(t.length){for(let n=0;n<t.length;n++)t[n].delete(e);t.length=0}}function q(e,t){e.effect&&(e=e.effect.fn);const n=new class{constructor(e,t=null,n){this.fn=e,this.scheduler=t,this.active=!0,this.deps=[],I(this,n)}run(){if(!this.active)return this.fn();if(!F.includes(this))try{return F.push(L=this),Y.push(Q),Q=!0,z=1<<++D,D<=W?(({deps:e})=>{if(e.length)for(let t=0;t<e.length;t++)e[t].w|=z})(this):K(this),this.fn()}finally{D<=W&&(e=>{const{deps:t}=e;if(t.length){let n=0;for(let o=0;o<t.length;o++){const r=t[o];M(r)&&!$(r)?r.delete(e):t[n++]=r,r.w&=~z,r.n&=~z}t.length=n}})(this),z=1<<--D,Z(),F.pop();const e=F.length;L=e>0?F[e-1]:void 0}}stop(){this.active&&(K(this),this.onStop&&this.onStop(),this.active=!1)}}(e);t&&(d(n,t),t.scope&&I(n,t.scope)),(!t||!t.lazy)&&n.run();const o=n.run.bind(n);return o.effect=n,o}function G(e){e.effect.stop()}var Q=!0,Y=[];function Z(){const e=Y.pop();Q=void 0===e||e}function V(e,t,n){if(!Q||void 0===L)return;let o=j.get(e);o||j.set(e,o=new Map);let r=o.get(n);r||o.set(n,r=T()),function(e,t){let n=!1;D<=W?$(e)||(e.n|=z,n=!M(e)):n=!e.has(L),n&&(e.add(L),L.deps.push(e))}(r)}function J(e,t,n,o,r,s){const a=j.get(e);if(!a)return;let c=[];if("clear"===t)c=[...a.values()];else if("length"===n&&y(e))a.forEach(((e,t)=>{("length"===t||t>=o)&&c.push(e)}));else switch(void 0!==n&&c.push(a.get(n)),t){case"add":y(e)?R(n)&&c.push(a.get("length")):(c.push(a.get(U)),b(e)&&c.push(a.get(H)));break;case"delete":y(e)||(c.push(a.get(U)),b(e)&&c.push(a.get(H)));break;case"set":b(e)&&c.push(a.get(U))}if(1===c.length)c[0]&&X(c[0]);else{const e=[];for(const t of c)t&&e.push(...t);X(T(e))}}function X(e,t){for(const t of y(e)?e:[...e])(t!==L||t.allowRecurse)&&(t.scheduler?t.scheduler():t.run())}var ee=function(e,t){const n=Object.create(null),o=e.split(",");for(let e=0;e<o.length;e++)n[o[e]]=!0;return t?e=>!!n[e.toLowerCase()]:e=>!!n[e]}("__proto__,__v_isRef,__isVue"),te=new Set(Object.getOwnPropertyNames(Symbol).map((e=>Symbol[e])).filter(x)),ne=se(),oe=se(!0),re=function(){const e={};return["includes","indexOf","lastIndexOf"].forEach((t=>{e[t]=function(...e){const n=de(this);for(let e=0,t=this.length;e<t;e++)V(n,0,e+"");const o=n[t](...e);return-1===o||!1===o?n[t](...e.map(de)):o}})),["push","pop","shift","unshift","splice"].forEach((t=>{e[t]=function(...e){Y.push(Q),Q=!1;const n=de(this)[t].apply(this,e);return Z(),n}})),e}();function se(e=!1,t=!1){return function(n,o,r){if("__v_isReactive"===o)return!e;if("__v_isReadonly"===o)return e;if("__v_raw"===o&&r===(e?t?pe:ue:t?le:ie).get(n))return n;const s=y(n);if(!e&&s&&m(re,o))return Reflect.get(re,o,r);const a=Reflect.get(n,o,r);return(x(o)?te.has(o):ee(o))||(e||V(n,0,o),t)?a:ge(a)?s&&R(o)?a:a.value:A(a)?e?function(e){return he(e,!0,ce,null,ue)}(a):fe(a):a}}var ae={get:ne,set:function(e=!1){return function(t,n,o,r){let s=t[n];if(!e&&!function(e){return!(!e||!e.__v_isReadonly)}(o)&&(o=de(o),s=de(s),!y(t)&&ge(s)&&!ge(o)))return s.value=o,!0;const a=y(t)&&R(n)?Number(n)<t.length:m(t,n),c=Reflect.set(t,n,o,r);return t===de(r)&&(a?((e,t)=>!Object.is(e,t))(o,s)&&J(t,"set",n,o):J(t,"add",n,o)),c}}(),deleteProperty:function(e,t){const n=m(e,t);e[t];const o=Reflect.deleteProperty(e,t);return o&&n&&J(e,"delete",t,void 0),o},has:function(e,t){const n=Reflect.has(e,t);return(!x(t)||!te.has(t))&&V(e,0,t),n},ownKeys:function(e){return V(e,0,y(e)?"length":U),Reflect.ownKeys(e)}},ce={get:oe,set:(e,t)=>!0,deleteProperty:(e,t)=>!0},ie=new WeakMap,le=new WeakMap,ue=new WeakMap,pe=new WeakMap;function fe(e){return e&&e.__v_isReadonly?e:he(e,!1,ae,null,ie)}function he(e,t,n,o,r){if(!A(e)||e.__v_raw&&(!t||!e.__v_isReactive))return e;const s=r.get(e);if(s)return s;const a=function(e){return e.__v_skip||!Object.isExtensible(e)?0:function(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}(k(e))}(e);if(0===a)return e;const c=new Proxy(e,2===a?o:n);return r.set(e,c),c}function de(e){const t=e&&e.__v_raw;return t?de(t):e}function ge(e){return Boolean(e&&!0===e.__v_isRef)}Promise.resolve();var me=!1,ye=[],be=Promise.resolve(),ve=e=>be.then(e),we=e=>{ye.includes(e)||ye.push(e),me||(me=!0,ve(xe))},xe=()=>{for(const e of ye)e();ye.length=0,me=!1},Ae=/^(spellcheck|draggable|form|list|type)$/,Ee=({el:e,get:t,effect:n,arg:o,modifiers:r})=>{let s;"class"===o&&(e._class=e.className),n((()=>{let n=t();if(o)(null==r?void 0:r.camel)&&(o=P(o)),Se(e,o,n,s);else{for(const t in n)Se(e,t,n[t],s&&s[t]);for(const t in s)(!n||!(t in n))&&Se(e,t,null)}s=n}))},Se=(e,t,n,o)=>{if("class"===t)e.setAttribute("class",u(e._class?[e._class,n]:n)||"");else if("style"===t){n=a(n);const{style:t}=e;if(n)if(w(n))n!==o&&(t.cssText=n);else{for(const e in n)Re(t,e,n[e]);if(o&&!w(o))for(const e in o)null==n[e]&&Re(t,e,"")}else e.removeAttribute("style")}else e instanceof SVGElement||!(t in e)||Ae.test(t)?"true-value"===t?e._trueValue=n:"false-value"===t?e._falseValue=n:null!=n?e.setAttribute(t,n):e.removeAttribute(t):(e[t]=n,"value"===t&&(e._value=n))},ke=/\s*!important$/,Re=(e,t,n)=>{y(n)?n.forEach((n=>Re(e,t,n))):t.startsWith("--")?e.setProperty(t,n):ke.test(n)?e.setProperty(B(t),n.replace(ke,""),"important"):e[t]=n},Ce=(e,t)=>{const n=e.getAttribute(t);return null!=n&&e.removeAttribute(t),n},Ne=(e,t,n,o)=>{e.addEventListener(t,n,o)},Pe=/^[A-Za-z_$][\w$]*(?:\.[A-Za-z_$][\w$]*|\['[^']*?']|\["[^"]*?"]|\[\d+]|\[[A-Za-z_$][\w$]*])*$/,Oe=["ctrl","shift","alt","meta"],Be={stop:e=>e.stopPropagation(),prevent:e=>e.preventDefault(),self:e=>e.target!==e.currentTarget,ctrl:e=>!e.ctrlKey,shift:e=>!e.shiftKey,alt:e=>!e.altKey,meta:e=>!e.metaKey,left:e=>"button"in e&&0!==e.button,middle:e=>"button"in e&&1!==e.button,right:e=>"button"in e&&2!==e.button,exact:(e,t)=>Oe.some((n=>e["".concat(n,"Key")]&&!t[n]))},_e=({el:e,get:t,exp:n,arg:o,modifiers:r})=>{if(!o)return;let s=Pe.test(n)?t("(e => ".concat(n,"(e))")):t("($event => { ".concat(n," })"));if("vue:mounted"!==o){if("vue:unmounted"===o)return()=>s();if(r){"click"===o&&(r.right&&(o="contextmenu"),r.middle&&(o="mouseup"));const e=s;s=t=>{if(!("key"in t)||B(t.key)in r){for(const e in r){const n=Be[e];if(n&&n(t,r))return}return e(t)}}}Ne(e,o,s,r)}else ve(s)},Ie=({el:e,get:t,effect:n})=>{n((()=>{e.textContent=Le(t())}))},Le=e=>null==e?"":A(e)?JSON.stringify(e,null,2):String(e),Te=e=>"_value"in e?e._value:e.value,Me=(e,t)=>{const n=t?"_trueValue":"_falseValue";return n in e?e[n]:t},$e=e=>{e.target.composing=!0},je=e=>{const t=e.target;t.composing&&(t.composing=!1,De(t,"input"))},De=(e,t)=>{const n=document.createEvent("HTMLEvents");n.initEvent(t,!0,!0),e.dispatchEvent(n)},ze=Object.create(null),We=(e,t,n)=>Fe(e,"return(".concat(t,")"),n),Fe=(e,t,n)=>{const o=ze[t]||(ze[t]=Ue(t));try{return o(e,n)}catch(e){console.error(e)}},Ue=e=>{try{return new Function("$data","$el","with($data){".concat(e,"}"))}catch(t){return console.error("".concat(t.message," in expression: ").concat(e)),()=>{}}},He={bind:Ee,on:_e,show:({el:e,get:t,effect:n})=>{const o=e.style.display;n((()=>{e.style.display=t()?o:"none"}))},text:Ie,html:({el:e,get:t,effect:n})=>{n((()=>{e.innerHTML=t()}))},model:({el:e,exp:t,get:n,effect:o,modifiers:r})=>{const s=e.type,a=n("(val) => { ".concat(t," = val }")),{trim:c,number:i="number"===s}=r||{};if("SELECT"===e.tagName){const t=e;Ne(e,"change",(()=>{const e=Array.prototype.filter.call(t.options,(e=>e.selected)).map((e=>i?_(Te(e)):Te(e)));a(t.multiple?e:e[0])})),o((()=>{const e=n(),o=t.multiple;for(let n=0,r=t.options.length;n<r;n++){const r=t.options[n],s=Te(r);if(o)y(e)?r.selected=f(e,s)>-1:r.selected=e.has(s);else if(p(Te(r),e))return void(t.selectedIndex!==n&&(t.selectedIndex=n))}!o&&-1!==t.selectedIndex&&(t.selectedIndex=-1)}))}else if("checkbox"===s){let t;Ne(e,"change",(()=>{const t=n(),o=e.checked;if(y(t)){const n=Te(e),r=f(t,n),s=-1!==r;if(o&&!s)a(t.concat(n));else if(!o&&s){const e=[...t];e.splice(r,1),a(e)}}else a(Me(e,o))})),o((()=>{const o=n();y(o)?e.checked=f(o,Te(e))>-1:o!==t&&(e.checked=p(o,Me(e,!0))),t=o}))}else if("radio"===s){let t;Ne(e,"change",(()=>{a(Te(e))})),o((()=>{const o=n();o!==t&&(e.checked=p(o,Te(e)))}))}else{const t=e=>c?e.trim():i?_(e):e;Ne(e,"compositionstart",$e),Ne(e,"compositionend",je),Ne(e,(null==r?void 0:r.lazy)?"change":"input",(()=>{e.composing||a(t(e.value))})),c&&Ne(e,"change",(()=>{e.value=e.value.trim()})),o((()=>{if(e.composing)return;const o=e.value,r=n();document.activeElement===e&&t(o)===r||o!==r&&(e.value=r)}))}},effect:({el:e,ctx:t,exp:n,effect:o})=>{ve((()=>o((()=>Fe(t.scope,n,e)))))}},Ke=/([\s\S]*?)\s+(?:in|of)\s+([\s\S]*)/,qe=/,([^,\}\]]*)(?:,([^,\}\]]*))?$/,Ge=/^\(|\)$/g,Qe=/^[{[]\s*((?:[\w_$]+\s*,?\s*)+)[\]}]$/,Ye=(e,t,n)=>{const o=t.match(Ke);if(!o)return;const r=e.nextSibling,s=e.parentElement,a=new Text("");s.insertBefore(a,e),s.removeChild(e);const c=o[2].trim();let i,l,u,p,f=o[1].trim().replace(Ge,"").trim(),h=!1,d="key",g=e.getAttribute(d)||e.getAttribute(d=":key")||e.getAttribute(d="v-bind:key");g&&(e.removeAttribute(d),"key"===d&&(g=JSON.stringify(g))),(p=f.match(qe))&&(f=f.replace(qe,"").trim(),l=p[1].trim(),p[2]&&(u=p[2].trim())),(p=f.match(Qe))&&(i=p[1].split(",").map((e=>e.trim())),h="["===f[0]);let m,b,v,w=!1;const x=(e,t,o,r)=>{const s={};i?i.forEach(((e,n)=>s[e]=t[h?n:e])):s[f]=t,r?(l&&(s[l]=r),u&&(s[u]=o)):l&&(s[l]=o);const a=at(n,s),c=g?We(a.scope,g):o;return e.set(c,o),a.key=c,a},E=(t,n)=>{const o=new it(e,t);return o.key=t.key,o.insert(s,n),o};return n.effect((()=>{const e=We(n.scope,c),t=v;if([b,v]=(e=>{const t=new Map,n=[];if(y(e))for(let o=0;o<e.length;o++)n.push(x(t,e[o],o));else if("number"==typeof e)for(let o=0;o<e;o++)n.push(x(t,o+1,o));else if(A(e)){let o=0;for(const r in e)n.push(x(t,e[r],o++,r))}return[n,t]})(e),w){for(let e=0;e<m.length;e++)v.has(m[e].key)||m[e].remove();const e=[];let n,o,r=b.length;for(;r--;){const c=b[r],i=t.get(c.key);let l;null==i?l=E(c,n?n.el:a):(l=m[i],Object.assign(l.ctx.scope,c.scope),i!==r&&(m[i+1]!==n||o===n)&&(o=l,l.insert(s,n?n.el:a))),e.unshift(n=l)}m=e}else m=b.map((e=>E(e,a))),w=!0})),r},Ze=({el:e,ctx:{scope:{$refs:t}},get:n,effect:o})=>{let r;return o((()=>{const o=n();t[o]=e,r&&o!==r&&delete t[r],r=o})),()=>{r&&delete t[r]}},Ve=/^(?:v-|:|@)/,Je=/\.([\w-]+)/g,Xe=!1,et=(e,t)=>{const n=e.nodeType;if(1===n){const n=e;if(n.hasAttribute("v-pre"))return;let o;if(Ce(n,"v-cloak"),o=Ce(n,"v-if"))return((e,t,n)=>{const o=e.parentElement,r=new Comment("v-if");o.insertBefore(r,e);const s=[{exp:t,el:e}];let a,c;for(;(a=e.nextElementSibling)&&(c=null,""===Ce(a,"v-else")||(c=Ce(a,"v-else-if")));)o.removeChild(a),s.push({exp:c,el:a});const i=e.nextSibling;o.removeChild(e);let l,u=-1;const p=()=>{l&&(o.insertBefore(r,l.el),l.remove(),l=void 0)};return n.effect((()=>{for(let e=0;e<s.length;e++){const{exp:t,el:a}=s[e];if(!t||We(n.scope,t))return void(e!==u&&(p(),l=new it(a,n),l.insert(o,r),o.removeChild(r),u=e))}u=-1,p()})),i})(n,o,t);if(o=Ce(n,"v-for"))return Ye(n,o,t);if((o=Ce(n,"v-scope"))||""===o){const e=o?We(t.scope,o):{};t=at(t,e),e.$template&&rt(n,e.$template)}const r=null!=Ce(n,"v-once");r&&(Xe=!0),(o=Ce(n,"ref"))&&ot(n,Ze,'"'.concat(o,'"'),t),tt(n,t);const s=[];for(const{name:e,value:o}of[...n.attributes])Ve.test(e)&&"v-cloak"!==e&&("v-model"===e?s.unshift([e,o]):"@"===e[0]||/^v-on\b/.test(e)?s.push([e,o]):nt(n,e,o,t));for(const[e,o]of s)nt(n,e,o,t);r&&(Xe=!1)}else if(3===n){const n=e.data;if(n.includes(t.delimiters[0])){let o,r=[],s=0;for(;o=t.delimitersRE.exec(n);){const e=n.slice(s,o.index);e&&r.push(JSON.stringify(e)),r.push("$s(".concat(o[1],")")),s=o.index+o[0].length}s<n.length&&r.push(JSON.stringify(n.slice(s))),ot(e,Ie,r.join("+"),t)}}else 11===n&&tt(e,t)},tt=(e,t)=>{let n=e.firstChild;for(;n;)n=et(n,t)||n.nextSibling},nt=(e,t,n,o)=>{let r,s,a;if(":"===(t=t.replace(Je,((e,t)=>((a||(a={}))[t]=!0,""))))[0])r=Ee,s=t.slice(1);else if("@"===t[0])r=_e,s=t.slice(1);else{const e=t.indexOf(":"),n=e>0?t.slice(2,e):t.slice(2);r=He[n]||o.dirs[n],s=e>0?t.slice(e+1):void 0}r&&(r===Ee&&"ref"===s&&(r=Ze),ot(e,r,n,o,s,a),e.removeAttribute(t))},ot=(e,t,n,o,r,s)=>{const a=t({el:e,get:(t=n)=>We(o.scope,t,e),effect:o.effect,ctx:o,exp:n,arg:r,modifiers:s});a&&o.cleanups.push(a)},rt=(e,t)=>{if("#"!==t[0])e.innerHTML=t;else{const n=document.querySelector(t);e.appendChild(n.content.cloneNode(!0))}},st=e=>{const t={delimiters:["{{","}}"],delimitersRE:/\{\{([^]+?)\}\}/g,...e,scope:e?e.scope:fe({}),dirs:e?e.dirs:{},effects:[],blocks:[],cleanups:[],effect:e=>{if(Xe)return we(e),e;const n=q(e,{scheduler:()=>we(n)});return t.effects.push(n),n}};return t},at=(e,t={})=>{const n=e.scope,o=Object.create(n);Object.defineProperties(o,Object.getOwnPropertyDescriptors(t)),o.$refs=Object.create(n.$refs);const r=fe(new Proxy(o,{set:(e,t,o,s)=>s!==r||e.hasOwnProperty(t)?Reflect.set(e,t,o,s):Reflect.set(n,t,o)}));return ct(r),{...e,scope:r}},ct=e=>{for(const t of Object.keys(e))"function"==typeof e[t]&&(e[t]=e[t].bind(e))},it=class{constructor(e,t,n=!1){s(this,"template"),s(this,"ctx"),s(this,"key"),s(this,"parentCtx"),s(this,"isFragment"),s(this,"start"),s(this,"end"),this.isFragment=e instanceof HTMLTemplateElement,n?this.template=e:this.isFragment?this.template=e.content.cloneNode(!0):this.template=e.cloneNode(!0),n?this.ctx=t:(this.parentCtx=t,t.blocks.push(this),this.ctx=st(t)),et(this.template,this.ctx)}get el(){return this.start||this.template}insert(e,t=null){if(this.isFragment)if(this.start){let n,o=this.start;for(;o&&(n=o.nextSibling,e.insertBefore(o,t),o!==this.end);)o=n}else this.start=new Text(""),this.end=new Text(""),e.insertBefore(this.end,t),e.insertBefore(this.start,this.end),e.insertBefore(this.template,this.end);else e.insertBefore(this.template,t)}remove(){if(this.parentCtx&&((e,t)=>{const n=e.indexOf(t);n>-1&&e.splice(n,1)})(this.parentCtx.blocks,this),this.start){const e=this.start.parentNode;let t,n=this.start;for(;n&&(t=n.nextSibling,e.removeChild(n),n!==this.end);)n=t}else this.template.parentNode.removeChild(this.template);this.teardown()}teardown(){this.ctx.blocks.forEach((e=>{e.teardown()})),this.ctx.effects.forEach(G),this.ctx.cleanups.forEach((e=>e()))}},lt=e=>e.replace(/[-.*+?^${}()|[\]\/\\]/g,"\\$&"),ut=e=>{const t=st();if(e&&(t.scope=fe(e),ct(t.scope),e.$delimiters)){const[n,o]=t.delimiters=e.$delimiters;t.delimitersRE=new RegExp(lt(n)+"([^]+?)"+lt(o),"g")}let n;return t.scope.$s=Le,t.scope.$nextTick=ve,t.scope.$refs=Object.create(null),{directive(e,n){return n?(t.dirs[e]=n,this):t.dirs[e]},mount(e){if("string"==typeof e&&!(e=document.querySelector(e)))return;let o;return o=(e=e||document.documentElement).hasAttribute("v-scope")?[e]:[...e.querySelectorAll("[v-scope]")].filter((e=>!e.matches("[v-scope] [v-scope]"))),o.length||(o=[e]),n=o.map((e=>new it(e,t,!0))),this},unmount(){n.forEach((e=>e.teardown()))}}},pt=document.currentScript;pt&&pt.hasAttribute("init")&&ut().mount();var ft=/^\d+(,\d+)*$/;var ht=20;function dt(e,t){const n=function(e){const t=e.split(",").map((e=>{const t=Number(e);return isNaN(t)?0:Math.abs(Math.floor(t))})),n=t.reduce(((e,t)=>e+t),0);return{array:t,size:n}}(e.border),o=e.coordinates?{x:ht,y:ht}:{x:0,y:0};!0===t&&(o.y=0),!1===t&&(o.x=0);return{w:e.w*e.size+2*n.size+o.x,h:e.h*e.size+2*n.size+o.y,border:n,offset:{x:n.size+o.x,y:n.size},margin:o}}var gt=document.getElementById("CN"),mt=document.getElementById("SN"),yt=document.getElementById("TP"),bt=document.getElementById("CanvasGhost"),vt=document.getElementById("TemplateGhost"),wt=document.getElementById("FEN"),xt=document.getElementById("DB"),At=document.getElementById("PV"),Et=navigator.clipboard,St="canShare"in navigator,kt=Math.min(2,Math.floor(devicePixelRatio));var Rt=matchMedia("(hover: none), (pointer: coarse)").matches,Ct={isTop:top==self,canShare:St,canSharePng:function(){if(!St)return!1;const e=atob("iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII"),t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);const n=new Blob([t]),o=new File([n],"1.png",{type:"image/png"});return navigator.canShare({files:[o]})}(),canCopy:Et&&"writeText"in Et,canPaste:Et&&"readText"in Et,canCopyImg:Et&&"write"in Et,isTouch:Rt,isTaiwan:navigator.languages.includes("zh-TW")};function Nt(e,t,n=!1){if(!(t instanceof Object))return e;const o=Object.keys(t);for(const r of o){if(n&&!(r in e))continue;const o=t[r];o instanceof Object?e[r]instanceof Object&&e[r]!=o?e[r]=Nt(e[r],o,n):e[r]=Pt(o):e[r]=o}return e}function Pt(e){return Nt(Array.isArray(e)?[]:{},e)}var Ot,Bt="function"==typeof structuredClone?structuredClone:Pt,_t="8/8/8/8/8/8/8/8",It="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",Lt="[ðŸ‡¦-ðŸ‡¿]{2}|\\p{ExtPict}\\uFE0F?\\p{EMod}?(\\u200D\\p{ExtPict}\\uFE0F?\\p{EMod}?)*",Tt="\\((!?)([kqbnrp])(\\d?)\\)",Mt="'(".concat(Lt,"|[^'])|''.."),$t="[-~]?(\\*\\d)?(".concat("[kqbnrpcxstadg]","|").concat(Mt,")"),jt=RegExp("^(?:".concat(Lt,")$"),"u"),Dt=RegExp("^(?:".concat(Tt,"|").concat($t,")$"),"iu"),zt=RegExp("\\/|\\d+|".concat(Tt,"|").concat($t,"|."),"iug");function Wt(e){const t=e.match(zt)||[],n=[0];let o=0;for(const e of t)"/"==e?n[++o]=0:e.match(/^\d+$/)?n[o]+=Number(e):n[o]++;const r=n.length;if(1==r)return;const s=n[0];for(const e of n)if(e!=s)return;return{w:s,h:r}}function Ft(e,t=8,n=8){const o=e.match(zt)||[],r=[];let s=!1;for(const e of o){if("/"==e){if(!s){const e=r.length+t-r.length%t;for(;r.length<e;)r.push("")}}else if(e.match(/^\d+$/)){const t=Number(e);for(let e=0;e<t;e++)r.push("")}else r.push(e);if(s="/"!=e&&r.length%t==0,r.length==t*n)break}for(;r.length<t*n;)r.push("");return r}function Ut(e,t=8,n=8){let o=0,r="";function s(){o&&(r+=o),o=0}for(let a=0;a<n;a++){for(let n=0;n<t;n++){const c=a*t+n;""==e[c]?o++:(s(),r+=e[c])}s(),a<n-1&&(r+="/")}return r}function Ht(e,t,n){if(!e.match(Dt))if(e.match(jt))e="'"+e;else{const t=[...e].length;e=1==t&&"'"!=e?"'"+e:2==t?"''"+e:""}return(e=(e=e.replace(RegExp("^".concat(Tt,"$"),"i"),((e,t,n,o)=>{let r=n;return o&&(r="*"+o+r),t&&(r="-"+r),r}))).replace(/^~/,"-").replace(/^-(?=.*')/,"")).startsWith("-")&&(e=e.toLowerCase()),e=qt(e,t,n)}function Kt(e){const t=(e=qt(e,!1,!0)).match(/^(-?)(?:\*(\d))?([kqbnrp])$/i);return t?t[1]||t[2]?"("+(t[1]?"!":"")+t[3]+(t[2]||"")+")":t[3]:""}function qt(e,t,n){return e.match(/^-?(\*\d)?[sng]$/i)?(t?(n&&(e=e.replace("s","g").replace("S","G")),e=e.replace("n","s").replace("N","S")):(n&&(e=e.replace("s","n").replace("S","N")),e=e.replace("g","s").replace("G","S")),e):e}function Gt(e,t,n=8){return void 0===t&&(e=(e-(t=e%8))/8),String.fromCharCode(97+t)+(n-e)}function Qt(e,t=8){return{x:e.charCodeAt(0)-97,y:t-Number(e[1])}}function Yt(e,t=8,n=8){const{x:o,y:r}=Qt(e,n);return r*t+o}function Zt(e){return Array.from({length:e},(e=>""))}function Vt(e,t,n,o=8,r=8){const s=Zt(o*r);s.anime="";for(let a=0;a<r;a++)for(let c=0;c<o;c++){const i=c+t,l=a+n,u=0<=i&&i<o&&0<=l&&l<r;e[a*o+c]&&(s[l*o+i]=u?e[a*o+c]:"",s.anime+=Gt(a,c,r)+Gt(l,i,r))}return s}function Jt(e,t,n=8,o=8){const r=Zt(n*o);r.anime="";for(let s=0;s<o;s++)for(let a=0;a<n;a++){let c=a,i=s;if("-"==t&&(c=n-1-c),"|"!=t&&"/"!=t||(i=o-1-i),"/"==t||"\\"==t){const e=i-c;c+=e,i-=e}"/"==t&&(i=o-1-i),e[i*n+c]&&(r[s*n+a]=e[i*n+c],r.anime+=Gt(i,c,o)+Gt(s,a,o))}return r}function Xt(e,t,n=8,o=8){const r=Zt(n*o);n==o&&(r.anime="");for(let s=0;s<n;s++)for(let a=0;a<o;a++){const c=1==t?s:2==t?o-1-a:n-1-s,i=1==t?o-1-a:2==t?n-1-s:a;e[i*n+c]&&(r[s*o+a]=e[i*n+c],n==o&&(r.anime+=Gt(i,c,o)+Gt(s,a,o)))}return r}function en(e,t){return e.map((e=>{if(""==e||e.startsWith("-"))return e;if(!t&&e.startsWith("'"))return e;const n=e.toLowerCase();return e=e==n?e.toUpperCase():n}))}function tn(e,t="",n=""){return new RegExp(t+nn(e)+n,"i")}function nn(e){let t=4;return e.match(/^\d/)&&(t=Number(e[0]),e=e.substring(1)),e.length<=t?"\\b"+e+"\\b":"\\b"+e.substring(0,t)+on(e.substring(t))}function on(e){return""==e?"":String.raw(Ot||(Ot=o(["(?:","","|\b)"],["(?:","","|\\b)"])),e[0],on(e.substring(1)))}var rn,sn,an,cn,ln="[a-h][1-8]",un="(?:[0-9A-Z][0-9A-Z]|[A-Z])",pn=String.raw(rn||(rn=o(["[[^]]+]"],["\\[[^\\]]+\\]"]))),fn=String.raw(sn||(sn=o(["(+)?[a-z]) (S[ S]+S)"],["(\\+)?[a-z]\\) (\\S[ \\S]+\\S)"]))),hn="(?:[nwb])?r?".concat(un,"?(?<from>").concat(ln,")[-*](?<to>").concat(ln,")(?:[-*](?<then>").concat(ln,"))?"),dn="=(?<pc>[nwb])?(?<p>".concat(un,")"),gn=["condition","2option","3stipulation","2sstipulation","3forsyth","2pieces","2twin"].map(nn).join("|"),mn=new RegExp(gn,"ig"),yn=String.raw(an||(an=o(["(?:(?<move>0-0(?:-0)?|",")(?:",")*(?:",")?(?:=(?<cc>[nwb]))?(?<ep> ep.)?)(?:",")*"],["(?:(?<move>0-0(?:-0)?|",")(?:",")*(?:",")?(?:=(?<cc>[nwb]))?(?<ep> ep\\.)?)(?:",")*"])),hn,pn,dn,pn),bn=yn.replace(/\?<[^>]+>/g,""),vn=String.raw(cn||(cn=o(["(?<count>d+.(?:..)?)?(?<main>","(?:/",")*)(?: [+#=])?"],["(?<count>\\d+\\.(?:\\.\\.)?)?(?<main>","(?:\\/",")*)(?: [+#=])?"])),bn,bn);function wn(e,t,n,o){n=kn(n),"w"==o&&(n=n.toUpperCase()),"b"==o&&(n=n.toLowerCase()),"n"==o&&(n="-"+n.toLowerCase()),e[Yt(t)]=n}function xn(e,t,n,o){return o&&o.push(t+n),t=Yt(t),e[n=Yt(n)]=e[t],e[t]="",e[n]}var An={"*2Q":"G","*2N":"N","*1N":"Z","*3N":"CA","*3B":"GI","*3Q":"LI","*1Q":"EQ","*2P":"BP","*1B":"AN","*1K":"PO","*2K":"ST","*3K":"DU","*2R":"WE","*3R":"PA",C:"I"},En={"*1B":"25,37,AL,AN,BM,C,CT,DB,GN,GY,NH","*1K":"PO","*1N":"36,AO,BK,BN,DR,GR,KP,LS,MA,MS,OH,RK,S1,S2,S3,S4,SQ,SS,SW,UU,Z,ZE,ZH,ZR","*1P":"BS,CP,MP","*1Q":"EQ,HA,KH,L,LE,NE","*1R":"DA,DK,EK,GT,MH,RM,RO,RR,SH,WA","*2B":"15,AR,BH,BT,BU,BW,ND,PR","*2K":"ST","*2N":"N","*2P":"BP","*2Q":"G","*2R":"DG,EM,RA,RF,RH,RW,WE","*3B":"BE,BL,FE,GI,LO,OK,RB,VA","*3K":"DU","*3N":"24,35,AH,CA,DS,GH,MO,OA,SA","*3P":"O,SP","*3Q":"16,AM,EH,KA,LI,M,OR,SE,SI","*3R":"BR,CH,CR,EA,FA,PA,RE,RL,TR",A:"AG,B1,B2,B3,BI,BO,CG,CY,DO,ET,F,FR,G2,G3,GE,GF,GL,KL,KO,LB,LH,LN,LR,MG,ML,MM,NA,NL,NO,PP,QE,QF,QN,QQ,RN,RP,RT,SK,SO,TH,WR",C:"I",N:"S"},Sn={custom:()=>({}),default:{}};for(const e in En)for(const t of En[e].split(","))Sn.default[t]=e;function kn(e){const t=e.toUpperCase(),n=function(e,t){for(const n in e)if(e[n]==t)return n}(Sn.custom(),t)||Sn.default[t];return n?e==t?n:n.toLowerCase():e}var Rn=new URL(location.href).searchParams,Cn=JSON.parse(localStorage.getItem("settings"))||{},Nn={BBS:{Id:!0,coordinates:!0,notes:!0,uncoloredNotes:!1,redBlue:!1},DB:{use:"PDB",exact:!1},PLAY:{symbol:null,ep:!0,negative:!1,zero:!1},feature:{janko:!1},popeye:{pieceMap:An},board:{pattern:void 0,bg:void 0,exHigh:!0,border:"1",blackWhite:!1,knightOffset:.6,SN:!1,size:44,w:8,h:8,fullFEN:!1,coordinates:!1,set:"1echecs",collapse:!0},message:{touchTip:!0,textShortcut:!0}};Nt(Nn,Cn,!0),Cn.popeye&&(Nn.popeye.pieceMap=Cn.popeye.pieceMap),Rn.has("janko")&&(Nn.feature.janko=!0);var Pn=fe(Nn);Sn.custom=()=>Pn.popeye.pieceMap;var On=matchMedia("(prefers-color-scheme: dark)");On.onchange=()=>Bn.isDark=On.matches;var Bn=fe({loading:!0,isDark:On.matches,pieceCount:"(0+0)",hor:!1,collapse:!1,dragging:!1}),_n=Ct.isTop?sessionStorage.getItem("state"):null,In=fe(_n?JSON.parse(_n):{split:!1,tab:0,play:{initFEN:null,playing:!1,pendingPromotion:!1,moveNumber:-1,game:"",history:[],turn:"w",castle:{K:!0,Q:!0,k:!0,q:!0},retro:{uncapture:null,unpromote:!1},enPassant:"",halfMove:0,fullMove:1,mode:"normal"},popeye:{initFEN:null,index:null,steps:null,playing:!1,error:!1,running:!1,editMap:!1,mapping:"",input:"",output:"",intInput:null,intOutput:null}});function Ln(e,t,n){const{size:o,w:r}=Pn.board,{border:s,margin:a}=dt(Pn.board,t),c=s.size,i=e?t?8:3:r,l=(e||gt).clientWidth/(o*i+2*c+a.x);return{s:o*l,offset:{x:(c+a.x)*l,y:c*l,r:c*l,b:(c+a.y)*l},width:((n||r)*o+2*s.size+a.x)*l}}function Tn(){return In.play.playing||In.popeye.playing}var Mn=0;function $n(e,t,n,o){return{$template:"#checkbox",id:"chk"+Mn++,label:t,checked:e,disabled:()=>null==o?void 0:o(),change:e=>{n&&n(e.target.checked)}}}function jn(e,t,n,o){const r=e.split(".");let s=e.startsWith("state.")?In:Pn;for(s==In&&r.shift(),e=r.pop();r.length;)s=s[r.shift()];return $n((()=>s[e]),t,(t=>{s[e]=t,n&&n()}),o)}var Dn=document.createElement("canvas"),zn=Dn.getContext("2d"),Wn=new Map;function Fn(e,t){const n=e.set+e.size*t;return Wn.get(n)}async function Un(e,t,n){const o=t.set+t.size*n;if(Wn.has(o))return Wn.get(o);const r=await async function(e,t,n){const{set:o,size:r}=t;e+="/x"+n;const[s,a]=await Promise.all([Hn("".concat(e,"/").concat(o).concat(r,".png")),Hn("".concat(e,"/symbol").concat(r,".png"))]);return Dn.width=r*n*3,Dn.height=r*n*12,zn.drawImage(s,0,0),zn.drawImage(a,0,r*n*6),Dn.toDataURL()}(e,t,n),s=await Hn(r);return Wn.set(o,s),s}function Hn(e){return new Promise(((t,n)=>{const o=new Image;o.onload=()=>t(o),o.onerror=n,o.src=e}))}var Kn=["k","q","b","n","r","p","c","x","s","t","a","d"],qn=document.createElement("canvas"),Gn=qn.getContext("2d"),Qn=document.createElement("canvas"),Yn=Qn.getContext("2d"),Zn={26:"YdVh1QDVYdVh",32:"AAAKAAAAo/+jAAr/AP8KAKP/owAAAAoAAA==",38:"AAw+DAAM3P/cDD7/AP8+DNz/3AwADD4MAA==",44:"AC9yLwAv+f/5L3L/AP9yL/n/+S8AL3IvAA==",52:"A3i2eAN4////eLb/AP+2eP///3gDeLZ4Aw==",64:"AAAEHgQAAAA/5v/mPwAE5v///+YEHv//AP//HgTm////5gQAP+b/5j8AAAAEHgQAAA==",76:"AARZhFkEAAS7////uwRZ//////9ZhP//AP//hFn//////1kEu////7sEAARZhFkEAA==",88:"AEfE68RHAEf8/////EfE///////E6///AP//68T//////8RH/P////xHAEfE68RHAA=="};function Vn(e,t,n,o,r,s){const{w:a,h:c,border:i,offset:l,margin:u}=dt(n,s),p=Fn(n,o);e.canvas.width=a*o,e.canvas.height=c*o,e.save(),e.scale(o,o);const f="classic"==n.bg,h=r||f;e.translate(l.x,l.y);for(let r=0;r<n.h;r++)for(let s=0;s<n.w;s++)h||Xn(e,r,s,n),Jn(e,p,r,s,t[r*n.w+s],n,o);if(e.restore(),f&&!r){!function(e,t,n){const o=e.canvas;Qn.width=qn.width=o.width,Qn.height=qn.height=o.height,Gn.drawImage(o,0,0),e.save(),e.fillStyle="white",e.fillRect(0,0,o.width,o.height),e.globalCompositeOperation="destination-in",e.drawImage(qn,0,0),e.restore(),e.save();const r=function(e){if("string"==typeof Zn[e]){const t=atob(Zn[e]),n=[];for(let e=0;e<t.length;e++)n.push(t.charCodeAt(e));Zn[e]=n}return Zn[e]}(t*n),s=Math.sqrt(r.length),a=(s-1)/2;for(let t=0;t<s;t++)for(let n=0;n<s;n++){const c=r[n*s+t];0!=c&&(e.globalAlpha=c/255,Yn.drawImage(o,t-a,n-a))}e.restore()}(e,n.size,o),e.save(),e.scale(o,o),e.translate(l.x,l.y);for(let t=0;t<n.h;t++)for(let o=0;o<n.w;o++)Xn(e,t,o,n);e.restore(),e.drawImage(Qn,0,0),e.drawImage(Qn,0,0),e.drawImage(Qn,0,0),e.drawImage(qn,0,0)}e.scale(o,o),void 0===s&&n.coordinates&&(e.save(),e.translate(l.x,l.y),function(e,t,n){const{size:o,w:r,h:s}=t;e.font="15px sans-serif",e.strokeStyle="black",e.lineWidth=2,e.fillStyle="white",e.lineJoin="round";for(let t=0;t<s;t++){const r=(t+1).toString(),a=e.measureText(r),c=o*(s-t)-(o-10)/2,i=(ht-a.width)/2-ht-n;e.strokeText(r,i,c),e.fillText(r,i,c)}for(let t=0;t<r&&t<26;t++){const r=String.fromCharCode(97+t),a=e.measureText(r),c=o*s+ht+n-5,i=o*t+(o-a.width)/2;e.strokeText(r,i,c),e.fillText(r,i,c)}}(e,n,i.size),e.restore()),r||function(e,t,n,o,r){e.save(),e.translate(r.x,0),n-=r.x,o-=r.y;let s=0;for(let r=0;r<t.array.length;r++){const a=t.array[r];if(e.strokeStyle=r%2?"white":"black",0==a)continue;e.lineWidth=a;const c=t.size-s-a/2;e.strokeRect(c,c,n-2*c,o-2*c),s+=a}e.restore()}(e,i,a,c,u)}function Jn(e,t,n,o,r,s,a){void 0===r&&(r="");const{size:c}=s,i=r&&r.startsWith("-");i&&(r=r.substring(1));const l=r.match(/^\*(\d)/);let u=l&&l[1]||void 0;void 0!==u&&(r=r.substring(2)),u=Number(u)%4,s.SN&&(r=qt(r,!1,!0));const p=r.toLowerCase(),f=Kn.indexOf(p),h=r.startsWith("'");if(f<0&&!h)return;e.save();const d=s.blackWhite,g=i?d?0:2:r==p?0:1,m=i&&d?"n"==p?s.knightOffset:.5:1,[y,b]=[u+1&2?1:0,2&u?1:0];if(e.translate((o+y)*c,(n+b)*c),0!==u&&e.rotate(Math.PI/2*u),h){!function(e,t,n){e.save();const o=jt.test(t),r=n-4;e.font="".concat(r,"px sans-serif");const s=n-2;let a=e.measureText(t);if(o&&a.width>s){const n=s/a.width;e.font="".concat(r*n,"px sans-serif"),a=e.measureText(t)}const c=function(e){return e.actualBoundingBoxAscent-e.actualBoundingBoxDescent}(o?e.measureText("M"):a),i=(n-Math.min(a.width,s))/2,l=Math.max((n-c)/2,0);e.fillStyle="black",e.fillText(t,i,n-l,s),e.restore()}(e,r.substring(r.startsWith("''")?2:1),c)}else e.drawImage(t,g*c*a,f*c*a,c*m*a,c*a,0,0,c*m,c),i&&d&&e.drawImage(t,(1+m)*c*a,f*c*a,c*(1-m)*a,c*a,c*m,0,c*(1-m),c);e.restore()}function Xn(e,t,n,o){const r=function(e,t,n){if("mono"==e)return 1;let o=(t+n)%2;return"inverted"!=e&&(o=1-o),o}(o.pattern,t,n),s=o.size;if(e.save(),e.translate(n*s,t*s),"classic"==o.bg){if(e.strokeStyle="black",e.lineWidth=s/60,e.fillStyle="#fff",e.fillRect(0,0,s,s),!r){e.beginPath();const t=s/7.5;for(let n=0;n<s;n+=t)e.moveTo(s-n,0),e.lineTo(0,s-n),n>0&&(e.moveTo(n,s),e.lineTo(s,n));e.stroke()}}else e.fillStyle=function(e,t){return"classic"==t?"none":"gray"==t?e?"#fff":"#bbb":"green"==t?e?"#EEEED2":"#769656":e?"#FFCE9E":"#D18B47"}(r,o.bg),e.fillRect(0,0,s,s);e.restore()}var eo,to={};function no(e,t,n,o){return oo(),(eo=new ro(e,t,n,o)).promise}function oo(e){eo&&eo.stop(e?to.callback:void 0)}var ro=class{constructor(e,t,n,o){var r;this.after=o?e:t,this.reverse=o,this.promise=new Promise((e=>this.resolve=e)),this.cursor=-1,this.stages=[];const s=n.split(","),a=Ft(e),{h:c,w:i}=to.options;for(const e of s){const t=[],n=e.match(/[`a-z]\d(=(\*\d)?[A-Z])?/g);for(let e=0;e<n.length;e+=2){let o=n[e],s=n[e+1];const l=Yt(o,i,c),u={p:a[l],promo:null==(r=s.match(/=(.+)$/))?void 0:r[1],from:Qt(o,c),to:Qt(s,c)};a[l]="",t.push(u)}this.stages.push({board:a.concat(),moves:t});for(const e of t)a[e.to.y*i+e.to.x]=e.promo||e.p}this.background=void 0,this.anime=this.step.bind(this),this.request=requestAnimationFrame(this.anime)}stop(e){cancelAnimationFrame(this.request),eo=void 0,e&&e(this.after),this.resolve()}step(e){const{ctx:t,options:n,callback:o}=to;this.startTime||(this.startTime=e);const r=(e-this.startTime)/150,s=Math.floor(r);if(s>=this.stages.length)return this.stop(o);const a=this.reverse?this.stages.length-1-s:s;s>this.cursor?(this.cursor=s,Vn(t,this.stages[a].board,n,kt),this.background=t.getImageData(0,0,t.canvas.width,t.canvas.height)):t.putImageData(this.background,0,0);const c=dt(n);t.save(),t.translate(c.offset.x,c.offset.y);const i=Fn(n,kt);let l=r-Math.floor(r);this.reverse&&(l=1-l);for(const e of this.stages[a].moves){const o=e.from.x*(1-l)+e.to.x*l;Jn(t,i,e.from.y*(1-l)+e.to.y*l,o,e.p,n,kt)}t.restore(),this.request=requestAnimationFrame(this.anime)}},so=new Array(64),ao=document.getElementById("Squares"),co={};function io(e){var t;null==(t=co.draw)||t.call(co,e)}function lo(){if(this.style.zIndex="10",Bn.collapse){const e=vo();e[so.indexOf(this)]="",io(e)}this.select()}function uo(){this.style.zIndex="unset",ho(this)?xo():Bn.collapse&&io(vo())}function po(){ho(this),Bn.collapse&&this.blur(),xo()}function fo(){if(!Bn.collapse){const e=vo();e[so.indexOf(this)]=Ht(this.value,Pn.board.SN),io(e)}}function ho(e,t){let n=Ht(e.value,Pn.board.SN,t);const o=n!==e.value;return e.value=n,o}function go(e,t){const n=e.value!==t;e.value=t,ho(e),n&&xo()}function mo(e,t){const n=yo(e);wt.value=n[0]+(Pn.board.fullFEN?So():""),ko(t)}function yo(e){const t=e.split(" ");if(t[1]&&t[1].match(/^[wb]$/)&&(In.play.turn=t[1]),t[2]&&t[2].match(/^(-|[kq]+)$/i))for(const e in In.play.castle)In.play.castle[e]=t[2].includes(e);return t[3]&&t[3].match(/^[a-h][36]$/)&&(In.play.enPassant=t[3]),t[4]&&t[4].match(/^\d+$/)&&(In.play.halfMove=Number(t[4])),t[5]&&t[5].match(/^\d+$/)&&(In.play.fullMove=Number(t[5])),t}function bo(){const e=new URL(location.href).searchParams.get("fen")||_t,t=wt.value.split(" ")[0],n=t==_t?"":"?fen="+encodeURIComponent(t);t!==e&&history.pushState(null,"",n||".")}function vo(){return so.map((e=>e.value))}function wo(){return vo().map((e=>qt(e,!1,!0)))}function xo(){io(Ao())}function Ao(){const{w:e,h:t,fullFEN:n}=Pn.board,o=vo();return wt.value=Ut(o,e,t)+(n?So():""),o}function Eo(){const e=function(){const{w:e,h:t}=Pn.board;if(8!=e||8!=t)return null;const n=wo();for(const e of n)if(""!=e&&!e.match(/^[kqbsnrp]$/i))return null;return Ut(n,8,8)}();return e?e+So(!0):null}function So(e){const t=In.play;t.enPassant.match(/^[a-h][36]$/)||(t.enPassant=""),e&&t.pass&&t.enPassant&&"3"==t.enPassant[1]!=("b"==t.turn)&&(t.turn="b"==t.turn?"w":"b");const n="retro"==t.mode;e&&((n||!Number.isSafeInteger(t.halfMove)||t.halfMove<0)&&(t.halfMove=0),(n||!Number.isSafeInteger(t.fullMove)||t.fullMove<1)&&(t.fullMove=1));const o=n?"-":function(e){const t=vo();let n="";const o=In.play.castle;e?("K"==t[60]&&(o.K&&"R"==t[63]&&(n+="K"),o.Q&&"R"==t[56]&&(n+="Q")),"k"==t[4]&&(o.k&&"r"==t[7]&&(n+="k"),o.q&&"r"==t[0]&&(n+="q"))):(o.K&&(n+="K"),o.Q&&(n+="Q"),o.k&&(n+="k"),o.q&&(n+="q"));return""==n?"-":n}(e),r=n?"-":t.enPassant||"-";return" ".concat(t.turn," ").concat(o," ").concat(r," ").concat(t.halfMove," ").concat(t.fullMove)}function ko(e){Ro(wt.value);const t=Wt(wt.value),{w:n,h:o}=t||Pn.board,r=Ft(wt.value,n,o);Lo({w:n,h:o});let s=!1;for(let e=0;e<n*o;e++)so[e].value=r[e],s=ho(so[e])||s;s||e||!t?xo():io(vo())}function Ro(e){const t=In.play,n=e.split(" ");if(1!=n.length){if("w"!=n[1]&&"b"!=n[1]||(t.turn=n[1]),n[2]){const e=["K","Q","k","q"];for(const o of e)t.castle[o]=n[2].includes(o)}t.enPassant=n[3]&&"-"!=n[3]?n[3]:"","retro"!=t.mode&&(t.halfMove=Number(n[4]||0),t.fullMove=Number(n[5]||1))}}function Co(e){for(const t of so)t.readOnly=e}function No(e){if(e.anime){const t=Ut(e,Pn.board.w,Pn.board.h);no(wt.value,t,e.anime)}else e.forEach(((e,t)=>so[t].value=e)),xo()}function Po(){Object.assign(In.play,{turn:"w",enPassant:"",halfMove:0,fullMove:1});const e=["K","Q","k","q"];for(const t of e)In.play.castle[t]=!0}to.options=Pn.board,to.callback=mo,addEventListener("popstate",(async function(){if(In.play.playing)return;const e=new URL(location.href).searchParams.get("fen");e&&mo(e,!0)})),window.FEN={update:()=>{yo(wt.value),ko(!0)},empty(){for(const e of so)e.value="";xo()},reset(){Lo({w:8,h:8}),Pn.board.fullFEN&&Po(),mo(It)},copy(){gtag("event","fen_copy"),navigator.clipboard.writeText(wt.value)},async paste(){gtag("event","fen_paste"),mo(await rr(),!0)},rotate(e){oo(!0);const{w:t,h:n}=Pn.board;t!==n&&Lo({w:n,h:t}),No(Xt(vo(),e,t,n))},color(e){for(const t of so){let n=t.value;n.startsWith("'")||""==n||(n.startsWith("-")&&(n=n.substr(1)),n=n.toLowerCase(),0==e&&(n="-"+n),1==e&&(n=n.toUpperCase()),t.value=n)}xo()},invert(e){No(en(vo(),e))},shift(e,t){oo(!0);const{w:n,h:o}=Pn.board;No(Vt(vo(),e,t,n,o))},mirror(e){oo(!0);const{w:t,h:n}=Pn.board;No(Jt(vo(),e,t,n))}};var Oo=document.getElementById("Zone"),Bo=document.getElementById("DragZone"),_o=document.getElementById("EditZone");function Io(){return document.body.clientWidth/(In.split?2:1)}async function Lo(e,t){const n=Pn.board,o={};for(const t in n)o[t]=void 0!==e[t]&&e[t]!==n[t],o[t]?n[t]=e[t]:e[t]=n[t];const{border:r,margin:s,w:a,h:c}=dt(e),i=$o(),l=Io()<(e.w+3)*e.size+s.x+4*r.size+4.2*i;o.mode=l!==Bn.hor,Bn.hor=l;const u=o.w||o.h;(u||t)&&function(){const{w:e,h:t}=Pn.board,n=e*t;ao.style.gridTemplateColumns="repeat(".concat(e,", 1fr)"),ao.style.gridTemplateRows="repeat(".concat(t,", 1fr)");for(let e=0;e<n||e<so.length;e++){if(!so[e]){const t=document.createElement("input");so[e]=t,t.type="text",t.oninput=fo,t.onchange=po,t.onfocus=lo,t.onblur=uo,t.classList.add("square"),ao.appendChild(t)}so[e].style.display=e<n?"block":"none"}}();const p=t||o.set||o.size,f=p||o.border,h=f||u,d=f||o.mode;if(d){let t=(3*e.size+2*r.size)*kt,n=(8*e.size+2*r.size)*kt;Bn.hor?([t,n]=[n+s.x*kt,t],gt.parentNode.classList.add("mb-3"),yt.classList.remove("ms-4")):(n+=s.y*kt,gt.parentNode.classList.remove("mb-3"),yt.classList.add("ms-4")),yt.width===t&&yt.height===n||(vt.width=yt.width=t,vt.height=yt.height=n)}if(h){const e=a*kt,t=c*kt;gt.width===e&&gt.height===t||(mt.width=bt.width=gt.width=e,mt.height=bt.height=gt.height=t),nr(mt.getContext("2d"))}Mo(),p&&await Wo(),h&&tr(),d&&Jo(),ve(Mo)}function To(e){const{w:t,h:n}=Pn.board,o=vo();Lo(e),function(e,t,n){const{w:o,h:r}=Pn.board;for(let s=0;s<r;s++)for(let r=0;r<o;r++){so[s*o+r].value=s<n&&r<t?e[s*t+r]:""}xo()}(o,t,n)}function Mo(){Oo.style.maxWidth="calc(".concat(Io(),"px + 1rem)"),gt.style.width=gt.width/kt+"px",yt.style.width=yt.width/kt+"px";const{w:e}=Pn.board,t=Ln(void 0,void 0,8);if(Bn.hor)if(e>8)yt.style.width=t.width+"px";else if(e<8){const{width:t}=Ln(yt,!0,e);gt.style.width=t+"px"}ao.style.borderWidth="".concat(t.offset.y,"px ").concat(t.offset.r,"px ").concat(t.offset.b,"px ").concat(t.offset.x,"px");const n=$o();Pn.board.collapse?(Oo.style.width="120%",Oo.style.width=Bo.clientWidth+4*n+"px"):Oo.style.width="unset",bt.style.width=gt.clientWidth+"px",bt.style.height=gt.clientHeight+"px",vt.style.width=yt.clientWidth+"px",vt.style.height=yt.clientHeight+"px",function(e){ao.style.width=CN.clientWidth+"px",ao.style.height=CN.clientHeight+"px";for(const t of so)t.style.fontSize=e-10+"px",t.style.lineHeight=e-10+"px"}(t.s),Oo.clientWidth<Bo.clientWidth+gt.clientWidth+6*n?(_o.style.marginTop=-Bo.clientHeight+"px",_o.style.width=Bo.clientWidth+"px",_o.style.textAlign=Bn.hor?"center":"start",Oo.classList.add("collapse"),Bn.collapse=!0):(_o.style.marginTop="0",_o.style.width="unset",_o.style.textAlign="unset",Oo.classList.remove("collapse"),Bn.collapse=!1)}function $o(){return parseFloat(getComputedStyle(document.documentElement).fontSize)}if(Ct.isTop)window.resizeIframe=function(){const e=document.getElementsByTagName("iframe")[0];e&&(e.style.minHeight=e.contentDocument.body.scrollHeight+"px")};else{if("undefined"!=typeof ResizeObserver){new ResizeObserver((e=>parent.resizeIframe())).observe(document.body)}else{new MutationObserver((e=>parent.resizeIframe())).observe(document.body,{childList:!0})}parent.resizeIframe()}window.Layout={setOption:Lo,setDimension:To,setBorder(e){const t=function(e){return"string"!=typeof e?null:(e=e.replace(/\D/g,",").replace(/,+/g,",").replace(/^,/,"").replace(/,$/,"")).match(ft)?e:null}(e.value);t?(e.value=t,Lo({border:t})):e.value=Pn.board.border},setHeight(e){if("number"==typeof e)To({h:Pn.board.h+e});else{const t=Math.floor(Number(e.value));isNaN(t)||t<=0?e.value=Pn.board.h:To({h:t})}},setWidth(e){if("number"==typeof e)To({w:Pn.board.w+e});else{const t=Math.floor(Number(e.value));isNaN(t)||t<=0?e.value=Pn.board.w:To({w:t})}}};var jo="k,K,-k,q,Q,-q,b,B,-b,n,N,-n,r,R,-r,p,P,-p,c,C,-c,x,X,-x".split(","),Do="k,q,b,n,r,p,c,x,K,Q,B,N,R,P,C,X,-k,-q,-b,-n,-r,-p,-c,-x".split(",");function zo(){return Pn.board.exHigh?2:1}async function Wo(){Bn.loading=!0;const e=[Un("assets",Pn.board,kt)],t=zo();kt!=t&&e.push(Un("assets",Pn.board,t)),await Promise.all(e),Bn.loading=!1}var Fo,Uo,Ho,Ko=gt.getContext("2d"),qo=bt.getContext("2d"),Go=yt.getContext("2d"),Qo=vt.getContext("2d"),Yo=document.createElement("canvas"),Zo=Yo.getContext("2d"),Vo={except:void 0,data:void 0};function Jo(e){e?Vo.except=e:e=Vo.except;const t=Object.assign({},Pn.board,Bn.hor?{w:8,h:3}:{w:3,h:8}),n=function(){let e=Bn.hor?Do:jo;In.play.playing&&"retro"==In.play.mode&&(e=e.concat(),Bn.hor?(e[6]="p",e[14]="P"):(e[18]="p",e[19]="P"));return e}();if(Vn(Go,n,t,kt,!1,Bn.hor),Tn()){const{size:t}=Pn.board,n="retro"==In.play.mode;Go.save();const{offset:o}=dt(Pn.board,Bn.hor);Go.translate(o.x,o.y),n&&(Go.save(),Go.font="".concat(t/2,"px sans-serif"),Go.strokeStyle="black",Go.lineWidth=t/12,Go.fillStyle="white",Go.lineJoin="round",Xo(1,7),Xo(2,7),Go.restore()),Go.save(),Go.globalAlpha=Bn.isDark?.5:.4,Go.fillStyle="black";for(let n=0;n<3;n++)for(let o=0;o<8;o++){if(null==e?void 0:e.includes(3*o+n))continue;const[r,s]=Bn.hor?[o,n]:[n,o];Go.fillRect(r*t,s*t,t,t)}if(Go.restore(),n){Go.save();const n=In.play.retro,o=3==e[0]?0:1;Go.lineWidth=t/12,Go.strokeStyle="#0d6efd",n.uncapture&&er(o,Kn.indexOf(n.uncapture)),n.unpromote&&er(1-o,5),Go.restore()}Go.restore()}else Vn(Qo,n,t,kt,!0,Bn.hor)}function Xo(e,t){const{size:n}=Pn.board,o=n/15;Bn.hor&&([e,t]=[t,e]);const r=Go.measureText("ep"),s=r.width,a=r.actualBoundingBoxDescent;Go.strokeText("ep",e*n-s-o,t*n-a-o),Go.fillText("ep",e*n-s-o,t*n-a-o)}function er(e,t){const{size:n}=Pn.board,o=n/8;Bn.hor&&([e,t]=[t,e]);const r=.5,s=(...s)=>{Go.moveTo(e*n+o*(s[0][0]+r),t*n+o*(s[0][1]+r));for(let a=1;a<s.length;a++)Go.lineTo(e*n+o*(s[a][0]+r),t*n+o*(s[a][1]+r))};Go.beginPath(),s([0,2],[0,0],[2,0]),s([5,0],[7,0],[7,2]),s([7,5],[7,7],[5,7]),s([0,5],[0,7],[2,7]),Go.stroke()}async function tr(e){e?Vo.data=e:e=Vo.data||vo();const t=Pn.board;if(Vn(Ko,e,t,kt),Vn(Zo,e,t,zo()),function(e){let t=0,n=0,o=0,r=0;for(const s of e)""!=s&&(s.startsWith("'")?r++:s.startsWith("-")?o++:s==s.toUpperCase()?t++:n++);Bn.pieceCount="(".concat(t,"+").concat(n).concat(o>0?"+"+o:"").concat(r>0?"+"+r:"",")")}(e),Bn.dragging||(Vn(qo,e,t,kt,!0),bo()),location.protocol.startsWith("http")){const e=document.getElementById("Save");e.href&&URL.revokeObjectURL(e.href),At.src=e.href=URL.createObjectURL(await or())}}function nr(e){const{w:t,h:n}=Pn.board;Vn(e,Zt(t*n),Pn.board,kt)}function or(){return new Promise((e=>Yo.toBlob(e)))}async function rr(){if(Ct.canPaste)return await navigator.clipboard.readText();throw alert('Pasting text is not enabled in your browser.\nIf you\'re using Firefox on desktops or Firefox Nightly on Android, this can be enabled by the following.\n1. Visit "about:config" in your address bar.\n2. Search for "dom.events.asyncClipboard.readText".\n3. Toggle its value to true.\n4. Reload this tool.'),!0}if(to.ctx=Ko,addEventListener("storage",(e=>{if(e.storageArea==localStorage&&"settings"==e.key){const e=JSON.parse(localStorage.getItem("settings"));Nt(Pn,e,!0),Lo({},!0)}})),In.play.playing){const e=In.play;e.playing=!1,Promise.all([Wo(),br()]).then((()=>{e.playing=!0,_r.goto(e.history[e.moveNumber])}))}var sr="normal",ar="pass",cr="retro",ir=[4,7,10,13],lr=[3,6,9,12],ur=lr.concat(15,16,18),pr=ir.concat(15,16,19);function fr(e){const t=In.play;let n=t.moveNumber;n+=e,n<-1&&(n=-1),n>t.history.length-1&&(n=t.history.length-1),n!=t.moveNumber&&hr(n)}function hr(e){const t=In.play,n=t.moveNumber,o=e>=0||0==n;if(_r.goto(t.history[e],o),o){const o=e==n-1,r=t.history[o?n:e];let s=r.from+r.to;"k"!=r.flags&&"q"!=r.flags||(s+=","+gr(r)),no(r.before,r.after,s,o!=(In.play.mode==cr))}}function dr(e,t,n){if(e=Gt(e),t=Gt(t),In.play.mode==cr){const n=Uo.retract({from:e,to:t,...In.play.retro});return n&&(wr(),xr()),n}{const o=Uo.move({from:e,to:t,promotion:n});return!!o&&("k"!=o.flags&&"q"!=o.flags||function(e){const t=Ft(e.before),n="w"==e.color;return t[Yt(e.from)]="",t[Yt(e.to)]=n?"K":"k",{before:Ut(t),after:e.after,move:gr(e)}}(o))}}function gr(e){const t="w"==e.color,n="k"==e.flags,o=t?1:8;return(n?"h":"a")+o+(n?"f":"d")+o}function mr(){mo(Uo.fen())}function yr(e){return Uo.get(Gt(e)).color}async function br(){Fo||((Fo=await import("./modules/chess.js")).store.state=In.play,Fo.store.options=Pn.PLAY,Uo=new Fo.Chess)}function vr(){Object.assign(In.play,{playing:!0,pendingPromotion:!1}),Co(!0),In.play.mode==cr?(wr(),xr()):Jo([])}function wr(){In.play.retro={uncapture:null,unpromote:!1,ep:!1}}function xr(){Jo("b"==Uo.turn()?ur:pr)}function Ar(e,t){if(2==e)return;const n=In.play.retro;var o;0==e==("b"==Uo.turn())?(0<t&&t<7&&(o=Kn[t],n.uncapture=n.uncapture==o?null:o),5!=t&&6!=t||(n.unpromote=!1)):5==t&&(n.unpromote=!n.unpromote,"p"!=n.uncapture&&"c"!=n.uncapture||(n.uncapture=null)),xr()}var Er,Sr,kr,Rr,Cr,Nr,Pr,Or,Br,_r={async start(){gtag("event","fen_play_"+In.play.mode);const e=Eo();if(e)try{await br(),Uo.init(e),In.play.over=Uo.overState(),vr()}catch(e){alert("This board is not playable: "+e.message.replace(/^.+:/,"").trim().replace(/[^.]$/,"$&."))}else alert("Only orthodox chess is supported.")},exit(){In.play.playing=!1,In.play.game="",Ro(Uo.fen()),Co(!1),Jo([])},goto(e,t){const n=Uo.goto(e);t||(oo(),mo(n)),In.play.mode==cr&&(wr(),xr())},move(e){e!=In.play.moveNumber&&hr(e)},moveBy(e){fr(e)},reset(){Po()},copyGame:()=>Uo.copyGame(),copyPGN:()=>Uo.copyPGN(),number:e=>Fo.number(e),format:e=>Fo.format(e),async pasteMoves(){const e=await rr();Uo.addMoves(Fo.parseMoves(e)),mr()},async pasteGame(){const e=await rr();await br(),Uo.loadGame(e)&&(mr(),vr())}},Ir=0;function Lr(e){Ur(e),"pending"==Bn.dragging&&function(e){const t=e.offsetX-Er,n=e.offsetY-Sr;return Math.sqrt(t*t+n*n)}(e)>5&&(Pr?(Br=Ct.isTouch?[]:null,Wr(e,!0)):Bn.dragging=!1),!0===Bn.dragging&&(Br&&Br.push({x:e.clientX,y:e.clientY}),Fr(e))}function Tr(e){if(In.popeye.playing)return;if("pending"==Bn.dragging&&!In.play.playing){const t=performance.now();t-Ir<300&&Cr.focus(),Ir=t,e.preventDefault(),Bn.dragging=!1}if(!Bn.dragging)return;if(Bn.dragging=!1,!Pr)return;Ur(e);const{w:t,h:n}=Pn.board,{s:o,offset:r}=Ln(),s=gt.getBoundingClientRect(),a=Math.floor((e.clientY-s.top-r.y)/o),c=Math.floor((e.clientX-s.left-r.x)/o),i=a*t+c;Nr.style.display="none";const l=a>-1&&a<n&&c>-1&&c<t;if(In.play.playing){let e;if(l){if(function(e,t){const n=In.play.mode;return n!=cr&&(n==ar&&yr(e)!=Uo.turn()&&Uo.switchSide(),!!Uo.checkPromotion(Gt(e),Gt(t))&&(Ho=t,In.play.pendingPromotion=!0,Jo("b"==Uo.turn()?lr:ir),!0))}(Or,i))return go(so[i],Pr);Or!=i&&(e=dr(Or,i))}"object"==typeof e?no(Ko,e.before,e.after,mo,e.move):mr()}else if(l){if(go(so[i],Pr),Br&&Br.length>10){const e=function(e){let t=0,n=0;for(const o of e)t+=o.x,n+=o.y;return t/=e.length,n/=e.length,{x:t,y:n}}(Br),t=function(e,t){let n=0;for(let o=0,r=t.length-1;o<t.length;r=o++){const s=t[o],a=t[r];a.y<=e.y?s.y>e.y&&Mr(a,s,e)>0&&n++:s.y<=e.y&&Mr(a,s,e)<0&&n--}return n}(e,Br);Dr(Cr,t>0?1:3)}}else bo()}function Mr(e,t,n){return(t.x-e.x)*(n.y-e.y)-(n.x-e.x)*(t.y-e.y)}var $r=performance.now();function jr(e){if(Tn())return;const{w:t,h:n}=Pn.board,{offset:o,s:r}=Ln(),s=Math.floor((e.offsetX-o.x)/r),a=Math.floor((e.offsetY-o.y)/r);if(a>-1&&a<n&&s>-1&&s<t){const n=so[a*t+s];if(""==n.value)return;e.preventDefault();const o=performance.now();if(o-$r<50)return;$r=o,Dr(n,e.deltaY>0?1:3)}}function Dr(e,t){e.value=e.value.replace(/(^-?)(?:\*(\d))?([^-].*$)/,((e,n,o,r)=>{const s=(Number(o||0)+t)%4;return n+(s?"*"+s:"")+r})),xo()}function zr(e){if(In.popeye.playing)return;if(Bn.loading||0!=e.button&&!e.targetTouches||e.targetTouches&&e.targetTouches.length>1)return;Ur(e),document.activeElement&&document.activeElement.blur();const t=this!=yt,{offset:n,s:o}=t?Ln():Ln(yt,Bn.hor),{w:r}=Pn.board;Er=e.offsetX,Sr=e.offsetY;const[s,a]=[n.x,n.y];kr=Math.floor((Er-s)/o);const c=(Rr=Math.floor((Sr-a)/o))*(t?r:3)+kr;if(Nr=t?bt:vt,In.play.playing){if(!t&&In.play.pendingPromotion){Bn.hor&&([kr,Rr]=[Rr,kr]);Rr>0&&Rr<5&&kr==("p"==Pr?0:1)&&(i=Or,l=Kn[Rr],dr(i,Ho,l)?(Ho>>>3==0&&(l=l.toUpperCase()),go(so[Ho],l)):mr(),In.play.pendingPromotion=!1,Jo([]))}if(t||"retro"!=In.play.mode||(e.preventDefault(),Bn.hor&&([kr,Rr]=[Rr,kr]),Ar(kr,Rr)),!t||!function(e){const t=In.play.mode;if(In.play.pendingPromotion)return!1;if(t!=cr&&Uo.isGameOver())return!1;const n=yr(e)==Uo.turn();return t==ar||n==(t==sr)}(c))return}var i,l;t&&(Or=c,Cr=so[c],Bn.dragging="pending",Pr=void 0),t&&""==Cr.value||(e.preventDefault(),Nr.style.clip="rect(".concat(Rr*o+a+1,"px,").concat((kr+1)*o+s-1,"px,").concat((Rr+1)*o+a-1,"px,").concat(kr*o+s+1,"px)"),t?Pr=Cr.value:(Pr=Bn.hor?jo[3*kr+Rr]:jo[c],Wr(e)))}function Wr(e,t){Nr.style.display="block",t&&(Cr.value="",xo()),Bn.dragging=!0,Fr(e)}function Fr(e){const{offset:t,s:n}=Ln(),{w:o,h:r,coordinates:s}=Pn.board,a=gt.getBoundingClientRect(),c=Nr==vt&&s&&!Bn.hor?a.left+ht:a.left,i=Math.floor((e.clientY-a.top-t.y)/n),l=Math.floor((e.clientX-a.left-t.x)/n);l===kr&&i===Rr||(Br=null);const{scrollLeft:u,scrollTop:p}=document.documentElement;i>-1&&i<r&&l>-1&&l<o?(Nr.style.left=c+(l-kr)*n+u+"px",Nr.style.top=a.top+(i-Rr)*n+p+"px"):(Nr.style.left=e.clientX+u+1-Er+"px",Nr.style.top=e.clientY+p-Sr+"px")}function Ur(e){if(e.targetTouches){const t=e.target.getBoundingClientRect(),n=e.targetTouches[0]||e.changedTouches[0];e.clientX=n.clientX,e.clientY=n.clientY,e.offsetX=e.clientX-t.x,e.offsetY=e.clientY-t.y}}var Hr={copyFEN(){gtag("event","fen_yacpdb_copyFEN");const{w:e,h:t}=Pn.board;return Ut(so.map((e=>Kt(e.value))),e,t)},async fetch(e){try{gtag("event","fen_yacpdb_get"),e.disabled=!0,e.value="Fetching...";const t="https://yacpdb.org/gateway/ql?q="+encodeURIComponent("Id('".concat(xt.value,"')")),n=await fetch("https://corsproxy.io/?"+encodeURIComponent(t)),o=await n.json();if(o.success){let e=function(e){const o=e.charCodeAt(1)-97,r=Number(e[2]);s[(n-r)*t+o]=e[0]};const{w:t,h:n}=Pn.board,r=o.result.entries[0].algebraic,s=Zt(t*n);for(const t of r.black)e(t.toLowerCase());for(const t of r.white)e(t);mo(Ut(s),t)}}catch{alert("An error has occurred. Please try again later.")}finally{e.disabled=!1,e.value="Get FEN"}},search(){gtag("event","fen_yacpdb_search"),window.open("https://yacpdb.org/#q/"+encodeURIComponent(Kr())+"/1")},copyQuery:()=>(gtag("event","fen_yacpdb_copy"),Kr()),copyEdit:()=>(gtag("event","fen_yacpdb_copyEdit"),function(){const e={w:[],b:[],n:[]},{w:t,h:n}=Pn.board;for(let o=0;o<n;o++)for(let n=0;n<t;n++){const r=so[o*t+n].value,s=r.match(/^(-?)([kqbsnrp])$/i);if(!s)continue;const a=qt(s[2],!1,!0).toUpperCase();e[s[1]?"n":r==r.toLowerCase()?"b":"w"].push(a+Gt(o,n))}let o=[];e.w.length&&o.push("    white: [".concat(e.w.join(", "),"]"));e.b.length&&o.push("    black: [".concat(e.b.join(", "),"]"));e.n.length&&o.push("    neutral: [".concat(e.n.join(", "),"]"));return o.join("\n")}())};function Kr(){let e=[];const{w:t,h:n}=Pn.board;for(let o=0;o<n;o++)for(let n=0;n<t;n++){let r=Kt(so[o*t+n].value).replace("(","").replace(")","");r&&(r.match(/\d/)||(r=r.startsWith("!")?"n"+r.toUpperCase():(r==r.toLowerCase()?"b":"w")+r.toUpperCase(),e.push(r+Gt(o,n))))}let o='MatrixExtended("'.concat(e.join(" "),'", false, false, "None")');return Pn.DB.exact&&(o+=" AND PCount(*) = "+e.length),o}var qr={async fetch(e){try{gtag("event","fen_pdb_get"),e.disabled=!0,e.value="Fetching...";const t=Gr+encodeURIComponent("PROBID='".concat(xt.value,"'")),n=await fetch("https://corsproxy.io/?"+encodeURIComponent(t));mo((await n.text()).match(/<b>FEN:<\/b> (.+)/)[1],!0)}catch{alert("An error has occurred. Please try again later.")}finally{e.disabled=!1,e.value="Get FEN"}},search(){gtag("event","fen_pdb_search"),window.open(Gr+encodeURIComponent(Zr()))},copyQuery:()=>(gtag("event","fen_pdb_copy"),Zr()),copyEdit:()=>(gtag("event","fen_pdb_copyEdit"),function(){const e={},{w:t,h:n}=Pn.board;for(let o=0;o<n;o++)for(let n=0;n<t;n++){const r=so[o*t+n].value,s=r.match(/^(-?)(?:\*(\d))?([kqbsnrpxc])$/i);if(!s)continue;let a;if("x"==s[3])a="sY";else{const e=Qr[Kn.indexOf(s[3].toLowerCase().replace("s","n"))];a=(s[1]?"n":r==r.toLowerCase()?"s":"w")+e+Yr[Number(s[2]||0)]}e[a]=(e[a]||"")+Gt(o,n)}const o=[];for(const t in e)o.push(t+e[t]);return o.join(" ")}())},Gr="https://pdb.dieschwalbe.de/search.jsp?expression=",Qr=["K","D","L","S","T","B","I"],Yr=["","R","U","L"];function Zr(){let e=[];const{w:t,h:n}=Pn.board;for(let o=0;o<n;o++)for(let n=0;n<t;n++){const r=so[o*t+n].value;if(!r.match(/^[kqbsnrp]$/i))continue;const s=Qr[Kn.indexOf(r.toLowerCase().replace("s","n"))],a=r==r.toLowerCase()?"s":"w";e.push(a+s+Gt(o,n))}let o="POSITION='".concat(e.join(" "),"'");return Pn.DB.exact&&(o+=" AND APIECES=".concat(e.length)),o}function Vr(e){return new URL(e,location.href).toString()}function Jr(){const{SN:e,w:t,h:n}=Pn.board;return e?Ut(wo(),t,n):wt.value}function Xr(){const e=Pn.board,t=Jr();let n=Vr("gen/?fen="+t);return 44!=e.size&&(n+="&size="+e.size),"1echecs"!=e.set&&(n+="&set="+e.set),e.pattern&&(n+="&pattern="+e.pattern),e.bg&&(n+="&bg="+e.bg),"1"!=e.border&&(n+="&border="+e.border),e.blackWhite&&(n+="&blackWhite&knightOffset="+e.knightOffset),Wt(t)||(n+="&w=".concat(e.w,"&h=").concat(e.h)),n}var es,ts,ns={copyJanko:()=>(gtag("event","fen_copy_janko"),"https://www.janko.at/Retros/d.php?ff="+Jr()),copyBase64:()=>(gtag("event","fen_link_copy64"),Yo.toDataURL()),copyBase64Img:()=>(gtag("event","fen_link_copy64img"),'<img fen="'.concat(Yo.toDataURL(),'">')),async copyUrl(){gtag("event","fen_gen_link");const e=new URLSearchParams;e.append("key","6d207e02198a847aa98d0a2a901485a5"),e.append("action","upload"),e.append("source",Yo.toDataURL().replace(/^.+base64,/,"")),e.append("format","txt");try{const t=await fetch("https://corsproxy.io/?https://freeimage.host/api/1/upload",{method:"post",body:e});return await t.text()}catch(e){throw alert("Internet connection failed. Please try again later."),e}},copyEmbed(){gtag("event","fen_copy_embed");const e=Pn.board;let t=Xr();const{w:n,h:o}=dt(e);return'<iframe src="'.concat(t,'" style="border:none;width:').concat(n,"px;height:").concat(o,'px"></iframe>')},copyEmbedUrl:()=>(gtag("event","fen_copy_embedUrl"),Xr()),copyImg:()=>(gtag("event","fen_copy_sdkImg"),'<img fen="'.concat(Jr(),'">')),copySDK(){gtag("event","fen_copy_sdk");const e=Pn.board;let t="";return 44!=e.size&&(t+=' data-size="'.concat(e.size,'"')),"1echecs"!=e.set&&(t+=' data-set="'.concat(e.set,'"')),e.bg&&(t+=' data-bg="'.concat(e.bg,'"')),"1"!=e.border&&(t+=' data-border="'.concat(e.border,'"')),e.blackWhite&&(t+=' data-black-white="true" data-knight-offset="'.concat(e.knightOffset,'"')),'<script src="'.concat(Vr("sdk.js"),'"').concat(t,"><\/script>")}},os={async copy(){if(8!=Pn.board.w||8!=Pn.board.h)throw alert("åªæ”¯æ´æ¨™æº–æ£‹ç›¤"),!0;gtag("event","fen_bbs_copy");return(await import("./modules/ptt.js")).generate(wo(),Jr(),xt.value,Pn.BBS,Pn.board,Ct.isTouch)}},rs=new RegExp(String.raw(es||(es=o(["^+(?<c>[nwb])(?<is>",")(?<at>",")(=(?<p>","))?$"],["^\\+(?<c>[nwb])(?<is>",")(?<at>",")(=(?<p>","))?$"])),un,ln,un)),ss=new RegExp(String.raw(ts||(ts=o(["^-([nwb]",")?(?<at>",")$"])),un,ln)),as=new RegExp("^(?<c>[nwb])".concat(un,"(?<from>").concat(ln,")-&gt;(?<to>").concat(ln,")(=(?<p>").concat(un,"))?$")),cs=new RegExp("^".concat(un,"(?<from>").concat(ln,")&lt;-&gt;").concat(un,"(?<to>").concat(ln,")$")),is=new RegExp("^(?<at>".concat(ln,")=(?<c>[nwb])?(?:r?(?<p>").concat(un,"))?$")),ls=new RegExp("^I".concat(ln,"(,").concat(ln,")*$"));function us(e,t,n){var o,r,s,a,c;let i=null==(o=t.match(rs))?void 0:o.groups;if(i)return wn(e,i.at,i.p||i.is,i.c);if(i=null==(r=t.match(ss))?void 0:r.groups,i)return wn(e,i.at,"");if(i=null==(s=t.match(as))?void 0:s.groups,i)return xn(e,i.from,i.to),void(i.p&&wn(e,i.to,i.p,i.c));if(i=null==(a=t.match(cs))?void 0:a.groups,i)return function(e,t,n){t=Yt(t),n=Yt(n);const o=e[n];e[n]=e[t],e[t]=o}(e,i.from,i.to);if(i=null==(c=t.match(is))?void 0:c.groups,i)return wn(e,i.at,i.p||function(e,t){const n=e[Yt(t)];return n.match(new RegExp(un,"i"))[0].toUpperCase()}(e,i.at),i.c||function(e,t){const n=e[Yt(t)];return un.startsWith("-")?"n":n==n.toLowerCase()?"b":"w"}(e,i.at));if(i=t.match(ls),i){n.push(...t.match(new RegExp(ln,"g")));for(const t of n)wn(e,t,"I","n")}else;}var ps=new RegExp(yn),fs=new RegExp(vn);function hs(e,t,n,o,r){let s,a;if(n.move.startsWith("0-0")){const o="w"==t?"1":"8",c="0-0"==n.move?["g","h","f"]:["c","a","d"];xn(e,"e"+o,c[0]+o,r),a=xn(e,c[1]+o,s=c[2]+o,r)}else a=xn(e,n.from,s=n.to,r),n.ep&&wn(e,n.to.replace("3","4").replace("6","5"),""),n.then&&xn(e,n.to,s=n.then,r);"I"==n.p?(o.push(s),wn(e,s,"I","n")):n.p&&wn(e,s,a=n.p,n.pc?n.pc:t),n.cc&&wn(e,s,a,n.cc)}var ds=new RegExp("^[nwb]".concat(un,"(").concat(ln,")--&gt;(").concat(ln,")$")),gs=new RegExp("^[nwb]".concat(un,"(").concat(ln,")&lt;--&gt;[nwb]").concat(un,"(").concat(ln,")$")),ms=new RegExp("^([+-]?)([nwb])(".concat(un,")(").concat(ln,")$")),ys=new RegExp("^(".concat(un,")==&gt;(").concat(un,")$")),bs=new RegExp("^mirror(".concat(ln,")&lt;--&gt;(").concat(ln,")$")),vs=new RegExp("^shift(".concat(ln,")==&gt;(").concat(ln,")$")),ws=/^rotate(90|180|270)$/;function xs(e,t){let n=t.match(ds);if(n)return xn(e,n[1],n[2]);if(n=t.match(gs),n)return exchange(e,n[1],n[2]);if(n=t.match(ms),n)"+"==n[1]||""==n[1]?wn(e,n[4],n[3],n[2]):wn(e,n[4],"");else{if(n=t.match(bs),n){let t;const o=Qt(n[1]),r=Qt(n[2]);return t=o.x==r.x?"|":o.y==r.y?"-":(o.x-r.x)*(o.y-r.y)>0?"\\":"/",void As(e,Jt(e,t))}if(n=t.match(vs),!n){if(n=t.match(ys),n){const t=kn(n[1]),o=t.toLowerCase(),r=kn(n[2]),s=r.toLowerCase();for(let n=0;n<e.length;n++)e[n]==t&&(e[n]=r),e[n]==o&&(e[n]=s),e[n]=="-"+o&&(e[n]="-"+s)}return n=t.match(ws),n?As(e,Xt(e,"90"==n[1]?-1:"180"==n[1]?2:1)):"PolishType"==t?As(e,en(e)):void 0}{const t=Qt(n[1]),o=Qt(n[2]);As(e,Vt(e,o.x-t.x,o.y-t.y))}}}function As(e,t){e.length=0,e.push(...t)}var Es,Ss,ks=new RegExp(fn),Rs=new RegExp(String.raw(Es||(Es=o(["\n\n+|(?:",")|(?:",")"],["\\n\\n+|(?:",")|(?:",")"])),fn,vn),"g");function Cs(e,t,n){return function(e,t,n,o){var r;if(!t)return n;console.log(n);const s=function(e){var t;const n=e.replace(/\n/g," ").replace(mn,"\n$&").split("\n"),o=n.filter((e=>e.match(tn("2option","^")))).join(" "),r=n.filter((e=>e.match(nn("condition")))).join(" ");return{imitators:null==(t=r.match(_s))?void 0:t.join(" ").match(new RegExp(ln,"g")),duplex:Is.test(o),halfDuplex:Ls.test(o)}}(e);let a=0;const c=function(e){return e.split(tn("2twin","\\b","\\b")).map((e=>{var t;return null==(t=e.match(Ps))?void 0:t[1].replace(/\s/g,"")}))}(e),i={pg:/dia/i.test(c[0]),fen:Bs(js(t),s.imitators),imitators:s.imitators,ordering:Os(c[0],s.halfDuplex)};let l=i;const u={stack:[],board:Ft(l.pg?It:l.fen),ordering:l.ordering,imitators:null==(r=l.imitators)?void 0:r.concat()};let p=!1;n=n.replace(/<br>/g,"\n");const f=s.duplex?function(e){const t=/^\n\n+ +1\./,n=e.replace(/\n\nsolution finished./,"\n  1.").match(/\n\n+[^\n]+/g).filter(((e,n,o)=>n>0&&e.match(t)&&o[n-1].match(t))).map((e=>e.match(/^\n+/)[0].length));return"\n".repeat(Math.max(...n))}(n):"";let h=!1;return n=n.replace(Rs,(e=>{if(p)return e;try{if(e.match(/^\n+$/)){u.stack.length=0;const t=l.pg?It:l.fen;return u.board=Ft(t),e==f&&h&&(u.ordering=Ts(u.ordering)),e}const t=e.match(ks);if(t){h=!1,l=Bt(t[1]?l:i);const n=c[++a];n&&(l.ordering=Os(n,s.halfDuplex),l.pg=/dia/i.test(n)),u.ordering=l.ordering,u.stack.length=0;const{fen:o,board:r}=function(e,t){const n=Ft(e),o=t.replace(/(mirror|shift|rotate) /g,"$1").replace(/ ==&gt; /g,"==&gt;").split(" ");for(const e of o)xs(n,e);return{fen:Ut(n),board:n}}(l.fen,t[2]);return l.fen=o,u.board=l.pg?Ft(It):r,e}return h=!0,function(e,t,n,o){var r;const{stack:s,ordering:a}=n,c=e.match(fs),i=c.groups.count,l=t.pg?It:t.fen;let u=null;if(i){const e=s.findIndex((e=>e.move==i||parseInt(e.move)>parseInt(i)));e>=0&&(u=e>0?s[e-1].fen:l,n.board=Ft(u),n.imitators&&(n.imitators=(e>0?s[e-1].imitators:t.imitators).concat()),s.length=e)}const p=a[!i||i.endsWith("...")?1:0],{imitators:f,board:h}=n,d=null==f?void 0:f.concat();if(f){for(const e of f)wn(h,e,"");f.length=0}const g=[],m=c.groups.main.split("/");for(let e of m){const t=e.match(ps);hs(h,p,t.groups,f,g);const n=null==(r=e.match(/\[[^\[\]]+(?=\])/g))?void 0:r.map((e=>e.substring(1)));n&&n.forEach((e=>us(h,e,f)))}const y=Ut(h);if(i&&s.push({move:i,color:p,fen:y,imitators:null==f?void 0:f.concat()}),d)for(let e=0;e<g.length;e++){const[t,n]=g[e].match(/[a-z]\d/g).map((e=>Qt(e))),o=n.x-t.x,r=n.y-t.y;for(const t of d){const n=Qt(t);g[e]+=t+Gt(n.y+r,n.x+o)}}return(1==s.length&&i?o("*",l)+" ":"")+o(e,y,g,u)}(e,l,u,o)}catch(t){return console.log(t,e),p=!0,e}})),n.replace(/   ?<span init/g,"<span").replace(/\n/g,"<br>")}(e,t,n,Ms)}var Ns,Ps=new RegExp(String.raw(Ss||(Ss=o(["","s+(S*(?:d|[^ds]s+d+(?:.[05])?))"],["","\\s+(\\S*(?:\\d|[^\\d\\s]\\s+\\d+(?:\\.[05])?))"])),nn("3stipulation")),"i");function Os(e,t){if(!e)return"wb";const n=e.match(/^(\d+-&gt;)?(?:exact-)?(?:(?:ser|pser|phser|semi|reci)-)?(hs|hr|h|s|r)?/i);let o;return o=!n||n[1]?"wb":"h"==n[2]?"bw":"wb",t?Ts(o):o}function Bs(e,t){if(!t)return e;const n=Ft(e);for(const e of t)n[Yt(e)]="-"+kn("i");return Ut(n)}var _s=new RegExp(String.raw(Ns||(Ns=o(["\bimitw*s+(?:",")+"],["\\bimit\\w*\\s+(?:",")+"])),ln),"ig"),Is=tn("3duplex"),Ls=tn("3halfDuplex");function Ts(e){return"wb"==e?"bw":"wb"}function Ms(e,t,n,o){const r="*"==e?"init ":"";t=t.replace(/-/g,"&#45;").replace(/"/g,"&#34;");let s="";return n&&n.length&&(s+=' data-anime="'.concat(n.join(","),'"')),o&&(s+=' data-before="'.concat(o,'"')),"<span ".concat(r,'class="step btn btn-secondary px-1 py-0" data-fen="').concat(t,'"').concat(s,">").concat(e,"</span>")}var $s=/[-+=]?(\.[0-9A-Z][0-9A-Z]|[A-Z])|\d+|\//gi;function js(e){return e.match($s).map((e=>{if("/"==e||e.match(/^\d+$/))return e;const t=e.match(/^[-+=]/)?e[0]:null;return t&&(e=e.substring(1)),e.startsWith(".")&&(e=e.substring(1)),e=kn(e),"+"==t&&(e=e.toUpperCase()),"-"==t&&(e=e.toLowerCase()),"="==t&&(e="-"+e.toLowerCase()),e})).join("")}var Ds,zs,Ws,Fs=["1Black","1Neutral","1White"].map(nn).join("|"),Us=["1Chameleon","2FrischAuf","2Functionary","2HalfNeutral","2HurdleColourChanging","1Jigger","1Kamikaze","1Magic","2Paralysing","2Protean","1Royal","1Uncapturable","1Volage"].map(nn).join("|"),Hs="(?<p>".concat(un,")(?<sq>(?:").concat(ln,")+)"),Ks=String.raw(Ds||(Ds=o(["s+(?<c>",")(?:s+(?:","))?(?<l>(?:s+",")+)"],["\\s+(?<c>",")(?:\\s+(?:","))?(?<l>(?:\\s+",")+)"])),Fs,Us,Hs),qs=String.raw(zs||(zs=o(["","(?:",")+(?=s+(?:",")|$)"],["","(?:",")+(?=\\s+(?:",")|$)"])),nn("2pieces"),Ks,gn);function Gs(e,t){if(2==t.length&&(t="."+t),"n"==e)return"="+t;const n="w"==e;return t.match(/[A-Z]/)?n?t:t.toLowerCase():(n?"+":"-")+t}In.popeye.running=!1,In.popeye.editMap=!1,In.popeye.playing&&Wo().then((()=>ve((()=>va(!0)))));var Qs,Ys,Zs,Vs,Js="modules/py.js",Xs=!1,ea=document.getElementById("Output");function ta(){5==(Ys+=".").length&&(Ys="."),In.popeye.output=In.popeye.intOutput+"<br>"+Ys,na()}function na(){Xs&&(Xs=!1,ve((()=>ea.scrollTop=ea.scrollHeight-ea.clientHeight)))}function oa(e){Ws.terminate(),Ws=void 0;const t=500-(performance.now()-Qs);na(),clearInterval(Zs),e?sa():(In.popeye.output=In.popeye.intOutput,setTimeout((()=>In.popeye.running=!1),Math.max(0,t)),ra())}function ra(){Ws||((Ws=new Worker(Js)).onerror=t=>{let n;t.preventDefault(),clearInterval(Zs),In.popeye.running=!1,t.filename?(Ws.terminate(),n="An error occur in the Popeye module. Please submit an issue about this.\n"+e.message):n="Unable to load the Popeye module; please check your network connection.",In.popeye.output=aa(n),Ws=void 0},Ws.onmessage=e=>{const t=e.data;++Vs>3e3?(In.popeye.intOutput+="<br>".concat(aa("Too much output. Please modify the input to prevent excessive output."),"<br>"),oa()):-1===t?(gtag("event","fen_popeye_fallback"),Js="modules/py.asm.js",oa(!0),In.popeye.intOutput="Fallback to JS mode.<br>"):null===t?oa():(Xs=Xs||Boolean(ea)&&ea.scrollTop+ea.clientHeight+30>ea.scrollHeight,"string"==typeof t.text&&(In.popeye.intOutput+=ca(t.text)+"<br>"),"string"==typeof t.err&&(In.popeye.error=!0,In.popeye.intOutput+=aa(ca(t.err))))})}function sa(){ra(),Ys=".";const e=In.popeye;Vs=0,e.intOutput="",e.error=!1,e.running=!0,Zs=setInterval(ta,500),Qs=performance.now(),Ws.postMessage("Opti NoBoard\n"+e.intInput)}function aa(e){return'<span class="text-danger">'.concat(e,"</span>")}function ca(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}var ia,la,ua,pa=new RegExp(String.raw(ia||(ia=o(["(?:",")s.+$"],["(?:",")\\s.+$"])),["remark","2author","2origin","3title"].map(nn).join("|")),"igm"),fa=new RegExp(String.raw(la||(la=o(["","s+S+"],["","\\s+\\S+"])),nn("5protocol")),"i"),ha=tn("3beginProblem"),da=tn("3endProblem"),ga=/\bnext\s[\s\S]+$/i,ma=nn("3forsyth"),ya=nn("2pieces");function ba(e){var t;e=e.replace(pa,"").replace(fa,"").replace(ha,"").replace(ga,"").replace(da,"");const n=In.popeye;if(new RegExp("".concat(ma,"|").concat(ya),"i").test(e))return n.initFEN=function(e){const t=e.match(new RegExp(qs,"ig"));if(!t)return null;const n=Zt(64);for(const e of t){const t=e.match(new RegExp(Ks,"ig"));for(const e of t){const t=e.match(new RegExp(Ks,"i")).groups,o=t.c[0].toLowerCase(),r=t.l.match(new RegExp(Hs,"ig"));for(const e of r){const t=e.match(new RegExp(Hs,"i")).groups,r=t.p.toUpperCase(),s=t.sq.match(new RegExp(ln,"g"));for(const e of s)n[Yt(e)]=Gs(o,r)}}}return Ut(n)}(e)||(null==(t=e.match(new RegExp(String.raw(ua||(ua=o(["","s+(S+)"],["","\\s+(\\S+)"])),ma),"i")))?void 0:t[1]),n.initFEN&&mo(js(n.initFEN)),e;{const{fen:t,imitators:o}=function(){const{w:e,h:t}=Pn.board;if(8!=e||8!=t)return null;const n=[],o=vo().map(((e,t)=>{if(""==e)return e;let o=Pn.board.SN?e.replace("s","n").replace("S","N").replace("g","s").replace("G","S"):e;if(o=function(e){let t=e.startsWith("-")?"=":"";t&&(e=e.substring(1));const n=e.toUpperCase();if(n.match(/^[KQBNRP]$/))e=e.replace("n","s").replace("N","S");else{const o=n==e,r=Sn.custom();if(!(n in r))return null;const s=r[n];2==(e=o?s:s.toLowerCase()).length&&(e="."+e),s.match(/^\d+$/)&&!t&&(t=o?"+":"-")}return t+e}(o),!o)throw alert("Unspecified fairy piece: "+e);return o.match(/^=?i$/i)?(n.push(Gt(t)),""):o}));return{fen:Ut(o,8,8),imitators:n}}();return n.initFEN=t,o.length&&(e+="\ncond imitator "+o.join("")),"fors ".concat(n.initFEN,"\n").concat(e)}}async function va(e){const t=In.popeye;t.steps=[...ea.querySelectorAll("span")],0!=t.steps.length&&(wa(0,!0),t.playing=!0,e&&await Wo(),Jo([]),ve(Mo))}async function wa(e,t){var n;const o=In.popeye,r=o.steps[e],s=o.steps[o.index];if(s&&s.dataset.anime&&(e==o.index-1&&!s.dataset.before||r.dataset.fen==s.dataset.before))await no(r.dataset.fen,s.dataset.fen,s.dataset.anime,!0);else{const t=r.dataset.before||(null==(n=o.steps[e-1])?void 0:n.dataset.fen);r.dataset.anime&&t?await no(t,r.dataset.fen,r.dataset.anime):(oo(),mo(r.dataset.fen))}t||s.classList.remove("active"),o.index=e,r.classList.add("active"),ve((()=>function(e){const t=10,n=e.offsetTop-t;ea.scrollTop>n&&(ea.scrollTop=n);const o=e.offsetTop+e.clientHeight-ea.clientHeight+t;ea.scrollTop<o&&(ea.scrollTop=o);const r=e.offsetLeft-t;ea.scrollLeft>r&&(ea.scrollLeft=r);const s=e.offsetLeft+e.clientWidth-ea.clientWidth+t;ea.scrollLeft<s&&(ea.scrollLeft=s)}(r)))}var xa={run(){gtag("event","fen_popeye_run");try{const e=In.popeye;e.intInput=ba(e.input),sa()}catch{}},cancel(){Ws&&oa()},play(){const e=In.popeye;ea.scrollTop=ea.scrollLeft=0,gtag("event","fen_popeye_play"),e.output=Cs(e.intInput,e.initFEN,e.intOutput),ve(va)},step(e){const t=In.popeye.steps.indexOf(e.target);t>=0&&t!=In.popeye.index&&(e.preventDefault(),wa(t))},exit(){const e=In.popeye;mo(e.steps[0].dataset.fen),e.output=e.intOutput,e.playing=!1,Jo([]),ve(Mo)},moveBy(e){const t=In.popeye;let n=t.index;n+=e,n<0&&(n=0),n>t.steps.length-1&&(n=t.steps.length-1),xa.move(n)},move(e){e!=In.popeye.index&&wa(e)},editMap(){gtag("event","fen_popeye_edit_map"),In.popeye.mapping=Aa(Pn.popeye.pieceMap),In.popeye.editMap=!0},resetMap(){In.popeye.mapping=Aa(An)},saveMap(){const e=In.popeye.mapping.toUpperCase().split("\n"),t={};for(const n of e){let[e,o]=n.replace(/\s/g,"").split("=");e.match(Ea)&&o&&o.match(Sa)&&(t[e]=o)}Pn.popeye.pieceMap=t,In.popeye.editMap=!1}};function Aa(e){const t=[];for(const n in e)t.push("".concat(n,"=").concat(e[n]));return t.join("\n")}var Ea=/^(\*[1-3][KQBNRP]|(\*[1-3])?[CXSTAD]|''..|'.)$/,Sa=new RegExp("^".concat(un,"$")),ka=["image/png","image/jpeg","image/bmp","image/webp"];function Ra(e){ka.includes(e.type)?alert("Image processing under development."):alert("Unsupported format.")}function Ca(){tr(),Jo()}!async function(){const e=Rn.get("image");if(e){const t=new URL(location.href);t.searchParams.delete("image"),history.replaceState(null,"",t.toString());const n=await fetch("shareImage?image="+e);Ra(await n.blob())}}(),async function(){window.addEventListener("resize",(()=>Lo({})));const e=Rn.get("fen");await Lo({},!0),co.draw=tr,e?(mo(e,!0),bo()):xo(),setTimeout(Mo,1e3)}(),At.onmousedown=zr,At.ontouchstart=zr,At.ondragstart=e=>e.preventDefault(),At.onwheel=jr,yt.onmousedown=zr,yt.ontouchstart=zr,document.body.onmousemove=Lr,document.body.ontouchmove=Lr,document.body.onmouseleave=Tr,document.body.onmouseup=Tr,document.body.ontouchend=Tr,document.addEventListener("mousedown",(function(e){var t;const n=null==(t=document.activeElement)?void 0:t.nodeName.toLowerCase();"input"!=n&&"textarea"!=n&&e.detail>1&&e.preventDefault()}),!1),addEventListener("keydown",(e=>{var t;if(!In.play.playing&&!In.popeye.playing)return;const n=null==(t=document.activeElement)?void 0:t.nodeName.toLowerCase();if("input"==n||"textarea"==n)return;const o=e.key;"a"!=o&&"ArrowLeft"!=o||(e.preventDefault(),In.play.playing?fr(-1):xa.moveBy(-1)),"d"!=o&&"ArrowRight"!=o||(e.preventDefault(),In.play.playing?fr(1):xa.moveBy(1))})),window.share=async function(e){if(gtag("event","fen_img_share"),Ct.canSharePng){const e=await or(),t=[new File([e],"board.png",{type:"image/png"})];navigator.share({files:t})}else{e.disabled=!0;const t=e.querySelector("i"),n=t.className;t.className="fa-spin fa-solid fa-spinner";try{const e=await ns.copyUrl();navigator.share({url:e,text:Jr()})}finally{e.disabled=!1,t.className=n}}},ut({env:Ct,copyImage:async function(){if(Ct.canCopyImg){const e=await or();return navigator.clipboard.write([new ClipboardItem({"image/png":e})])}throw alert('Image copying is not enabled in your browser.\nIf you\'re using Firefox, this can be enabled by the following.\n1. Visit "about:config" in your address bar.\n2. Search for "dom.events.asyncClipboard.clipboardItem".\n3. Toggle its value to true.\n4. Reload this tool.'),!0},CheckboxBase:$n,Checkbox:jn,CheckboxR:function(e,t){return jn(e,t,null,(()=>"retro"==In.play.mode))},CopyButton:function(e,t,n,o){return{$template:"#copyBtn",cls:n,label:e,dis:void 0!==o&&o,state:0,async copy(){this.state=1;try{let e=t;for(;"function"==typeof e;)e=await e();"string"==typeof e&&function(e){if(Ct.canCopy)navigator.clipboard.writeText(e);else{const t=document.createElement("input");document.body.appendChild(t),t.value=e,t.select(),document.execCommand("copy"),document.body.removeChild(t)}}(e),this.state=2,setTimeout((()=>this.state=0),1e3)}catch(e){this.state=0}}}},redraw:Ca,updateBG:function(){nr(mt.getContext("2d")),Ca()},updateSN:function(){let e=!1;for(const t of so)e=ho(t,!0)||e;e&&xo()},openFile:function(e){const t=e.files[0];e.value="",Ra(t)},Popeye:xa,updateEdwards:Ao,toFEN:xo,toggleCoordinates(){Lo({},!0)},get DB(){return"PDB"==Pn.DB.use?qr:Hr},get noEditing(){return Tn()},get hideTemplate(){return Bn.hor&&In.popeye.playing},YACPDB:Hr,BBS:os,API:ns,PLAY:_r,store:Pn,state:In,status:Bn,drawExport:async function(){await Wo(),tr()},resize(){In.split,Promise.resolve().then((()=>Lo({})))},saveSettings:function(){localStorage.setItem("settings",JSON.stringify(Pn))},saveSession:function(){Ct.isTop&&sessionStorage.setItem("state",JSON.stringify(In))}}).mount()})();