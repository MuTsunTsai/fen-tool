(()=>{Object.create;var t=Object.freeze,n=Object.defineProperty,o=(Object.getOwnPropertyDescriptor,Object.getOwnPropertyNames,Object.getPrototypeOf,Object.prototype.hasOwnProperty,(e,o)=>t(n(e,"raw",{value:t(o||e.slice())}))),r=Object.defineProperty,s=(e,t,n)=>(((e,t,n)=>{t in e?r(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n);function a(e){if(y(e)){const t={};for(let n=0;n<e.length;n++){const o=e[n],r=w(o)?l(o):a(o);if(r)for(const e in r)t[e]=r[e]}return t}return w(e)||k(e)?e:void 0}var i=/;(?![^(]*\))/g,c=/:(.+)/;function l(e){const t={};return e.split(i).forEach((e=>{if(e){const n=e.split(c);n.length>1&&(t[n[0].trim()]=n[1].trim())}})),t}function u(e){let t="";if(w(e))t=e;else if(y(e))for(let n=0;n<e.length;n++){const o=u(e[n]);o&&(t+=o+" ")}else if(k(e))for(const n in e)e[n]&&(t+=n+" ");return t.trim()}function f(e,t){if(e===t)return!0;let n=b(e),o=b(t);if(n||o)return!(!n||!o)&&e.getTime()===t.getTime();if(n=y(e),o=y(t),n||o)return!(!n||!o)&&function(e,t){if(e.length!==t.length)return!1;let n=!0;for(let o=0;n&&o<e.length;o++)n=f(e[o],t[o]);return n}(e,t);if(n=k(e),o=k(t),n||o){if(!n||!o)return!1;if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e){const o=e.hasOwnProperty(n),r=t.hasOwnProperty(n);if(o&&!r||!o&&r||!f(e[n],t[n]))return!1}}return String(e)===String(t)}function p(e,t){return e.findIndex((e=>f(e,t)))}var h,d=Object.assign,g=Object.prototype.hasOwnProperty,m=(e,t)=>g.call(e,t),y=Array.isArray,v=e=>"[object Map]"===A(e),b=e=>e instanceof Date,w=e=>"string"==typeof e,x=e=>"symbol"==typeof e,k=e=>null!==e&&"object"==typeof e,E=Object.prototype.toString,A=e=>E.call(e),S=e=>A(e).slice(8,-1),N=e=>w(e)&&"NaN"!==e&&"-"!==e[0]&&""+parseInt(e,10)===e,R=e=>{const t=Object.create(null);return n=>t[n]||(t[n]=e(n))},P=/-(\w)/g,C=R((e=>e.replace(P,((e,t)=>t?t.toUpperCase():"")))),O=/\B([A-Z])/g,_=R((e=>e.replace(O,"-$1").toLowerCase())),B=e=>{const t=parseFloat(e);return isNaN(t)?e:t};function I(e,t){(t=t||h)&&t.active&&t.effects.push(e)}var T,L=e=>{const t=new Set(e);return t.w=0,t.n=0,t},M=e=>(e.w&W)>0,j=e=>(e.n&W)>0,z=new WeakMap,$=0,W=1,D=30,F=[],U=Symbol(""),H=Symbol(""),K=class{constructor(e,t=null,n){this.fn=e,this.scheduler=t,this.active=!0,this.deps=[],I(this,n)}run(){if(!this.active)return this.fn();if(!F.includes(this))try{return F.push(T=this),Y.push(Q),Q=!0,W=1<<++$,$<=D?(({deps:e})=>{if(e.length)for(let t=0;t<e.length;t++)e[t].w|=W})(this):q(this),this.fn()}finally{$<=D&&(e=>{const{deps:t}=e;if(t.length){let n=0;for(let o=0;o<t.length;o++){const r=t[o];M(r)&&!j(r)?r.delete(e):t[n++]=r,r.w&=~W,r.n&=~W}t.length=n}})(this),W=1<<--$,Z(),F.pop();const e=F.length;T=e>0?F[e-1]:void 0}}stop(){this.active&&(q(this),this.onStop&&this.onStop(),this.active=!1)}};function q(e){const{deps:t}=e;if(t.length){for(let n=0;n<t.length;n++)t[n].delete(e);t.length=0}}function G(e){e.effect.stop()}var Q=!0,Y=[];function Z(){const e=Y.pop();Q=void 0===e||e}function V(e,t,n){if(!Q||void 0===T)return;let o=z.get(e);o||z.set(e,o=new Map);let r=o.get(n);r||o.set(n,r=L()),function(e,t){let n=!1;$<=D?j(e)||(e.n|=W,n=!M(e)):n=!e.has(T),n&&(e.add(T),T.deps.push(e))}(r)}function J(e,t,n,o,r,s){const a=z.get(e);if(!a)return;let i=[];if("clear"===t)i=[...a.values()];else if("length"===n&&y(e))a.forEach(((e,t)=>{("length"===t||t>=o)&&i.push(e)}));else switch(void 0!==n&&i.push(a.get(n)),t){case"add":y(e)?N(n)&&i.push(a.get("length")):(i.push(a.get(U)),v(e)&&i.push(a.get(H)));break;case"delete":y(e)||(i.push(a.get(U)),v(e)&&i.push(a.get(H)));break;case"set":v(e)&&i.push(a.get(U))}if(1===i.length)i[0]&&X(i[0]);else{const e=[];for(const t of i)t&&e.push(...t);X(L(e))}}function X(e,t){for(const t of y(e)?e:[...e])(t!==T||t.allowRecurse)&&(t.scheduler?t.scheduler():t.run())}var ee=function(e,t){const n=Object.create(null),o=e.split(",");for(let e=0;e<o.length;e++)n[o[e]]=!0;return t?e=>!!n[e.toLowerCase()]:e=>!!n[e]}("__proto__,__v_isRef,__isVue"),te=new Set(Object.getOwnPropertyNames(Symbol).map((e=>Symbol[e])).filter(x)),ne=se(),oe=se(!0),re=function(){const e={};return["includes","indexOf","lastIndexOf"].forEach((t=>{e[t]=function(...e){const n=de(this);for(let e=0,t=this.length;e<t;e++)V(n,0,e+"");const o=n[t](...e);return-1===o||!1===o?n[t](...e.map(de)):o}})),["push","pop","shift","unshift","splice"].forEach((t=>{e[t]=function(...e){Y.push(Q),Q=!1;const n=de(this)[t].apply(this,e);return Z(),n}})),e}();function se(e=!1,t=!1){return function(n,o,r){if("__v_isReactive"===o)return!e;if("__v_isReadonly"===o)return e;if("__v_raw"===o&&r===(e?t?fe:ue:t?le:ce).get(n))return n;const s=y(n);if(!e&&s&&m(re,o))return Reflect.get(re,o,r);const a=Reflect.get(n,o,r);return(x(o)?te.has(o):ee(o))||(e||V(n,0,o),t)?a:ge(a)?s&&N(o)?a:a.value:k(a)?e?function(e){return he(e,!0,ie,null,ue)}(a):pe(a):a}}var ae={get:ne,set:function(e=!1){return function(t,n,o,r){let s=t[n];if(!e&&!function(e){return!(!e||!e.__v_isReadonly)}(o)&&(o=de(o),s=de(s),!y(t)&&ge(s)&&!ge(o)))return s.value=o,!0;const a=y(t)&&N(n)?Number(n)<t.length:m(t,n),i=Reflect.set(t,n,o,r);return t===de(r)&&(a?((e,t)=>!Object.is(e,t))(o,s)&&J(t,"set",n,o):J(t,"add",n,o)),i}}(),deleteProperty:function(e,t){const n=m(e,t);e[t];const o=Reflect.deleteProperty(e,t);return o&&n&&J(e,"delete",t,void 0),o},has:function(e,t){const n=Reflect.has(e,t);return(!x(t)||!te.has(t))&&V(e,0,t),n},ownKeys:function(e){return V(e,0,y(e)?"length":U),Reflect.ownKeys(e)}},ie={get:oe,set:(e,t)=>!0,deleteProperty:(e,t)=>!0},ce=new WeakMap,le=new WeakMap,ue=new WeakMap,fe=new WeakMap;function pe(e){return e&&e.__v_isReadonly?e:he(e,!1,ae,null,ce)}function he(e,t,n,o,r){if(!k(e)||e.__v_raw&&(!t||!e.__v_isReactive))return e;const s=r.get(e);if(s)return s;const a=function(e){return e.__v_skip||!Object.isExtensible(e)?0:function(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}(S(e))}(e);if(0===a)return e;const i=new Proxy(e,2===a?o:n);return r.set(e,i),i}function de(e){const t=e&&e.__v_raw;return t?de(t):e}function ge(e){return Boolean(e&&!0===e.__v_isRef)}Promise.resolve();var me=!1,ye=[],ve=Promise.resolve(),be=e=>ve.then(e),we=e=>{ye.includes(e)||ye.push(e),me||(me=!0,be(xe))},xe=()=>{for(const e of ye)e();ye.length=0,me=!1},ke=/^(spellcheck|draggable|form|list|type)$/,Ee=({el:e,get:t,effect:n,arg:o,modifiers:r})=>{let s;"class"===o&&(e._class=e.className),n((()=>{let n=t();if(o)(null==r?void 0:r.camel)&&(o=C(o)),Ae(e,o,n,s);else{for(const t in n)Ae(e,t,n[t],s&&s[t]);for(const t in s)(!n||!(t in n))&&Ae(e,t,null)}s=n}))},Ae=(e,t,n,o)=>{if("class"===t)e.setAttribute("class",u(e._class?[e._class,n]:n)||"");else if("style"===t){n=a(n);const{style:t}=e;if(n)if(w(n))n!==o&&(t.cssText=n);else{for(const e in n)Ne(t,e,n[e]);if(o&&!w(o))for(const e in o)null==n[e]&&Ne(t,e,"")}else e.removeAttribute("style")}else e instanceof SVGElement||!(t in e)||ke.test(t)?"true-value"===t?e._trueValue=n:"false-value"===t?e._falseValue=n:null!=n?e.setAttribute(t,n):e.removeAttribute(t):(e[t]=n,"value"===t&&(e._value=n))},Se=/\s*!important$/,Ne=(e,t,n)=>{y(n)?n.forEach((n=>Ne(e,t,n))):t.startsWith("--")?e.setProperty(t,n):Se.test(n)?e.setProperty(_(t),n.replace(Se,""),"important"):e[t]=n},Re=(e,t)=>{const n=e.getAttribute(t);return null!=n&&e.removeAttribute(t),n},Pe=(e,t,n,o)=>{e.addEventListener(t,n,o)},Ce=/^[A-Za-z_$][\w$]*(?:\.[A-Za-z_$][\w$]*|\['[^']*?']|\["[^"]*?"]|\[\d+]|\[[A-Za-z_$][\w$]*])*$/,Oe=["ctrl","shift","alt","meta"],_e={stop:e=>e.stopPropagation(),prevent:e=>e.preventDefault(),self:e=>e.target!==e.currentTarget,ctrl:e=>!e.ctrlKey,shift:e=>!e.shiftKey,alt:e=>!e.altKey,meta:e=>!e.metaKey,left:e=>"button"in e&&0!==e.button,middle:e=>"button"in e&&1!==e.button,right:e=>"button"in e&&2!==e.button,exact:(e,t)=>Oe.some((n=>e["".concat(n,"Key")]&&!t[n]))},Be=({el:e,get:t,exp:n,arg:o,modifiers:r})=>{if(!o)return;let s=Ce.test(n)?t("(e => ".concat(n,"(e))")):t("($event => { ".concat(n," })"));if("vue:mounted"!==o){if("vue:unmounted"===o)return()=>s();if(r){"click"===o&&(r.right&&(o="contextmenu"),r.middle&&(o="mouseup"));const e=s;s=t=>{if(!("key"in t)||_(t.key)in r){for(const e in r){const n=_e[e];if(n&&n(t,r))return}return e(t)}}}Pe(e,o,s,r)}else be(s)},Ie=({el:e,get:t,effect:n})=>{n((()=>{e.textContent=Te(t())}))},Te=e=>null==e?"":k(e)?JSON.stringify(e,null,2):String(e),Le=e=>"_value"in e?e._value:e.value,Me=(e,t)=>{const n=t?"_trueValue":"_falseValue";return n in e?e[n]:t},je=e=>{e.target.composing=!0},ze=e=>{const t=e.target;t.composing&&(t.composing=!1,$e(t,"input"))},$e=(e,t)=>{const n=document.createEvent("HTMLEvents");n.initEvent(t,!0,!0),e.dispatchEvent(n)},We=Object.create(null),De=(e,t,n)=>Fe(e,"return(".concat(t,")"),n),Fe=(e,t,n)=>{const o=We[t]||(We[t]=Ue(t));try{return o(e,n)}catch(e){console.error(e)}},Ue=e=>{try{return new Function("$data","$el","with($data){".concat(e,"}"))}catch(t){return console.error("".concat(t.message," in expression: ").concat(e)),()=>{}}},He={bind:Ee,on:Be,show:({el:e,get:t,effect:n})=>{const o=e.style.display;n((()=>{e.style.display=t()?o:"none"}))},text:Ie,html:({el:e,get:t,effect:n})=>{n((()=>{e.innerHTML=t()}))},model:({el:e,exp:t,get:n,effect:o,modifiers:r})=>{const s=e.type,a=n("(val) => { ".concat(t," = val }")),{trim:i,number:c="number"===s}=r||{};if("SELECT"===e.tagName){const t=e;Pe(e,"change",(()=>{const e=Array.prototype.filter.call(t.options,(e=>e.selected)).map((e=>c?B(Le(e)):Le(e)));a(t.multiple?e:e[0])})),o((()=>{const e=n(),o=t.multiple;for(let n=0,r=t.options.length;n<r;n++){const r=t.options[n],s=Le(r);if(o)y(e)?r.selected=p(e,s)>-1:r.selected=e.has(s);else if(f(Le(r),e))return void(t.selectedIndex!==n&&(t.selectedIndex=n))}!o&&-1!==t.selectedIndex&&(t.selectedIndex=-1)}))}else if("checkbox"===s){let t;Pe(e,"change",(()=>{const t=n(),o=e.checked;if(y(t)){const n=Le(e),r=p(t,n),s=-1!==r;if(o&&!s)a(t.concat(n));else if(!o&&s){const e=[...t];e.splice(r,1),a(e)}}else a(Me(e,o))})),o((()=>{const o=n();y(o)?e.checked=p(o,Le(e))>-1:o!==t&&(e.checked=f(o,Me(e,!0))),t=o}))}else if("radio"===s){let t;Pe(e,"change",(()=>{a(Le(e))})),o((()=>{const o=n();o!==t&&(e.checked=f(o,Le(e)))}))}else{const t=e=>i?e.trim():c?B(e):e;Pe(e,"compositionstart",je),Pe(e,"compositionend",ze),Pe(e,(null==r?void 0:r.lazy)?"change":"input",(()=>{e.composing||a(t(e.value))})),i&&Pe(e,"change",(()=>{e.value=e.value.trim()})),o((()=>{if(e.composing)return;const o=e.value,r=n();document.activeElement===e&&t(o)===r||o!==r&&(e.value=r)}))}},effect:({el:e,ctx:t,exp:n,effect:o})=>{be((()=>o((()=>Fe(t.scope,n,e)))))}},Ke=/([\s\S]*?)\s+(?:in|of)\s+([\s\S]*)/,qe=/,([^,\}\]]*)(?:,([^,\}\]]*))?$/,Ge=/^\(|\)$/g,Qe=/^[{[]\s*((?:[\w_$]+\s*,?\s*)+)[\]}]$/,Ye=(e,t,n)=>{const o=t.match(Ke);if(!o)return;const r=e.nextSibling,s=e.parentElement,a=new Text("");s.insertBefore(a,e),s.removeChild(e);const i=o[2].trim();let c,l,u,f,p=o[1].trim().replace(Ge,"").trim(),h=!1,d="key",g=e.getAttribute(d)||e.getAttribute(d=":key")||e.getAttribute(d="v-bind:key");g&&(e.removeAttribute(d),"key"===d&&(g=JSON.stringify(g))),(f=p.match(qe))&&(p=p.replace(qe,"").trim(),l=f[1].trim(),f[2]&&(u=f[2].trim())),(f=p.match(Qe))&&(c=f[1].split(",").map((e=>e.trim())),h="["===p[0]);let m,v,b,w=!1;const x=(e,t,o,r)=>{const s={};c?c.forEach(((e,n)=>s[e]=t[h?n:e])):s[p]=t,r?(l&&(s[l]=r),u&&(s[u]=o)):l&&(s[l]=o);const a=at(n,s),i=g?De(a.scope,g):o;return e.set(i,o),a.key=i,a},E=(t,n)=>{const o=new ct(e,t);return o.key=t.key,o.insert(s,n),o};return n.effect((()=>{const e=De(n.scope,i),t=b;if([v,b]=(e=>{const t=new Map,n=[];if(y(e))for(let o=0;o<e.length;o++)n.push(x(t,e[o],o));else if("number"==typeof e)for(let o=0;o<e;o++)n.push(x(t,o+1,o));else if(k(e)){let o=0;for(const r in e)n.push(x(t,e[r],o++,r))}return[n,t]})(e),w){for(let e=0;e<m.length;e++)b.has(m[e].key)||m[e].remove();const e=[];let n,o,r=v.length;for(;r--;){const i=v[r],c=t.get(i.key);let l;null==c?l=E(i,n?n.el:a):(l=m[c],Object.assign(l.ctx.scope,i.scope),c!==r&&(m[c+1]!==n||o===n)&&(o=l,l.insert(s,n?n.el:a))),e.unshift(n=l)}m=e}else m=v.map((e=>E(e,a))),w=!0})),r},Ze=({el:e,ctx:{scope:{$refs:t}},get:n,effect:o})=>{let r;return o((()=>{const o=n();t[o]=e,r&&o!==r&&delete t[r],r=o})),()=>{r&&delete t[r]}},Ve=/^(?:v-|:|@)/,Je=/\.([\w-]+)/g,Xe=!1,et=(e,t)=>{const n=e.nodeType;if(1===n){const n=e;if(n.hasAttribute("v-pre"))return;let o;if(Re(n,"v-cloak"),o=Re(n,"v-if"))return((e,t,n)=>{const o=e.parentElement,r=new Comment("v-if");o.insertBefore(r,e);const s=[{exp:t,el:e}];let a,i;for(;(a=e.nextElementSibling)&&(i=null,""===Re(a,"v-else")||(i=Re(a,"v-else-if")));)o.removeChild(a),s.push({exp:i,el:a});const c=e.nextSibling;o.removeChild(e);let l,u=-1;const f=()=>{l&&(o.insertBefore(r,l.el),l.remove(),l=void 0)};return n.effect((()=>{for(let e=0;e<s.length;e++){const{exp:t,el:a}=s[e];if(!t||De(n.scope,t))return void(e!==u&&(f(),l=new ct(a,n),l.insert(o,r),o.removeChild(r),u=e))}u=-1,f()})),c})(n,o,t);if(o=Re(n,"v-for"))return Ye(n,o,t);if((o=Re(n,"v-scope"))||""===o){const e=o?De(t.scope,o):{};t=at(t,e),e.$template&&rt(n,e.$template)}const r=null!=Re(n,"v-once");r&&(Xe=!0),(o=Re(n,"ref"))&&ot(n,Ze,'"'.concat(o,'"'),t),tt(n,t);const s=[];for(const{name:e,value:o}of[...n.attributes])Ve.test(e)&&"v-cloak"!==e&&("v-model"===e?s.unshift([e,o]):"@"===e[0]||/^v-on\b/.test(e)?s.push([e,o]):nt(n,e,o,t));for(const[e,o]of s)nt(n,e,o,t);r&&(Xe=!1)}else if(3===n){const n=e.data;if(n.includes(t.delimiters[0])){let o,r=[],s=0;for(;o=t.delimitersRE.exec(n);){const e=n.slice(s,o.index);e&&r.push(JSON.stringify(e)),r.push("$s(".concat(o[1],")")),s=o.index+o[0].length}s<n.length&&r.push(JSON.stringify(n.slice(s))),ot(e,Ie,r.join("+"),t)}}else 11===n&&tt(e,t)},tt=(e,t)=>{let n=e.firstChild;for(;n;)n=et(n,t)||n.nextSibling},nt=(e,t,n,o)=>{let r,s,a;if(":"===(t=t.replace(Je,((e,t)=>((a||(a={}))[t]=!0,""))))[0])r=Ee,s=t.slice(1);else if("@"===t[0])r=Be,s=t.slice(1);else{const e=t.indexOf(":"),n=e>0?t.slice(2,e):t.slice(2);r=He[n]||o.dirs[n],s=e>0?t.slice(e+1):void 0}r&&(r===Ee&&"ref"===s&&(r=Ze),ot(e,r,n,o,s,a),e.removeAttribute(t))},ot=(e,t,n,o,r,s)=>{const a=t({el:e,get:(t=n)=>De(o.scope,t,e),effect:o.effect,ctx:o,exp:n,arg:r,modifiers:s});a&&o.cleanups.push(a)},rt=(e,t)=>{if("#"!==t[0])e.innerHTML=t;else{const n=document.querySelector(t);e.appendChild(n.content.cloneNode(!0))}},st=e=>{const t={delimiters:["{{","}}"],delimitersRE:/\{\{([^]+?)\}\}/g,...e,scope:e?e.scope:pe({}),dirs:e?e.dirs:{},effects:[],blocks:[],cleanups:[],effect:e=>{if(Xe)return we(e),e;const n=function(e,t){e.effect&&(e=e.effect.fn);const n=new K(e);t&&(d(n,t),t.scope&&I(n,t.scope)),(!t||!t.lazy)&&n.run();const o=n.run.bind(n);return o.effect=n,o}(e,{scheduler:()=>we(n)});return t.effects.push(n),n}};return t},at=(e,t={})=>{const n=e.scope,o=Object.create(n);Object.defineProperties(o,Object.getOwnPropertyDescriptors(t)),o.$refs=Object.create(n.$refs);const r=pe(new Proxy(o,{set:(e,t,o,s)=>s!==r||e.hasOwnProperty(t)?Reflect.set(e,t,o,s):Reflect.set(n,t,o)}));return it(r),{...e,scope:r}},it=e=>{for(const t of Object.keys(e))"function"==typeof e[t]&&(e[t]=e[t].bind(e))},ct=class{constructor(e,t,n=!1){s(this,"template"),s(this,"ctx"),s(this,"key"),s(this,"parentCtx"),s(this,"isFragment"),s(this,"start"),s(this,"end"),this.isFragment=e instanceof HTMLTemplateElement,n?this.template=e:this.isFragment?this.template=e.content.cloneNode(!0):this.template=e.cloneNode(!0),n?this.ctx=t:(this.parentCtx=t,t.blocks.push(this),this.ctx=st(t)),et(this.template,this.ctx)}get el(){return this.start||this.template}insert(e,t=null){if(this.isFragment)if(this.start){let n,o=this.start;for(;o&&(n=o.nextSibling,e.insertBefore(o,t),o!==this.end);)o=n}else this.start=new Text(""),this.end=new Text(""),e.insertBefore(this.end,t),e.insertBefore(this.start,this.end),e.insertBefore(this.template,this.end);else e.insertBefore(this.template,t)}remove(){if(this.parentCtx&&((e,t)=>{const n=e.indexOf(t);n>-1&&e.splice(n,1)})(this.parentCtx.blocks,this),this.start){const e=this.start.parentNode;let t,n=this.start;for(;n&&(t=n.nextSibling,e.removeChild(n),n!==this.end);)n=t}else this.template.parentNode.removeChild(this.template);this.teardown()}teardown(){this.ctx.blocks.forEach((e=>{e.teardown()})),this.ctx.effects.forEach(G),this.ctx.cleanups.forEach((e=>e()))}},lt=e=>e.replace(/[-.*+?^${}()|[\]\/\\]/g,"\\$&"),ut=e=>{const t=st();if(e&&(t.scope=pe(e),it(t.scope),e.$delimiters)){const[n,o]=t.delimiters=e.$delimiters;t.delimitersRE=new RegExp(lt(n)+"([^]+?)"+lt(o),"g")}let n;return t.scope.$s=Te,t.scope.$nextTick=be,t.scope.$refs=Object.create(null),{directive(e,n){return n?(t.dirs[e]=n,this):t.dirs[e]},mount(e){if("string"==typeof e&&!(e=document.querySelector(e)))return;let o;return o=(e=e||document.documentElement).hasAttribute("v-scope")?[e]:[...e.querySelectorAll("[v-scope]")].filter((e=>!e.matches("[v-scope] [v-scope]"))),o.length||(o=[e]),n=o.map((e=>new ct(e,t,!0))),this},unmount(){n.forEach((e=>e.teardown()))}}},ft=document.currentScript;ft&&ft.hasAttribute("init")&&ut().mount();var pt={pattern:void 0,bg:void 0,exHigh:!0,border:"1",blackWhite:!1,knightOffset:.6,SN:!1,size:44,w:8,h:8,fullFEN:!1,coordinates:!1,set:"1echecs",collapse:!0},ht=/^\d+(,\d+)*$/,dt=[26,32,38,44],gt=["1echecs","alpha","goodCompanion","merida","skak"];function mt(e){return"string"!=typeof e?null:(e=e.replace(/\D/g,",").replace(/,+/g,",").replace(/^,/,"").replace(/,$/,"")).match(ht)?e:null}var yt=20;function vt(e,t){const n=function(e){const t=e.split(",").map((e=>{const t=Number(e);return isNaN(t)?0:Math.abs(Math.floor(t))})),n=t.reduce(((e,t)=>e+t),0);return{array:t,size:n}}(e.border),o=e.coordinates?{x:yt,y:yt}:{x:0,y:0};!0===t&&(o.y=0),!1===t&&(o.x=0);return{w:e.w*e.size+2*n.size+o.x,h:e.h*e.size+2*n.size+o.y,border:n,offset:{x:n.size+o.x,y:n.size},margin:o}}var bt=document.getElementById("CN"),wt=document.getElementById("SN"),xt=document.getElementById("TP"),kt=document.getElementById("CanvasGhost"),Et=document.getElementById("TemplateGhost"),At=document.getElementById("FEN"),St=document.getElementById("DB"),Nt=document.getElementById("PV"),Rt=navigator.clipboard,Pt="canShare"in navigator,Ct=Math.min(2,Math.floor(devicePixelRatio));var Ot=matchMedia("(hover: none), (pointer: coarse)").matches,_t={isTop:top==self,thread:"undefined"!=typeof SharedArrayBuffer,canShare:Pt,canSharePng:function(){if(!Pt)return!1;const e=atob("iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII"),t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);const n=new Blob([t]),o=new File([n],"1.png",{type:"image/png"});return navigator.canShare({files:[o]})}(),canCopy:Rt&&"writeText"in Rt,canPaste:Rt&&"readText"in Rt,canCopyImg:Rt&&"write"in Rt,isTouch:Ot,isTaiwan:navigator.languages.includes("zh-TW")};function Bt(e,t,n=!1){if(!(t instanceof Object))return e;const o=Object.keys(t);for(const r of o){if(n&&!(r in e))continue;const o=t[r];o instanceof Object?e[r]instanceof Object&&e[r]!=o?e[r]=Bt(e[r],o,n):e[r]=It(o):e[r]=o}return e}function It(e){return Bt(Array.isArray(e)?[]:{},e)}var Tt,Lt="function"==typeof structuredClone?structuredClone:It,Mt="8/8/8/8/8/8/8/8",jt="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",zt="[🇦-🇿]{2}|\\p{ExtPict}\\uFE0F?\\p{EMod}?(\\u200D\\p{ExtPict}\\uFE0F?\\p{EMod}?)*",$t="\\((!?)([kqbnrp])(\\d?)\\)",Wt="'(".concat(zt,"|[^'])|''.."),Dt="[-~]?(\\*\\d)?(".concat("[kqbnrpcxstadg]","|").concat(Wt,")"),Ft=RegExp("^(?:".concat(zt,")$"),"u"),Ut=RegExp("^(?:".concat($t,"|").concat(Dt,")$"),"iu"),Ht=RegExp("\\/|\\d+|".concat($t,"|").concat(Dt,"|."),"iug");function Kt(e){const t=e.match(Ht)||[],n=[0];let o=0;for(const e of t)"/"==e?n[++o]=0:e.match(/^\d+$/)?n[o]+=Number(e):n[o]++;const r=n.length;if(1==r)return;const s=n[0];for(const e of n)if(e!=s)return;return{w:s,h:r}}function qt(e,t=8,n=8){const o=e.match(Ht)||[],r=[];let s=!1;for(const e of o){if("/"==e){if(!s){const e=r.length+t-r.length%t;for(;r.length<e;)r.push("")}}else if(e.match(/^\d+$/)){const t=Number(e);for(let e=0;e<t;e++)r.push("")}else r.push(e);if(s="/"!=e&&r.length%t==0,r.length==t*n)break}for(;r.length<t*n;)r.push("");return r}function Gt(e,t=8,n=8){let o=0,r="";function s(){o&&(r+=o),o=0}for(let a=0;a<n;a++){for(let n=0;n<t;n++){const i=a*t+n;""==e[i]?o++:(s(),r+=e[i])}s(),a<n-1&&(r+="/")}return r}function Qt(e,t,n){if(!e.match(Ut))if(e.match(Ft))e="'"+e;else{const t=[...e].length;e=1==t&&"'"!=e?"'"+e:2==t?"''"+e:""}return(e=(e=e.replace(RegExp("^".concat($t,"$"),"i"),((e,t,n,o)=>{let r=n;return o&&(r="*"+o+r),t&&(r="-"+r),r}))).replace(/^~/,"-").replace(/^-(?=.*')/,"")).startsWith("-")&&(e=e.toLowerCase()),e=Zt(e,t,n)}function Yt(e){const t=(e=Zt(e,!1,!0)).match(/^(-?)(?:\*(\d))?([kqbnrp])$/i);if(!t)return"";const n=Zt(t[3],!0);return t[1]||t[2]?"("+(t[1]?"!":"")+n+(t[2]||"")+")":n}function Zt(e,t,n){return e.match(/^-?(\*\d)?[sng]$/i)?(t?(n&&(e=e.replace("s","g").replace("S","G")),e=e.replace("n","s").replace("N","S")):(n&&(e=e.replace("s","n").replace("S","N")),e=e.replace("g","s").replace("G","S")),e):e}function Vt(e,t,n=8){return void 0===t&&(e=(e-(t=e%8))/8),String.fromCharCode(97+t)+(n-e)}function Jt(e,t=8){return{x:e.charCodeAt(0)-97,y:t-Number(e[1])}}function Xt(e,t=8,n=8){const{x:o,y:r}=Jt(e,n);return r*t+o}function en(e){return Array.from({length:e},(e=>""))}function tn(e,t,n,o=8,r=8){const s=en(o*r);s.anime="";for(let a=0;a<r;a++)for(let i=0;i<o;i++){const c=i+t,l=a+n,u=0<=c&&c<o&&0<=l&&l<r;e[a*o+i]&&(s[l*o+c]=u?e[a*o+i]:"",s.anime+=Vt(a,i,r)+Vt(l,c,r))}return s}function nn(e,t,n=8,o=8){const r=en(n*o);r.anime="";for(let s=0;s<o;s++)for(let a=0;a<n;a++){let i=a,c=s;if("-"==t&&(i=n-1-i),"|"!=t&&"/"!=t||(c=o-1-c),"/"==t||"\\"==t){const e=c-i;i+=e,c-=e}"/"==t&&(c=o-1-c),e[c*n+i]&&(r[s*n+a]=e[c*n+i],r.anime+=Vt(c,i,o)+Vt(s,a,o))}return r}function on(e,t,n=8,o=8){const r=en(n*o);n==o&&(r.anime="");for(let s=0;s<n;s++)for(let a=0;a<o;a++){const i=1==t?s:2==t?o-1-a:n-1-s,c=1==t?o-1-a:2==t?n-1-s:a;e[c*n+i]&&(r[s*o+a]=e[c*n+i],n==o&&(r.anime+=Vt(c,i,o)+Vt(s,a,o)))}return r}function rn(e,t){return e.map((e=>{if(""==e||e.startsWith("-"))return e;if(!t&&e.startsWith("'"))return e;const n=e.toLowerCase();return e=e==n?e.toUpperCase():n}))}function sn(e,t="",n=""){return new RegExp(t+an(e)+n,"i")}function an(e){let t=4;return e.match(/^\d/)&&(t=Number(e[0]),e=e.substring(1)),e.length<=t?"\\b"+e+"\\b":"\\b"+e.substring(0,t)+cn(e.substring(t))}function cn(e){return""==e?"":String.raw(Tt||(Tt=o(["(?:","","|\b)"],["(?:","","|\\b)"])),e[0],cn(e.substring(1)))}var ln,un,fn,pn,hn="[a-h][1-8]",dn="(?:[0-9A-Z][0-9A-Z]|[A-Z])",gn=String.raw(ln||(ln=o(["[[^]]+]"],["\\[[^\\]]+\\]"]))),mn=String.raw(un||(un=o(["(+)?[a-z]) (S[ S]+S)"],["(\\+)?[a-z]\\) (\\S[ \\S]+\\S)"]))),yn="(?:[nwb])?r?".concat(dn,"?(?<from>").concat(hn,")[-*](?<to>").concat(hn,")(?<ep> ep.)?(?<then>([-*]").concat(hn,"(=[nwb]?").concat(dn,")?)*)"),vn="=(?<pc>[nwb])?(?<p>".concat(dn,")"),bn=["condition","2option","3stipulation","2sstipulation","3forsyth","2pieces","2twin"].map(an).join("|"),wn=new RegExp(bn,"ig"),xn=String.raw(fn||(fn=o(["(?:(?<move>0-0(?:-0)?|",")(?:",")*(?:",")?(?:=(?<cc>[nwb]))?)(?:",")*"])),yn,gn,vn,gn),kn=xn.replace(/\?<[^>]+>/g,""),En=String.raw(pn||(pn=o(["(?<count>d+.(?:..)?)?(?<main>","(?:/",")*)(?: [+#=])?"],["(?<count>\\d+\\.(?:\\.\\.)?)?(?<main>","(?:\\/",")*)(?: [+#=])?"])),kn,kn);function An(e,t,n,o){return n=Cn(n),"w"==o&&(n=n.toUpperCase()),"b"==o&&(n=n.toLowerCase()),"n"==o&&(n="-"+n.toLowerCase()),e[Xt(t)]=n,n}function Sn(e,t,n,o){return o&&o.push(t+n),t=Xt(t),e[n=Xt(n)]=e[t],e[t]="",e[n]}var Nn={"*2Q":"G","*2N":"N","*1N":"Z","*3N":"CA","*3B":"GI","*3Q":"LI","*1Q":"EQ","*2P":"BP","*1B":"AN","*1K":"PO","*2K":"ST","*3K":"DU","*2R":"WE","*3R":"PA",C:"I"},Rn={"*1B":"25,37,AL,AN,BM,C,CT,DB,GN,GY,NH","*1K":"PO","*1N":"36,AO,BK,BN,DR,GR,KP,LS,MA,MS,OH,RK,S1,S2,S3,S4,SQ,SS,SW,UU,Z,ZE,ZH,ZR","*1P":"BS,CP,MP","*1Q":"EQ,HA,KH,L,LE,NE","*1R":"DA,DK,EK,GT,MH,RM,RO,RR,SH,WA","*2B":"15,AR,BH,BT,BU,BW,ND,PR","*2K":"ST","*2N":"N","*2P":"BP","*2Q":"G","*2R":"DG,EM,RA,RF,RH,RW,WE","*3B":"BE,BL,FE,GI,LO,OK,RB,VA","*3K":"DU","*3N":"24,35,AH,CA,DS,GH,MO,OA,SA","*3P":"O,SP","*3Q":"16,AM,EH,KA,LI,M,OR,SE,SI","*3R":"BR,CH,CR,EA,FA,PA,RE,RL,TR",A:"AG,B1,B2,B3,BI,BO,CG,CY,DO,ET,F,FR,G2,G3,GE,GF,GL,KL,KO,LB,LH,LN,LR,MG,ML,MM,NA,NL,NO,PP,QE,QF,QN,QQ,RN,RP,RT,SK,SO,TH,WR",C:"I",N:"S"},Pn={custom:()=>({}),default:{}};for(const e in Rn)for(const t of Rn[e].split(","))Pn.default[t]=e;function Cn(e){const t=e.toUpperCase(),n=function(e,t){for(const n in e)if(e[n]==t)return n}(Pn.custom(),t)||Pn.default[t];return n?e==t?n:n.toLowerCase():e}var On=new URL(location.href).searchParams,_n=JSON.parse(localStorage.getItem("settings"))||{},Bn={BBS:{Id:!0,coordinates:!0,notes:!0,uncoloredNotes:!1,redBlue:!1},DB:{use:"PDB",exact:!1},PLAY:{symbol:null,ep:!0,negative:!1,zero:!1},Stockfish:{study:!1,downloaded:!1,depth:50,lines:3},feature:{janko:!1},popeye:{pieceMap:Nn},board:pt,project:[]};Bt(Bn,_n,!0),_n.project&&(Bn.project=_n.project),_n.popeye&&(Bn.popeye.pieceMap=_n.popeye.pieceMap),On.has("janko")&&(Bn.feature.janko=!0);var In=pe(Bn);Pn.custom=()=>In.popeye.pieceMap;var Tn=matchMedia("(prefers-color-scheme: dark)");Tn.onchange=()=>Ln.isDark=Tn.matches;var Ln=pe({loading:!0,isDark:Tn.matches,pieceCount:"(0+0)",hor:!1,collapse:!1,dragging:!1,selection:null,stockfish:{status:In.Stockfish.downloaded?3:0,running:0},syzygy:{running:!1}}),Mn=_t.isTop?sessionStorage.getItem("state"):null,jn={depth:0,score:null,mate:null,lines:[],header:[]},zn={split:!1,tab:0,compute:"py",play:{initFEN:null,playing:!1,pendingPromotion:!1,moveNumber:-1,game:"",history:[],turn:"w",castle:{K:!0,Q:!0,k:!0,q:!0},retro:{uncapture:null,unpromote:!1},enPassant:"",halfMove:0,fullMove:1,mode:"normal"},popeye:{initFEN:null,index:null,steps:null,playing:!1,error:!1,running:!1,editMap:!1,mapping:"",input:"",output:"",intInput:null,intOutput:null},stockfish:jn,syzygy:{header:null,lines:null}},$n=pe(Mn?JSON.parse(Mn):zn);for(const e in zn)e in $n||($n[e]=zn[e]);function Wn(e,t,n){const{size:o,w:r}=In.board,{border:s,margin:a}=vt(In.board,t),i=s.size,c=e?t?8:3:r,l=(e||bt).clientWidth/(o*c+2*i+a.x);return{s:o*l,offset:{x:(i+a.x)*l,y:i*l,r:i*l,b:(i+a.y)*l},width:((n||r)*o+2*s.size+a.x)*l}}function Dn(){return $n.play.playing||$n.popeye.playing}var Fn=0;function Un(e,t,n,o){return{$template:"#checkbox",id:"chk"+Fn++,label:t,checked:e,disabled:()=>null==o?void 0:o(),change:e=>{n&&n(e.target.checked)}}}function Hn(e,t,n,o){const r=e.split(".");let s=e.startsWith("state.")?$n:In;for(s==$n&&r.shift(),e=r.pop();r.length;)s=s[r.shift()];return Un((()=>s[e]),t,(t=>{s[e]=t,n&&n()}),o)}var Kn=0;var qn=document.createElement("canvas"),Gn=qn.getContext("2d"),Qn=new Map;function Yn(e,t){const n=e.set+e.size*t;return Qn.get(n)}async function Zn(e,t,n){const o=t.set+t.size*n;if(Qn.has(o))return Qn.get(o);const r=await async function(e,t,n){const{set:o,size:r}=t;e+="/x"+n;const[s,a]=await Promise.all([Vn("".concat(e,"/").concat(o).concat(r,".png")),Vn("".concat(e,"/symbol").concat(r,".png"))]);return qn.width=r*n*3,qn.height=r*n*12,Gn.drawImage(s,0,0),Gn.drawImage(a,0,r*n*6),qn.toDataURL()}(e,t,n),s=await Vn(r);return Qn.set(o,s),s}function Vn(e){return new Promise(((t,n)=>{const o=new Image;o.onload=()=>t(o),o.onerror=n,o.src=e}))}var Jn=["k","q","b","n","r","p","c","x","s","t","a","d"],Xn=document.createElement("canvas"),eo=Xn.getContext("2d"),to=document.createElement("canvas"),no=to.getContext("2d"),oo={26:"YdVh1QDVYdVh",32:"AAAKAAAAo/+jAAr/AP8KAKP/owAAAAoAAA==",38:"AAw+DAAM3P/cDD7/AP8+DNz/3AwADD4MAA==",44:"AC9yLwAv+f/5L3L/AP9yL/n/+S8AL3IvAA==",52:"A3i2eAN4////eLb/AP+2eP///3gDeLZ4Aw==",64:"AAAEHgQAAAA/5v/mPwAE5v///+YEHv//AP//HgTm////5gQAP+b/5j8AAAAEHgQAAA==",76:"AARZhFkEAAS7////uwRZ//////9ZhP//AP//hFn//////1kEu////7sEAARZhFkEAA==",88:"AEfE68RHAEf8/////EfE///////E6///AP//68T//////8RH/P////xHAEfE68RHAA=="};function ro(e,t,n,o,r,s){const{w:a,h:i,border:c,offset:l,margin:u}=vt(n,s),f=Yn(n,o);e.canvas.width=a*o,e.canvas.height=i*o,e.save(),e.scale(o,o);const p="classic"==n.bg,h=r||p;e.translate(l.x,l.y);for(let r=0;r<n.h;r++)for(let s=0;s<n.w;s++)h||ao(e,r,s,n),so(e,f,r,s,t[r*n.w+s],n,o);if(e.restore(),p&&!r){!function(e,t,n){const o=e.canvas;to.width=Xn.width=o.width,to.height=Xn.height=o.height,eo.drawImage(o,0,0),e.save(),e.fillStyle="white",e.fillRect(0,0,o.width,o.height),e.globalCompositeOperation="destination-in",e.drawImage(Xn,0,0),e.restore(),e.save();const r=function(e){if("string"==typeof oo[e]){const t=atob(oo[e]),n=[];for(let e=0;e<t.length;e++)n.push(t.charCodeAt(e));oo[e]=n}return oo[e]}(t*n),s=Math.sqrt(r.length),a=(s-1)/2;for(let t=0;t<s;t++)for(let n=0;n<s;n++){const i=r[n*s+t];0!=i&&(e.globalAlpha=i/255,no.drawImage(o,t-a,n-a))}e.restore()}(e,n.size,o),e.save(),e.scale(o,o),e.translate(l.x,l.y);for(let t=0;t<n.h;t++)for(let o=0;o<n.w;o++)ao(e,t,o,n);e.restore(),e.drawImage(to,0,0),e.drawImage(to,0,0),e.drawImage(to,0,0),e.drawImage(Xn,0,0)}e.scale(o,o),void 0===s&&n.coordinates&&(e.save(),e.translate(l.x,l.y),function(e,t,n){const{size:o,w:r,h:s}=t;e.font="15px sans-serif",e.strokeStyle="black",e.lineWidth=2,e.fillStyle="white",e.lineJoin="round";for(let t=0;t<s;t++){const r=(t+1).toString(),a=e.measureText(r),i=o*(s-t)-(o-10)/2,c=(yt-a.width)/2-yt-n;e.strokeText(r,c,i),e.fillText(r,c,i)}for(let t=0;t<r&&t<26;t++){const r=String.fromCharCode(97+t),a=e.measureText(r),i=o*s+yt+n-5,c=o*t+(o-a.width)/2;e.strokeText(r,c,i),e.fillText(r,c,i)}}(e,n,c.size),e.restore()),r||function(e,t,n,o,r){e.save(),e.translate(r.x,0),n-=r.x,o-=r.y;let s=0;for(let r=0;r<t.array.length;r++){const a=t.array[r];if(e.strokeStyle=r%2?"white":"black",0==a)continue;e.lineWidth=a;const i=t.size-s-a/2;e.strokeRect(i,i,n-2*i,o-2*i),s+=a}e.restore()}(e,c,a,i,u)}function so(e,t,n,o,r,s,a){void 0===r&&(r="");const{size:i}=s,c=r&&r.startsWith("-");c&&(r=r.substring(1));const l=r.match(/^\*(\d)/);let u=l&&l[1]||void 0;void 0!==u&&(r=r.substring(2)),u=Number(u)%4,s.SN&&(r=Zt(r,!1,!0));const f=r.toLowerCase(),p=Jn.indexOf(f),h=r.startsWith("'");if(p<0&&!h)return;e.save();const d=s.blackWhite,g=c?d?0:2:r==f?0:1,m=c&&d?"n"==f?s.knightOffset:.5:1,[y,v]=[u+1&2?1:0,2&u?1:0];if(e.translate((o+y)*i,(n+v)*i),0!==u&&e.rotate(Math.PI/2*u),h){!function(e,t,n){e.save();const o=Ft.test(t),r=n-4;e.font="".concat(r,"px sans-serif");const s=n-2;let a=e.measureText(t);if(o&&a.width>s){const n=s/a.width;e.font="".concat(r*n,"px sans-serif"),a=e.measureText(t)}const i=function(e){return e.actualBoundingBoxAscent-e.actualBoundingBoxDescent}(o?e.measureText("M"):a),c=(n-Math.min(a.width,s))/2,l=Math.max((n-i)/2,0);e.fillStyle="black",e.fillText(t,c,n-l,s),e.restore()}(e,r.substring(r.startsWith("''")?2:1),i)}else e.drawImage(t,g*i*a,p*i*a,i*m*a,i*a,0,0,i*m,i),c&&d&&e.drawImage(t,(1+m)*i*a,p*i*a,i*(1-m)*a,i*a,i*m,0,i*(1-m),i);e.restore()}function ao(e,t,n,o){const r=function(e,t,n){if("mono"==e)return 1;let o=(t+n)%2;return"inverted"!=e&&(o=1-o),o}(o.pattern,t,n),s=o.size;if(e.save(),e.translate(n*s,t*s),"classic"==o.bg){if(e.strokeStyle="black",e.lineWidth=s/60,e.fillStyle="#fff",e.fillRect(0,0,s,s),!r){e.beginPath();const t=s/7.5;for(let n=0;n<s;n+=t)e.moveTo(s-n,0),e.lineTo(0,s-n),n>0&&(e.moveTo(n,s),e.lineTo(s,n));e.stroke()}}else e.fillStyle=function(e,t){return"classic"==t?"none":"gray"==t?e?"#fff":"#bbb":"green"==t?e?"#EEEED2":"#769656":e?"#FFCE9E":"#D18B47"}(r,o.bg),e.fillRect(0,0,s,s);e.restore()}var io,co={};function lo(e,t,n,o){return uo(),(io=new fo(e,t,n,o)).promise}function uo(e){io&&io.stop(e?co.callback:void 0)}var fo=class{constructor(e,t,n,o){var r;this.after=o?e:t,this.reverse=o,this.promise=new Promise((e=>this.resolve=e)),this.cursor=-1,this.stages=[];const s=n.split(","),a=qt(e),{h:i,w:c}=co.options;for(const e of s){const t=[],n=e.match(/[`a-z]\d(=(\*\d)?[A-Z])?/g);for(let e=0;e<n.length;e+=2){let o=n[e],s=n[e+1];const l=Xt(o,c,i),u={p:a[l],promo:null==(r=s.match(/=(.+)$/))?void 0:r[1],from:Jt(o,i),to:Jt(s,i)};a[l]="",t.push(u)}this.stages.push({board:a.concat(),moves:t});for(const e of t)a[e.to.y*c+e.to.x]=e.promo||e.p}this.background=void 0,this.anime=this.step.bind(this),this.request=requestAnimationFrame(this.anime)}stop(e){cancelAnimationFrame(this.request),io=void 0,e&&e(this.after),this.resolve()}step(e){const{ctx:t,options:n,callback:o}=co;this.startTime||(this.startTime=e);const r=(e-this.startTime)/150,s=Math.floor(r);if(s>=this.stages.length)return this.stop(o);const a=this.reverse?this.stages.length-1-s:s;s>this.cursor?(this.cursor=s,ro(t,this.stages[a].board,n,Ct),this.background=t.getImageData(0,0,t.canvas.width,t.canvas.height)):t.putImageData(this.background,0,0);const i=vt(n);t.save(),t.translate(i.offset.x,i.offset.y);const c=Yn(n,Ct);let l=r-Math.floor(r);this.reverse&&(l=1-l);for(const e of this.stages[a].moves){const o=e.from.x*(1-l)+e.to.x*l;so(t,c,e.from.y*(1-l)+e.to.y*l,o,e.p,n,Ct)}t.restore(),this.request=requestAnimationFrame(this.anime)}},po="k,K,-k,q,Q,-q,b,B,-b,n,N,-n,r,R,-r,p,P,-p,c,C,-c,x,X,-x".split(","),ho="k,q,b,n,r,p,c,x,K,Q,B,N,R,P,C,X,-k,-q,-b,-n,-r,-p,-c,-x".split(",");function go(){return In.board.exHigh?2:1}async function mo(){Ln.loading=!0;const e=[Zn("assets",In.board,Ct)],t=go();Ct!=t&&e.push(Zn("assets",In.board,t)),await Promise.all(e),Ln.loading=!1}var yo=bt.getContext("2d"),vo=kt.getContext("2d"),bo=xt.getContext("2d"),wo=Et.getContext("2d"),xo=document.createElement("canvas"),ko=xo.getContext("2d"),Eo={except:void 0,data:void 0};function Ao(e){e?Eo.except=e:e=Eo.except;const t=Object.assign({},In.board,Ln.hor?{w:8,h:3}:{w:3,h:8}),n=function(){let e=Ln.hor?ho:po;$n.play.playing&&"retro"==$n.play.mode&&(e=e.concat(),Ln.hor?(e[6]="p",e[14]="P"):(e[18]="p",e[19]="P"));return e}();ro(bo,n,t,Ct,!1,Ln.hor);const{size:o}=In.board;if(Dn()){const t="retro"==$n.play.mode;bo.save();const{offset:n}=vt(In.board,Ln.hor);bo.translate(n.x,n.y),t&&(bo.save(),bo.font="".concat(o/2,"px sans-serif"),bo.strokeStyle="black",bo.lineWidth=o/12,bo.fillStyle="white",bo.lineJoin="round",So(1,7),So(2,7),bo.restore()),bo.save(),bo.globalAlpha=Ln.isDark?.5:.4,bo.fillStyle="black";for(let t=0;t<3;t++)for(let n=0;n<8;n++){if(null==e?void 0:e.includes(3*n+t))continue;const[r,s]=Ln.hor?[n,t]:[t,n];bo.fillRect(r*o,s*o,o,o)}if(bo.restore(),t){bo.save();const t=$n.play.retro,n=3==e[0]?0:1;bo.lineWidth=o/12,bo.strokeStyle="#0d6efd",t.uncapture&&No(n,Jn.indexOf(t.uncapture)),t.unpromote&&No(1-n,5),bo.restore()}bo.restore()}else if(ro(wo,n,t,Ct,!0,Ln.hor),Ln.selection){bo.save();const{offset:e}=vt(In.board,Ln.hor);bo.lineWidth=o/12,bo.strokeStyle="#0d6efd",bo.translate(e.x,e.y);const t=po.indexOf(Ln.selection),n=t%3;No(n,(t-n)/3),bo.restore()}}function So(e,t){const{size:n}=In.board,o=n/15;Ln.hor&&([e,t]=[t,e]);const r=bo.measureText("ep"),s=r.width,a=r.actualBoundingBoxDescent;bo.strokeText("ep",e*n-s-o,t*n-a-o),bo.fillText("ep",e*n-s-o,t*n-a-o)}function No(e,t){const{size:n}=In.board,o=n/8;Ln.hor&&([e,t]=[t,e]);const r=.5,s=(...s)=>{bo.moveTo(e*n+o*(s[0][0]+r),t*n+o*(s[0][1]+r));for(let a=1;a<s.length;a++)bo.lineTo(e*n+o*(s[a][0]+r),t*n+o*(s[a][1]+r))};bo.beginPath(),s([0,2],[0,0],[2,0]),s([5,0],[7,0],[7,2]),s([7,5],[7,7],[5,7]),s([0,5],[0,7],[2,7]),bo.stroke()}async function Ro(e){e?Eo.data=e:e=Eo.data||nr();const t=In.board;if(ro(yo,e,t,Ct),ro(ko,e,t,go()),function(e){let t=0,n=0,o=0,r=0;for(const s of e)""!=s&&(s.startsWith("'")?r++:s.startsWith("-")?o++:s==s.toUpperCase()?t++:n++);Ln.pieceCount="(".concat(t,"+").concat(n).concat(o>0?"+"+o:"").concat(r>0?"+"+r:"",")")}(e),Ln.dragging||(ro(vo,e,t,Ct,!0),tr()),location.protocol.startsWith("http")){const e=document.getElementById("Save");e.href&&URL.revokeObjectURL(e.href),Nt.src=e.href=URL.createObjectURL(await Co())}}function Po(e){const{w:t,h:n}=In.board;ro(e,en(t*n),In.board,Ct)}function Co(){return new Promise((e=>xo.toBlob(e)))}co.ctx=yo,addEventListener("storage",(e=>{if(e.storageArea==localStorage&&"settings"==e.key){const e=JSON.parse(localStorage.getItem("settings"));Bt(In,e,!0),To({},!0)}}));var Oo=document.getElementById("Zone"),_o=document.getElementById("DragZone"),Bo=document.getElementById("EditZone");function Io(){return document.body.clientWidth/($n.split?2:1)}async function To(e,t){const n=In.board,o={};for(const t in n)o[t]=void 0!==e[t]&&e[t]!==n[t],o[t]?n[t]=e[t]:e[t]=n[t];const{border:r,margin:s,w:a,h:i}=vt(e),c=jo(),l=Io()<(e.w+3)*e.size+s.x+4*r.size+4.2*c;o.mode=l!==Ln.hor,Ln.hor=l;const u=o.w||o.h;(u||t)&&function(){const{w:e,h:t}=In.board,n=e*t;Ho.style.gridTemplateColumns="repeat(".concat(e,", 1fr)"),Ho.style.gridTemplateRows="repeat(".concat(t,", 1fr)");for(let e=0;e<n||e<Uo.length;e++){if(!Uo[e]){const t=document.createElement("input");Uo[e]=t,t.type="text",t.oninput=Zo,t.onchange=Yo,t.onfocus=Go,t.onblur=Qo,t.classList.add("square"),Ho.appendChild(t)}Uo[e].style.display=e<n?"block":"none"}}();const f=t||o.set||o.size,p=f||o.border,h=p||u,d=p||o.mode;if(d){let t=(3*e.size+2*r.size)*Ct,n=(8*e.size+2*r.size)*Ct;Ln.hor?([t,n]=[n+s.x*Ct,t],bt.parentNode.classList.add("mb-3"),xt.classList.remove("ms-4")):(n+=s.y*Ct,bt.parentNode.classList.remove("mb-3"),xt.classList.add("ms-4")),xt.width===t&&xt.height===n||(Et.width=xt.width=t,Et.height=xt.height=n)}if(h){const e=a*Ct,t=i*Ct;bt.width===e&&bt.height===t||(wt.width=kt.width=bt.width=e,wt.height=kt.height=bt.height=t),Po(wt.getContext("2d"))}Mo(),f&&await mo(),h&&Ro(),d&&Ao(),be(Mo)}function Lo(e){const{w:t,h:n}=In.board,o=nr();To(e),function(e,t,n){const{w:o,h:r}=In.board;for(let s=0;s<r;s++)for(let r=0;r<o;r++){const a=Uo[s*o+r];a.value=s<n&&r<t?e[s*t+r]:""}rr()}(o,t,n)}function Mo(){Oo.style.maxWidth="calc(".concat(Io(),"px + 1rem)"),bt.style.width=bt.width/Ct+"px",xt.style.width=xt.width/Ct+"px";const{w:e}=In.board,t=Wn(void 0,void 0,8);if(Ln.hor)if(e>8)xt.style.width=t.width+"px";else if(e<8){const{width:t}=Wn(xt,!0,e);bt.style.width=t+"px"}Ho.style.borderWidth="".concat(t.offset.y,"px ").concat(t.offset.r,"px ").concat(t.offset.b,"px ").concat(t.offset.x,"px");const n=jo();In.board.collapse?(Oo.style.width="120%",Oo.style.width=_o.clientWidth+4*n+"px"):Oo.style.width="unset",kt.style.width=bt.clientWidth+"px",kt.style.height=bt.clientHeight+"px",Et.style.width=xt.clientWidth+"px",Et.style.height=xt.clientHeight+"px",function(e){Ho.style.width=CN.clientWidth+"px",Ho.style.height=CN.clientHeight+"px";for(const t of Uo)t.style.fontSize=e-10+"px",t.style.lineHeight=e-10+"px"}(t.s),Oo.clientWidth<_o.clientWidth+bt.clientWidth+6*n?(Bo.style.marginTop=-_o.clientHeight+"px",Bo.style.width=_o.clientWidth+"px",Bo.style.textAlign=Ln.hor?"center":"start",Oo.classList.add("collapse"),Ln.collapse=!0):(Bo.style.marginTop="0",Bo.style.width="unset",Bo.style.textAlign="unset",Oo.classList.remove("collapse"),Ln.collapse=!1)}function jo(){return parseFloat(getComputedStyle(document.documentElement).fontSize)}if(_t.isTop)window.resizeIframe=function(){const e=document.getElementsByTagName("iframe")[0];e&&(e.style.minHeight=e.contentDocument.body.scrollHeight+"px")};else{if("undefined"!=typeof ResizeObserver){new ResizeObserver((e=>parent.resizeIframe())).observe(document.body)}else{new MutationObserver((e=>parent.resizeIframe())).observe(document.body,{childList:!0})}parent.resizeIframe()}var zo={setOption:To,setDimension:Lo,setBorder(e){const t=mt(e.value);t?(e.value=t,To({border:t})):e.value=In.board.border},get height(){return In.board.h},set height(e){Lo({h:e})},get width(){return In.board.w},set width(e){Lo({w:e})}};async function $o(){if(_t.canPaste)return await navigator.clipboard.readText();throw alert('Pasting text is not enabled in your browser.\nIf you\'re using Firefox on desktops or Firefox Nightly on Android, this can be enabled by the following.\n1. Visit "about:config" in your address bar.\n2. Search for "dom.events.asyncClipboard.readText".\n3. Toggle its value to true.\n4. Reload this tool.'),!0}window.Layout=zo;var Wo,Do,Fo,Uo=new Array(64),Ho=document.getElementById("Squares"),Ko={};function qo(e){var t;null==(t=Ko.draw)||t.call(Ko,e)}function Go(){if(this.style.zIndex="10",Ln.collapse){const e=nr();e[Uo.indexOf(this)]="",qo(e)}this.select()}function Qo(){this.style.zIndex="unset",Vo(this)?rr():Ln.collapse&&qo(nr())}function Yo(){Vo(this),Ln.collapse&&this.blur(),rr()}function Zo(){if(!Ln.collapse){const e=nr();e[Uo.indexOf(this)]=Qt(this.value,In.board.SN),qo(e)}}function Vo(e,t){let n=Qt(e.value,In.board.SN,t);const o=n!==e.value;return e.value=n,o}function Jo(e,t){const n=e.value!==t;e.value=t,Vo(e),n&&rr()}function Xo(e,t){const n=er(e);At.value=n[0]+(In.board.fullFEN?ir():""),cr(t)}function er(e){const t=e.split(" ");if(t[1]&&t[1].match(/^[wb]$/)&&($n.play.turn=t[1]),t[2]&&t[2].match(/^(-|[kq]+)$/i))for(const e in $n.play.castle)$n.play.castle[e]=t[2].includes(e);return t[3]&&t[3].match(/^[a-h][36]$/)&&($n.play.enPassant=t[3]),t[4]&&t[4].match(/^\d+$/)&&($n.play.halfMove=Number(t[4])),t[5]&&t[5].match(/^\d+$/)&&($n.play.fullMove=Number(t[5])),t}function tr(){const e=new URL(location.href).searchParams.get("fen")||Mt,t=At.value.split(" ")[0],n=t==Mt?"":"?fen="+encodeURIComponent(t);t!==e&&history.pushState(null,"",n||".")}function nr(){return Uo.map((e=>e.value))}function or(){return nr().map((e=>Zt(e,!1,!0)))}function rr(){qo(sr())}function sr(){const{w:e,h:t,fullFEN:n}=In.board,o=nr();return At.value=Gt(o,e,t)+(n?ir():""),o}function ar(){const e=function(){const{w:e,h:t}=In.board;if(8!=e||8!=t)return null;const n=or();for(const e of n)if(""!=e&&!e.match(/^[kqbsnrp]$/i))return null;return Gt(n,8,8)}();return e?e+ir(!0):null}function ir(e){const t=$n.play;t.enPassant.match(/^[a-h][36]$/)||(t.enPassant=""),e&&t.pass&&t.enPassant&&"3"==t.enPassant[1]!=("b"==t.turn)&&(t.turn="b"==t.turn?"w":"b");const n="retro"==t.mode;e&&((n||!Number.isSafeInteger(t.halfMove)||t.halfMove<0)&&(t.halfMove=0),(n||!Number.isSafeInteger(t.fullMove)||t.fullMove<1)&&(t.fullMove=1));const o=n?"-":function(e){const t=nr();let n="";const o=$n.play.castle;e?("K"==t[60]&&(o.K&&"R"==t[63]&&(n+="K"),o.Q&&"R"==t[56]&&(n+="Q")),"k"==t[4]&&(o.k&&"r"==t[7]&&(n+="k"),o.q&&"r"==t[0]&&(n+="q"))):(o.K&&(n+="K"),o.Q&&(n+="Q"),o.k&&(n+="k"),o.q&&(n+="q"));return""==n?"-":n}(e),r=n?"-":t.enPassant||"-";return" ".concat(t.turn," ").concat(o," ").concat(r," ").concat(t.halfMove," ").concat(t.fullMove)}function cr(e){lr(At.value);const t=Kt(At.value),{w:n,h:o}=t||In.board,r=qt(At.value,n,o);To({w:n,h:o});let s=!1;for(let e=0;e<n*o;e++)Uo[e].value=r[e],s=Vo(Uo[e])||s;s||e||!t?rr():qo(nr())}function lr(e){const t=$n.play,n=e.split(" ");if(1!=n.length){if("w"!=n[1]&&"b"!=n[1]||(t.turn=n[1]),n[2]){const e=["K","Q","k","q"];for(const o of e)t.castle[o]=n[2].includes(o)}t.enPassant=n[3]&&"-"!=n[3]?n[3]:"","retro"!=t.mode&&(t.halfMove=Number(n[4]||0),t.fullMove=Number(n[5]||1))}}function ur(e){for(const t of Uo)t.readOnly=e}function fr(e){if(e.anime){const t=Gt(e,In.board.w,In.board.h);lo(At.value,t,e.anime)}else e.forEach(((e,t)=>Uo[t].value=e)),rr()}function pr(){Object.assign($n.play,{turn:"w",enPassant:"",halfMove:0,fullMove:1});const e=["K","Q","k","q"];for(const t of e)$n.play.castle[t]=!0}if(co.options=In.board,co.callback=Xo,addEventListener("popstate",(async function(){if($n.play.playing)return;const e=new URL(location.href).searchParams.get("fen");e&&Xo(e,!0)})),window.FEN={update:()=>{er(At.value),cr(!0)},empty(){for(const e of Uo)e.value="";rr()},reset(){To({w:8,h:8}),In.board.fullFEN&&pr(),Xo(jt)},copy(){gtag("event","fen_copy"),navigator.clipboard.writeText(At.value)},async paste(){gtag("event","fen_paste"),Xo(await $o(),!0)},rotate(e){uo(!0);const{w:t,h:n}=In.board;t!==n&&To({w:n,h:t}),fr(on(nr(),e,t,n))},color(e){for(const t of Uo){let n=t.value;n.startsWith("'")||""==n||(n.startsWith("-")&&(n=n.substr(1)),n=n.toLowerCase(),0==e&&(n="-"+n),1==e&&(n=n.toUpperCase()),t.value=n)}rr()},fixSN(){gtag("event","fen_fix_sn");for(const e of Uo){let t=e.value;t.startsWith("'")||""==t||(e.value=t.replace("s","n").replace("S","N"))}rr()},invert(e){fr(rn(nr(),e))},shift(e,t){uo(!0);const{w:n,h:o}=In.board;fr(tn(nr(),e,t,n,o))},mirror(e){uo(!0);const{w:t,h:n}=In.board;fr(nn(nr(),e,t,n))}},$n.play.playing){const e=$n.play;e.playing=!1,Promise.all([mo(),Nr()]).then((()=>{Rr(),Tr.goto(e.history[e.moveNumber])}))}var hr="normal",dr="pass",gr="retro",mr=[4,7,10,13],yr=[3,6,9,12],vr=yr.concat(15,16,18),br=mr.concat(15,16,19);function wr(e){const t=$n.play;let n=t.moveNumber;n+=e,n<-1&&(n=-1),n>t.history.length-1&&(n=t.history.length-1),n!=t.moveNumber&&xr(n)}function xr(e){const t=$n.play,n=t.moveNumber,o=e>=0||0==n;if(Tr.goto(t.history[e],o),o){const o=e==n-1,r=t.history[o?n:e];let s=r.from+r.to;"k"!=r.flags&&"q"!=r.flags||(s+=","+Er(r)),lo(r.before,r.after,s,o!=($n.play.mode==gr))}}function kr(e,t,n){if(e=Vt(e),t=Vt(t),$n.play.mode==gr){const n=Do.retract({from:e,to:t,...$n.play.retro});return n&&(Pr(),Cr()),n}{const o=Do.move({from:e,to:t,promotion:n});return!!o&&("k"!=o.flags&&"q"!=o.flags||function(e){const t=qt(e.before),n="w"==e.color;return t[Xt(e.from)]="",t[Xt(e.to)]=n?"K":"k",{before:Gt(t),after:e.after,move:Er(e)}}(o))}}function Er(e){const t="w"==e.color,n="k"==e.flags,o=t?1:8;return(n?"h":"a")+o+(n?"f":"d")+o}function Ar(){Xo(Do.fen())}function Sr(e){return Do.get(Vt(e)).color}async function Nr(){return Wo||((Wo=await import("./modules/chess.js")).Chess.options=In.PLAY,Do=new Wo.Chess($n.play)),Wo}function Rr(){Object.assign($n.play,{playing:!0,pendingPromotion:!1}),ur(!0),$n.play.mode==gr?(Pr(),Cr()):Ao([])}function Pr(){$n.play.retro={uncapture:null,unpromote:!1,ep:!1}}function Cr(){Ao("b"==Do.turn()?vr:br)}function Or(e,t){if(2==e)return;const n=$n.play.retro;var o;0==e==("b"==Do.turn())?(0<t&&t<7&&(o=Jn[t],n.uncapture=n.uncapture==o?null:o),5!=t&&6!=t||(n.unpromote=!1)):5==t&&(n.unpromote=!n.unpromote,"p"!=n.uncapture&&"c"!=n.uncapture||(n.uncapture=null)),Cr()}async function _r(e){await Nr(),Do.loadGame(e)&&(Ar(),Rr())}var Br,Ir,Tr={async start(){gtag("event","fen_play_"+$n.play.mode);try{const e=ar();if(!e)throw"Only orthodox chess is supported.";await Nr(),Do.init(e),$n.play.over=Do.overState(),Rr()}catch(e){alert(e instanceof Error?e.message:e)}},exit(){$n.play.playing=!1,$n.play.game="",Xo($n.play.initFEN),lr($n.play.initFEN),ur(!1),Ao([])},goto(e,t){$n.play.pendingPromotion&&($n.play.pendingPromotion=!1,Ao([]));const n=Do.goto(e);t||(uo(),Xo(n)),$n.play.mode==gr&&(Pr(),Cr())},move(e){e!=$n.play.moveNumber&&xr(e)},moveBy(e){wr(e)},reset(){pr()},copyGame:()=>Do.copyGame(),copyPGN:()=>Do.copyPGN(),number:e=>Wo.number(e,$n.play.mode),format:e=>Wo.format(e,$n.play.mode),async pasteMoves(){const e=await $o();Do.addMoves(Wo.parseMoves(e)),Ar()},async pasteGame(){const e=await $o();await _r(e)}},Lr=new RegExp(String.raw(Br||(Br=o(["^+(?<c>[nwb])(?<is>",")(?<at>",")(=(?<p>","))?$"],["^\\+(?<c>[nwb])(?<is>",")(?<at>",")(=(?<p>","))?$"])),dn,hn,dn)),Mr=new RegExp(String.raw(Ir||(Ir=o(["^-([nwb]",")?(?<at>",")$"])),dn,hn)),jr=new RegExp("^(?<c>[nwb])".concat(dn,"(?<from>").concat(hn,")-&gt;(?<to>").concat(hn,")(=(?<p>").concat(dn,"))?$")),zr=new RegExp("^".concat(dn,"(?<from>").concat(hn,")&lt;-&gt;").concat(dn,"(?<to>").concat(hn,")$")),$r=new RegExp("^(?<at>".concat(hn,")=(?<c>[nwb])?(?:r?(?<p>").concat(dn,"))?$")),Wr=new RegExp("^I".concat(hn,"(,").concat(hn,")*$"));function Dr(e,t,n){var o,r,s,a,i;let c=null==(o=t.match(Lr))?void 0:o.groups;if(c)return An(e,c.at,c.p||c.is,c.c);if(c=null==(r=t.match(Mr))?void 0:r.groups,c)return An(e,c.at,"");if(c=null==(s=t.match(jr))?void 0:s.groups,c)return Sn(e,c.from,c.to),void(c.p&&An(e,c.to,c.p,c.c));if(c=null==(a=t.match(zr))?void 0:a.groups,c)return function(e,t,n){t=Xt(t),n=Xt(n);const o=e[n];e[n]=e[t],e[t]=o}(e,c.from,c.to);if(c=null==(i=t.match($r))?void 0:i.groups,c)return An(e,c.at,c.p||function(e,t){const n=e[Xt(t)];return n.match(new RegExp(dn,"i"))[0].toUpperCase()}(e,c.at),c.c||function(e,t){const n=e[Xt(t)];return dn.startsWith("-")?"n":n==n.toLowerCase()?"b":"w"}(e,c.at));if(c=t.match(Wr),c){n.push(...t.match(new RegExp(hn,"g")));for(const t of n)An(e,t,"I","n")}else;}var Fr=new RegExp(xn),Ur=new RegExp(En);function Hr(e,t,n,o,r){let s,a;if(n.move.startsWith("0-0")){const o="w"==t?"1":"8",i="0-0"==n.move?["g","h","f"]:["c","a","d"];Sn(e,"e"+o,i[0]+o,r),a=Sn(e,i[1]+o,s=i[2]+o,r)}else if(a=Sn(e,n.from,s=n.to,r),n.ep&&An(e,n.to.replace("3","4").replace("6","5"),""),n.then){let t=n.to,o=n.then.match(new RegExp("".concat(vn,"|").concat(hn),"g"));for(const n of o){const o=n.match(new RegExp(vn));if(o){const n=An(e,t,o.groups.p,o.groups.pc);r&&(r[r.length-1]+="="+n)}else Sn(e,t,n,r),t=n}}"I"==n.p?(o.push(s),An(e,s,"I","n")):n.p&&An(e,s,a=n.p,n.pc?n.pc:t),n.cc&&An(e,s,a,n.cc)}var Kr=new RegExp("^[nwb]".concat(dn,"(").concat(hn,")--&gt;(").concat(hn,")$")),qr=new RegExp("^[nwb]".concat(dn,"(").concat(hn,")&lt;--&gt;[nwb]").concat(dn,"(").concat(hn,")$")),Gr=new RegExp("^([+-]?)([nwb])(".concat(dn,")(").concat(hn,")$")),Qr=new RegExp("^(".concat(dn,")==&gt;(").concat(dn,")$")),Yr=new RegExp("^mirror(".concat(hn,")&lt;--&gt;(").concat(hn,")$")),Zr=new RegExp("^shift(".concat(hn,")==&gt;(").concat(hn,")$")),Vr=/^rotate(90|180|270)$/;function Jr(e,t){let n=t.match(Kr);if(n)return Sn(e,n[1],n[2]);if(n=t.match(qr),n)return exchange(e,n[1],n[2]);if(n=t.match(Gr),n)"+"==n[1]||""==n[1]?An(e,n[4],n[3],n[2]):An(e,n[4],"");else{if(n=t.match(Yr),n){let t;const o=Jt(n[1]),r=Jt(n[2]);return t=o.x==r.x?"|":o.y==r.y?"-":(o.x-r.x)*(o.y-r.y)>0?"\\":"/",void Xr(e,nn(e,t))}if(n=t.match(Zr),!n){if(n=t.match(Qr),n){const t=Cn(n[1]),o=t.toLowerCase(),r=Cn(n[2]),s=r.toLowerCase();for(let n=0;n<e.length;n++)e[n]==t&&(e[n]=r),e[n]==o&&(e[n]=s),e[n]=="-"+o&&(e[n]="-"+s)}return n=t.match(Vr),n?Xr(e,on(e,"90"==n[1]?-1:"180"==n[1]?2:1)):"PolishType"==t?Xr(e,rn(e)):void 0}{const t=Jt(n[1]),o=Jt(n[2]);Xr(e,tn(e,o.x-t.x,o.y-t.y))}}}function Xr(e,t){e.length=0,e.push(...t)}var es,ts,ns=new RegExp(mn),os=new RegExp(String.raw(es||(es=o(["\n\n+|(?:",")|(?:",")"],["\\n\\n+|(?:",")|(?:",")"])),mn,En),"g");function rs(e,t,n){return function(e,t,n,o){var r;if(!t)return n;console.log(n);const s=function(e){var t;const n=e.replace(/\n/g," ").replace(wn,"\n$&").split("\n"),o=n.filter((e=>e.match(sn("2option","^")))).join(" "),r=n.filter((e=>e.match(an("condition")))).join(" ");return{imitators:null==(t=r.match(ls))?void 0:t.join(" ").match(new RegExp(hn,"g")),duplex:us.test(o),halfDuplex:fs.test(o)}}(e);let a=0;const i=function(e){return e.split(sn("2twin","\\b","\\b")).map((e=>{var t;return null==(t=e.match(as))?void 0:t[1].replace(/\s/g,"")}))}(e),c={pg:/dia/i.test(i[0]),fen:cs(gs(t),s.imitators),imitators:s.imitators,ordering:is(i[0],s.halfDuplex)};let l=c;const u={stack:[],board:qt(l.pg?jt:l.fen),ordering:l.ordering,imitators:null==(r=l.imitators)?void 0:r.concat()};let f=!1;n=n.replace(/<br>/g,"\n");const p=s.duplex?function(e){const t=/^\n\n+ +1\./,n=e.replace(/\n\nsolution finished./,"\n  1.").match(/\n\n+[^\n]+/g).filter(((e,n,o)=>n>0&&e.match(t)&&o[n-1].match(t))).map((e=>e.match(/^\n+/)[0].length));return"\n".repeat(Math.max(...n))}(n):"";let h=!1;return n=n.replace(os,(e=>{if(f)return e;try{if(e.match(/^\n+$/)){u.stack.length=0;const t=l.pg?jt:l.fen;return u.board=qt(t),e==p&&h&&(u.ordering=ps(u.ordering)),e}const t=e.match(ns);if(t){h=!1,l=Lt(t[1]?l:c);const n=i[++a];n&&(l.ordering=is(n,s.halfDuplex),l.pg=/dia/i.test(n)),u.ordering=l.ordering,u.stack.length=0;const{fen:o,board:r}=function(e,t){const n=qt(e),o=t.replace(/(mirror|shift|rotate) /g,"$1").replace(/ ==&gt; /g,"==&gt;").split(" ");for(const e of o)Jr(n,e);return{fen:Gt(n),board:n}}(l.fen,t[2]);return l.fen=o,u.board=l.pg?qt(jt):r,e}return h=!0,function(e,t,n,o){var r;const{stack:s,ordering:a}=n,i=e.match(Ur),c=i.groups.count,l=t.pg?jt:t.fen;let u=null;if(c){const e=s.findIndex((e=>e.move==c||parseInt(e.move)>parseInt(c)));e>=0&&(u=e>0?s[e-1].fen:l,n.board=qt(u),n.imitators&&(n.imitators=(e>0?s[e-1].imitators:t.imitators).concat()),s.length=e)}const f=a[!c||c.endsWith("...")?1:0],{imitators:p,board:h}=n,d=null==p?void 0:p.concat();if(p){for(const e of p)An(h,e,"");p.length=0}const g=[],m=i.groups.main.split("/");for(let e of m){const t=e.match(Fr);Hr(h,f,t.groups,p,g);const n=null==(r=e.match(/\[[^\[\]]+(?=\])/g))?void 0:r.map((e=>e.substring(1)));n&&n.forEach((e=>Dr(h,e,p)))}const y=Gt(h);if(c&&s.push({move:c,color:f,fen:y,imitators:null==p?void 0:p.concat()}),d)for(let e=0;e<g.length;e++){const[t,n]=g[e].match(/[a-z]\d/g).map((e=>Jt(e))),o=n.x-t.x,r=n.y-t.y;for(const t of d){const n=Jt(t);g[e]+=t+Vt(n.y+r,n.x+o)}}return(1==s.length&&c?o("*",l)+" ":"")+o(e,y,g,u)}(e,l,u,o)}catch(t){return console.log(t,e),f=!0,e}})),n.replace(/   ?<span init/g,"<span").replace(/\n/g,"<br>")}(e,t,n,hs)}var ss,as=new RegExp(String.raw(ts||(ts=o(["","s+(S*(?:d|[^ds]s+d+(?:.[05])?))"],["","\\s+(\\S*(?:\\d|[^\\d\\s]\\s+\\d+(?:\\.[05])?))"])),an("3stipulation")),"i");function is(e,t){var n;if(!e)return"wb";const o=e.match(/^(\d+-&gt;)?(?:exact-)?(?:(?:ser|pser|phser|semi|reci)-)?(hs|hr|h|s|r)?/i);let r;return r=!o||o[1]?"wb":"h"==(null==(n=o[2])?void 0:n.toLowerCase())?"bw":"wb",t?ps(r):r}function cs(e,t){if(!t)return e;const n=qt(e);for(const e of t)n[Xt(e)]="-"+Cn("i");return Gt(n)}var ls=new RegExp(String.raw(ss||(ss=o(["\bimitw*s+(?:",")+"],["\\bimit\\w*\\s+(?:",")+"])),hn),"ig"),us=sn("3duplex"),fs=sn("3halfDuplex");function ps(e){return"wb"==e?"bw":"wb"}function hs(e,t,n,o){const r="*"==e?"init ":"";t=t.replace(/-/g,"&#45;").replace(/"/g,"&#34;");let s="";return n&&n.length&&(s+=' data-anime="'.concat(n.join(","),'"')),o&&(s+=' data-before="'.concat(o,'"')),"<span ".concat(r,'class="step btn px-1 py-0" data-fen="').concat(t,'"').concat(s,">").concat(e,"</span>")}var ds=/[-+=]?(\.[0-9A-Z][0-9A-Z]|[A-Z])|\d+|\//gi;function gs(e){return e.match(ds).map((e=>{if("/"==e||e.match(/^\d+$/))return e;const t=e.match(/^[-+=]/)?e[0]:null;return t&&(e=e.substring(1)),e.startsWith(".")&&(e=e.substring(1)),e=Cn(e),"+"==t&&(e=e.toUpperCase()),"-"==t&&(e=e.toLowerCase()),"="==t&&(e="-"+e.toLowerCase()),e})).join("")}var ms,ys,vs,bs,ws=["1Black","1Neutral","1White"].map(an).join("|"),xs=["1Chameleon","2FrischAuf","2Functionary","2HalfNeutral","2HurdleColourChanging","1Jigger","1Kamikaze","1Magic","2Paralysing","2Protean","1Royal","1Uncapturable","1Volage"].map(an).join("|"),ks="(?<p>".concat(dn,")(?<sq>(?:").concat(hn,")+)"),Es=String.raw(ms||(ms=o(["s+(?<c>",")(?:s+(?:","))?(?<l>(?:s+",")+)"],["\\s+(?<c>",")(?:\\s+(?:","))?(?<l>(?:\\s+",")+)"])),ws,xs,ks),As=String.raw(ys||(ys=o(["","(?:",")+(?=s+(?:",")|$)"],["","(?:",")+(?=\\s+(?:",")|$)"])),an("2pieces"),Es,bn);function Ss(e,t){if(2==t.length&&(t="."+t),"n"==e)return"="+t;const n="w"==e;return t.match(/[A-Z]/)?n?t:t.toLowerCase():(n?"+":"-")+t}$n.popeye.running=!1,$n.popeye.editMap=!1,$n.popeye.playing&&mo().then((()=>be((()=>Zs(!0)))));var Ns,Rs,Ps,Cs="modules/py489.js",Os=!1,_s=document.getElementById("Output");function Bs(){$n.popeye.output=$n.popeye.intOutput+'<br><i class="fa-solid fa-spinner fa-spin"></i>',Is()}function Is(){Os&&(Os=!1,be((()=>_s.scrollTop=_s.scrollHeight-_s.clientHeight)))}function Ts(e){vs.terminate(),vs=void 0;const t=500-(performance.now()-Ns);Is(),clearInterval(Rs),e?Ms():($n.popeye.output=$n.popeye.intOutput,setTimeout((()=>$n.popeye.running=!1),Math.max(0,t)),Ls())}function Ls(){vs||((vs=new Worker(Cs)).onerror=t=>{let n;t.preventDefault(),clearInterval(Rs),$n.popeye.running=!1,t.filename?(vs.terminate(),n="An error occur in the Popeye module. Please submit an issue about this.\n"+e.message):n="Unable to load the Popeye module; please check your network connection.",$n.popeye.output=js(n),vs=void 0},vs.onmessage=e=>{const t=e.data;++Ps>3e3?($n.popeye.intOutput+="<br>".concat(js("Too much output. Please modify the input to prevent excessive output."),"<br>"),Ts()):-1===t?(gtag("event","fen_popeye_fallback"),Cs="modules/py489.asm.js",Ts(!0),$n.popeye.intOutput="Fallback to JS mode.<br>"):-2===t?Ts((bs/=2)>=4):null===t?Ts():(Os=Os||Boolean(_s)&&_s.scrollTop+_s.clientHeight+30>_s.scrollHeight,"string"==typeof t.text&&($n.popeye.intOutput+=zs(t.text)+"<br>"),"string"==typeof t.err&&($n.popeye.error=!0,$n.popeye.intOutput+=js(zs(t.err))))})}function Ms(){Ls(),spinner=".";const e=$n.popeye;Ps=0,e.intOutput="",e.error=!1,e.running=!0,Rs=setInterval(Bs,500),Ns=performance.now(),vs.postMessage({mem:bs,input:"Opti NoBoard\n"+e.intInput})}function js(e){return'<span class="text-danger">'.concat(e,"</span>")}function zs(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}var $s,Ws,Ds,Fs=new RegExp(String.raw($s||($s=o(["(?:",")s.+$"],["(?:",")\\s.+$"])),["remark","2author","2origin","3title"].map(an).join("|")),"igm"),Us=new RegExp(String.raw(Ws||(Ws=o(["","s+S+"],["","\\s+\\S+"])),an("5protocol")),"i"),Hs=sn("3beginProblem"),Ks=sn("3endProblem"),qs=/\bnext\s[\s\S]+$/i,Gs=an("3forsyth"),Qs=an("2pieces");function Ys(e){var t;e=e.replace(Fs,"").replace(Us,"").replace(Hs,"").replace(qs,"").replace(Ks,"");const n=$n.popeye;if(new RegExp("".concat(Gs,"|").concat(Qs),"i").test(e))return n.initFEN=function(e){const t=e.match(new RegExp(As,"ig"));if(!t)return null;const n=en(64);for(const e of t){const t=e.match(new RegExp(Es,"ig"));for(const e of t){const t=e.match(new RegExp(Es,"i")).groups,o=t.c[0].toLowerCase(),r=t.l.match(new RegExp(ks,"ig"));for(const e of r){const t=e.match(new RegExp(ks,"i")).groups,r=t.p.toUpperCase(),s=t.sq.match(new RegExp(hn,"g"));for(const e of s)n[Xt(e)]=Ss(o,r)}}}return Gt(n)}(e)||(null==(t=e.match(new RegExp(String.raw(Ds||(Ds=o(["","s+(S+)"],["","\\s+(\\S+)"])),Gs),"i")))?void 0:t[1]),n.initFEN&&Xo(gs(n.initFEN)),e;{const{fen:t,imitators:o}=function(){const{w:e,h:t}=In.board;if(8!=e||8!=t)return null;const n=[],o=nr().map(((e,t)=>{if(""==e)return e;let o=In.board.SN?e.replace("s","n").replace("S","N").replace("g","s").replace("G","S"):e;if(o=function(e){let t=e.startsWith("-")?"=":"";t&&(e=e.substring(1));const n=e.toUpperCase();if(n.match(/^[KQBNRP]$/))e=e.replace("n","s").replace("N","S");else{const o=n==e,r=Pn.custom();if(!(n in r))return null;const s=r[n];2==(e=o?s:s.toLowerCase()).length&&(e="."+e),s.match(/^\d+$/)&&!t&&(t=o?"+":"-")}return t+e}(o),!o)throw alert("Unspecified fairy piece: "+e);return o.match(/^=?i$/i)?(n.push(Vt(t)),""):o}));return{fen:Gt(o,8,8),imitators:n}}();return n.initFEN=t,o.length&&(e+="\ncond imitator "+o.join("")),"fors ".concat(n.initFEN,"\n").concat(e)}}async function Zs(e){const t=$n.popeye;t.steps=[..._s.querySelectorAll("span")],0!=t.steps.length&&(Vs(0,!0),t.playing=!0,e&&await mo(),Ao([]),be(Mo))}async function Vs(e,t){var n;const o=$n.popeye,r=o.steps[e],s=o.steps[o.index];if(s&&s.dataset.anime&&(e==o.index-1&&!s.dataset.before||r.dataset.fen==s.dataset.before))await lo(r.dataset.fen,s.dataset.fen,s.dataset.anime,!0);else{const t=r.dataset.before||(null==(n=o.steps[e-1])?void 0:n.dataset.fen);r.dataset.anime&&t?await lo(t,r.dataset.fen,r.dataset.anime):(uo(),Xo(r.dataset.fen))}t||s.classList.remove("active"),o.index=e,r.classList.add("active"),be((()=>function(e){const t=10,n=e.offsetTop-t;_s.scrollTop>n&&(_s.scrollTop=n);const o=e.offsetTop+e.clientHeight-_s.clientHeight+t;_s.scrollTop<o&&(_s.scrollTop=o);const r=e.offsetLeft-t;_s.scrollLeft>r&&(_s.scrollLeft=r);const s=e.offsetLeft+e.clientWidth-_s.clientWidth+t;_s.scrollLeft<s&&(_s.scrollLeft=s)}(r)))}var Js={run(){gtag("event","fen_popeye_run"),bs=512;try{const e=$n.popeye;e.intInput=Ys(e.input),Ms()}catch{}},cancel(){vs&&Ts()},play(){const e=$n.popeye;_s.scrollTop=_s.scrollLeft=0,gtag("event","fen_popeye_play"),e.output=rs(e.intInput,e.initFEN,e.intOutput),be(Zs)},step(e){const t=$n.popeye;if(!t.playing)return;const n=t.steps.indexOf(e.target);n>=0&&n!=t.index&&(e.preventDefault(),Vs(n))},exit(){const e=$n.popeye;Xo(e.steps[0].dataset.fen),e.output=e.intOutput,e.playing=!1,Ao([]),be(Mo)},moveBy(e){const t=$n.popeye;let n=t.index;n+=e,n<0&&(n=0),n>t.steps.length-1&&(n=t.steps.length-1),Js.move(n)},move(e){e!=$n.popeye.index&&Vs(e)},editMap(){gtag("event","fen_popeye_edit_map"),$n.popeye.mapping=Xs(In.popeye.pieceMap),$n.popeye.editMap=!0},resetMap(){$n.popeye.mapping=Xs(Nn)},saveMap(){const e=$n.popeye.mapping.toUpperCase().split("\n"),t={};for(const n of e){let[e,o]=n.replace(/\s/g,"").split("=");e.match(ua)&&o&&o.match(fa)&&(t[e]=o)}In.popeye.pieceMap=t,$n.popeye.editMap=!1}};function Xs(e){const t=[];for(const n in e)t.push("".concat(n,"=").concat(e[n]));return t.join("\n")}var ea,ta,na,oa,ra,sa,aa,ia,ca,la,ua=/^(\*[1-3][KQBNRP]|(\*[1-3])?[CXSTAD]|''..|'.)$/,fa=new RegExp("^".concat(dn,"$")),pa=0;function ha(e){Aa(e),"pending"==Ln.dragging&&function(e){const t=e.offsetX-ea,n=e.offsetY-ta;return Math.sqrt(t*t+n*n)}(e)>5&&(sa=NaN,ia?(la=_t.isTouch?[]:null,function(e,t){ga(),aa.style.display="block",t&&(ra.value="",rr());Ln.dragging=!0,ka(e)}(e,Boolean(ra))):Ln.dragging=!1),!0===Ln.dragging&&(la&&la.push({x:e.clientX,y:e.clientY}),ka(e))}function da(e,t){const{s:n,offset:o}=Wn(),r=t.getBoundingClientRect(),s=Math.floor((e.clientY-r.top-o.y)/n);return{x:Math.floor((e.clientX-r.left-o.x)/n),y:s}}function ga(){Ln.selection=null,Ao([])}function ma(e){if("pending"==Ln.dragging&&!$n.play.playing&&e.target==Nt){const t=performance.now();t-pa<300&&ra.focus(),pa=t,e.preventDefault(),Ln.dragging=!1}aa&&(aa.style.display="none"),Aa(e);if(performance.now()-sa<250){if(e.target==xt&&!Dn()){let{x:t,y:n}=da(e,xt);if(Ln.hor&&([t,n]=[n,t]),Ea(t,n,3,8)){const e=po[3*n+t];Ln.selection==e?Ln.selection=null:Ln.selection=e,Ao([])}else ga();return void(Ln.dragging=!1)}if(e.target==Nt&&$n.popeye.playing){const{x:t}=da(e,Nt);return t<3&&Js.moveBy(-1),void(t>4&&Js.moveBy(1))}}if($n.popeye.playing||!Ln.dragging)return;if(Ln.dragging=!1,!ia)return;const{w:t,h:n}=In.board,{x:o,y:r}=da(e,bt),s=r*t+o,a=Ea(o,r,t,n);if($n.play.playing){let e;if(a){if(function(e,t){const n=$n.play.mode;return n!=gr&&(n==dr&&Sr(e)!=Do.turn()&&Do.switchSide(),!!Do.checkPromotion(Vt(e),Vt(t))&&(Fo=t,$n.play.pendingPromotion=!0,Ao("b"==Do.turn()?yr:mr),!0))}(ca,s))return Jo(Uo[s],ia);ca!=s&&(e=kr(ca,s))}"object"==typeof e?lo(e.before,e.after,e.move):Ar()}else if(a){if(Jo(Uo[s],ia),la&&la.length>10){const e=function(e){let t=0,n=0;for(const o of e)t+=o.x,n+=o.y;return t/=e.length,n/=e.length,{x:t,y:n}}(la),t=function(e,t){let n=0;for(let o=0,r=t.length-1;o<t.length;r=o++){const s=t[o],a=t[r];a.y<=e.y?s.y>e.y&&ya(a,s,e)>0&&n++:s.y<=e.y&&ya(a,s,e)<0&&n--}return n}(e,la);wa(ra,t>0?1:3)}}else tr()}function ya(e,t,n){return(t.x-e.x)*(n.y-e.y)-(n.x-e.x)*(t.y-e.y)}var va=performance.now();function ba(e){if(Dn())return;const{w:t,h:n}=In.board,{offset:o,s:r}=Wn(),s=Math.floor((e.offsetX-o.x)/r),a=Math.floor((e.offsetY-o.y)/r);if(Ea(s,a,t,n)){const n=Uo[a*t+s];if(""==n.value)return;e.preventDefault();const o=performance.now();if(o-va<50)return;va=o,wa(n,e.deltaY>0?1:3)}}function wa(e,t){e.value=e.value.replace(/(^-?)(?:\*(\d))?([^-].*$)/,((e,n,o,r)=>{const s=(Number(o||0)+t)%4;return n+(s?"*"+s:"")+r})),rr()}function xa(e){if(sa=performance.now(),$n.popeye.playing)return;if(Ln.loading||0!=e.button&&!e.targetTouches||e.targetTouches&&e.targetTouches.length>1)return;Aa(e),document.activeElement&&document.activeElement.blur();const t=this!=xt,{offset:n,s:o}=t?Wn():Wn(xt,Ln.hor),{w:r,h:s}=In.board;ea=e.offsetX,ta=e.offsetY;const[a,i]=[n.x,n.y];na=Math.floor((ea-a)/o);const c=(oa=Math.floor((ta-i)/o))*(t?r:3)+na;aa=t?kt:Et;const l=Ln.selection;if(t&&l)if(e.preventDefault(),Ea(na,oa,r,s)){const e=Uo[c];e.value==l?e.value="":e.value=l,rr()}else ga();else{if($n.play.playing){if(!t&&$n.play.pendingPromotion){Ln.hor&&([na,oa]=[oa,na]);oa>0&&oa<5&&na==("p"==ia?0:1)&&(u=ca,f=Jn[oa],kr(u,Fo,f)?(Fo>>>3==0&&(f=f.toUpperCase()),Jo(Uo[Fo],f)):Ar(),$n.play.pendingPromotion=!1,Ao([]))}if(t||"retro"!=$n.play.mode||(e.preventDefault(),Ln.hor&&([na,oa]=[oa,na]),Or(na,oa)),!t||!function(e){const t=$n.play.mode;if($n.play.pendingPromotion)return!1;if(t!=gr&&Do.isGameOver())return!1;const n=Sr(e)==Do.turn();return t==dr||n==(t==hr)}(c))return}var u,f;t?(ca=c,ra=Uo[c],Ln.dragging="pending",ia=void 0):ra=void 0,t&&""==ra.value||(e.preventDefault(),aa.style.clip="rect(".concat(oa*o+i+1,"px,").concat((na+1)*o+a-1,"px,").concat((oa+1)*o+i-1,"px,").concat(na*o+a+1,"px)"),t?ia=ra.value:(ia=Ln.hor?po[3*na+oa]:po[c],Ln.dragging="pending"))}}function ka(e){const{offset:t,s:n}=Wn(),{w:o,h:r,coordinates:s}=In.board,a=bt.getBoundingClientRect(),i=aa==Et&&s&&!Ln.hor?a.left+yt:a.left,c=Math.floor((e.clientY-a.top-t.y)/n),l=Math.floor((e.clientX-a.left-t.x)/n);l===na&&c===oa||(la=null);const{scrollLeft:u,scrollTop:f}=document.documentElement;Ea(l,c,o,r)?(aa.style.left=i+(l-na)*n+u+"px",aa.style.top=a.top+(c-oa)*n+f+"px"):(aa.style.left=e.clientX+u+1-ea+"px",aa.style.top=e.clientY+f-ta+"px")}function Ea(e,t,n,o){return t>-1&&t<o&&e>-1&&e<n}function Aa(e){if(e.targetTouches){const t=e.target.getBoundingClientRect(),n=e.targetTouches[0]||e.changedTouches[0];e.clientX=n.clientX,e.clientY=n.clientY,e.offsetX=e.clientX-t.x,e.offsetY=e.clientY-t.y}}var Sa,Na=document.currentScript,Ra=new URL("api/",Na.src),Pa="img[fen]",Ca=document.createElement("iframe");function Oa(e){const t=new MessageChannel;t.port1.onmessage=t=>{e.src=t.data,e.title=Sa.getTitle(n,e.dataset)};const n=e.getAttribute("fen"),o=function(e){const t=Object.assign({},pt);if(e){const n=Number(e.size);dt.includes(n)&&(t.size=n),gt.includes(e.set)&&(t.set=e.set),e.border=mt(e.border),e.border&&(t.border=e.border),0<e.knightOffset&&e.knightOffset<1&&(t.knightOffset=e.offset),t.blackWhite=Boolean(e.blackWhite),t.pattern=e.pattern,t.bg=e.bg,t.SN=e.SN;const o=Math.floor(Number(e.w)),r=Math.floor(Number(e.h));o>0&&(t.w=o),r>0&&(t.h=r)}return t}(Object.assign({},Sa.getDefault(),e.dataset)),r=Kt(n);r&&Object.assign(o,r);const{w:s,h:a}=vt(o);e.width=s,e.height=a,Ca.contentWindow.postMessage({fen:n,options:o},"*",[t.port2])}function _a(e){e instanceof Element&&(e.matches(Pa)?Oa(e):e.querySelectorAll(Pa).forEach((e=>Oa(e))))}Ca.style.display="none";var Ba={add(){In.project.push({fen:At.value})},remove(e){In.project.splice(e,1)}},Ia={copyFEN(){gtag("event","fen_yacpdb_copyFEN");const{w:e,h:t}=In.board;return Gt(Uo.map((e=>Yt(e.value))),e,t)},async fetch(e){try{gtag("event","fen_yacpdb_get"),e.disabled=!0,e.value="Fetching...";const t="https://yacpdb.org/gateway/ql?q="+encodeURIComponent("Id('".concat(St.value,"')")),n=await fetch("https://corsproxy.io/?"+encodeURIComponent(t)),o=await n.json();if(o.success){let e=function(e){const o=e.charCodeAt(1)-97,r=Number(e[2]);s[(n-r)*t+o]=e[0]};const{w:t,h:n}=In.board,r=o.result.entries[0].algebraic,s=en(t*n);for(const t of r.black)e(t.toLowerCase());for(const t of r.white)e(t);Xo(Gt(s),t)}}catch{alert("An error has occurred. Please try again later.")}finally{e.disabled=!1,e.value="Get FEN"}},search(){gtag("event","fen_yacpdb_search"),window.open("https://yacpdb.org/#q/"+encodeURIComponent(Ta())+"/1")},copyQuery:()=>(gtag("event","fen_yacpdb_copy"),Ta()),copyEdit:()=>(gtag("event","fen_yacpdb_copyEdit"),function(){const e={w:[],b:[],n:[]},{w:t,h:n}=In.board;for(let o=0;o<n;o++)for(let n=0;n<t;n++){const r=Uo[o*t+n].value,s=r.match(/^(-?)([kqbsnrp])$/i);if(!s)continue;const a=Zt(s[2],!1,!0).toUpperCase();e[s[1]?"n":r==r.toLowerCase()?"b":"w"].push(a+Vt(o,n))}let o=[];e.w.length&&o.push("    white: [".concat(e.w.join(", "),"]"));e.b.length&&o.push("    black: [".concat(e.b.join(", "),"]"));e.n.length&&o.push("    neutral: [".concat(e.n.join(", "),"]"));return o.join("\n")}())};function Ta(){let e=[];const{w:t,h:n}=In.board;for(let o=0;o<n;o++)for(let n=0;n<t;n++){let r=Yt(Uo[o*t+n].value).replace("(","").replace(")","");r&&(r.match(/\d/)||(r=r.startsWith("!")?"n"+r.toUpperCase():(r==r.toLowerCase()?"b":"w")+r.toUpperCase(),e.push(r+Vt(o,n))))}let o='MatrixExtended("'.concat(e.join(" "),'", false, false, "None")');return In.DB.exact&&(o+=" AND PCount(*) = "+e.length),o}var La={async fetch(e){try{gtag("event","fen_pdb_get"),e.disabled=!0,e.value="Fetching...";const t=Ma+encodeURIComponent("PROBID='".concat(St.value,"'")),n=await fetch("https://corsproxy.io/?"+encodeURIComponent(t));Xo((await n.text()).match(/<b>FEN:<\/b> (.+)/)[1],!0)}catch{alert("An error has occurred. Please try again later.")}finally{e.disabled=!1,e.value="Get FEN"}},search(){gtag("event","fen_pdb_search"),window.open(Ma+encodeURIComponent($a()))},copyQuery:()=>(gtag("event","fen_pdb_copy"),$a()),copyEdit:()=>(gtag("event","fen_pdb_copyEdit"),function(){const e={},{w:t,h:n}=In.board;for(let o=0;o<n;o++)for(let n=0;n<t;n++){const r=Uo[o*t+n].value,s=r.match(/^(-?)(?:\*(\d))?([kqbsnrpxc])$/i);if(!s)continue;let a;if("x"==s[3])a="sY";else{const e=ja[Jn.indexOf(s[3].toLowerCase().replace("s","n"))];a=(s[1]?"n":r==r.toLowerCase()?"s":"w")+e+za[Number(s[2]||0)]}e[a]=(e[a]||"")+Vt(o,n)}const o=[];for(const t in e)o.push(t+e[t]);return o.join(" ")}())},Ma="https://pdb.dieschwalbe.de/search.jsp?expression=",ja=["K","D","L","S","T","B","I"],za=["","R","U","L"];function $a(){let e=[];const{w:t,h:n}=In.board;for(let o=0;o<n;o++)for(let n=0;n<t;n++){const r=Uo[o*t+n].value;if(!r.match(/^[kqbsnrp]$/i))continue;const s=ja[Jn.indexOf(r.toLowerCase().replace("s","n"))],a=r==r.toLowerCase()?"s":"w";e.push(a+s+Vt(o,n))}let o="POSITION='".concat(e.join(" "),"'");return In.DB.exact&&(o+=" AND APIECES=".concat(e.length)),o}function Wa(e){return new URL(e,location.href).toString()}function Da(){const{SN:e,w:t,h:n}=In.board;return e?Gt(or(),t,n):At.value}function Fa(){const e=In.board,t=Da();let n=Wa("gen/?fen="+t);return 44!=e.size&&(n+="&size="+e.size),"1echecs"!=e.set&&(n+="&set="+e.set),e.pattern&&(n+="&pattern="+e.pattern),e.bg&&(n+="&bg="+e.bg),"1"!=e.border&&(n+="&border="+e.border),e.blackWhite&&(n+="&blackWhite&knightOffset="+e.knightOffset),Kt(t)||(n+="&w=".concat(e.w,"&h=").concat(e.h)),n}var Ua,Ha,Ka,qa,Ga={copyJanko:()=>(gtag("event","fen_copy_janko"),"https://www.janko.at/Retros/d.php?ff="+Da()),copyBase64:()=>(gtag("event","fen_link_copy64"),xo.toDataURL()),copyBase64Img:()=>(gtag("event","fen_link_copy64img"),'<img fen="'.concat(xo.toDataURL(),'">')),async copyUrl(){gtag("event","fen_gen_link");const e=new FormData,t=await new Promise((e=>xo.toBlob(e)));e.append("key","7802c5da1788f2315222d44bfba20519"),e.append("image",t,"fen");try{const t=await fetch("https://api.imgbb.com/1/upload",{method:"post",body:e}),n=await t.json();if(!n.success)throw n.error.message;return n.data.url+"?="+Da()}catch(e){throw alert("string"==typeof e?e:"Internet connection failed. Please try again later."),e}},copyEmbed(){gtag("event","fen_copy_embed");const e=In.board;let t=Fa();const{w:n,h:o}=vt(e);return'<iframe src="'.concat(t,'" style="border:none;width:').concat(n,"px;height:").concat(o,'px"></iframe>')},copyEmbedUrl:()=>(gtag("event","fen_copy_embedUrl"),Fa()),copyImg:()=>(gtag("event","fen_copy_sdkImg"),'<img fen="'.concat(Da(),'">')),copySDK(){gtag("event","fen_copy_sdk");const e=In.board;let t="";return 44!=e.size&&(t+=' data-size="'.concat(e.size,'"')),"1echecs"!=e.set&&(t+=' data-set="'.concat(e.set,'"')),e.bg&&(t+=' data-bg="'.concat(e.bg,'"')),"1"!=e.border&&(t+=' data-border="'.concat(e.border,'"')),e.blackWhite&&(t+=' data-black-white="true" data-knight-offset="'.concat(e.knightOffset,'"')),'<script src="'.concat(Wa("sdk.js"),'"').concat(t,"><\/script>")}},Qa={async copy(){if(8!=In.board.w||8!=In.board.h)throw alert("只支援標準棋盤"),!0;gtag("event","fen_bbs_copy");return(await import("./modules/ptt.js")).generate(or(),Da(),St.value,In.BBS,In.board,_t.isTouch)}},Ya=["image/png","image/jpeg","image/bmp","image/webp"];function Za(e){Ya.includes(e.type)?alert("Image processing under development."):alert("Unsupported format.")}if(async function(){const e=On.get("image");if(e){const t=new URL(location.href);t.searchParams.delete("image"),history.replaceState(null,"",t.toString());const n=await fetch("shareImage?image="+e);Za(await n.blob())}}(),$n.stockfish.lines.length){const e=$n.stockfish.lines,t=$n.stockfish.header;$n.stockfish.lines=[],$n.stockfish.header=[],Nr().then((n=>{Ha=n,$n.stockfish.lines=e,$n.stockfish.header=t}))}function Va(e){Ua.postMessage(e)}window.cmd=Va;var Ja="(".concat(hn,")(").concat(hn,")([qrbn]?)"),Xa="modules/stockfish/",ei=_t.thread?"":"-single",ti=1,ni=["".concat(Xa,"stockfish-nnue-16.js#stockfish-nnue-16.wasm,worker"),"".concat(Xa,"stockfish-nnue-16.wasm"),"".concat(Xa,"stockfish-nnue-16-single.js#stockfish-nnue-16-single.wasm,worker"),"".concat(Xa,"stockfish-nnue-16-single.wasm"),"".concat(Xa,"nn-5af11540bbfe.nnue")];function oi(e){return Ua?Promise.resolve():new Promise(((t,n)=>{Ln.stockfish.running=1,(Ua=new Worker("".concat(Xa,"stockfish-nnue-16").concat(ei,".js#stockfish-nnue-16").concat(ei,".wasm"))).onmessage=e=>{const n=e.data;console.info(n),"readyok"==n&&(Ln.stockfish.running=2,t()),n.startsWith("info ")&&function(e){var t;if(2!=Ln.stockfish.running)return;const n=e.match(/multipv (\d+)/);if(!n)return;const o=Number(n[1])-1,r=e.match(/mate (-?)(\d+)/),s=e.match(/score cp (-?\d+)/);let a,i=Number(s&&s[1]||0)/100;if(r){const e="w"==qa.split(" ")[1]==Boolean(r[1])?"Black":"White";a=Number(r[2])+$n.stockfish.header.length/2,0==o&&($n.stockfish.mate=[e,a])}if(0==o){const t=e.match(/depth (\d+)/);t&&($n.stockfish.depth=t[1]),s&&($n.stockfish.score=i)}const c=e.match(new RegExp("pv (".concat(Ja,"(?: ").concat(Ja,")*)")));if(c){if((null==(t=$n.stockfish.lines[o])?void 0:t.raw)==c[1])return;const e=c[1].split(" ").map((e=>e.match(new RegExp(Ja))));$n.stockfish.moves=[];const n=$n.stockfish.header;Ka.init(n.length?n[n.length-1].after:qa);for(const t of e){if(Ka.move({from:t[1],to:t[2],promotion:t[3]}).san.endsWith("=")){i=0;break}}const s={rawScore:r?r[1]?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY:i,score:r?r[1]+"#"+r[2]:i.toFixed(2),raw:c[1],moves:Ka.state.history.concat(),pgn:Ka.copyPGN(n)};$n.stockfish.lines[o]=s}In.Stockfish.study&&ri()}(n.substring(5)),n.match(new RegExp("^bestmove ".concat(Ja)))&&function(){const e=In.Stockfish.depth;if(!In.Stockfish.study||e<4||!ri())ii.stop();else{const t=$n.stockfish.header;t.push(...$n.stockfish.lines[0].moves.slice(0,2));Va("position fen "+t[t.length-1].after),Va("go depth "+e)}}()},Ua.onerror=e=>{e.message.includes("RangeError")?n(-1):e.message.includes("memory")?n("Not enough memory."):n("Unknown error has occurred.")},Va("uci"),Va("setoption name Use NNUE value true"),_t.thread&&Va("setoption name Threads value "+Math.max(2,navigator.hardwareConcurrency-4)),Va("setoption name Hash value "+e),Va("isready")}))}function ri(){const e=$n.stockfish.lines.filter((e=>e&&e.moves.length));if(e.length<=1)return!1;e.forEach((e=>e.moves[0]&&(e.moves[0].annotation=void 0)));const t=e.filter((e=>e.rawScore>ti));if(t.length>1)return!1;if(1==t.length)return t[0].moves[0].annotation="!",!0;const n=e.filter((e=>e.rawScore>-ti));return 1==n.length&&(n[0].moves[0].annotation="!",!0)}var si,ai,ii={async download(){gtag("event","fen_stockfish_download"),Ln.stockfish.status=1,"serviceWorker"in navigator&&await navigator.serviceWorker.ready;for(const e of ni){if(200!=(await fetch(e)).status)return alert("Download failed. Please check your network connection."),void(Ln.stockfish.status=0)}In.Stockfish.downloaded=!0,Ln.stockfish.status=2},async analyze(){try{gtag("event","fen_stockfish_run");let e=128,t=oi(e);if(!(qa=ar()))throw"Only orthodox chess is supported.";for(Ha||(Ha=await Nr()),(Ka=new Ha.Chess).init(qa);;)try{await t;break}catch(n){if(-1!==n)throw n;if(ii.stop(),e/=2,e<4)throw"Not enough memory.";t=oi(e)}$n.stockfish=Lt(jn),Va("setoption name MultiPV value "+In.Stockfish.lines),Va("ucinewgame"),Va("position fen "+qa),Va("go depth "+In.Stockfish.depth)}catch(e){ii.stop(),alert(e instanceof Error?e.message:e),Ln.stockfish.running=0}},play(e){gtag("event","fen_stockfish_play"),$n.play.mode="normal",$n.tab=6,_r(e.pgn)},stop(){Ua&&Ua.terminate(),Ua=void 0,Ln.stockfish.running=0},format:e=>Ha.formatGame(e)};if($n.syzygy.lines){const e=$n.syzygy.lines;e.forEach((e=>e.searching=!1)),$n.syzygy.lines=[],Nr().then((t=>{si=t,$n.syzygy.lines=e}))}var ci=new Set;function li(e){return new Promise((t=>{ci.add(t),setTimeout((()=>{ci.delete(t),t()}),1e3*e)}))}async function ui(e,t){try{if(!t.running)return null;const n=t.ready;if(t.ready=n.then((()=>li(1))),await n,!t.running)return null;const o=await fetch("https://tablebase.lichess.ovh/standard?fen="+e);return 429==o.status?(await li(61),await ui(e,t)):await o.json()}catch{throw"Unable to connect to the server. Please check your network connection."}}async function fi(e){const t=new((si=await Nr()).Chess);t.init(e.fen);const n=await ui(t.fen(),e),o="w"==t.turn()?"White":"Black",r=n.category;if($n.syzygy.header="The position is a ".concat(r," for ").concat(o,"."),"unknown"==r||r.includes("loss")||!e.running)return;$n.syzygy.lines=[],e.outcome=r,e.op=function(e){return"draw"==e?e:gi[di.indexOf(e)]}(r);const s=n.moves.filter((t=>t.category==e.op));for(const n of s){t.init(e.fen);const[o,r,s]=n.uci.match(/..|./g);t.move({from:o,to:r,promotion:s});const a=t.fen();e.positions.add(pi(a));const i={fen:a,dtm:n.dtm,indent:0,history:t.state.history.concat(),leaf:!0,moves:t.state.history.concat(),pgn:t.copyPGN(),transpose:!1,searching:!t.isGameOver()};$n.syzygy.lines.push(i)}if(!e.running)return;let a=$n.syzygy.lines.filter((e=>e.searching));if(a.length>1)return;for(a[0].moves[0].annotation="!";a.length;){const t=a.map((t=>hi(t,e)));if(await Promise.all(t),a=$n.syzygy.lines.filter((e=>e.searching)),!e.running)return}}function pi(e){return e.replace(/ \d+ \d+$/,"")}async function hi(e,t){const n=new si.Chess;n.init(e.fen);const o="number"==typeof e.dtm,r=n.moves({verbose:!0}),s=await ui(e.fen,t),a=new Set(s.moves.filter((e=>e.category==t.outcome)).map((e=>e.uci))),i=r.filter((e=>a.has(e.from+e.to+(e.promotion||"")))).map((e=>async function(e,t,n){const o=await ui(e.after,t);if(!t.running)return null;const r=o.moves.filter((e=>e.category==t.op));return{score:(n?o.dtm:0)-r.length,json:o,dtm:o.dtm,defense:e,moves:r}}(e,t,o))),c=(await Promise.all(i)).filter((e=>e)).sort(((e,t)=>t.score-e.score)).filter(((e,t,n)=>e.score==n[0].score));if(e.searching=!1,!t.running)return;const l=c.filter((e=>"draw"!=t.op&&e.moves.length>0||1==e.moves.length));if(0==l.length)return;const u=1==l.length,f=l.map((o=>function(e,t,n,o,r){o.init(t.fen);const s=o.move(e.defense);n&&(s.annotation="!");const[a,i,c]=e.moves[0].uci.match(/..|./g),l=o.move({from:a,to:i,promotion:c});1==e.moves.length&&(l.annotation="!");const u=o.fen(),f=pi(u),p=r.positions.has(f);p||r.positions.add(f);const h=o.state.history.concat();return{dtm:"number"==typeof e.dtm?1-e.dtm:null,fen:u,transpose:p,leaf:!0,indent:t.indent+(n?0:1),history:t.history.concat(h),moves:n?t.moves.concat(h):h,pgn:o.copyPGN(t.history),searching:!o.isGameOver()&&!p}}(o,e,u,n,t))),p=$n.syzygy.lines.concat(),h=p.indexOf(e);u?p.splice(h,1,...f):(e.leaf=!1,p.splice(h+1,0,...f)),$n.syzygy.lines=p}var di=["win","maybe-win","cursed-win"],gi=["loss","maybe-loss","blessed-loss"];var mi={async run(){var e;const t={positions:new Set,running:!0,ready:Promise.resolve()};ai=t;try{if(gtag("event","fen_syzygy_run"),Ln.syzygy.running=!0,$n.syzygy.header=null,$n.syzygy.lines=null,t.fen=ar(),!t.fen)throw"Only orthodox chess is supported.";if((null==(e=t.fen.split(" ")[0].match(/[a-z]/gi))?void 0:e.length)>7)throw"Only supports position with up to 7 pieces.";await fi(t)}catch(e){alert(e instanceof Error?e.message:e)}finally{t.running&&mi.stop()}},play(e){gtag("event","fen_syzygy_play"),$n.play.mode="normal",$n.tab=6,_r(e.pgn)},stop(){var e;ai&&(ai.running=!1);for(const e of ci)e();ci.clear(),null==(e=$n.syzygy.lines)||e.forEach((e=>e.searching=!1)),Ln.syzygy.running=!1},format:e=>si.formatGame(e.moves)+(e.searching?" ...":e.transpose?" (transpose)":"")};function yi(){Ro(),Ao()}!async function(){window.addEventListener("resize",(()=>To({})));const e=On.get("fen");await To({},!0),Ko.draw=Ro,e?(Xo(e,!0),tr()):rr(),setTimeout(Mo,1e3)}(),Nt.onmousedown=xa,Nt.ontouchstart=xa,Nt.ondragstart=e=>e.preventDefault(),Nt.onwheel=ba,xt.onmousedown=xa,xt.ontouchstart=xa,document.body.onmousedown=e=>{Dn()||e.target==xt||e.target==Nt||ga()},document.body.onmousemove=ha,document.body.ontouchmove=ha,document.body.onmouseleave=ma,document.body.onmouseup=ma,document.body.ontouchend=ma,async function(e){Sa=e,document.head.appendChild(Ca),await new Promise((e=>{const t=n=>{n.source==Ca.contentWindow&&(removeEventListener("message",t),e())};addEventListener("message",t),Ca.src=Ra.toString()}));const t=document.documentElement;new MutationObserver((e=>{for(const t of e)if("attributes"==t.type){const e=t.attributeName.toLowerCase(),n=e.startsWith("data");t.target==Na&&n&&_a(document),"IMG"!=t.target.nodeName||"fen"!=e&&!n||Oa(t.target)}else for(const e of t.addedNodes)_a(e)})).observe(t,{childList:!0,attributes:!0,subtree:!0}),_a(t)}({getDefault:()=>In.board,getTitle:e=>e}),document.addEventListener("mousedown",(function(e){var t;const n=null==(t=document.activeElement)?void 0:t.nodeName.toLowerCase();"input"!=n&&"textarea"!=n&&e.detail>1&&e.preventDefault()}),!1),addEventListener("keydown",(e=>{var t;if(!$n.play.playing&&!$n.popeye.playing)return;const n=null==(t=document.activeElement)?void 0:t.nodeName.toLowerCase();if("input"==n||"textarea"==n)return;const o=e.key;"a"!=o&&"ArrowLeft"!=o||(e.preventDefault(),$n.play.playing?wr(-1):Js.moveBy(-1)),"d"!=o&&"ArrowRight"!=o||(e.preventDefault(),$n.play.playing?wr(1):Js.moveBy(1))})),window.share=async function(e){if(gtag("event","fen_img_share"),_t.canSharePng){const e=await Co(),t=[new File([e],"board.png",{type:"image/png"})];navigator.share({files:t})}else{e.disabled=!0;const t=e.querySelector("i"),n=t.className;t.className="fa-spin fa-solid fa-spinner";try{const e=await Ga.copyUrl();navigator.share({url:e,text:Da()})}finally{e.disabled=!1,t.className=n}}},ut({env:_t,copyImage:async function(){if(_t.canCopyImg){const e=await Co();return navigator.clipboard.write([new ClipboardItem({"image/png":e})])}throw alert('Image copying is not enabled in your browser.\nIf you\'re using Firefox, this can be enabled by the following.\n1. Visit "about:config" in your address bar.\n2. Search for "dom.events.asyncClipboard.clipboardItem".\n3. Toggle its value to true.\n4. Reload this tool.'),!0},CheckboxBase:Un,Checkbox:Hn,CheckboxR:function(e,t){return Hn(e,t,null,(()=>"retro"==$n.play.mode))},CopyButton:function(e,t,n,o){return{$template:"#copyBtn",cls:n,label:e,dis:void 0!==o&&o,state:0,async copy(){this.state=1;try{let e=t;for(;"function"==typeof e;)e=await e();"string"==typeof e&&function(e){if(_t.canCopy)navigator.clipboard.writeText(e);else{const t=document.createElement("input");document.body.appendChild(t),t.value=e,t.select(),document.execCommand("copy"),document.body.removeChild(t)}}(e),this.state=2,setTimeout((()=>this.state=0),1e3)}catch(e){this.state=0}}}},Radio:function(e,t,n,o,r,s){return{$template:"#radio",id:"rdo"+Kn++,text:o,value:r,label:e,checked:e=>t[n]==r[e],set:e=>t[n]=r[e],disabled:()=>null==s?void 0:s()}},NumInput:function(e,t,n,o,r){const s=()=>t[n];return{$template:"#number",title:e,get:s,set:e=>{const a=e.target,i=s(),c=Math.round(Number(a.value));isNaN(c)||c<o||c>r?a.value=i:t[n]=c},setBy:e=>t[n]+=e,isMin:()=>s()<=o,isMax:()=>s()>=r}},Layout:zo,redraw:yi,updateBG:function(){Po(wt.getContext("2d")),yi()},updateSN:function(){let e=!1;for(const t of Uo)e=Vo(t,!0)||e;e&&rr()},openFile:function(e){const t=e.files[0];e.value="",Za(t)},Popeye:Js,updateEdwards:sr,toFEN:rr,setFEN:Xo,toggleCoordinates(){To({},!0)},get DB(){return"PDB"==In.DB.use?La:Ia},get noEditing(){return Dn()},get hideTemplate(){return Ln.hor&&$n.popeye.playing},YACPDB:Ia,BBS:Qa,API:Ga,PLAY:Tr,Stockfish:ii,Syzygy:mi,Project:Ba,store:In,state:$n,status:Ln,drawExport:async function(){await mo(),Ro()},resize(){$n.split,Promise.resolve().then((()=>To({})))},saveSettings:function(){localStorage.setItem("settings",JSON.stringify(In))},saveSession:function(){_t.isTop&&sessionStorage.setItem("state",JSON.stringify($n))}}).mount()})();