(()=>{var t=/\/|\d+|\(!?[kqbnrp]\d?\)|[-~]?(\*\d)?([kqbsnrpcx]|'[^']|''..)|./giu;var e={pattern:void 0,bg:void 0,border:"1",blackWhite:!1,knightOffset:.6,SN:!1,size:44,w:8,h:8,set:"1echecs"},s=/^\d+(,\d+)*$/,n=[26,32,38,44],r=["1echecs","alpha","goodCompanion","merida","skak"];var o="０１２３４５６７８９".split(""),a=function(){const t=new Map,e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ,./<>?;':\"[]\\{}|!@#$%^&*()_+-=`~".split(""),s="ａｂｃｄｅｆｇｈｉｊｋｌｍｎｏｐｑｒｓｔｕｖｗｘｙｚＡＢＣＤＥＦＧＨＩＪＫＬＭＮＯＰＱＲＳＴＵＶＷＸＹＺ，．／＜＞？；’：”〔〕＼｛｝｜！＠＃＄％︿＆＊（）ˍ＋－＝‘～".split("");for(let n=0;n<e.length;n++)t.set(e[n],s[n]);for(let e=0;e<10;e++)t.set(e.toString(),o[e]);return t}();var i=["k","q","b","n","r","p","c","x"];function c(t,e,s,n,r,o,c){const l=c.size,f=r.startsWith("-");f&&(r=r.substring(1));const u=r.match(/^\*(\d)/);let g=u&&u[1]||void 0;void 0!==g&&(r=r.substring(2)),g=Number(g)%4,"s"==r&&(r="n"),"S"==r&&(r="N");const h=r.toLowerCase(),d=i.indexOf(h),b=r.startsWith("'"),p="gray"==c.bg;if((d<0||p)&&2!=o&&function(t,e,s,n,r){const o=r.size;t.save(),"gray"==r.bg?t.fillStyle=n?"#fff":"#bbb":t.fillStyle=n?"#FFCE9E":"#D18B47";t.fillRect(s*o,e*o,o,o),t.restore()}(t,s,n,o,c),d<0&&!b)return;t.save(),p&&(o=2);const m=c.blackWhite,k=f?m?0:2:r==h?0:1,v=f&&m?"n"==h?c.knightOffset:.5:1,[z,w]=[g+1&2?1:0,2&g?1:0];if(t.translate((n+z)*l,(s+w)*l),0!==g&&t.rotate(Math.PI/2*g),b){const e=r.substring(1);!function(t,e,s){t.fillStyle="black";const n=t.measureText(e),r=n.actualBoundingBoxAscent-n.actualBoundingBoxDescent,o=Math.max((s-n.width)/2,0),a=Math.max((s-r)/2,0);t.fillText(e,o,s-a,s)}(t,r.startsWith("''")?r.substring(2):(x=e,((y=!1)&&"c"==x.toLowerCase()?"‧":y&&"x"==x.toLowerCase()?"╳":a.get(x))||e),l)}else t.drawImage(e,(k+3*o)*l,d*l,l*v,l,0,0,l*v,l),f&&m&&t.drawImage(e,(1+v+3*o)*l,d*l,l*(1-v),l,l*v,0,l*(1-v),l);var x,y;t.restore()}function l(t,e,s){if("mono"==t)return 1;let n=(e+s)%2;return"inverted"!=t&&(n=1-n),n}var f=document.getElementById("CN"),u=f.getContext("2d");function g(t,e,s){const n=function(t){const e=t.split(",").map((t=>{const e=Number(t);return isNaN(e)?0:Math.abs(Math.floor(e))})),s=e.reduce(((t,e)=>t+e),0);return{array:e,size:s}}(s.border),r=8*s.size+2*n.size,o=8*s.size+2*n.size;f.width=r,f.height=o,function(t,e,s,n){t.save();let r=0;for(let o=0;o<e.array.length;o++){const a=e.array[o];if(t.strokeStyle=o%2?"white":"black",0==a)continue;t.lineWidth=a;const i=e.size-r-a/2;t.strokeRect(i,i,s-2*i,n-2*i),r+=a}t.restore()}(u,n,r,o),u.save(),u.translate(n.size,n.size),u.font=s.size-4+"px arial";for(let n=0;n<8;n++)for(let r=0;r<8;r++){const o=l(s.pattern,n,r);c(u,t,n,r,e[8*n+r],o,s)}return u.restore(),f}var h=new Map;parent.postMessage(null,"*"),onmessage=async o=>{if(o.source!=parent||!o.ports[0])return;gtag("event","fen_sdk_gen");const a=function(e,s=8,n=8){const r=e.match(t)||[],o=[];let a=!1;for(const t of r){if("/"==t){if(!a){const t=o.length+s-o.length%s;for(;o.length<t;)o.push("")}}else if(t.match(/^\d+$/)){const e=Number(t);for(let t=0;t<e;t++)o.push("")}else o.push(t);if(a="/"!=t&&o.length%s==0,o.length==s*n)break}for(;o.length<s*n;)o.push("");return o}(o.data.fen||"8/8/8/8/8/8/8/8"),i=function(t){const o=Object.assign({},e);if(t){const e=Number(t.size);n.includes(e)&&(o.size=e),r.includes(t.set)&&(o.set=t.set),t.border&&t.border.match(s)&&(o.border=t.border),0<t.knightOffset&&t.knightOffset<1&&(o.knightOffset=t.offset),o.blackWhite=Boolean(t.blackWhite),o.pattern=t.pattern,o.bg=t.bg,o.SN=t.SN}return o}(o.data.options),c=await function(t){const e=t.set+t.size;if(h.has(e))return h.get(e);{const s=new Promise((e=>{const s=new Image;s.onload=()=>e(s),s.src=`../assets/${t.set}${t.size}.png`}));return h.set(e,s),s}}(i),l=g(c,a,i);o.ports[0].postMessage(l.toDataURL())}})();