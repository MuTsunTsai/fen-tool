(()=>{var t=/\/|\d|\(!?[kqbnrp]\d?\)|[-~]?(\*\d)?([kqbsnrpcx]|'[^']|''..)|./giu;var e={uncolored:!1,inverted:!1,grayBG:!1,blackWhite:!1,knightOffset:.6,SN:!1,size:44,set:"1echecs"},s=[26,32,38,44],n=["1echecs","alpha","goodCompanion","merida","skak"];var o="０１２３４５６７８９".split(""),r=function(){const t=new Map,e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ,./<>?;':\"[]\\{}|!@#$%^&*()_+-=`~".split(""),s="ａｂｃｄｅｆｇｈｉｊｋｌｍｎｏｐｑｒｓｔｕｖｗｘｙｚＡＢＣＤＥＦＧＨＩＪＫＬＭＮＯＰＱＲＳＴＵＶＷＸＹＺ，．／＜＞？；’：”〔〕＼｛｝｜！＠＃＄％︿＆＊（）ˍ＋－＝‘～".split("");for(let n=0;n<e.length;n++)t.set(e[n],s[n]);for(let e=0;e<10;e++)t.set(e.toString(),o[e]);return t}();var a=["k","q","b","n","r","p","c","x"];function i(t,e,s,n,o,i,c){const l=c.size,f=o.startsWith("-");f&&(o=o.substring(1));const u=o.match(/^\*(\d)/);let g=u&&u[1]||void 0;void 0!==g&&(o=o.substring(2)),g=Number(g)%4,"s"==o&&(o="n"),"S"==o&&(o="N");const h=o.toLowerCase(),d=a.indexOf(h),p=o.startsWith("'");if((d<0||c.grayBG)&&2!=i&&function(t,e,s,n,o){const r=o.size;t.save(),o.grayBG?t.fillStyle=n?"#fff":"#bbb":t.fillStyle=n?"#FFCE9E":"#D18B47";t.fillRect(s*r+1,e*r+1,r,r),t.restore()}(t,s,n,i,c),d<0&&!p)return;t.save(),c.grayBG&&(i=2);const b=c.blackWhite,m=f?b?0:2:o==h?0:1,k=f&&b?"n"==h?c.knightOffset:.5:1,[v,w]=[g+1&2?1:0,2&g?1:0];if(t.translate((n+v)*l+1,(s+w)*l+1),0!==g&&t.rotate(Math.PI/2*g),p){const e=o.substring(1);!function(t,e,s){t.fillStyle="black";const n=t.measureText(e),o=n.actualBoundingBoxAscent-n.actualBoundingBoxDescent,r=Math.max((s-n.width)/2,0),a=Math.max((s-o)/2,0);t.fillText(e,r,s-a,s)}(t,o.startsWith("''")?o.substring(2):(x=e,((B=!1)&&"c"==x.toLowerCase()?"‧":B&&"x"==x.toLowerCase()?"╳":r.get(x))||e),l)}else t.drawImage(e,(m+3*i)*l,d*l,l*k,l,0,0,l*k,l),f&&b&&t.drawImage(e,(1+k+3*i)*l,d*l,l*(1-k),l,l*k,0,l*(1-k),l);var x,B;t.restore()}var c=document.getElementById("CN"),l=c.getContext("2d");var f=new Map;parent.postMessage(null,"*"),onmessage=async o=>{if(o.source!=parent||!o.ports[0])return;const r=function(e){const s=e.match(t)||[],n=[];let o=!1;for(const t of s){if("/"==t){if(!o){const t=n.length+8-n.length%8;for(;n.length<t;)n.push("")}}else if(t.match(/^\d$/)){const e=Number(t);for(let t=0;t<e;t++)n.push("")}else n.push(t);o="/"!=t&&n.length%8==0}for(;n.length<64;)n.push("");return n}(o.data.fen||"8/8/8/8/8/8/8/8"),a=function(t){const o=Object.assign({},e),r=Number(t.size);s.includes(r)&&(o.size=r),n.includes(t.set)&&(o.set=t.set),0<t.knightOffset&&t.knightOffset<1&&(o.knightOffset=t.offset);for(const e of["uncolored","inverted","grayBG","blackWhite"])t[e]&&(o[e]=!0);return o}(o.data.options),u=await function(t){const e=t.set+t.size;if(f.has(e))return f.get(e);{const s=new Promise((e=>{const s=new Image;s.onload=()=>e(s),s.src=`../assets/${t.set}${t.size}.png`}));return f.set(e,s),s}}(a),g=function(t,e,s){const n=8*s.size+2;c.width=c.height=n,l.fillStyle="black",l.fillRect(0,0,n,n),l.font=s.size-4+"px arial";for(let n=0;n<8;n++)for(let o=0;o<8;o++){const r=s.uncolored||s.inverted==Boolean((n+o)%2)?1:0;i(l,t,n,o,e[8*n+o],r,s)}return c}(u,r,a);o.ports[0].postMessage(g.toDataURL())}})();