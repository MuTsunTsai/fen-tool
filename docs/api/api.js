(()=>{var e="[ðŸ‡¦-ðŸ‡¿]{2}|\\p{ExtPict}\\uFE0F?\\p{EMod}?(\\u200D\\p{ExtPict}\\uFE0F?\\p{EMod}?)*",t="\\((!?)([kqbnrp])(\\d?)\\)",n=`[-~]?(\\*\\d)?([kqbnrpcxstadg]|${`'(${e}|[^'])|''..`})`,s=RegExp(`^(?:${e})$`,"u"),r=RegExp(`\\/|\\d+|${t}|${n}|.`,"iug");var o={pattern:void 0,bg:void 0,exHigh:!0,border:"1",blackWhite:!1,knightOffset:.6,SN:!1,size:44,w:8,h:8,fullFEN:!1,coordinates:!1,set:"1echecs",collapse:!1},a=/^\d+(,\d+)*$/,i=[26,32,38,44],c=["1echecs","alpha","goodCompanion","merida","skak"];function l(e){const t=Object.assign({},o);if(e){const s=Number(e.size);i.includes(s)&&(t.size=s),c.includes(e.set)&&(t.set=e.set),e.border="string"!=typeof(n=e.border)?null:(n=n.replace(/\D/g,",").replace(/,+/g,",").replace(/^,/,"").replace(/,$/,"")).match(a)?n:null,e.border&&(t.border=e.border),0<e.knightOffset&&e.knightOffset<1&&(t.knightOffset=e.offset),t.blackWhite=Boolean(e.blackWhite),t.pattern=e.pattern,t.bg=e.bg,t.SN=e.SN;const r=Math.floor(Number(e.w)),o=Math.floor(Number(e.h));r>0&&(t.w=r),o>0&&(t.h=o)}var n;return t}var f=20;function h(e,t){const n=function(e){const t=e.split(",").map((e=>{const t=Number(e);return isNaN(t)?0:Math.abs(Math.floor(t))})),n=t.reduce(((e,t)=>e+t),0);return{array:t,size:n}}(e.border),s=e.coordinates?{x:f,y:f}:{x:0,y:0};!0===t&&(s.y=0),!1===t&&(s.x=0);return{w:e.w*e.size+2*n.size+s.x,h:e.h*e.size+2*n.size+s.y,border:n,offset:{x:n.size+s.x,y:n.size},margin:s}}var g=document.createElement("canvas"),u=g.getContext("2d"),d=new Map;async function A(e,t,n){const s=t.set+t.size*n;if(d.has(s))return d.get(s);const r=await async function(e,t,n){const{set:s,size:r}=t;1!=n&&(e+="/x"+n);const[o,a]=await Promise.all([m(`${e}/${s}${r}.png`),m(`${e}/symbol${r}.png`)]);return g.width=r*n*3,g.height=r*n*12,u.drawImage(o,0,0),u.drawImage(a,0,r*n*6),g.toDataURL()}(e,t,n),o=await m(r);return d.set(s,o),o}function m(e){return new Promise(((t,n)=>{const s=new Image;s.onload=()=>t(s),s.onerror=n,s.src=e}))}var w=["k","q","b","n","r","p","c","x","s","t","a","d"],p=document.createElement("canvas"),b=p.getContext("2d"),x=document.createElement("canvas"),v=x.getContext("2d"),E={26:"YdVh1QDVYdVh",32:"AAAKAAAAo/+jAAr/AP8KAKP/owAAAAoAAA==",38:"AAw+DAAM3P/cDD7/AP8+DNz/3AwADD4MAA==",44:"AC9yLwAv+f/5L3L/AP9yL/n/+S8AL3IvAA==",52:"A3i2eAN4////eLb/AP+2eP///3gDeLZ4Aw==",64:"AAAEHgQAAAA/5v/mPwAE5v///+YEHv//AP//HgTm////5gQAP+b/5j8AAAAEHgQAAA==",76:"AARZhFkEAAS7////uwRZ//////9ZhP//AP//hFn//////1kEu////7sEAARZhFkEAA==",88:"AEfE68RHAEf8/////EfE///////E6///AP//68T//////8RH/P////xHAEfE68RHAA=="};function y(e,t,n,s,r,o){const{w:a,h:i,border:c,offset:l,margin:g}=h(n,o),u=function(e,t){const n=e.set+e.size*t;return d.get(n)}(n,s);e.canvas.width=a*s,e.canvas.height=i*s,e.save(),e.scale(s,s);const A="classic"==n.bg,m=r||A;e.translate(l.x,l.y);for(let r=0;r<n.h;r++)for(let o=0;o<n.w;o++)m||P(e,r,o,n),k(e,u,r,o,t[r*n.w+o],n,s);if(e.restore(),A&&!r){!function(e,t,n){const s=e.canvas;x.width=p.width=s.width,x.height=p.height=s.height,b.drawImage(s,0,0),e.save(),e.fillStyle="white",e.fillRect(0,0,s.width,s.height),e.globalCompositeOperation="destination-in",e.drawImage(p,0,0),e.restore(),e.save();const r=function(e){if("string"==typeof E[e]){const t=atob(E[e]),n=[];for(let e=0;e<t.length;e++)n.push(t.charCodeAt(e));E[e]=n}return E[e]}(t*n),o=Math.sqrt(r.length),a=(o-1)/2;for(let t=0;t<o;t++)for(let n=0;n<o;n++){const i=r[n*o+t];0!=i&&(e.globalAlpha=i/255,v.drawImage(s,t-a,n-a))}e.restore()}(e,n.size,s),e.save(),e.scale(s,s),e.translate(l.x,l.y);for(let t=0;t<n.h;t++)for(let s=0;s<n.w;s++)P(e,t,s,n);e.restore(),e.drawImage(x,0,0),e.drawImage(x,0,0),e.drawImage(x,0,0),e.drawImage(p,0,0)}e.scale(s,s),void 0===o&&n.coordinates&&(e.save(),e.translate(l.x,l.y),function(e,t,n){const{size:s,w:r,h:o}=t;e.font="15px sans-serif",e.strokeStyle="black",e.lineWidth=2,e.fillStyle="white",e.lineJoin="round";for(let t=0;t<o;t++){const r=(t+1).toString(),a=e.measureText(r),i=s*(o-t)-(s-10)/2,c=(f-a.width)/2-f-n;e.strokeText(r,c,i),e.fillText(r,c,i)}for(let t=0;t<r&&t<26;t++){const r=String.fromCharCode(97+t),a=e.measureText(r),i=s*o+f+n-5,c=s*t+(s-a.width)/2;e.strokeText(r,c,i),e.fillText(r,c,i)}}(e,n,c.size),e.restore()),r||function(e,t,n,s,r){e.save(),e.translate(r.x,0),n-=r.x,s-=r.y;let o=0;for(let r=0;r<t.array.length;r++){const a=t.array[r];if(e.strokeStyle=r%2?"white":"black",0==a)continue;e.lineWidth=a;const i=t.size-o-a/2;e.strokeRect(i,i,n-2*i,s-2*i),o+=a}e.restore()}(e,c,a,i,g)}function k(e,t,n,r,o,a,i){const{size:c}=a,l=o&&o.startsWith("-");l&&(o=o.substring(1));const f=o.match(/^\*(\d)/);let h=f&&f[1]||void 0;void 0!==h&&(o=o.substring(2)),h=Number(h)%4,a.SN&&(o=function(e,t,n){return e.match(/^-?(\*\d)?[sng]$/i)?(t?(n&&(e=e.replace("s","g").replace("S","G")),e=e.replace("n","s").replace("N","S")):(n&&(e=e.replace("s","n").replace("S","N")),e=e.replace("g","s").replace("G","S")),e):e}(o,!1,!0));const g=o.toLowerCase(),u=w.indexOf(g),d=o.startsWith("'");if(u<0&&!d)return;e.save();const A=a.blackWhite,m=l?A?0:2:o==g?0:1,p=l&&A?"n"==g?a.knightOffset:.5:1,[b,x]=[h+1&2?1:0,2&h?1:0];if(e.translate((r+b)*c,(n+x)*c),0!==h&&e.rotate(Math.PI/2*h),d){!function(e,t,n){e.save();const r=s.test(t),o=n-4;e.font=`${o}px sans-serif`;const a=n-2;let i=e.measureText(t);if(r&&i.width>a){const n=a/i.width;e.font=o*n+"px sans-serif",i=e.measureText(t)}const c=function(e){return e.actualBoundingBoxAscent-e.actualBoundingBoxDescent}(r?e.measureText("M"):i),l=(n-Math.min(i.width,a))/2,f=Math.max((n-c)/2,0);e.fillStyle="black",e.fillText(t,l,n-f,a),e.restore()}(e,o.substring(o.startsWith("''")?2:1),c)}else e.drawImage(t,m*c*i,u*c*i,c*p*i,c*i,0,0,c*p,c),l&&A&&e.drawImage(t,(1+p)*c*i,u*c*i,c*(1-p)*i,c*i,c*p,0,c*(1-p),c);e.restore()}function P(e,t,n,s){const r=function(e,t,n){if("mono"==e)return 1;let s=(t+n)%2;return"inverted"!=e&&(s=1-s),s}(s.pattern,t,n),o=s.size;if(e.save(),e.translate(n*o,t*o),"classic"==s.bg){if(e.strokeStyle="black",e.lineWidth=o/60,e.fillStyle="#fff",e.fillRect(0,0,o,o),!r){e.beginPath();const t=o/7.5;for(let n=0;n<o;n+=t)e.moveTo(o-n,0),e.lineTo(0,o-n),n>0&&(e.moveTo(n,o),e.lineTo(o,n));e.stroke()}}else e.fillStyle=function(e,t){return"classic"==t?"none":"gray"==t?e?"#fff":"#bbb":"green"==t?e?"#EEEED2":"#769656":e?"#FFCE9E":"#D18B47"}(r,s.bg),e.fillRect(0,0,o,o);e.restore()}var z=document.getElementById("CN"),S=z.getContext("2d"),N=Math.min(2,Math.floor(devicePixelRatio));parent.postMessage(null,"*"),onmessage=async e=>{if(e.source!=parent||!e.ports[0])return;gtag("event","fen_sdk_gen");const t=l(e.data.options),n=e.data.fen||"8/8/8/8/8/8/8/8",{w:s,h:o}=function(e){const t=e.match(r)||[],n=[0];let s=0;for(const e of t)"/"==e?n[++s]=0:e.match(/^\d+$/)?n[s]+=Number(e):n[s]++;const o=n.length;if(1==o)return;const a=n[0];for(const e of n)if(e!=a)return;return{w:a,h:o}}(n)||t,a=function(e,t=8,n=8){const s=e.match(r)||[],o=[];let a=!1;for(const e of s){if("/"==e){if(!a){const e=o.length+t-o.length%t;for(;o.length<e;)o.push("")}}else if(e.match(/^\d+$/)){const t=Number(e);for(let e=0;e<t;e++)o.push("")}else o.push(e);if(a="/"!=e&&o.length%t==0,o.length==t*n)break}for(;o.length<t*n;)o.push("");return o}(n,s,o);t.w=s,t.h=o,await A("../assets",t,N);const i=function(e,t){const{w:n,h:s}=h(t);return z.width=n*N,z.height=s*N,z.style.width=n+"px",z.style.height=s+"px",y(S,e,t,N),z}(a,t);e.ports[0].postMessage(i.toDataURL())}})();