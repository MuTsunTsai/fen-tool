"use strict";(()=>{var t=3,e=97,n="[ðŸ‡¦-ðŸ‡¿]{2}|\\p{ExtPict}\\uFE0F?\\p{EMod}?(\\u200D\\p{ExtPict}\\uFE0F?\\p{EMod}?)*",o="\\((!?)([kqbnrp])(\\d?)\\)",s="'(".concat(n,"|[^'])|''.."),r="[-~]?(\\*\\d)?(".concat("[kqbnrpcxstadg]","|").concat(s,")"),a=RegExp("^(?:".concat(n,")$"),"u"),c=("^(?:".concat(o,"|").concat(r,")$"),RegExp("\\/|\\d+|".concat(o,"|").concat(r,"|."),"iug"));var i={pattern:void 0,bg:void 0,exHigh:!0,border:"1",blackWhite:!1,knightOffset:.6,SN:!1,size:44,w:8,h:8,fullFEN:!1,coordinates:!1,set:"1echecs",collapse:!0},l=/^\d+(,\d+)*$/,f=[26,32,38,44],h=["1echecs","alpha","goodCompanion","kilfiger","merida","mpchess","skak"];function u(t){const e=Object.assign({},i);if(t){const n=Number(t.size);f.includes(n)&&(e.size=n),t.set&&h.includes(t.set)&&(e.set=t.set),t.border=function(t){if("string"==typeof t&&(t=t.replace(/\D/g,",").replace(/,+/g,",").replace(/^,/,"").replace(/,$/,"")).match(l))return t}(t.border),t.border&&(e.border=t.border),t.knightOffset&&0<t.knightOffset&&t.knightOffset<1&&(e.knightOffset=t.knightOffset),e.blackWhite=Boolean(t.blackWhite),e.pattern=t.pattern,e.bg=t.bg,e.SN=t.SN||!1;const o=Math.floor(Number(t.w)),s=Math.floor(Number(t.h));o>0&&(e.w=o),s>0&&(e.h=s)}return e}var g=20;function d(t,e){const n=function(t){const e=t.split(",").map((t=>{const e=Number(t);return isNaN(e)?0:Math.abs(Math.floor(e))})),n=e.reduce(((t,e)=>t+e),0);return{array:e,size:n}}(t.border),o=t.coordinates?{x:g,y:g}:{x:0,y:0};!0===e&&(o.y=0),!1===e&&(o.x=0);return{w:t.w*t.size+2*n.size+o.x,h:t.h*t.size+2*n.size+o.y,border:n,offset:{x:n.size+o.x,y:n.size},margin:o}}var A=12,p=6,m=document.createElement("canvas"),w=m.getContext("2d"),b=new Map;async function x(e,n,o){const s=n.set+n.size*o;if(b.has(s))return b.get(s);const r=await async function(e,n,o){const{set:s,size:r}=n;e+="/x"+o;const[a,c]=await Promise.all([v("".concat(e,"/").concat(s).concat(r,".png")),v("".concat(e,"/symbol").concat(r,".png"))]);return m.width=r*o*t,m.height=r*o*A,w.drawImage(a,0,0),w.drawImage(c,0,r*o*p),m.toDataURL()}(e,n,o),a=await v(r);return b.set(s,a),a}function v(t){return new Promise(((e,n)=>{const o=new Image;o.onload=()=>e(o),o.onerror=n,o.src=t}))}var E=.5,y=26,k=4,P=5,z=7.5,S=60,N=255,M=["k","q","b","n","r","p","c","x","s","t","a","d"],T=document.createElement("canvas"),I=T.getContext("2d"),D=document.createElement("canvas"),R=D.getContext("2d"),C={26:"YdVh1QDVYdVh",32:"AAAKAAAAo/+jAAr/AP8KAKP/owAAAAoAAA==",38:"AAw+DAAM3P/cDD7/AP8+DNz/3AwADD4MAA==",44:"AC9yLwAv+f/5L3L/AP9yL/n/+S8AL3IvAA==",52:"A3i2eAN4////eLb/AP+2eP///3gDeLZ4Aw==",64:"AAAEHgQAAAA/5v/mPwAE5v///+YEHv//AP//HgTm////5gQAP+b/5j8AAAAEHgQAAA==",76:"AARZhFkEAAS7////uwRZ//////9ZhP//AP//hFn//////1kEu////7sEAARZhFkEAA==",88:"AEfE68RHAEf8/////EfE///////E6///AP//68T//////8RH/P////xHAEfE68RHAA=="};function F(t,n,o,s,r,a){const{w:c,h:i,border:l,offset:f,margin:h}=d(o,a),u=function(t,e){const n=t.set+t.size*e;return b.get(n)}(o,s);t.canvas.width=c*s,t.canvas.height=i*s,t.save(),t.scale(s,s);const A="classic"==o.bg,p=r||A;t.translate(f.x,f.y);for(let e=0;e<o.h;e++)for(let r=0;r<o.w;r++)p||O(t,e,r,o),L(t,e,r,n[e*o.w+r],{assets:u,options:o,dpr:s});if(t.restore(),A&&!r){!function(t,e,n){const o=t.canvas;D.width=T.width=o.width,D.height=T.height=o.height,I.drawImage(o,0,0),t.save(),t.fillStyle="white",t.fillRect(0,0,o.width,o.height),t.globalCompositeOperation="destination-in",t.drawImage(T,0,0),t.restore(),t.save();const s=function(t){if("string"==typeof C[t]){const e=atob(C[t]),n=[];for(let t=0;t<e.length;t++)n.push(e.charCodeAt(t));C[t]=n}return C[t]}(e*n),r=Math.sqrt(s.length),a=(r-1)/2;for(let e=0;e<r;e++)for(let n=0;n<r;n++){const c=s[n*r+e];0!=c&&(t.globalAlpha=c/N,R.drawImage(o,e-a,n-a))}t.restore()}(t,o.size,s),t.save(),t.scale(s,s),t.translate(f.x,f.y);for(let e=0;e<o.h;e++)for(let n=0;n<o.w;n++)O(t,e,n,o);t.restore(),t.drawImage(D,0,0),t.drawImage(D,0,0),t.drawImage(D,0,0),t.drawImage(T,0,0)}t.scale(s,s),void 0===a&&o.coordinates&&(t.save(),t.translate(f.x,f.y),function(t,n,o){const{size:s,w:r,h:a}=n;t.font="15px sans-serif",t.strokeStyle="black",t.lineWidth=2,t.fillStyle="white",t.lineJoin="round";for(let e=0;e<a;e++){const n=(e+1).toString(),r=t.measureText(n),c=s*(a-e)-s/2+P,i=(g-r.width)/2-g-o;t.strokeText(n,i,c),t.fillText(n,i,c)}for(let n=0;n<r&&n<y;n++){const r=String.fromCharCode(e+n),c=t.measureText(r),i=s*a+g+o-P,l=s*n+(s-c.width)/2;t.strokeText(r,l,i),t.fillText(r,l,i)}}(t,o,l.size),t.restore()),r||function(t,e,n,o,s){t.save(),t.translate(s.x,0),n-=s.x,o-=s.y;let r=0;for(let s=0;s<e.array.length;s++){const a=e.array[s];if(t.strokeStyle=s%2?"white":"black",0==a)continue;t.lineWidth=a;const c=e.size-r-a/2;t.strokeRect(c,c,n-2*c,o-2*c),r+=a}t.restore()}(t,l,c,i,h)}function L(t,e,n,o,{assets:s,options:r,dpr:c}){const i=function(t,e){void 0===t&&(t="");const n=t&&t.startsWith("-");n&&(t=t.substring(1));const o=t.match(/^\*(\d)/);let s=o&&o[1]||void 0;void 0!==s&&(t=t.substring(2));s=Number(s)%4,e.SN&&(t=function(t,e,n){return t.match(/^-?(\*\d)?[sng]$/i)?(e?(n&&(t=t.replace("s","g").replace("S","G")),t=t.replace("n","s").replace("N","S")):(n&&(t=t.replace("s","n").replace("S","N")),t=t.replace("g","s").replace("G","S")),t):t}(t,!1,!0));const r=t.toLowerCase(),a=M.indexOf(r),c=t.startsWith("'");return a<0&&!c?null:{neutral:n,rotate:s,isText:c,value:t,lower:r,typeIndex:a}}(o,r);if(!i)return;const{neutral:l,rotate:f,isText:h,value:u,lower:g,typeIndex:d}=i;t.save();const A=r.blackWhite,p=function(t,e){const{neutral:n,value:o,lower:s}=t;return n?e?0:2:o==s?0:1}(i,A),m=function(t,e,n,o){return t&&n?"n"==e?o.knightOffset:E:1}(l,g,A,r),[w,b]=[f+1&2?1:0,2&f?1:0],{size:x}=r;if(t.translate((n+w)*x,(e+b)*x),0!==f&&t.rotate(Math.PI/2*f),h){!function(t,e,n){t.save();const o=a.test(e),s=n-k;t.font="".concat(s,"px sans-serif");const r=n-2;let c=t.measureText(e);if(o&&c.width>r){const n=r/c.width;t.font="".concat(s*n,"px sans-serif"),c=t.measureText(e)}const i=function(t){return t.actualBoundingBoxAscent-t.actualBoundingBoxDescent}(o?t.measureText("M"):c),l=(n-Math.min(c.width,r))/2,f=Math.max((n-i)/2,0);t.fillStyle="black",t.fillText(e,l,n-f,r),t.restore()}(t,u.substring(u.startsWith("''")?2:1),x)}else t.drawImage(s,p*x*c,d*x*c,x*m*c,x*c,0,0,x*m,x),l&&A&&t.drawImage(s,(1+m)*x*c,d*x*c,x*(1-m)*c,x*c,x*m,0,x*(1-m),x);t.restore()}function O(t,e,n,o){const s=function(t,e,n){if("mono"==t)return 1;let o=(e+n)%2;return"inverted"!=t&&(o=1-o),o}(o.pattern,e,n),r=o.size;t.save(),t.translate(n*r,e*r),"classic"==o.bg?(t.strokeStyle="black",t.lineWidth=r/S,t.fillStyle="#fff",t.fillRect(0,0,r,r),s||function(t,e){t.beginPath();const n=e/z;for(let o=0;o<e;o+=n)t.moveTo(e-o,0),t.lineTo(0,e-o),o>0&&(t.moveTo(o,e),t.lineTo(e,o));t.stroke()}(t,r)):(t.fillStyle=function(t,e){return"classic"==e?"none":"gray"==e?t?"#fff":"#bbb":"green"==e?t?"#EEEED2":"#769656":t?"#FFCE9E":"#D18B47"}(s,o.bg),t.fillRect(0,0,r,r)),t.restore()}var W=document.getElementById("CN"),H=W.getContext("2d"),B=Math.min(2,Math.floor(devicePixelRatio));parent.postMessage(null,"*"),onmessage=async t=>{if(t.source!=parent||!t.ports[0])return;gtag("event","fen_sdk_gen");const e=u(t.data.options),n=t.data.fen||"8/8/8/8/8/8/8/8",{w:o,h:s}=function(t){const e=t.match(c)||[],n=[0];let o=0;for(const t of e)"/"==t?n[++o]=0:t.match(/^\d+$/)?n[o]+=Number(t):n[o]++;const s=n.length;if(1==s)return;const r=n[0];for(const t of n)if(t!=r)return;return{w:r,h:s}}(n)||e,r=function(t,e=8,n=8){const o=t.match(c)||[],s=[];let r=!1;for(const t of o){if("/"==t){if(!r){const t=s.length+e-s.length%e;for(;s.length<t;)s.push("")}}else if(t.match(/^\d+$/)){const e=Number(t);for(let t=0;t<e;t++)s.push("")}else s.push(t);if(r="/"!=t&&s.length%e==0,s.length==e*n)break}for(;s.length<e*n;)s.push("");return s}(n,o,s);e.w=o,e.h=s,await x("../assets",e,B);const a=function(t,e){const{w:n,h:o}=d(e);return W.width=n*B,W.height=o*B,W.style.width=n+"px",W.style.height=o+"px",F(H,t,e,B),W}(r,e);t.ports[0].postMessage(a.toDataURL())}})();