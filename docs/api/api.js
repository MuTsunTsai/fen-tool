(()=>{var t="０１２３４５６７８９".split(""),e=function(){const e=new Map,s="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ,./<>?;':\"[]\\{}|!@#$%^&*()_+-=`~".split(""),a="ａｂｃｄｅｆｇｈｉｊｋｌｍｎｏｐｑｒｓｔｕｖｗｘｙｚＡＢＣＤＥＦＧＨＩＪＫＬＭＮＯＰＱＲＳＴＵＶＷＸＹＺ，．／＜＞？；’：”〔〕＼｛｝｜！＠＃＄％︿＆＊（）ˍ＋－＝‘～".split("");for(let t=0;t<s.length;t++)e.set(s[t],a[t]);for(let s=0;s<10;s++)e.set(s.toString(),t[s]);return e}();var s=["k","q","b","n","r","p","c","x"];function a(t,a,n,r,o,i,l){const c=l.size,f=o.startsWith("-");f&&(o=o.substring(1));const u=o.match(/^\*(\d)/);let g=u&&u[1]||void 0;void 0!==g&&(o=o.substring(2)),g=Number(g)%4,"s"==o&&(o="n"),"S"==o&&(o="N");const h=o.toLowerCase(),d=s.indexOf(h),m=o.startsWith("'");if((d<0||l.grayBG)&&2!=i&&function(t,e,s,a,n){const r=n.size;t.save(),n.grayBG?t.fillStyle=a?"#fff":"#bbb":t.fillStyle=a?"#FFCE9E":"#D18B47";t.fillRect(s*r+1,e*r+1,r,r),t.restore()}(t,n,r,i,l),d<0&&!m)return;t.save(),l.grayBG&&(i=2);const p=l.blackWhite,b=f?p?0:2:o==h?0:1,v=f&&p?"n"==h?l.knightOffset:.5:1,[k,x]=[g+1&2?1:0,2&g?1:0];if(t.translate((r+k)*c+1,(n+x)*c+1),0!==g&&t.rotate(Math.PI/2*g),m){const s=o.substring(1);!function(t,e,s){t.fillStyle="black";const a=t.measureText(e),n=a.actualBoundingBoxAscent-a.actualBoundingBoxDescent,r=Math.max((s-a.width)/2,0),o=Math.max((s-n)/2,0);t.fillText(e,r,s-o,s)}(t,o.startsWith("''")?o.substring(2):(B=s,((w=!1)&&"c"==B.toLowerCase()?"‧":w&&"x"==B.toLowerCase()?"╳":e.get(B))||s),c)}else t.drawImage(a,(b+3*i)*c,d*c,c*v,c,0,0,c*v,c),f&&p&&t.drawImage(a,(1+v+3*i)*c,d*c,c*(1-v),c,c*v,0,c*(1-v),c);var B,w;t.restore()}var n=/\/|\d|\(!?[kqbnrp]\d?\)|[-~]?(\*\d)?([kqbsnrpcx]|'[^']|''..)|./giu;var r={uncolored:!1,inverted:!1,grayBG:!1,blackWhite:!1,knightOffset:.6,SN:!1,size:44,set:"1echecs"},o=Number(url.searchParams.get("size"));[26,32,38,44].includes(o)&&(r.size=o);var i=url.searchParams.get("set");["1echecs","alpha","goodCompanion","merida","skak"].includes(i)&&(r.set=i);var l=Number(url.searchParams.get("knightOffset"));0<l&&l<1&&(r.knightOffset=l);for(const t of["uncolored","inverted","grayBG","blackWhite"])url.searchParams.has(t)&&(r[t]=!0);var c=document.getElementById("CN"),f=c.getContext("2d");c.width=c.height=8*r.size+2;var u=new Image,g=new Promise((t=>{u.onload=t,u.src=`../assets/${r.set}${r.size}.png`}));parent.postMessage(null),onmessage=async t=>{if(!t.ports[0])return;await g;!function(t){const e=8*r.size+2;f.fillStyle="black",f.fillRect(0,0,e,e),f.font=r.size-4+"px arial";for(let e=0;e<8;e++)for(let s=0;s<8;s++){const n=r.uncolored||r.inverted==Boolean((e+s)%2)?1:0;a(f,u,e,s,t[8*e+s],n,r)}}(function(t){const e=t.match(n)||[],s=[];let a=!1;for(const t of e){if("/"==t){if(!a){const t=s.length+8-s.length%8;for(;s.length<t;)s.push("")}}else if(t.match(/^\d$/)){const e=Number(t);for(let t=0;t<e;t++)s.push("")}else s.push(t);a="/"!=t&&s.length%8==0}for(;s.length<64;)s.push("");return s}(t.data||"8/8/8/8/8/8/8/8")),t.ports[0].postMessage(c.toDataURL())}})();