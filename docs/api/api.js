(()=>{var t=/\/|\d+|\(!?[kqbnrp]\d?\)|[-~]?(\*\d)?([kqbsnrpcx]|'[^']|''..)|./giu;var e={pattern:void 0,bg:void 0,border:"1",blackWhite:!1,knightOffset:.6,SN:!1,size:44,w:8,h:8,set:"1echecs"},n=/^\d+(,\d+)*$/,s=[26,32,38,44],r=["1echecs","alpha","goodCompanion","merida","skak"];function o(t){const e=t.split(",").map((t=>{const e=Number(t);return isNaN(e)?0:Math.abs(Math.floor(e))})),n=e.reduce(((t,e)=>t+e),0);return{array:e,size:n}}var a="０１２３４５６７８９".split(""),i=function(){const t=new Map,e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ,./<>?;':\"[]\\{}|!@#$%^&*()_+-=`~".split(""),n="ａｂｃｄｅｆｇｈｉｊｋｌｍｎｏｐｑｒｓｔｕｖｗｘｙｚＡＢＣＤＥＦＧＨＩＪＫＬＭＮＯＰＱＲＳＴＵＶＷＸＹＺ，．／＜＞？；’：”〔〕＼｛｝｜！＠＃＄％︿＆＊（）ˍ＋－＝‘～".split("");for(let s=0;s<e.length;s++)t.set(e[s],n[s]);for(let e=0;e<10;e++)t.set(e.toString(),a[e]);return t}();var c=["k","q","b","n","r","p","c","x"];function f(t,e,n,s,r,o,a){const f=a.size,l=r.startsWith("-");l&&(r=r.substring(1));const h=r.match(/^\*(\d)/);let u=h&&h[1]||void 0;void 0!==u&&(r=r.substring(2)),u=Number(u)%4,"s"==r&&(r="n"),"S"==r&&(r="N");const g=r.toLowerCase(),d=c.indexOf(g),b=r.startsWith("'"),p="gray"==a.bg;if((d<0||p)&&2!=o&&function(t,e,n,s,r){const o=r.size;t.save(),"gray"==r.bg?t.fillStyle=s?"#fff":"#bbb":t.fillStyle=s?"#FFCE9E":"#D18B47";t.fillRect(n*o,e*o,o,o),t.restore()}(t,n,s,o,a),d<0&&!b)return;t.save(),p&&(o=2);const m=a.blackWhite,w=l?m?0:2:r==g?0:1,k=l&&m?"n"==g?a.knightOffset:.5:1,[v,z]=[u+1&2?1:0,2&u?1:0];if(t.translate((s+v)*f,(n+z)*f),0!==u&&t.rotate(Math.PI/2*u),b){const e=r.substring(1);!function(t,e,n){t.save();const s=/\p{Extended_Pictographic}/u.test(e),r=n-4;t.font=`${r}px arial`;const o=n-2;let a=t.measureText(e);if(s&&a.width>o){const n=o/a.width;t.font=r*n+"px arial",a=t.measureText(e)}const i=a.actualBoundingBoxAscent-a.actualBoundingBoxDescent,c=(n-Math.min(a.width,o))/2,f=Math.max((n-i)/2,0);t.fillStyle="black",t.fillText(e,c,n-f,o),t.restore()}(t,r.startsWith("''")?r.substring(2):(x=e,((N=!1)&&"c"==x.toLowerCase()?"‧":N&&"x"==x.toLowerCase()?"╳":i.get(x))||e),f)}else t.drawImage(e,(w+3*o)*f,d*f,f*k,f,0,0,f*k,f),l&&m&&t.drawImage(e,(1+k+3*o)*f,d*f,f*(1-k),f,f*k,0,f*(1-k),f);var x,N;t.restore()}function l(t,e,n){if("mono"==t)return 1;let s=(e+n)%2;return"inverted"!=t&&(s=1-s),s}var h=document.getElementById("CN"),u=h.getContext("2d");function g(t,e,n){const s=o(n.border),r=n.w*n.size+2*s.size,a=n.h*n.size+2*s.size;return h.width=r,h.height=a,function(t,e,n,s,r){const a=o(s.border),i=s.w*s.size+2*a.size,c=s.h*s.size+2*a.size;t.canvas.width=i,t.canvas.height=c,r?t.clearRect(0,0,i,c):function(t,e,n,s){t.save();let r=0;for(let o=0;o<e.array.length;o++){const a=e.array[o];if(t.strokeStyle=o%2?"white":"black",0==a)continue;t.lineWidth=a;const i=e.size-r-a/2;t.strokeRect(i,i,n-2*i,s-2*i),r+=a}t.restore()}(t,a,i,c),t.save(),t.translate(a.size,a.size);for(let o=0;o<s.h;o++)for(let a=0;a<s.w;a++){const i=r?2:l(s.pattern,o,a);f(t,e,o,a,n[o*s.w+a],i,s)}t.restore()}(u,t,e,n),h}var d=new Map;parent.postMessage(null,"*"),onmessage=async o=>{if(o.source!=parent||!o.ports[0])return;gtag("event","fen_sdk_gen");const a=function(t){const o=Object.assign({},e);if(t){const e=Number(t.size),a=Math.floor(Number(t.w)),i=Math.floor(Number(t.h));s.includes(e)&&(o.size=e),r.includes(t.set)&&(o.set=t.set),t.border&&t.border.match(n)&&(o.border=t.border),0<t.knightOffset&&t.knightOffset<1&&(o.knightOffset=t.offset),o.blackWhite=Boolean(t.blackWhite),o.pattern=t.pattern,o.bg=t.bg,o.SN=t.SN,a>0&&(o.w=a),i>0&&(o.h=i)}return o}(o.data.options),i=o.data.fen||"8/8/8/8/8/8/8/8",{w:c,h:f}=function(e){const n=e.match(t)||[],s=[0];let r=0;for(const t of n)"/"==t?s[++r]=0:t.match(/^\d+$/)?s[r]+=Number(t):s[r]++;const o=s.length;if(1==o)return;const a=s[0];for(const t of s)if(t!=a)return;return{w:a,h:o}}(i)||a,l=function(e,n=8,s=8){const r=e.match(t)||[],o=[];let a=!1;for(const t of r){if("/"==t){if(!a){const t=o.length+n-o.length%n;for(;o.length<t;)o.push("")}}else if(t.match(/^\d+$/)){const e=Number(t);for(let t=0;t<e;t++)o.push("")}else o.push(t);if(a="/"!=t&&o.length%n==0,o.length==n*s)break}for(;o.length<n*s;)o.push("");return o}(i,c,f);a.w=c,a.h=f;const h=await function(t){const e=t.set+t.size;if(d.has(e))return d.get(e);{const n=new Promise((e=>{const n=new Image;n.onload=()=>e(n),n.src=`../assets/${t.set}${t.size}.png`}));return d.set(e,n),n}}(a),u=g(h,l,a);o.ports[0].postMessage(u.toDataURL())}})();