(()=>{var e="[ðŸ‡¦-ðŸ‡¿]{2}|\\p{ExtPict}\\uFE0F?\\p{EMod}?(\\u200D\\p{ExtPict}\\uFE0F?\\p{EMod}?)*",t="\\((!?)([kqbnrp])(\\d?)\\)",n=`[-~]?(\\*\\d)?([kqbnrpcxstadg]|${`'(${e}|[^'])|''..`})`,s=RegExp(`^(?:${e})$`,"u"),r=RegExp(`\\/|\\d+|${t}|${n}|.`,"iug");var a={pattern:void 0,bg:void 0,border:"1",blackWhite:!1,knightOffset:.6,SN:!1,size:44,w:8,h:8,set:"1echecs",collapse:!1},o=/^\d+(,\d+)*$/,i=[26,32,38,44],c=["1echecs","alpha","goodCompanion","merida","skak"];function l(e){const t=e.split(",").map((e=>{const t=Number(e);return isNaN(t)?0:Math.abs(Math.floor(t))})),n=t.reduce(((e,t)=>e+t),0);return{array:t,size:n}}var f=["k","q","b","n","r","p","c","x","s","t","a","d"],h=document.createElement("canvas"),g=h.getContext("2d"),d=document.createElement("canvas"),u=d.getContext("2d"),m={26:[0,0,0,0,0,0,97,213,97,0,0,213,255,213,0,0,97,213,97,0,0,0,0,0,0],32:[0,0,10,0,0,0,163,255,163,0,10,255,255,255,10,0,163,255,163,0,0,0,10,0,0],38:[0,12,62,12,0,12,220,255,220,12,62,255,255,255,62,12,220,255,220,12,0,12,62,12,0],44:[0,47,114,47,0,47,249,255,249,47,114,255,255,255,114,47,249,255,249,47,0,47,114,47,0]};function p(e,t,n,s,r){const a=l(s.border),o=s.w*s.size+2*a.size,i=s.h*s.size+2*a.size;e.canvas.width=o,e.canvas.height=i;const c="classic"==s.bg,f=r||c;f&&e.clearRect(0,0,o,i),e.save(),e.translate(a.size,a.size);for(let r=0;r<s.h;r++)for(let a=0;a<s.w;a++)f||b(e,r,a,s),w(e,t,r,a,n[r*s.w+a],s);if(e.restore(),c&&!r){!function(e,t){const n=e.canvas;d.width=h.width=n.width,d.height=h.height=n.height,g.drawImage(n,0,0),e.save(),e.fillStyle="white",e.fillRect(0,0,n.width,n.height),e.globalCompositeOperation="destination-in",e.drawImage(h,0,0),e.restore(),e.save();for(let s=0;s<5;s++)for(let r=0;r<5;r++){const a=m[t][5*r+s];0!=a&&(e.globalAlpha=a/255,u.drawImage(n,s-2,r-2))}e.restore()}(e,s.size),e.save(),e.translate(a.size,a.size);for(let t=0;t<s.h;t++)for(let n=0;n<s.w;n++)b(e,t,n,s);e.restore(),e.drawImage(d,0,0),e.drawImage(d,0,0),e.drawImage(d,0,0),e.drawImage(h,0,0)}r||function(e,t,n,s){e.save();let r=0;for(let a=0;a<t.array.length;a++){const o=t.array[a];if(e.strokeStyle=a%2?"white":"black",0==o)continue;e.lineWidth=o;const i=t.size-r-o/2;e.strokeRect(i,i,n-2*i,s-2*i),r+=o}e.restore()}(e,a,o,i)}function w(e,t,n,r,a,o){const i=o.size,c=a.startsWith("-");c&&(a=a.substring(1));const l=a.match(/^\*(\d)/);let h=l&&l[1]||void 0;void 0!==h&&(a=a.substring(2)),h=Number(h)%4,o.SN&&(a=function(e,t,n){return e.match(/^-?(\*\d)?[sng]$/i)?(t?(n&&(e=e.replace("s","g").replace("S","G")),e=e.replace("n","s").replace("N","S")):(n&&(e=e.replace("s","n").replace("S","N")),e=e.replace("g","s").replace("G","S")),e):e}(a,!1,!0));const g=a.toLowerCase(),d=f.indexOf(g),u=a.startsWith("'");if(d<0&&!u)return;e.save();const m=o.blackWhite,p=c?m?0:2:a==g?0:1,w=c&&m?"n"==g?o.knightOffset:.5:1,[b,v]=[h+1&2?1:0,2&h?1:0];if(e.translate((r+b)*i,(n+v)*i),0!==h&&e.rotate(Math.PI/2*h),u){!function(e,t,n){e.save();const r=s.test(t),a=n-4;e.font=`${a}px sans-serif`;const o=n-2;let i=e.measureText(t);if(r&&i.width>o){const n=o/i.width;e.font=a*n+"px sans-serif",i=e.measureText(t)}const c=function(e){return e.actualBoundingBoxAscent-e.actualBoundingBoxDescent}(r?e.measureText("M"):i),l=(n-Math.min(i.width,o))/2,f=Math.max((n-c)/2,0);e.fillStyle="black",e.fillText(t,l,n-f,o),e.restore()}(e,a.substring(a.startsWith("''")?2:1),i)}else e.drawImage(t,p*i,d*i,i*w,i,0,0,i*w,i),c&&m&&e.drawImage(t,(1+w)*i,d*i,i*(1-w),i,i*w,0,i*(1-w),i);e.restore()}function b(e,t,n,s){const r=function(e,t,n){if("mono"==e)return 1;let s=(t+n)%2;return"inverted"!=e&&(s=1-s),s}(s.pattern,t,n),a=s.size;if(e.save(),e.translate(n*a,t*a),"classic"==s.bg){if(e.strokeStyle="black",e.lineWidth=a/60,e.fillStyle="#fff",e.fillRect(0,0,a,a),!r){e.beginPath();const t=a/7.5;for(let n=0;n<a;n+=t)e.moveTo(a-n,0),e.lineTo(0,a-n),n>0&&(e.moveTo(n,a),e.lineTo(a,n));e.stroke()}}else e.fillStyle=function(e,t){return"classic"==t?"none":"gray"==t?e?"#fff":"#bbb":"green"==t?e?"#EEEED2":"#769656":e?"#FFCE9E":"#D18B47"}(r,s.bg),e.fillRect(0,0,a,a);e.restore()}var v=document.getElementById("CN"),k=v.getContext("2d");var z=document.createElement("canvas"),x=z.getContext("2d");var E=new Map;function I(e){const t=e.set+e.size;if(E.has(t))return E.get(t);{const n=new Promise((async t=>{const n=new Image,s=await async function(e,t){const{set:n,size:s}=t,r=new Image,a=new Image;return await Promise.all([new Promise((t=>{r.onload=t,r.src=`${e}/${n}${s}.png`})),new Promise((t=>{a.onload=t,a.src=`${e}/symbol${s}.png`}))]),z.width=3*s,z.height=12*s,x.drawImage(r,0,0),x.drawImage(a,0,6*s),z}("../assets",e);n.onload=()=>t(n),n.src=s.toDataURL()}));return E.set(t,n),n}}parent.postMessage(null,"*"),onmessage=async e=>{if(e.source!=parent||!e.ports[0])return;gtag("event","fen_sdk_gen");const t=function(e){const t=Object.assign({},a);if(e){const n=Number(e.size),s=Math.floor(Number(e.w)),r=Math.floor(Number(e.h));i.includes(n)&&(t.size=n),c.includes(e.set)&&(t.set=e.set),e.border&&e.border.match(o)&&(t.border=e.border),0<e.knightOffset&&e.knightOffset<1&&(t.knightOffset=e.offset),t.blackWhite=Boolean(e.blackWhite),t.pattern=e.pattern,t.bg=e.bg,t.SN=e.SN,s>0&&(t.w=s),r>0&&(t.h=r)}return t}(e.data.options),n=e.data.fen||"8/8/8/8/8/8/8/8",{w:s,h:f}=function(e){const t=e.match(r)||[],n=[0];let s=0;for(const e of t)"/"==e?n[++s]=0:e.match(/^\d+$/)?n[s]+=Number(e):n[s]++;const a=n.length;if(1==a)return;const o=n[0];for(const e of n)if(e!=o)return;return{w:o,h:a}}(n)||t,h=function(e,t=8,n=8){const s=e.match(r)||[],a=[];let o=!1;for(const e of s){if("/"==e){if(!o){const e=a.length+t-a.length%t;for(;a.length<e;)a.push("")}}else if(e.match(/^\d+$/)){const t=Number(e);for(let e=0;e<t;e++)a.push("")}else a.push(e);if(o="/"!=e&&a.length%t==0,a.length==t*n)break}for(;a.length<t*n;)a.push("");return a}(n,s,f);t.w=s,t.h=f;const g=function(e,t,n){const s=l(n.border),r=n.w*n.size+2*s.size,a=n.h*n.size+2*s.size;return v.width=r,v.height=a,p(k,e,t,n),v}(await I(t),h,t);e.ports[0].postMessage(g.toDataURL())}})();