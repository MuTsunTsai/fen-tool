"use strict";(()=>{var t=3,e=97,n="\\p{Extended_Pictographic}",o="\\p{Emoji_Modifier}",r="".concat("\\p{Regional_Indicator}","{2}|").concat(n,"\\uFE0F?").concat(o,"?(\\u200D").concat(n,"\\uFE0F?").concat(o,"?)*"),s="\\((!?)([kqbnrp])(\\d?)\\)",a="'(".concat(r,"|[^'])|''.."),c="[-~]?(\\*\\d)?(".concat("[kqbnrpcxstadg]","|").concat(a,")"),i=RegExp("^(?:".concat(r,")$"),"u"),l=("^(?:".concat(s,"|").concat(c,")$"),RegExp("\\/|\\d+|".concat(s,"|").concat(c,"|."),"iug"));var f={pattern:void 0,bg:void 0,exHigh:!0,border:"1",blackWhite:!1,knightOffset:.6,SN:!1,size:44,w:8,h:8,fullFEN:!1,coordinates:!1,set:"1echecs",collapse:!0},h=/^\d+(,\d+)*$/,u=[26,32,38,44],d=["1echecs","alpha","goodCompanion","kilfiger","merida","mpchess","skak"];function g(t){const e=Object.assign({},f);if(t){const n=Number(t.size);u.includes(n)&&(e.size=n),t.set&&d.includes(t.set)&&(e.set=t.set),t.border=function(t){if("string"==typeof t&&(t=t.replace(/\D/g,",").replace(/,+/g,",").replace(/^,/,"").replace(/,$/,"")).match(h))return t}(t.border),t.border&&(e.border=t.border),t.knightOffset&&0<t.knightOffset&&t.knightOffset<1&&(e.knightOffset=t.knightOffset),e.blackWhite=Boolean(t.blackWhite),e.pattern=t.pattern,e.bg=t.bg,e.SN=t.SN||!1;const o=Math.floor(Number(t.w)),r=Math.floor(Number(t.h));o>0&&(e.w=o),r>0&&(e.h=r)}return e}var A=20;function m(t,e){const n=function(t){const e=t.split(",").map((t=>{const e=Number(t);return isNaN(e)?0:Math.abs(Math.floor(e))})),n=e.reduce(((t,e)=>t+e),0);return{array:e,size:n}}(t.border),o=t.coordinates?{x:A,y:A}:{x:0,y:0};!0===e&&(o.y=0),!1===e&&(o.x=0);return{w:t.w*t.size+2*n.size+o.x,h:t.h*t.size+2*n.size+o.y,border:n,offset:{x:n.size+o.x,y:n.size},margin:o}}var p=12,w=6,b=document.createElement("canvas"),x=b.getContext("2d"),v=new Map;async function k(e,n,o){const r=n.set+n.size*o;if(v.has(r))return v.get(r);const s=await async function(e,n,o){const{set:r,size:s}=n;e+="/x"+o;const[a,c]=await Promise.all([y("".concat(e,"/").concat(r).concat(s,".png")),y("".concat(e,"/symbol").concat(s,".png"))]);return b.width=s*o*t,b.height=s*o*p,x.drawImage(a,0,0),x.drawImage(c,0,s*o*w),b.toDataURL()}(e,n,o),a=await y(s);return v.set(r,a),a}function y(t){return new Promise(((e,n)=>{const o=new Image;o.onload=()=>e(o),o.onerror=n,o.src=t}))}var E=.5,z=26,N=4,P=5,S=7.5,I=60,T=255,M=["k","q","b","n","r","p","c","x","s","t","a","d"],R=document.createElement("canvas"),D=R.getContext("2d"),C=document.createElement("canvas"),F=C.getContext("2d"),L={26:"YdVh1QDVYdVh",32:"AAAKAAAAo/+jAAr/AP8KAKP/owAAAAoAAA==",38:"AAw+DAAM3P/cDD7/AP8+DNz/3AwADD4MAA==",44:"AC9yLwAv+f/5L3L/AP9yL/n/+S8AL3IvAA==",52:"A3i2eAN4////eLb/AP+2eP///3gDeLZ4Aw==",64:"AAAEHgQAAAA/5v/mPwAE5v///+YEHv//AP//HgTm////5gQAP+b/5j8AAAAEHgQAAA==",76:"AARZhFkEAAS7////uwRZ//////9ZhP//AP//hFn//////1kEu////7sEAARZhFkEAA==",88:"AEfE68RHAEf8/////EfE///////E6///AP//68T//////8RH/P////xHAEfE68RHAA=="},O={};function W(t,n,o,r,s,a){const{w:c,h:i,border:l,offset:f,margin:h}=m(o,a),u=function(t,e){const n=t.set+t.size*e;return v.get(n)}(o,r);t.canvas.width=c*r,t.canvas.height=i*r,t.save(),t.scale(r,r);const d="classic"==o.bg,g=s||d;t.translate(f.x,f.y);for(let e=0;e<o.h;e++)for(let s=0;s<o.w;s++)g||B(t,e,s,o),H(t,e,s,n[e*o.w+s],{assets:u,options:o,dpr:r});if(t.restore(),d&&!s){!function(t,e,n){const o=t.canvas;C.width=R.width=o.width,C.height=R.height=o.height,D.drawImage(o,0,0),t.save(),t.fillStyle="white",t.fillRect(0,0,o.width,o.height),t.globalCompositeOperation="destination-in",t.drawImage(R,0,0),t.restore(),t.save();const r=function(t){if(!(t in O)){const e=atob(L[t]),n=[];for(let t=0;t<e.length;t++)n.push(e.charCodeAt(t));O[t]=n}return O[t]}(e*n),s=Math.sqrt(r.length),a=(s-1)/2;for(let e=0;e<s;e++)for(let n=0;n<s;n++){const c=r[n*s+e];0!=c&&(t.globalAlpha=c/T,F.drawImage(o,e-a,n-a))}t.restore()}(t,o.size,r),t.save(),t.scale(r,r),t.translate(f.x,f.y);for(let e=0;e<o.h;e++)for(let n=0;n<o.w;n++)B(t,e,n,o);t.restore(),t.drawImage(C,0,0),t.drawImage(C,0,0),t.drawImage(C,0,0),t.drawImage(R,0,0)}t.scale(r,r),void 0===a&&o.coordinates&&(t.save(),t.translate(f.x,f.y),function(t,n,o){const{size:r,w:s,h:a}=n;t.font="15px sans-serif",t.strokeStyle="black",t.lineWidth=2,t.fillStyle="white",t.lineJoin="round";for(let e=0;e<a;e++){const n=(e+1).toString(),s=t.measureText(n),c=r*(a-e)-r/2+P,i=(A-s.width)/2-A-o;t.strokeText(n,i,c),t.fillText(n,i,c)}for(let n=0;n<s&&n<z;n++){const s=String.fromCharCode(e+n),c=t.measureText(s),i=r*a+A+o-P,l=r*n+(r-c.width)/2;t.strokeText(s,l,i),t.fillText(s,l,i)}}(t,o,l.size),t.restore()),s||function(t,e,n,o,r){t.save(),t.translate(r.x,0),n-=r.x,o-=r.y;let s=0;for(let r=0;r<e.array.length;r++){const a=e.array[r];if(t.strokeStyle=r%2?"white":"black",0==a)continue;t.lineWidth=a;const c=e.size-s-a/2;t.strokeRect(c,c,n-2*c,o-2*c),s+=a}t.restore()}(t,l,c,i,h)}function H(t,e,n,o,{assets:r,options:s,dpr:a}){const c=function(t,e){void 0===t&&(t="");const n=Boolean(t)&&t.startsWith("-");n&&(t=t.substring(1));const o=t.match(/^\*(\d)/);let r=o&&o[1]?Number(o[1]):void 0;void 0!==r&&(t=t.substring(2));r=Number(r)%4,e.SN&&(t=function(t,e,n){return t.match(/^-?(\*\d)?[sng]$/i)?(e?(n&&(t=t.replace("s","g").replace("S","G")),t=t.replace("n","s").replace("N","S")):(n&&(t=t.replace("s","n").replace("S","N")),t=t.replace("g","s").replace("G","S")),t):t}(t,!1,!0));const s=t.toLowerCase(),a=M.indexOf(s),c=t.startsWith("'");return a<0&&!c?null:{neutral:n,rotate:r,isText:c,value:t,lower:s,typeIndex:a}}(o,s);if(!c)return;const{neutral:l,rotate:f,isText:h,value:u,lower:d,typeIndex:g}=c;t.save();const A=s.blackWhite,m=function(t,e){const{neutral:n,value:o,lower:r}=t;return n?e?0:2:o==r?0:1}(c,A),p=function(t,e,n,o){return t&&n?"n"==e?o.knightOffset:E:1}(l,d,A,s),[w,b]=[f+1&2?1:0,2&f?1:0],{size:x}=s;if(t.translate((n+w)*x,(e+b)*x),0!==f&&t.rotate(Math.PI/2*f),h){!function(t,e,n){t.save();const o=i.test(e),r=n-N;t.font="".concat(r,"px sans-serif");const s=n-2;let a=t.measureText(e);if(o&&a.width>s){const n=s/a.width;t.font="".concat(r*n,"px sans-serif"),a=t.measureText(e)}const c=function(t){return t.actualBoundingBoxAscent-t.actualBoundingBoxDescent}(o?t.measureText("M"):a),l=(n-Math.min(a.width,s))/2,f=Math.max((n-c)/2,0);t.fillStyle="black",t.fillText(e,l,n-f,s),t.restore()}(t,u.substring(u.startsWith("''")?2:1),x)}else t.drawImage(r,m*x*a,g*x*a,x*p*a,x*a,0,0,x*p,x),l&&A&&t.drawImage(r,(1+p)*x*a,g*x*a,x*(1-p)*a,x*a,x*p,0,x*(1-p),x);t.restore()}function B(t,e,n,o){const r=function(t,e,n){if("mono"==t)return 1;let o=(e+n)%2;return"inverted"!=t&&(o=1-o),o}(o.pattern,e,n),s=o.size;t.save(),t.translate(n*s,e*s),"classic"==o.bg?(t.strokeStyle="black",t.lineWidth=s/I,t.fillStyle="#fff",t.fillRect(0,0,s,s),r||function(t,e){t.beginPath();const n=e/S;for(let o=0;o<e;o+=n)t.moveTo(e-o,0),t.lineTo(0,e-o),o>0&&(t.moveTo(o,e),t.lineTo(e,o));t.stroke()}(t,s)):(t.fillStyle=function(t,e){return"classic"==e?"none":"gray"==e?t?"#fff":"#bbb":"green"==e?t?"#EEEED2":"#769656":t?"#FFCE9E":"#D18B47"}(r,o.bg),t.fillRect(0,0,s,s)),t.restore()}var $=document.getElementById("CN"),Z=$.getContext("2d"),_=Math.min(2,Math.floor(devicePixelRatio));parent.postMessage(null,"*"),onmessage=async t=>{if(t.source!=parent||!t.ports[0])return;gtag("event","fen_sdk_gen");const e=g(t.data.options),n=t.data.fen||"8/8/8/8/8/8/8/8",{w:o,h:r}=function(t){const e=t.match(l)||[],n=[0];let o=0;for(const t of e)"/"==t?n[++o]=0:t.match(/^\d+$/)?n[o]+=Number(t):n[o]++;const r=n.length;if(1==r)return;const s=n[0];for(const t of n)if(t!=s)return;return{w:s,h:r}}(n)||e,s=function(t,e=8,n=8){const o=t.match(l)||[],r=[];let s=!1;for(const t of o){if("/"==t){if(!s){const t=r.length+e-r.length%e;for(;r.length<t;)r.push("")}}else if(t.match(/^\d+$/)){const e=Number(t);for(let t=0;t<e;t++)r.push("")}else r.push(t);if(s="/"!=t&&r.length%e==0,r.length==e*n)break}for(;r.length<e*n;)r.push("");return r}(n,o,r);e.w=o,e.h=r,await k("../assets",e,_);const a=function(t,e){const{w:n,h:o}=m(e);return $.width=n*_,$.height=o*_,$.style.width=n+"px",$.style.height=o+"px",W(Z,t,e,_),$}(s,e);t.ports[0].postMessage(a.toDataURL())}})();