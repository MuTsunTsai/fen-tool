(()=>{var t=/\/|\d|\(!?[kqbnrp]\d?\)|[-~]?(\*\d)?([kqbsnrpcx]|'[^']|''..)|./giu;var e={pattern:void 0,bg:void 0,blackWhite:!1,knightOffset:.6,SN:!1,size:44,set:"1echecs"},n=[26,32,38,44],s=["1echecs","alpha","goodCompanion","merida","skak"];var o="０１２３４５６７８９".split(""),a=function(){const t=new Map,e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ,./<>?;':\"[]\\{}|!@#$%^&*()_+-=`~".split(""),n="ａｂｃｄｅｆｇｈｉｊｋｌｍｎｏｐｑｒｓｔｕｖｗｘｙｚＡＢＣＤＥＦＧＨＩＪＫＬＭＮＯＰＱＲＳＴＵＶＷＸＹＺ，．／＜＞？；’：”〔〕＼｛｝｜！＠＃＄％︿＆＊（）ˍ＋－＝‘～".split("");for(let s=0;s<e.length;s++)t.set(e[s],n[s]);for(let e=0;e<10;e++)t.set(e.toString(),o[e]);return t}();var r=["k","q","b","n","r","p","c","x"];function i(t,e,n,s,o,i,c){const l=c.size,f=o.startsWith("-");f&&(o=o.substring(1));const g=o.match(/^\*(\d)/);let u=g&&g[1]||void 0;void 0!==u&&(o=o.substring(2)),u=Number(u)%4,"s"==o&&(o="n"),"S"==o&&(o="N");const h=o.toLowerCase(),d=r.indexOf(h),p=o.startsWith("'"),b="gray"==c.bg;if((d<0||b)&&2!=i&&function(t,e,n,s,o){const a=o.size;t.save(),"gray"==o.bg?t.fillStyle=s?"#fff":"#bbb":t.fillStyle=s?"#FFCE9E":"#D18B47";t.fillRect(n*a+1,e*a+1,a,a),t.restore()}(t,n,s,i,c),d<0&&!p)return;t.save(),b&&(i=2);const m=c.blackWhite,k=f?m?0:2:o==h?0:1,v=f&&m?"n"==h?c.knightOffset:.5:1,[w,x]=[u+1&2?1:0,2&u?1:0];if(t.translate((s+w)*l+1,(n+x)*l+1),0!==u&&t.rotate(Math.PI/2*u),p){const e=o.substring(1);!function(t,e,n){t.fillStyle="black";const s=t.measureText(e),o=s.actualBoundingBoxAscent-s.actualBoundingBoxDescent,a=Math.max((n-s.width)/2,0),r=Math.max((n-o)/2,0);t.fillText(e,a,n-r,n)}(t,o.startsWith("''")?o.substring(2):(z=e,((S=!1)&&"c"==z.toLowerCase()?"‧":S&&"x"==z.toLowerCase()?"╳":a.get(z))||e),l)}else t.drawImage(e,(k+3*i)*l,d*l,l*v,l,0,0,l*v,l),f&&m&&t.drawImage(e,(1+v+3*i)*l,d*l,l*(1-v),l,l*v,0,l*(1-v),l);var z,S;t.restore()}function c(t,e,n){if("mono"==t)return 1;let s=(e+n)%2;return"inverted"!=t&&(s=1-s),s}var l=document.getElementById("CN"),f=l.getContext("2d");var g=new Map;parent.postMessage(null,"*"),onmessage=async o=>{if(o.source!=parent||!o.ports[0])return;gtag("event","fen_sdk_gen");const a=function(e){const n=e.match(t)||[],s=[];let o=!1;for(const t of n){if("/"==t){if(!o){const t=s.length+8-s.length%8;for(;s.length<t;)s.push("")}}else if(t.match(/^\d$/)){const e=Number(t);for(let t=0;t<e;t++)s.push("")}else s.push(t);o="/"!=t&&s.length%8==0}for(;s.length<64;)s.push("");return s}(o.data.fen||"8/8/8/8/8/8/8/8"),r=function(t){const o=Object.assign({},e);if(t){const e=Number(t.size);n.includes(e)&&(o.size=e),s.includes(t.set)&&(o.set=t.set),0<t.knightOffset&&t.knightOffset<1&&(o.knightOffset=t.offset),o.blackWhite=Boolean(t.blackWhite),o.pattern=t.pattern,o.bg=t.bg,o.SN=t.SN}return o}(o.data.options),u=await function(t){const e=t.set+t.size;if(g.has(e))return g.get(e);{const n=new Promise((e=>{const n=new Image;n.onload=()=>e(n),n.src=`../assets/${t.set}${t.size}.png`}));return g.set(e,n),n}}(r),h=function(t,e,n){const s=8*n.size+2;l.width=l.height=s,f.fillStyle="black",f.fillRect(0,0,s,s),f.font=n.size-4+"px arial";for(let s=0;s<8;s++)for(let o=0;o<8;o++){const a=c(n.pattern,s,o);i(f,t,s,o,e[8*s+o],a,n)}return l}(u,a,r);o.ports[0].postMessage(h.toDataURL())}})();