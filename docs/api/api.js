(()=>{var t="[ðŸ‡¦-ðŸ‡¿]{2}|\\p{ExtPict}\\uFE0F?\\p{EMod}?(\\u200D\\p{ExtPict}\\uFE0F?\\p{EMod}?)*",e="\\((!?)([kqbnrp])(\\d?)\\)",n="'(".concat(t,"|[^'])|''.."),o="[-~]?(\\*\\d)?(".concat("[kqbnrpcxstadg]","|").concat(n,")"),s=RegExp("^(?:".concat(t,")$"),"u"),r=("^(?:".concat(e,"|").concat(o,")$"),RegExp("\\/|\\d+|".concat(e,"|").concat(o,"|."),"iug"));var a={pattern:void 0,bg:void 0,exHigh:!0,border:"1",blackWhite:!1,knightOffset:.6,SN:!1,size:44,w:8,h:8,fullFEN:!1,coordinates:!1,set:"1echecs",collapse:!0},c=/^\d+(,\d+)*$/,i=[26,32,38,44],l=["1echecs","alpha","goodCompanion","kilfiger","merida","mpchess","skak"];function f(t){const e=Object.assign({},a);if(t){const o=Number(t.size);i.includes(o)&&(e.size=o),l.includes(t.set)&&(e.set=t.set),t.border="string"!=typeof(n=t.border)?null:(n=n.replace(/\D/g,",").replace(/,+/g,",").replace(/^,/,"").replace(/,$/,"")).match(c)?n:null,t.border&&(e.border=t.border),0<t.knightOffset&&t.knightOffset<1&&(e.knightOffset=t.offset),e.blackWhite=Boolean(t.blackWhite),e.pattern=t.pattern,e.bg=t.bg,e.SN=t.SN;const s=Math.floor(Number(t.w)),r=Math.floor(Number(t.h));s>0&&(e.w=s),r>0&&(e.h=r)}var n;return e}var h=20;function g(t,e){const n=function(t){const e=t.split(",").map((t=>{const e=Number(t);return isNaN(e)?0:Math.abs(Math.floor(e))})),n=e.reduce(((t,e)=>t+e),0);return{array:e,size:n}}(t.border),o=t.coordinates?{x:h,y:h}:{x:0,y:0};!0===e&&(o.y=0),!1===e&&(o.x=0);return{w:t.w*t.size+2*n.size+o.x,h:t.h*t.size+2*n.size+o.y,border:n,offset:{x:n.size+o.x,y:n.size},margin:o}}var u=document.createElement("canvas"),d=u.getContext("2d"),A=new Map;async function m(t,e,n){const o=e.set+e.size*n;if(A.has(o))return A.get(o);const s=await async function(t,e,n){const{set:o,size:s}=e;t+="/x"+n;const[r,a]=await Promise.all([p("".concat(t,"/").concat(o).concat(s,".png")),p("".concat(t,"/symbol").concat(s,".png"))]);return u.width=s*n*3,u.height=s*n*12,d.drawImage(r,0,0),d.drawImage(a,0,s*n*6),u.toDataURL()}(t,e,n),r=await p(s);return A.set(o,r),r}function p(t){return new Promise(((e,n)=>{const o=new Image;o.onload=()=>e(o),o.onerror=n,o.src=t}))}var w=["k","q","b","n","r","p","c","x","s","t","a","d"],b=document.createElement("canvas"),x=b.getContext("2d"),v=document.createElement("canvas"),E=v.getContext("2d"),y={26:"YdVh1QDVYdVh",32:"AAAKAAAAo/+jAAr/AP8KAKP/owAAAAoAAA==",38:"AAw+DAAM3P/cDD7/AP8+DNz/3AwADD4MAA==",44:"AC9yLwAv+f/5L3L/AP9yL/n/+S8AL3IvAA==",52:"A3i2eAN4////eLb/AP+2eP///3gDeLZ4Aw==",64:"AAAEHgQAAAA/5v/mPwAE5v///+YEHv//AP//HgTm////5gQAP+b/5j8AAAAEHgQAAA==",76:"AARZhFkEAAS7////uwRZ//////9ZhP//AP//hFn//////1kEu////7sEAARZhFkEAA==",88:"AEfE68RHAEf8/////EfE///////E6///AP//68T//////8RH/P////xHAEfE68RHAA=="};function k(t,e,n,o,s,r){const{w:a,h:c,border:i,offset:l,margin:f}=g(n,r),u=function(t,e){const n=t.set+t.size*e;return A.get(n)}(n,o);t.canvas.width=a*o,t.canvas.height=c*o,t.save(),t.scale(o,o);const d="classic"==n.bg,m=s||d;t.translate(l.x,l.y);for(let s=0;s<n.h;s++)for(let r=0;r<n.w;r++)m||z(t,s,r,n),P(t,u,s,r,e[s*n.w+r],n,o);if(t.restore(),d&&!s){!function(t,e,n){const o=t.canvas;v.width=b.width=o.width,v.height=b.height=o.height,x.drawImage(o,0,0),t.save(),t.fillStyle="white",t.fillRect(0,0,o.width,o.height),t.globalCompositeOperation="destination-in",t.drawImage(b,0,0),t.restore(),t.save();const s=function(t){if("string"==typeof y[t]){const e=atob(y[t]),n=[];for(let t=0;t<e.length;t++)n.push(e.charCodeAt(t));y[t]=n}return y[t]}(e*n),r=Math.sqrt(s.length),a=(r-1)/2;for(let e=0;e<r;e++)for(let n=0;n<r;n++){const c=s[n*r+e];0!=c&&(t.globalAlpha=c/255,E.drawImage(o,e-a,n-a))}t.restore()}(t,n.size,o),t.save(),t.scale(o,o),t.translate(l.x,l.y);for(let e=0;e<n.h;e++)for(let o=0;o<n.w;o++)z(t,e,o,n);t.restore(),t.drawImage(v,0,0),t.drawImage(v,0,0),t.drawImage(v,0,0),t.drawImage(b,0,0)}t.scale(o,o),void 0===r&&n.coordinates&&(t.save(),t.translate(l.x,l.y),function(t,e,n){const{size:o,w:s,h:r}=e;t.font="15px sans-serif",t.strokeStyle="black",t.lineWidth=2,t.fillStyle="white",t.lineJoin="round";for(let e=0;e<r;e++){const s=(e+1).toString(),a=t.measureText(s),c=o*(r-e)-(o-10)/2,i=(h-a.width)/2-h-n;t.strokeText(s,i,c),t.fillText(s,i,c)}for(let e=0;e<s&&e<26;e++){const s=String.fromCharCode(97+e),a=t.measureText(s),c=o*r+h+n-5,i=o*e+(o-a.width)/2;t.strokeText(s,i,c),t.fillText(s,i,c)}}(t,n,i.size),t.restore()),s||function(t,e,n,o,s){t.save(),t.translate(s.x,0),n-=s.x,o-=s.y;let r=0;for(let s=0;s<e.array.length;s++){const a=e.array[s];if(t.strokeStyle=s%2?"white":"black",0==a)continue;t.lineWidth=a;const c=e.size-r-a/2;t.strokeRect(c,c,n-2*c,o-2*c),r+=a}t.restore()}(t,i,a,c,f)}function P(t,e,n,o,r,a,c){void 0===r&&(r="");const{size:i}=a,l=r&&r.startsWith("-");l&&(r=r.substring(1));const f=r.match(/^\*(\d)/);let h=f&&f[1]||void 0;void 0!==h&&(r=r.substring(2)),h=Number(h)%4,a.SN&&(r=function(t,e,n){return t.match(/^-?(\*\d)?[sng]$/i)?(e?(n&&(t=t.replace("s","g").replace("S","G")),t=t.replace("n","s").replace("N","S")):(n&&(t=t.replace("s","n").replace("S","N")),t=t.replace("g","s").replace("G","S")),t):t}(r,!1,!0));const g=r.toLowerCase(),u=w.indexOf(g),d=r.startsWith("'");if(u<0&&!d)return;t.save();const A=a.blackWhite,m=l?A?0:2:r==g?0:1,p=l&&A?"n"==g?a.knightOffset:.5:1,[b,x]=[h+1&2?1:0,2&h?1:0];if(t.translate((o+b)*i,(n+x)*i),0!==h&&t.rotate(Math.PI/2*h),d){!function(t,e,n){t.save();const o=s.test(e),r=n-4;t.font="".concat(r,"px sans-serif");const a=n-2;let c=t.measureText(e);if(o&&c.width>a){const n=a/c.width;t.font="".concat(r*n,"px sans-serif"),c=t.measureText(e)}const i=function(t){return t.actualBoundingBoxAscent-t.actualBoundingBoxDescent}(o?t.measureText("M"):c),l=(n-Math.min(c.width,a))/2,f=Math.max((n-i)/2,0);t.fillStyle="black",t.fillText(e,l,n-f,a),t.restore()}(t,r.substring(r.startsWith("''")?2:1),i)}else t.drawImage(e,m*i*c,u*i*c,i*p*c,i*c,0,0,i*p,i),l&&A&&t.drawImage(e,(1+p)*i*c,u*i*c,i*(1-p)*c,i*c,i*p,0,i*(1-p),i);t.restore()}function z(t,e,n,o){const s=function(t,e,n){if("mono"==t)return 1;let o=(e+n)%2;return"inverted"!=t&&(o=1-o),o}(o.pattern,e,n),r=o.size;if(t.save(),t.translate(n*r,e*r),"classic"==o.bg){if(t.strokeStyle="black",t.lineWidth=r/60,t.fillStyle="#fff",t.fillRect(0,0,r,r),!s){t.beginPath();const e=r/7.5;for(let n=0;n<r;n+=e)t.moveTo(r-n,0),t.lineTo(0,r-n),n>0&&(t.moveTo(n,r),t.lineTo(r,n));t.stroke()}}else t.fillStyle=function(t,e){return"classic"==e?"none":"gray"==e?t?"#fff":"#bbb":"green"==e?t?"#EEEED2":"#769656":t?"#FFCE9E":"#D18B47"}(s,o.bg),t.fillRect(0,0,r,r);t.restore()}var S=document.getElementById("CN"),N=S.getContext("2d"),M=Math.min(2,Math.floor(devicePixelRatio));parent.postMessage(null,"*"),onmessage=async t=>{if(t.source!=parent||!t.ports[0])return;gtag("event","fen_sdk_gen");const e=f(t.data.options),n=t.data.fen||"8/8/8/8/8/8/8/8",{w:o,h:s}=function(t){const e=t.match(r)||[],n=[0];let o=0;for(const t of e)"/"==t?n[++o]=0:t.match(/^\d+$/)?n[o]+=Number(t):n[o]++;const s=n.length;if(1==s)return;const a=n[0];for(const t of n)if(t!=a)return;return{w:a,h:s}}(n)||e,a=function(t,e=8,n=8){const o=t.match(r)||[],s=[];let a=!1;for(const t of o){if("/"==t){if(!a){const t=s.length+e-s.length%e;for(;s.length<t;)s.push("")}}else if(t.match(/^\d+$/)){const e=Number(t);for(let t=0;t<e;t++)s.push("")}else s.push(t);if(a="/"!=t&&s.length%e==0,s.length==e*n)break}for(;s.length<e*n;)s.push("");return s}(n,o,s);e.w=o,e.h=s,await m("../assets",e,M);const c=function(t,e){const{w:n,h:o}=g(e);return S.width=n*M,S.height=o*M,S.style.width=n+"px",S.style.height=o+"px",k(N,t,e,M),S}(a,e);t.ports[0].postMessage(c.toDataURL())}})();