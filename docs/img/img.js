(()=>{var e={uncolored:!1,inverted:!1,grayBG:!1,blackWhite:!1,knightOffset:.6,SN:!1,size:44,set:"1echecs"},t=[26,32,38,44],s=["1echecs","alpha","goodCompanion","merida","skak"];var n=/\/|\d|\(!?[kqbnrp]\d?\)|[-~]?(\*\d)?([kqbsnrpcx]|'[^']|''..)|./giu;var a="０１２３４５６７８９".split(""),r=function(){const e=new Map,t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ,./<>?;':\"[]\\{}|!@#$%^&*()_+-=`~".split(""),s="ａｂｃｄｅｆｇｈｉｊｋｌｍｎｏｐｑｒｓｔｕｖｗｘｙｚＡＢＣＤＥＦＧＨＩＪＫＬＭＮＯＰＱＲＳＴＵＶＷＸＹＺ，．／＜＞？；’：”〔〕＼｛｝｜！＠＃＄％︿＆＊（）ˍ＋－＝‘～".split("");for(let n=0;n<t.length;n++)e.set(t[n],s[n]);for(let t=0;t<10;t++)e.set(t.toString(),a[t]);return e}();var o=["k","q","b","n","r","p","c","x"];function i(e,t,s,n,a,i,c){const l=c.size,f=a.startsWith("-");f&&(a=a.substring(1));const h=a.match(/^\*(\d)/);let g=h&&h[1]||void 0;void 0!==g&&(a=a.substring(2)),g=Number(g)%4,"s"==a&&(a="n"),"S"==a&&(a="N");const u=a.toLowerCase(),d=o.indexOf(u),m=a.startsWith("'");if((d<0||c.grayBG)&&2!=i&&function(e,t,s,n,a){const r=a.size;e.save(),a.grayBG?e.fillStyle=n?"#fff":"#bbb":e.fillStyle=n?"#FFCE9E":"#D18B47";e.fillRect(s*r+1,t*r+1,r,r),e.restore()}(e,s,n,i,c),d<0&&!m)return;e.save(),c.grayBG&&(i=2);const b=c.blackWhite,k=f?b?0:2:a==u?0:1,v=f&&b?"n"==u?c.knightOffset:.5:1,[p,B]=[g+1&2?1:0,2&g?1:0];if(e.translate((n+p)*l+1,(s+B)*l+1),0!==g&&e.rotate(Math.PI/2*g),m){const t=a.substring(1);!function(e,t,s){e.fillStyle="black";const n=e.measureText(t),a=n.actualBoundingBoxAscent-n.actualBoundingBoxDescent,r=Math.max((s-n.width)/2,0),o=Math.max((s-a)/2,0);e.fillText(t,r,s-o,s)}(e,a.startsWith("''")?a.substring(2):(x=t,((y=!1)&&"c"==x.toLowerCase()?"‧":y&&"x"==x.toLowerCase()?"╳":r.get(x))||t),l)}else e.drawImage(t,(k+3*i)*l,d*l,l*v,l,0,0,l*v,l),f&&b&&e.drawImage(t,(1+v+3*i)*l,d*l,l*(1-v),l,l*v,0,l*(1-v),l);var x,y;e.restore()}var c=document.getElementById("CN"),l=c.getContext("2d");var f=new URL(location.href),h=function(e){const t=e.match(n)||[],s=[];let a=!1;for(const e of t){if("/"==e){if(!a){const e=s.length+8-s.length%8;for(;s.length<e;)s.push("")}}else if(e.match(/^\d$/)){const t=Number(e);for(let e=0;e<t;e++)s.push("")}else s.push(e);a="/"!=e&&s.length%8==0}for(;s.length<64;)s.push("");return s}(f.searchParams.get("fen")||"8/8/8/8/8/8/8/8"),g=function(n){const a=Object.assign({},e),r=Number(n.size);t.includes(r)&&(a.size=r),s.includes(n.set)&&(a.set=n.set),0<n.knightOffset&&n.knightOffset<1&&(a.knightOffset=n.offset);for(const e of["uncolored","inverted","grayBG","blackWhite"])n[e]&&(a[e]=!0);return a}({size:f.searchParams.get("size"),set:f.searchParams.get("set"),knightOffset:f.searchParams.get("knightOffset"),uncolored:f.searchParams.has("uncolored"),inverted:f.searchParams.has("inverted"),grayBG:f.searchParams.has("grayBG"),blackWhite:f.searchParams.has("blackWhite")}),u=new Image;u.onload=()=>function(e,t,s){const n=8*s.size+2;c.width=c.height=n,l.fillStyle="black",l.fillRect(0,0,n,n),l.font=s.size-4+"px arial";for(let n=0;n<8;n++)for(let a=0;a<8;a++){const r=s.uncolored||s.inverted==Boolean((n+a)%2)?1:0;i(l,e,n,a,t[8*n+a],r,s)}return c}(u,h,g),u.src=`../assets/${g.set}${g.size}.png`})();