(()=>{var e="０１２３４５６７８９".split(""),t=function(){const t=new Map,s="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ,./<>?;':\"[]\\{}|!@#$%^&*()_+-=`~".split(""),n="ａｂｃｄｅｆｇｈｉｊｋｌｍｎｏｐｑｒｓｔｕｖｗｘｙｚＡＢＣＤＥＦＧＨＩＪＫＬＭＮＯＰＱＲＳＴＵＶＷＸＹＺ，．／＜＞？；’：”〔〕＼｛｝｜！＠＃＄％︿＆＊（）ˍ＋－＝‘～".split("");for(let e=0;e<s.length;e++)t.set(s[e],n[e]);for(let s=0;s<10;s++)t.set(s.toString(),e[s]);return t}();var s=["k","q","b","n","r","p","c","x"];function n(e,n,a,r,o,i,l){const c=l.size,f=o.startsWith("-");f&&(o=o.substring(1));const h=o.match(/^\*(\d)/);let g=h&&h[1]||void 0;void 0!==g&&(o=o.substring(2)),g=Number(g)%4,"s"==o&&(o="n"),"S"==o&&(o="N");const u=o.toLowerCase(),d=s.indexOf(u),m=o.startsWith("'");if((d<0||l.grayBG)&&2!=i&&function(e,t,s,n,a){const r=a.size;e.save(),a.grayBG?e.fillStyle=n?"#fff":"#bbb":e.fillStyle=n?"#FFCE9E":"#D18B47";e.fillRect(s*r+1,t*r+1,r,r),e.restore()}(e,a,r,i,l),d<0&&!m)return;e.save(),l.grayBG&&(i=2);const b=l.blackWhite,v=f?b?0:2:o==u?0:1,p=f&&b?"n"==u?l.knightOffset:.5:1,[k,x]=[g+1&2?1:0,2&g?1:0];if(e.translate((r+k)*c+1,(a+x)*c+1),0!==g&&e.rotate(Math.PI/2*g),m){const s=o.substring(1);!function(e,t,s){e.fillStyle="black";const n=e.measureText(t),a=n.actualBoundingBoxAscent-n.actualBoundingBoxDescent,r=Math.max((s-n.width)/2,0),o=Math.max((s-a)/2,0);e.fillText(t,r,s-o,s)}(e,o.startsWith("''")?o.substring(2):(B=s,((w=!1)&&"c"==B.toLowerCase()?"‧":w&&"x"==B.toLowerCase()?"╳":t.get(B))||s),c)}else e.drawImage(n,(v+3*i)*c,d*c,c*p,c,0,0,c*p,c),f&&b&&e.drawImage(n,(1+p+3*i)*c,d*c,c*(1-p),c,c*p,0,c*(1-p),c);var B,w;e.restore()}var a=/\/|\d|\(!?[kqbnrp]\d?\)|[-~]?(\*\d)?([kqbsnrpcx]|'[^']|''..)|./giu;var r={uncolored:!1,inverted:!1,grayBG:!1,blackWhite:!1,knightOffset:.6,SN:!1,size:44,set:"1echecs"},o=new URL(location.href),i=function(e){const t=e.match(a)||[],s=[];let n=!1;for(const e of t){if("/"==e){if(!n){const e=s.length+8-s.length%8;for(;s.length<e;)s.push("")}}else if(e.match(/^\d$/)){const t=Number(e);for(let e=0;e<t;e++)s.push("")}else s.push(e);n="/"!=e&&s.length%8==0}for(;s.length<64;)s.push("");return s}(o.searchParams.get("fen")||"8/8/8/8/8/8/8/8"),l=Number(o.searchParams.get("size"));[26,32,38,44].includes(l)&&(r.size=l);var c=o.searchParams.get("set");["1echecs","alpha","goodCompanion","merida","skak"].includes(c)&&(r.set=c);var f=Number(o.searchParams.get("knightOffset"));0<f&&f<1&&(r.knightOffset=f);for(const e of["uncolored","inverted","grayBG","blackWhite","SN"])console.log(e,o.searchParams.has(e)),o.searchParams.has(e)&&(r[e]=!0);var h=document.getElementById("CN"),g=h.getContext("2d");h.width=h.height=8*r.size+2;var u=new Image;u.onload=function(){const e=8*r.size+2;g.fillStyle="black",g.fillRect(0,0,e,e),g.font=r.size-4+"px arial";for(let e=0;e<8;e++)for(let t=0;t<8;t++){const s=r.uncolored||r.inverted==Boolean((e+t)%2)?1:0;n(g,u,e,t,i[8*e+t],s,r)}},u.src=`../assets/${r.set}${r.size}.png`})();