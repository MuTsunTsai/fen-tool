<!DOCTYPE html>
<html>

<head>
	<title>FEN Visualization</title>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, width=device-width, user-scalable=no">
	<meta name="description" content="Quick online tool for editing FEN.">

	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-4GYC00FPRR"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag() { dataLayer.push(arguments); }
		gtag('js', new Date());
		gtag('config', 'G-4GYC00FPRR');
	</script>

	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
	<link href="style.css" rel="stylesheet">

	<script src="https://unpkg.com/petite-vue@0.4.1/dist/petite-vue.iife.js" defer></script>
	<script src="main.js" defer></script>
</head>

<body class="m-3" v-scope>

	<template id="checkbox">
		<div class="form-check">
			<input type="checkbox" class="form-check-input" :id="id" :checked="checked()" @change="change">
			<label class="form-check-label" :for="id">{{ label }}</label>
		</div>
	</template>

	<div class="text-center">
		<div class="d-inline-block text-start">
			<div class="row gx-3">
				<label class="col-auto col-form-label">FEN:</label>
				<div class="col">
					<input type="text" class="form-control" id="FEN" value="8/8/8/8/8/8/8/8" onchange="toSquares(true)">
				</div>
				<div class="col-auto">
					<button class="btn btn-secondary" title="Copy" onclick="copyFEN()">
						<i class="fa-solid fa-clipboard"></i>
					</button>
					<button class="btn btn-secondary" title="Paste" onclick="pasteFEN()">
						<i class="fa-solid fa-paste"></i>
					</button>
				</div>
			</div>

			<br>

			<div class="d-flex mb-3" style="flex-wrap: wrap-reverse; gap:0 3rem;">
				<div class="flex-grow-1 mb-4">
					<div id="S"></div>
				</div>
				<div class="flex-grow-0 mb-4">
					<canvas id="CN" style="cursor:pointer;"></canvas>
					<canvas id="TP" class="ms-4" style="cursor:pointer;">
				</div>
			</div>

			<div v-scope v-cloak width="100%" v-effect="saveSettings()">
				<ul class="nav nav-tabs mb-3">
					<li class="nav-item">
						<div class="nav-link" :class="{active:tab==0}" @click="tab=0">General</div>
					</li>
					<li class="nav-item">
						<div class="nav-link" :class="{active:tab==1}" @click="tab=1">PDB tool</div>
					</li>
					<li class="nav-item">
						<div class="nav-link" :class="{active:tab==2}" @click="tab=2">BBS tool</div>
					</li>
				</ul>

				<div style="position: relative;">
					<section class="pb-4" v-visible="tab==0">
						<div class="mb-3">
							<div class="d-inline-block">
								<button type="button" class="btn btn-secondary"
										onClick="FEN.value='8/8/8/8/8/8/8/8'; toSquares();">
									<i class="fa-solid fa-trash-can"></i>&ensp;Empty board
								</button>
								<button type="button" class="btn btn-secondary"
										onClick="FEN.value='rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR'; toSquares();">
									<i class="fa-solid fa-flag-checkered"></i> &ensp;Starting position
								</button>
							</div><br>
							<div class="d-inline-block">
								<button type="button" class="btn btn-secondary" onClick="rotate(-1)">
									<i class="fa-solid fa-rotate-left"></i>&ensp;Rotate CCW
								</button>
								<button type="button" class="btn btn-secondary" onClick="rotate(1)">
									<i class="fa-solid fa-rotate-right"></i>&ensp;Rotate CW
								</button>
							</div>
							<div class="d-inline-block">
								<input type="button" class="btn btn-secondary" value="All Black" onClick="color(-1)">
								<input type="button" class="btn btn-secondary" value="All Neutral" onClick="color(0)">
								<input type="button" class="btn btn-secondary" value="All White" onClick="color(1)">
							</div>
							<div class="d-inline-block">
								<input type="button" class="btn btn-secondary" value="Switch side" onClick="invertColor(false)">
								<input type="button" class="btn btn-secondary" value="Switch case" onClick="invertColor(true)">
							</div>
						</div>
						<div class="row gx-3 mb-3">
							<div class="col-12 col-sm-6 mb-2">
								<div v-scope="Checkbox('board.uncolored', 'Uncolored chessboard', draw)"></div>
								<div v-scope="Checkbox('board.inverted', 'Reverse square color', draw)"></div>
								<div v-scope="Checkbox('board.SN', 'Use S for knight', updateSN)"></div>
								<div v-scope="Checkbox('board.grayBG', 'Gray background', updateBG)"></div>
								<div v-scope="Checkbox('board.blackWhite', 'Black/White neutral piece', drawTemplate)"></div>
								<div class="row align-items-center" v-show="store.board.blackWhite">
									<label class="col-auto col-form-label">Knight offset</label>
									<div class="col">
										<input type="range" class="form-range" min="0" max="1" step="0.05"
											   v-model.number="store.board.knightOffset" @input="drawTemplate()">
									</div>
								</div>
							</div>
							<div class="col-12 col-sm-6">
								<div class="row gx-3 mb-2">
									<label class="col-auto col-form-label">Chess set:</label>
									<div class="col">
										<select class="form-select" v-model="store.board.set" onchange="load(this.value)">
											<option value="1echecs">1Echecs</option>
											<option value="goodCompanion">Good Companion</option>
											<option value="merida">Merida</option>
											<option value="skak">Skak</option>
										</select>
									</div>
								</div>
								<div class="row gx-3">
									<label class="col-auto col-form-label">Square size:</label>
									<div class="col">
										<select class="form-select" v-model.number="store.board.size"
												onchange="setSize(Number(this.value))">
											<option value="26">26</option>
											<option value="32">32</option>
											<option value="38">38</option>
											<option value="44">44</option>
										</select>
									</div>
								</div>
							</div>
						</div>
						<div class="text-end">
							<button type="button" class="btn btn-secondary" id="B64" onClick="toBase64()">
								<i class="fa-solid fa-clipboard"></i>&ensp;Copy base64 link
							</button>
							<div class="d-inline-block">
								<button class="btn btn-primary" onclick="share()">
									<i class="fa-solid fa-share-nodes"></i>&ensp;Share image
								</button>
								<a class="btn btn-primary" download="board.png" id="Save">
									<i class="fa-solid fa-download"></i>&ensp;Save image
								</a>
							</div>
						</div>
					</section>

					<section v-visible="tab==1">
						<div class="row gx-3 mb-3">
							<label class="col-12 col-sm-auto col-form-label">PDB No:</label>
							<div class="col">
								<input type="text" class="form-control" id="PDB">
							</div>
							<div class="col-auto">
								<input type="button" id="PDB_GET" class="btn btn-primary" value="Get FEN" onclick="getPDB_FEN()">
							</div>
						</div>
						<div class="text-end">
							<button class="btn btn-secondary" onclick="copyPDB()">
								<i class="fa-solid fa-clipboard"></i>&ensp;Copy PDB position search query
							</button>
							<button class="btn btn-primary" onclick="searchPDB()">
								<i class="fa-solid fa-magnifying-glass"></i>&ensp;Search this position in PDB
							</button>
						</div>
					</section>

					<section v-visible="tab==2">
						<div class="row gx-3">
							<div class="col-12 col-sm-8 mb-3">
								<div v-scope="Checkbox('BBS.PDB', 'Include PDB ID')"></div>
								<div v-scope="Checkbox('BBS.coordinates', 'Include Coordinates')"></div>
								<div v-scope="Checkbox('BBS.notes', 'Include Notes')"></div>
								<div v-scope="Checkbox('BBS.uncoloredNotes', 'Uncolored Note')"></div>
								<div v-scope="Checkbox('BBS.redBlue', 'Use Red and Blue in BBS Code')"></div>
							</div>
							<div class="col-12 col-sm-4 text-end">
								<button type="button" class="btn btn-primary" onclick="generateBBS()">
									<i class="fa-solid fa-clipboard"></i>&ensp;Copy BBS Code
								</button>
							</div>
						</div>
					</section>
				</div>
			</div>

			<hr>
			<div class="mb-5 row small">
				<div class="col-12 col-md">
					For more information, see <a href="https://github.com/MuTsunTsai/fen-tool" target="_blank">README</a> of
					this tool on GitHub.
				</div>
				<div class="col-auto text-end">Copyright Â© 2023 Mu-Tsun Tsai</div>
			</div>	
		</div>
	</div>
	
	<canvas id="CanvasGhost" class="ghost" width="210" height="210"></canvas>
	<canvas id="TemplateGhost" class="ghost"></canvas>
</body>

</html>